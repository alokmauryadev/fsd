const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/vendor.DwUKJXLy.js","js/vendor-firebase.C18sCpyG.js","js/monkeytype-packages.DhEhHx1h.js"])))=>i.map(i=>d[i]);
import"./modulepreload-polyfill.DSS5IYso.js";import{e as ft,a as ge,p as Wa,c as ie,t as lt,b as js,s as J,h as K,d as xo,f as Le,g as nn,r as Pa,i as Ry,j as Fk,k as Rk,m as ir,z as Dk,n as _o,o as rn,q as Wk,u as Dy,v as Wy,w as Py,x as gi,y as Pk,A as Ga,B as zk,C as Hk,D as Cr,E as gs,F as Io,G as Ok,H as ln,I as Nk,J as Uk,K as Vk,L as Kk,M as Gk,N as pg,O as jk,P as Qk,Q as mg,R as vd,S as Yk,T as Xk,U as yp}from"./misc.S-WMW7u4.js";/* empty css              */import{$ as i}from"./vendor-jquery.DXUl38o6.js";import{h as V,y as Qt,s as Zk,t as Zu,e as Jk,S as eS,a as zy,g as nr,x as Tc,f as Ce,c as kr,b as Hy,d as wd,i as tS,E as kn,j as Jl,T as sl,M as il,C as Oy,k as ec,V as oS,N as Ct,l as Ny,m as aS,n as rr,o as gu,p as Uy,q as sS,r as iS,z as bp,u as nS,v as Ju,w as _l,I as rS,A as lS,B as Cd,D as Lc,F as Vy,G as Ky,H as cS,J as kd,K as dS,L as uS,O as fS,P as pS,Q as mS,R as gS,U as hS,W as yS,X as bS,Y as vS,Z as wS,_ as CS}from"./monkeytype-packages.DhEhHx1h.js";import{d as It,b as kS,t as SS,U as Vo,e as xS,s as TS,c as ef,f as LS,j as Hi,k as $S,m as MS,n as AS,p as ES,q as te,r as gg,u as _S,v as hg,w as IS,x as BS,z as D,y as nt,H as $c,C as mo,B as qS,A as FS,D as RS,E as DS,L as WS,F as PS,G as zS,P as HS,S as OS,T as NS,I as US,J as VS,K as KS,M as GS,N as jS,O as yg,Q as Gy,R as QS,V as YS,W as st,X as jy,Y as Qy,_ as Yy,$ as XS,a0 as ZS,a1 as Xy,a2 as JS,a3 as e1,a4 as Zy,a5 as t1,a6 as bg,a7 as o1,a8 as a1,a9 as Jy,aa as vg,ab as s1,ac as i1}from"./vendor.DwUKJXLy.js";import{g as n1,i as r1,a as l1,b as c1,c as d1,o as u1,s as f1,d as p1,e as m1,f as g1,h as h1,j as y1,k as vp,l as b1,F as v1,m as w1,n as C1,G as k1,p as S1,q as x1,u as eb,t as wp,E as tb,v as T1,w as L1,x as $1,y as M1}from"./vendor-firebase.C18sCpyG.js";import{f as A1}from"./firebase-config-live.BtTDvW81.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="f87268f0-d340-4141-b64f-5f2267cd8150",e._sentryDebugIdIdentifier="sentry-dbid-f87268f0-d340-4141-b64f-5f2267cd8150")}catch{}{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:monkeytype-frontend":!0})}const E1="https://api.monkeytype.com",_1="2025.09.24_14.49_f025b121c",I1="6Lc-V8McAAAAAJ7s6LGNe7MBZnRiwbsbiWts87aj",Sn={backendUrl:E1,clientVersion:_1,recaptchaSiteKey:I1},B1="modulepreload",q1=function(e){return"/"+e},wg={},Sd=function(t,o,a){let s=Promise.resolve();if(o&&o.length>0){let l=function(u){return Promise.all(u.map(f=>Promise.resolve(f).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),d=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));s=l(o.map(u=>{if(u=q1(u),u in wg)return;wg[u]=!0;const f=u.endsWith(".css"),p=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${p}`))return;const h=document.createElement("link");if(h.rel=f?"stylesheet":B1,f||(h.as="script"),h.crossOrigin="",h.href=u,d&&h.setAttribute("nonce",d),document.head.appendChild(h),f)return new Promise((g,y)=>{h.addEventListener("load",g),h.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${u}`)))})}))}function n(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return s.then(l=>{for(const c of l||[])c.status==="rejected"&&n(c.reason);return t().catch(n)})};let ob=!0;function hu(e){ob=e}function Qs(){return ob}const ab=[];function F1(e){ab.push(e)}function Cg(){ab.forEach(e=>{try{e()}catch(t){console.error("Banner event subscriber threw an error"),console.error(t)}})}const sb=[];function R1(e){sb.push(e)}function D1(e,t,o){sb.forEach(a=>{try{a(e,t,o)}catch(s){console.error("Notification event subscriber threw an error"),console.error(s)}})}function Ys(e){return e*parseFloat(getComputedStyle(document.documentElement).fontSize)}function yu(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}function kg(e){const t=["","thousand","million","billion","trillion","quadrillion","quintillion","sextillion","septillion","octillion","nonillion","decillion"];let o=0,a=e;for(;a>=1e3;)a/=1e3,o++;const s=t[o]??"unknown";return{rounded:Math.round(a),roundedTo2:V(a),orderOfMagnitude:s}}function Mc(e,t=1){if(e<1e3)return e.toFixed(t);const o=Math.floor(Math.log(e)/Math.log(1e3)),a="kmbtqQsSond".charAt(o-1);return(e/Math.pow(1e3,o)).toFixed(t)+a}function W1(e){let t=0,o=0,a=0,s=0,n=0,l=0,c=0;const d=e.length;if(d===0)return null;for(let g=0;g<d;g++)l=g+1,c=e[g],t+=l,o+=c,s+=l*l,a+=l*c,n++;const u=(n*a-t*o)/(n*s-t*t),f=o/n-u*t/n,p=[1,1*u+f],h=[d,d*u+f];return[p,h]}function Sg(e,t=10){return e!=null?parseInt(e,t):void 0}function tf(){const e=i("#bannerCenter").height();i("#app").css("padding-top",e+Ys(2)+"px"),i("#notificationCenter").css("margin-top",e+"px")}let cn=0,P1=0;class Cp{constructor(t,o,a,s,n,l,c,d=()=>{},u){this.type=t,this.message=u?o:ft(o),this.level=a,this.important=s??!1,t==="banner"||t==="psa"?this.duration=n:n===void 0?a===-1?this.duration=0:this.duration=3e3:this.duration=n*1e3,this.customTitle=l,this.customIcon=c,this.id=P1++,this.closeCallback=d}show(){let t="notice",o='<i class="fas fa-info-circle"></i>',a="Notice";if(this.level===1?(t="good",o='<i class="fas fa-check-circle"></i>',a="Success"):this.level===-1&&(t="bad",o='<i class="fas fa-times-circle"></i>',a="Error"),this.important&&(t+=" important"),this.customTitle!==void 0&&(a=this.customTitle),(this.type==="banner"||this.type==="psa")&&(o='<i class="fas fa-fw fa-bullhorn"></i>'),this.customIcon!==void 0&&(o=`<i class="fas fa-fw fa-${this.customIcon}"></i>`),this.type==="notification"){this.duration===0&&(cn++,Ac());const s=i("#notificationCenter .history").height();i("#notificationCenter .history").prepend(`

          <div class="notif ${t}" id=${this.id}>
              <div class="message"><div class="title"><div class="icon">${o}</div>${a}</div>${this.message}</div>
          </div>

          `);const n=i("#notificationCenter .history").height();i(`#notificationCenter .notif[id='${this.id}']`).remove(),i("#notificationCenter .history").css("margin-top",0).animate({marginTop:n-s},ge(125),()=>{i("#notificationCenter .history").css("margin-top",0),i("#notificationCenter .history").prepend(`

                  <div class="notif ${t}" id=${this.id}>
                      <div class="message"><div class="title"><div class="icon">${o}</div>${a}</div>${this.message}</div>
                  </div>

              `),i(`#notificationCenter .notif[id='${this.id}']`).css("opacity",0).animate({opacity:1},ge(125),()=>{i(`#notificationCenter .notif[id='${this.id}']`).css("opacity","")}),i(`#notificationCenter .notif[id='${this.id}']`).on("click",()=>{this.hide(),this.closeCallback(),this.duration===0&&cn--,Ac()})}),i(`#notificationCenter .notif[id='${this.id}']`).on("hover",()=>{i(`#notificationCenter .notif[id='${this.id}']`).toggleClass("hover")})}else if(this.type==="banner"||this.type==="psa"){let s=`<div class="icon lefticon">${o}</div>`,n=!1;/images\/.*/.test(this.customIcon)&&(n=!0,s=`<div class="icon lefticon"><i class="fas fa-fw fa-bullhorn"></i></div><div class="image" style="background-image: url(${this.customIcon})"></div>`),i("#bannerCenter").prepend(`
        <div class="${this.type} ${t} content-grid ${n?"withImage":""}" id="${this.id}">
        <div class="container">
          ${s}
          <div class="text">
            ${this.message}
          </div>
          ${this.duration>=0?`
          <div class="closeButton">
            <i class="fas fa-fw fa-times"></i>
          </div>
          `:`<div class="righticon">${o}</div>`}
        </div>
      </div>
      `),tf(),Cg(),this.duration>=0&&i(`#bannerCenter .banner[id='${this.id}'] .closeButton, #bannerCenter .psa[id='${this.id}'] .closeButton`).on("click",()=>{this.hide(),this.closeCallback()}),/please (<a.*>)?refresh/i.test(this.message)&&(i(`#bannerCenter .banner[id='${this.id}'], #bannerCenter .psa[id='${this.id}']`).addClass("clickable"),i(`#bannerCenter .banner[id='${this.id}'], #bannerCenter .psa[id='${this.id}']`).on("click",()=>{window.location.reload()}))}this.duration>0&&setTimeout(()=>{this.hide()},this.duration+250)}hide(){this.type==="notification"?i(`#notificationCenter .notif[id='${this.id}']`).css("opacity",1).animate({opacity:0},ge(125),()=>{i(`#notificationCenter .notif[id='${this.id}']`).animate({height:0},ge(125),()=>{i(`#notificationCenter .notif[id='${this.id}']`).remove()})}):(this.type==="banner"||this.type==="psa")&&i(`#bannerCenter .banner[id='${this.id}'], #bannerCenter .psa[id='${this.id}']`).css("opacity",1).animate({opacity:0},ge(125),()=>{i(`#bannerCenter .banner[id='${this.id}'], #bannerCenter .psa[id='${this.id}']`).remove(),tf(),Cg()})}}function Ac(){cn>1?(i("#notificationCenter .clearAll").removeClass("invisible"),i("#notificationCenter .clearAll").slideDown(125)):cn<1&&(i("#notificationCenter .clearAll").addClass("invisible"),i("#notificationCenter .clearAll").slideUp(125))}function m(e,t=0,o={}){D1(e,t,o.customTitle),new Cp("notification",e,t,o.important,o.duration,o.customTitle,o.customIcon,o.closeCallback,o.allowHTML).show()}function z1(e,t=-1,o="bullhorn",a=!1,s,n){const l=new Cp("banner",e,t,!1,a?-1:0,void 0,o,s,n);return l.show(),l.id}function Hs(e,t=-1,o="bullhorn",a=!1,s,n){const l=new Cp("psa",e,t,!1,a?-1:0,void 0,o,s,n);return l.show(),l.id}function H1(){i("#notificationCenter .notif").remove(),cn=0,Ac()}const O1=It(100,tf);i(window).on("resize",()=>{O1()});i("#notificationCenter .clearAll").on("click",()=>{i("#notificationCenter .notif.bad").each((e,t)=>{var o;(o=i(t)[0])==null||o.click()}),cn=0,Ac()});const ib=[];function N1(e){ib.push(e)}function U1(e,t){ib.forEach(o=>{try{o(e,t)}catch(a){console.error("Google Sign Up event subscriber threw an error"),console.error(a)}})}let tc,Be,Qi=!1,oc;const{promise:V1,resolve:K1}=Wa();async function G1(e){try{oc=e,tc=c1().length===0?r1(A1):l1(),Be=d1(tc);const t=window.localStorage.getItem("firebasePersistence")==="LOCAL";await kp(t,!1),u1(Be,async o=>{Qi||await e(!0,o)}),K1()}catch(t){tc=void 0,Be=void 0,console.error("Authentication failed to initialize",t),await e(!1,null)}}function B(){return(Be==null?void 0:Be.currentUser)!==void 0&&(Be==null?void 0:Be.currentUser)!==null}function go(){return(Be==null?void 0:Be.currentUser)??null}function j1(){return n1(tc)}function Bo(){return Be!==void 0}async function Q1(){console.log("auth signout"),await(Be==null?void 0:Be.signOut())}async function Y1(e,t,o){if(Be===void 0)throw new Error("Authentication uninitialized");await kp(o,!0);const{data:a,error:s}=await Qt(h1(Be,e,t));if(s!==null)throw console.error(s),nb(s,"Failed to sign in with email and password");return a}async function X1(e,t){if(Be===void 0)throw new Error("Authentication uninitialized");await kp(t,!0),Qi=!0;const{data:o,error:a}=await Qt(y1(Be,e));if(a!==null)throw Qi=!1,console.log(a),nb(a,"Failed to sign in with popup");const s=vp(o);s!=null&&s.isNewUser?U1(o,!0):(Qi=!1,await(oc==null?void 0:oc(!0,o.user)))}async function Z1(e,t){if(Be===void 0)throw new Error("Authentication uninitialized");return Qi=!0,await b1(Be,e,t)}async function J1(){const e=go();return e===null?null:g1(e)}async function kp(e,t=!1){if(Be===void 0)throw new Error("Authentication uninitialized");const o=e?p1:m1;t&&window.localStorage.setItem("firebasePersistence",e?"LOCAL":"SESSION"),await f1(Be,o)}function nb(e,t){let o=ie(e,t);return e instanceof v1&&(e.code==="auth/wrong-password"?o="Incorrect password":e.code==="auth/user-not-found"?o="User not found":e.code==="auth/invalid-email"?o="Invalid email format (make sure you are using your email to login - not your username)":e.code==="auth/invalid-credential"?o="Email/password is incorrect or your account does not have password authentication enabled.":e.code==="auth/popup-closed-by-user"?o="":e.code==="auth/popup-blocked"?o="Sign in popup was blocked by the browser. Check the address bar for a blocked popup icon, or update your browser settings to allow popups.":e.code==="auth/user-cancelled"?o="":e.code==="auth/account-exists-with-different-credential"&&(o="Account already exists, but its using a different authentication method. Try signing in with a different method")),new Error(o,{cause:e})}function rb(){Qi=!1}let xg=!1,lb;function ex(e){const t=new AbortController;return setTimeout(()=>t.abort(new Error("request timed out")),e),t.signal}function tx(e){return async t=>{try{const o=await J1();o!==null&&(t.headers.Authorization=`Bearer ${o}`);const a=(AbortSignal==null?void 0:AbortSignal.timeout)===void 0;t.fetchOptions={...t.fetchOptions,signal:a?ex(e):AbortSignal.timeout(e)};const s=await SS(t);s.status>=400&&console.error(`${t.method} ${t.path} failed`,{status:s.status,...s.body});const n=s.headers.get(Zk);if(n!==null&&(lb=parseInt(n)),n!==null&&!xg){const l=parseInt(n);if(l!==Zu){const c=l>Zu?'Looks like the client and server versions are mismatched (backend is newer). Please <a onClick="location.reload(true)">refresh</a> the page.':"Looks like our monkeys didn't deploy the new server version correctly. If this message persists contact support.";Hs(c,1,void 0,!1,void 0,!0),xg=!0}}return s}catch(o){let a="Unknown error";return o instanceof Error&&(o.message.includes("timed out")?a="request took too long to complete":a=o.message),{status:500,body:{message:a},headers:new Headers}}}}function cb(e,t,o=1e4){return kS(e,{baseUrl:t,jsonQuery:!0,api:tx(o),baseHeaders:{Accept:"application/json","X-Client-Version":Sn.clientVersion}})}const db=Sn.backendUrl,ox=cb(Jk,db,1e4),ax=cb(eS,db,24e4),E={...ox,dev:ax},ub=[];function sx(e){ub.push(e)}window.addEventListener("load",()=>{window.addEventListener("online",()=>{Tg(!0)}),window.addEventListener("offline",()=>{Tg(!1)})});function Tg(e){ub.forEach(t=>{try{t(e)}catch(o){console.error("Connection event subscriber threw an error"),console.error(o)}})}let To=!1,Xs=!1,Ee=!1,Wt=null,nl=!0,_s=!1,of=1,ce=0,fb=!0,xd=0,Ro=!1,hi=!1,Ot=!1,de=!1;function pb(e){To=e}function ix(e){Xs=e}function Sp(e){Ee=e}function mb(e){Wt=e}function Lg(e){nl=e}function xp(e){_s=e}function Tp(e){of=e}function nx(e){ce=e}function $g(){ce++}function rx(){ce--}function gb(e){fb=e}function bu(e){xd=e}function lx(e){Ro=e}function cx(e){hi=e}let{promise:dx,resolve:Mg}=Wa();function ac(e){Ot=e,e?{promise:dx,resolve:Mg}=Wa():Mg()}function hb(e){de=e}let Sr=navigator.onLine;function tt(){return Sr}let lr,af=!1;function Td(){af||lr===void 0&&(lr=Hs("No internet connection",0,"exclamation-triangle",!1,()=>{af=!0,lr=void 0}))}const ux=It(5e3,()=>{Sr?(lr!==void 0&&(m("You're back online",1,{customTitle:"Connection"}),i(`#bannerCenter .psa.notice[id="${lr}"] .closeButton`).trigger("click")),af=!1):Ee||Td()});sx(e=>{Sr=e,ux()});window.addEventListener("load",()=>{Sr=navigator.onLine,Sr||Td()});function Ag(e,t){if(Array.isArray(e))return t.length===e.length?void 0:e.filter((o,a)=>!t.includes(a));{const o=Object.entries(e);return t.length===o.length?void 0:Object.fromEntries(o.filter(([a])=>!t.includes(a)))}}function fx(e,t){return t.slice(0,-1).reduce((o,a)=>o[a],e)}function Lp(e,t){let a,s=structuredClone(t);for(let l=0;l<=2;l++){if(a=e.safeParse(s),a.success)return a.data;if(l===2)break;const c=a.error.errors.reduce((d,{path:u})=>{const f=u.slice(0,-1).join("."),p=u.at(-1);return p!==void 0&&d.set(f,[...d.get(f)??[],p]),d},new Map);for(const[d,u]of c.entries())if(d==="")s=Ag(s,u)??(Array.isArray(s)?[]:{});else{const f=d.split("."),p=fx(s,f),h=f.at(-1),g=Ag(p[h],u);g===void 0?delete p[h]:p[h]=g}}const n=a==null?void 0:a.error.errors.map(l=>`${l.path.join(".")}: ${l.message}`).join(", ");throw new Error("unable to sanitize: "+n)}const px={theme:"serika_dark",themeLight:"serika",themeDark:"serika_dark",autoSwitchTheme:!1,customTheme:!1,customThemeColors:["#323437","#e2b714","#e2b714","#646669","#2c2e31","#d1d0c5","#ca4754","#7e2a33","#ca4754","#7e2a33"],favThemes:[],showKeyTips:!0,smoothCaret:"medium",codeUnindentOnBackspace:!1,quickRestart:"off",punctuation:!1,numbers:!1,words:50,time:30,mode:"time",quoteLength:[1],language:"english",fontSize:2,freedomMode:!1,difficulty:"normal",blindMode:!1,quickEnd:!1,caretStyle:"default",paceCaretStyle:"default",flipTestColors:!1,layout:"default",funbox:[],confidenceMode:"off",indicateTypos:"off",timerStyle:"mini",liveSpeedStyle:"off",liveAccStyle:"off",liveBurstStyle:"off",colorfulMode:!1,randomTheme:"off",timerColor:"main",timerOpacity:"1",stopOnError:"off",showAllLines:!1,keymapMode:"off",keymapStyle:"staggered",keymapLegendStyle:"lowercase",keymapLayout:"overrideSync",keymapShowTopRow:"layout",keymapSize:1,fontFamily:"Roboto_Mono",smoothLineScroll:!1,alwaysShowDecimalPlaces:!1,alwaysShowWordsHistory:!1,singleListCommandLine:"on",capsLockWarning:!0,playSoundOnError:"off",playSoundOnClick:"off",soundVolume:.5,startGraphsAtZero:!0,showOutOfFocusWarning:!0,paceCaret:"off",paceCaretCustomSpeed:100,repeatedPace:!0,accountChart:["on","on","on","on"],minWpm:"off",minWpmCustomSpeed:100,highlightMode:"letter",typingSpeedUnit:"wpm",ads:"result",hideExtraLetters:!1,strictSpace:!1,minAcc:"off",minAccCustom:90,monkey:!1,repeatQuotes:"off",oppositeShiftMode:"off",customBackground:"",customBackgroundSize:"cover",customBackgroundFilter:[0,1,1,1],customLayoutfluid:["qwerty","dvorak","colemak"],customPolyglot:["english","spanish","french","german"],monkeyPowerLevel:"off",minBurst:"off",minBurstCustomSpeed:100,burstHeatmap:!1,britishEnglish:!1,lazyMode:!1,showAverage:"off",tapeMode:"off",tapeMargin:50,maxLineWidth:0,playTimeWarning:"off"};function Jo(){return structuredClone(px)}function Ld(e){return mx(gx(hx(e)))}function mx(e){const t=Jo(),o={};for(const a of lt(t)){const s=e[a]??t[a];o[a]=s}return o}function gx(e){return Lp(zy.strip(),e)}function hx(e){if(e.quickTab===!0&&e.quickRestart===void 0&&(e.quickRestart="tab"),typeof e.smoothCaret=="boolean"&&(e.smoothCaret=e.smoothCaret?"medium":"off"),e.swapEscAndTab===!0&&e.quickRestart===void 0&&(e.quickRestart="esc"),e.alwaysShowCPM===!0&&e.typingSpeedUnit===void 0&&(e.typingSpeedUnit="cpm"),e.showAverage==="wpm"&&(e.showAverage="speed"),typeof e.playSoundOnError=="boolean"&&(e.playSoundOnError=e.playSoundOnError?"1":"off"),e.showTimerProgress===!1&&e.timerStyle===void 0&&(e.timerStyle="off"),e.showLiveWpm===!0&&e.liveSpeedStyle===void 0){let t="mini";e.timerStyle!=="bar"&&e.timerStyle!=="off"&&(t=e.timerStyle),e.liveSpeedStyle=t}if(e.showLiveBurst===!0&&e.liveBurstStyle===void 0){let t="mini";e.timerStyle!=="bar"&&e.timerStyle!=="off"&&(t=e.timerStyle),e.liveBurstStyle=t}if(e.showLiveAcc===!0&&e.liveAccStyle===void 0){let t="mini";e.timerStyle!=="bar"&&e.timerStyle!=="off"&&(t=e.timerStyle),e.liveAccStyle=t}if(typeof e.soundVolume=="string"&&(e.soundVolume=parseFloat(e.soundVolume)),typeof e.funbox=="string"&&(e.funbox==="none"?e.funbox=[]:e.funbox=e.funbox.split("#")),typeof e.customLayoutfluid=="string"&&(e.customLayoutfluid=e.customLayoutfluid.split("#")),typeof e.indicateTypos=="boolean"&&(e.indicateTypos=e.indicateTypos===!1?"off":"replace"),typeof e.fontSize=="string"){const t=e.fontSize;let o=parseInt(t);t==="125"?o=1.25:t==="15"&&(o=1.5),e.fontSize=o}else e.fontSize!==void 0&&e.fontSize<0&&(e.fontSize=1);if(Array.isArray(e.accountChart)&&e.accountChart.length!==4&&(e.accountChart=["on","on","on","on"]),typeof e.minAccCustom=="number"&&e.minAccCustom>100&&(e.minAccCustom=100),Array.isArray(e.customThemeColors)&&e.customThemeColors.length===9){const t=e.customThemeColors;t.splice(4,0,"#000000"),e.customThemeColors=t}if(Array.isArray(e.customBackgroundFilter)&&e.customBackgroundFilter.length===5){const t=e.customBackgroundFilter;e.customBackgroundFilter=[t[0],t[1],t[2],t[3]]}return typeof e.quoteLength=="number"&&(e.quoteLength===-1?e.quoteLength=[0,1,2,3]:e.quoteLength=[e.quoteLength]),e.tapeMargin!==void 0&&(e.tapeMargin<10?e.tapeMargin=10:e.tapeMargin>90&&(e.tapeMargin=90)),e.maxLineWidth!==void 0&&(e.maxLineWidth<20&&e.maxLineWidth!==0?e.maxLineWidth=20:e.maxLineWidth>1e3&&(e.maxLineWidth=1e3)),e}class cr{constructor(t,o,a,s=!1){this.firstDayOfWeek=a;const n=new Vo(o),l=this.getInterval(n,s);this.startDay=l.start,this.endDay=l.end,this.data=this.buildData(t,n),this.isFullYear=s}getInterval(t,o=!1){const a=o?xS(t):new Vo;let s=TS(t);return o||(s=ef(LS(a),1),this.isFirstDayOfWeek(s)||(s=this.previousFirstDayOfWeek(s))),{start:s,end:a}}buildData(t,o){const a=new Array(Math.max(0,386-t.length)).fill(void 0);a.push(...t);const s=Hi(this.endDay,this.startDay)+1,n=a.length-s+Hi(this.endDay,o);return a.slice(n)}getMonths(){const t=$S({start:this.startDay,end:this.endDay}),o=[];for(let a=0;a<t.length;a++){const s=t[a];let n=a===0?this.startDay:MS(s),l=a===t.length-1?this.endDay:AS(n);this.isFirstDayOfWeek(n)||(n=a===0?this.previousFirstDayOfWeek(n):this.nextFirstDayOfWeek(n)),this.isLastDayOfWeek(l)||(l=this.nextLastDayOfWeek(l));const c=ES(l,n,{roundingMethod:"ceil"});c>2?o.push({text:te(s,"MMM").toLowerCase(),weeks:c}):a===0&&o.push({text:"",weeks:c})}return o}getDays(){const t=[],o=this.getBuckets(),a=l=>{if(l===void 0||l===null||l===0)return"0";for(let c=0;c<4;c++)if(l<=(o[c]??0))return(1+c).toString();return"4"};for(let l=0;l<this.startDay.getDay()-this.firstDayOfWeek;l++)t.push({level:"filler"});const s=Hi(this.endDay,this.startDay);let n=this.startDay;for(let l=0;l<=s;l++){const c=this.data[l],d=te(n,"EEEE dd MMM yyyy");t.push({level:a(c),label:c!=null?`${c} ${c===1?"test":"tests"} on ${d}`:`no activity on ${d}`}),n=ef(n,1)}for(let l=this.endDay.getDay()-this.firstDayOfWeek;l<6;l++)t.push({level:"filler"});return t}getTotalTests(){const t=Hi(this.endDay,this.startDay);return this.data.slice(0,t+1).reduce((o,a)=>(o??0)+(a??0),0)??0}getBuckets(){const o=this.data.filter(l=>l!=null).sort((l,c)=>l-c),a=o.slice(Math.round(o.length*.1),o.length-Math.round(o.length*.1)),n=a.reduce((l,c)=>l+c,0)/a.length;return[Math.floor(n/2),Math.round(n),Math.round(n*1.5)]}isFirstDayOfWeek(t){return gg(t).getDay()===this.firstDayOfWeek}previousFirstDayOfWeek(t){return _S(t,this.firstDayOfWeek)}nextFirstDayOfWeek(t){return hg(t,this.firstDayOfWeek)}isLastDayOfWeek(t){return gg(t).getDay()===(this.firstDayOfWeek+6)%7}nextLastDayOfWeek(t){return hg(t,(this.firstDayOfWeek+6)%7)}}class yx extends cr{constructor(t,o,a){super(t,o,a),this.lastDay=new Vo(o)}increment(t){const o=new Vo(t),a=new Vo(this.lastDay);if(IS(o,a)){const s=this.data.length-1;this.data[s]=(nr(this.data[s])??0)+1}else{if(BS(o,a))throw new Error("cannot alter data in the past.");{const s=Hi(o,a)-1;for(let l=0;l<s;l++)this.data.push(void 0);this.data.push(1);const n=this.getInterval(o);this.startDay=n.start,this.endDay=n.end,this.lastDay=o}}this.data=this.buildData(this.data,this.lastDay)}getFullYearCalendar(){const t=new Date;return this.lastDay.getFullYear()!==new Vo(t).getFullYear()?new cr([],t,this.firstDayOfWeek,!0):new cr(this.data,this.lastDay,this.firstDayOfWeek,!0)}}const bx={results:void 0,personalBests:{time:{},words:{},quote:{},zen:{},custom:{}},name:"",email:"",uid:"",isPremium:!1,config:Jo(),customThemes:[],presets:[],tags:[],banned:void 0,verified:void 0,lbMemory:{time:{15:{english:0},60:{english:0}}},typingStats:{timeTyping:0,startedTests:0,completedTests:0},quoteRatings:void 0,quoteMod:!1,favoriteQuotes:{},addedAt:0,filterPresets:[],xp:0,inboxUnreadSize:0,streak:0,maxStreak:0,streakHourOffset:void 0,allTimeLbs:{time:{15:{english:{count:0,rank:0}},60:{english:{count:0,rank:0}}}}};function Eg(){return structuredClone(bx)}function rt(e,t=!1,o=!1,a=":",s=!0,n=!1){e=Math.abs(e);let l=0,c;n?(l=Math.floor(e/86400),c=Math.floor(e%86400/3600)):c=Math.floor(e/3600);const d=Math.floor(e%3600/60),u=V(e%3600%60);let f,p,h,g;n&&(l<10&&a!=="text"?f="0"+l:f=l),c<10&&a!=="text"?p="0"+c:p=c,d<10&&a!=="text"?h="0"+d:h=d,u<10&&(d>0||c>0||t)&&a!=="text"?g="0"+u:g=u;let y="";return l>0&&n&&(y+=f,a==="text"?l===1?y+=" day ":y+=" days ":y+=a),(c>0||o)&&(y+=p,a==="text"?c===1?y+=" hour ":y+=" hours ":y+=a),(d>0||c>0||t)&&(y+=h,a==="text"?d===1?y+=" minute ":y+=" minutes ":s&&(y+=a)),s&&(y+=g,a==="text"&&(u===1?y+=" second":y+=" seconds")),c===0&&d===0&&!s&&a==="text"&&(y="less than 1 minute"),y.trim()}const _g={af:0,ar:6,arDZ:0,arEG:0,arMA:1,arSA:0,arTN:1,az:1,be:1,beTarask:1,bg:1,bn:0,bs:1,ca:1,ckb:0,cs:1,cy:0,da:1,de:1,deAT:1,el:1,enAU:1,enCA:0,enGB:1,enIE:1,enIN:1,enNZ:1,enUS:0,enZA:0,eo:1,es:1,et:1,eu:1,faIR:6,fi:1,fr:1,frCA:0,frCH:1,fy:1,gd:0,gl:1,gu:1,he:0,hi:0,hr:1,ht:1,hu:1,hy:1,id:1,is:1,it:1,itCH:1,ja:0,jaHira:0,ka:1,kk:1,km:0,kn:1,ko:0,lb:1,lt:1,lv:1,mk:1,mn:1,ms:1,mt:1,nb:1,nl:1,nlBE:1,nn:1,oc:1,pl:1,pt:1,ptBR:0,ro:1,ru:1,se:1,sk:1,sl:1,sq:1,sr:1,srLatn:1,sv:1,ta:1,te:0,th:0,tr:1,ug:0,uk:1,uz:1,uzCyrl:1,vi:1,zhCN:1,zhHK:0,zhTW:1};function yb(){if(navigator.language===void 0||navigator.language===null)return 0;const e=new Intl.Locale(navigator.language);if(e==null)return 0;if("weekInfo"in e)return e.weekInfo.firstDay%7;if("getWeekInfo"in e)return e.getWeekInfo().firstDay%7;let t=_g[navigator.language.replaceAll("-","")];return t!==void 0||(t=_g[navigator.language.split("-")[0]],t!==void 0)?t:0}const bb=[];function sa(e){bb.push(e)}function $d(e){bb.forEach(t=>{try{t(e)}catch(o){console.error("Auth event subscriber threw an error"),console.error(o)}})}let F;const vb=yb();class Vn extends Error{constructor(t,o){super(t),this.responseCode=o,this.name="SnapshotInitError",this.responseCode=o}}function x(){return F}function kt(e,t){const o=F==null?void 0:F.banned,a=F==null?void 0:F.verified,s=F==null?void 0:F.lbOptOut;try{e==null||delete e.banned}catch{}try{e==null||delete e.verified}catch{}try{e==null||delete e.lbOptOut}catch{}F=e,F&&(F.banned=o,F.verified=a,F.lbOptOut=s),(t==null?void 0:t.dispatchEvent)!==!1&&$d({type:"snapshotUpdated",data:{isInitial:!1}})}async function vx(){var t,o,a,s,n,l,c;const e=Eg();try{if(!B())return!1;const[d,u,f]=await Promise.all([E.users.get(),E.configs.get(),E.presets.get()]);if(d.status!==200)throw new Vn(`${d.body.message} (user)`,d.status);if(u.status!==200)throw new Vn(`${u.body.message} (config)`,u.status);if(f.status!==200)throw new Vn(`${f.body.message} (presets)`,f.status);const p=d.body.data,h=u.body.data,g=f.body.data;if(p===null)throw new Vn("Request was successful but user data is null",200);if(h!==null&&"config"in h)throw new Error("Config data is not in the correct format. Please refresh the page or contact support.");e.name=p.name,e.personalBests=p.personalBests,e.personalBests??(e.personalBests={time:{},words:{},quote:{},zen:{},custom:{}});for(const b of["time","words","quote","zen","custom"])(t=e.personalBests)[b]??(t[b]={});e.banned=p.banned,e.lbOptOut=p.lbOptOut,e.verified=p.verified,e.discordId=p.discordId,e.discordAvatar=p.discordAvatar,e.needsToChangeName=p.needsToChangeName,e.typingStats={timeTyping:p.timeTyping??0,startedTests:p.startedTests??0,completedTests:p.completedTests??0},e.quoteMod=p.quoteMod,e.favoriteQuotes=p.favoriteQuotes??{},e.quoteRatings=p.quoteRatings,e.details=p.profileDetails,e.addedAt=p.addedAt,e.inventory=p.inventory,e.xp=p.xp??0,e.inboxUnreadSize=p.inboxUnreadSize??0,e.streak=((o=p==null?void 0:p.streak)==null?void 0:o.length)??0,e.maxStreak=((a=p==null?void 0:p.streak)==null?void 0:a.maxLength)??0,e.filterPresets=p.resultFilterPresets??[],e.isPremium=(p==null?void 0:p.isPremium)??!1,e.allTimeLbs=p.allTimeLbs,p.testActivity!==void 0&&(e.testActivity=new yx(p.testActivity.testsByDays,new Date(p.testActivity.lastDay),vb));const y=(s=p==null?void 0:p.streak)==null?void 0:s.hourOffset;if(e.streakHourOffset=y??void 0,p.lbMemory!==void 0&&(e.lbMemory=p.lbMemory),h==null?e.config={...Jo()}:e.config=Ld(h),e.customThemes=p.customThemes??[],e.tags=((n=p.tags)==null?void 0:n.map(b=>({...b,display:b.name.replaceAll("_"," ")})))??[],e.tags=(l=e.tags)==null?void 0:l.sort((b,C)=>b.name>C.name?1:b.name<C.name?-1:0),g!=null){const b=g.map(C=>({...C,display:C.name.replace(/_/gi," ")}));e.presets=b,e.presets=(c=e.presets)==null?void 0:c.sort((C,L)=>C.name>L.name?1:C.name<L.name?-1:0)}return F=e,F}catch(d){throw F=Eg(),d}}async function $p(e){var a;if(!B()||!F||F.results!==void 0&&(e===void 0||F.results.length>e)||!tt())return!1;const t=await E.results.get({query:{offset:e}});if(t.status!==200)return m("Error getting results: "+t.body.message,-1),!1;if(!B())return!1;const o=t.body.data.map(s=>(s.bailedOut===void 0&&(s.bailedOut=!1),s.blindMode===void 0&&(s.blindMode=!1),s.lazyMode===void 0&&(s.lazyMode=!1),s.difficulty===void 0&&(s.difficulty="normal"),s.funbox===void 0&&(s.funbox=[]),(s.language===void 0||s.language===null)&&(s.language="english"),s.numbers===void 0&&(s.numbers=!1),s.punctuation===void 0&&(s.punctuation=!1),s.numbers===void 0&&(s.numbers=!1),s.quoteLength===void 0&&(s.quoteLength=-1),s.restartCount===void 0&&(s.restartCount=0),s.incompleteTestSeconds===void 0&&(s.incompleteTestSeconds=0),s.afkDuration===void 0&&(s.afkDuration=0),s.tags===void 0&&(s.tags=[]),s));if(o==null||o.sort((s,n)=>n.timestamp-s.timestamp),F.results!==void 0&&F.results.length>0){const s=(a=js(F.results))==null?void 0:a.timestamp,n=o.filter(l=>l.timestamp<s);F.results.push(...n)}else F.results=o;return!0}async function wx(e){if(!F)return!1;if(F.customThemes===void 0&&(F.customThemes=[]),F.customThemes.length>=20)return m("Too many custom themes!",0),!1;const t=await E.users.addCustomTheme({body:{...e}});if(t.status!==200)return m("Error adding custom theme: "+t.body.message,-1),!1;if(t.body.data===null)return m("Error adding custom theme: No data returned",-1),!1;const o={...e,_id:t.body.data._id};return F.customThemes.push(o),!0}async function Cx(e,t){var n;if(!B()||!F)return!1;F.customThemes===void 0&&(F.customThemes=[]);const o=(n=F.customThemes)==null?void 0:n.find(l=>l._id===e);if(!o)return m("Editing failed: Custom theme with id: "+e+" does not exist",-1),!1;const a=await E.users.editCustomTheme({body:{themeId:e,theme:t}});if(a.status!==200)return m("Error editing custom theme: "+a.body.message,-1),!1;const s={...t,_id:e};return F.customThemes[F.customThemes.indexOf(o)]=s,!0}async function kx(e){var a,s;if(!B()||!F||!((a=F.customThemes)==null?void 0:a.find(n=>n._id===e)))return!1;const o=await E.users.deleteCustomTheme({body:{themeId:e}});return o.status!==200?(m("Error deleting custom theme: "+o.body.message,-1),!1):(F.customThemes=(s=F.customThemes)==null?void 0:s.filter(n=>n._id!==e),!0)}async function wb(e,t,o,a,s,n,l){const c=x();if(!c)return[0,0];function d(){var L;const f=[];(L=c==null?void 0:c.tags)==null||L.forEach(S=>{S.active===!0&&f.push(S._id)});let p=0,h=0,g=0,y=0,b=0,C=0;if((c==null?void 0:c.results)!==void 0){for(const S of c.results)if(S.mode===e&&(S.punctuation??!1)===o&&(S.numbers??!1)===a&&S.language===s&&S.difficulty===n&&(S.lazyMode===l||S.lazyMode===void 0&&!l)&&(f.length===0||f.some(q=>{var P;return(P=S.tags)==null?void 0:P.includes(q)}))){if(`${S.mode2}`!=`${t}`&&e!=="quote")continue;if(C<10&&(g+=S.wpm,y+=S.acc,C++),`${S.mode2}`==`${t}`&&(p+=S.wpm,h+=S.acc,b++,b>=10))break}}return b===0&&e==="quote"?[g/C,y/C]:[p/b,h/b]}return c===null||await $p()===null?[0,0]:d()}async function Sx(e,t,o,a,s,n,l){const c=x();if(!c)return 0;function d(){var h;const f=[];(h=c==null?void 0:c.tags)==null||h.forEach(g=>{g.active===!0&&f.push(g._id)});let p=0;if((c==null?void 0:c.results)!==void 0){for(const g of c.results)if(g.mode===e&&(g.punctuation??!1)===o&&(g.numbers??!1)===a&&g.language===s&&g.difficulty===n&&(g.lazyMode===l||g.lazyMode===void 0&&!l)&&(f.length===0||f.some(y=>{var b;return(b=g.tags)==null?void 0:b.includes(y)}))){if(g.timestamp<Date.now()-864e5||`${g.mode2}`!=`${t}`&&e!=="quote")continue;g.wpm>p&&(p=g.wpm)}}return p}return c===null||await $p()===null?0:d()}async function xx(e,t,o,a,s,n,l){const c=x();if(!c)return 0;let d=0;for(const u of c.tags){if(!u.active)continue;const f=await Cb(u._id,e,t,o,a,s,n,l);f>d&&(d=f)}return d}async function xr(e,t,o,a,s,n,l,c){var u,f;if(!c.every(p=>p.canGetPb))return;const d=(f=(u=F==null?void 0:F.personalBests)==null?void 0:u[e])==null?void 0:f[t];return d==null?void 0:d.find(p=>(p.punctuation??!1)===o&&(p.numbers??!1)===a&&p.difficulty===n&&p.language===s&&(p.lazyMode??!1)===l)}function Tx(e,t,o,a,s,n,l,c,d,u,f){if(e==="quote"||!F)return;function p(){var g,y;if(!F)return;let h=!1;F.personalBests??(F.personalBests={time:{},words:{},quote:{},zen:{},custom:{}}),(g=F.personalBests)[e]??(g[e]={[t]:[]}),(y=F.personalBests[e])[t]??(y[t]=[]),F.personalBests[e][t].forEach(b=>{(b.punctuation??!1)===o&&(b.numbers??!1)===a&&b.difficulty===n&&b.language===s&&(b.lazyMode??!1)===l&&(h=!0,b.wpm=c,b.acc=d,b.raw=u,b.timestamp=Date.now(),b.consistency=f,b.lazyMode=l)}),h||F.personalBests[e][t].push({language:s,difficulty:n,lazyMode:l,punctuation:o,numbers:a,wpm:c,acc:d,raw:u,timestamp:Date.now(),consistency:f})}F!==null&&p()}async function Cb(e,t,o,a,s,n,l,c){var p,h,g,y;if(F===null)return 0;let d=0;const u=(((p=x())==null?void 0:p.tags)??[]).find(b=>b._id===e);return u===void 0||(u.personalBests??(u.personalBests={time:{},words:{},quote:{},zen:{},custom:{}}),(h=u.personalBests)[t]??(h[t]={[o]:[]}),(g=u.personalBests[t])[o]??(g[o]=[]),d=((y=(u.personalBests[t][o]??[]).find(b=>(b.punctuation??!1)===a&&(b.numbers??!1)===s&&b.difficulty===l&&b.language===n&&(b.lazyMode===c||b.lazyMode===void 0&&!c)))==null?void 0:y.wpm)??0),d}async function Lx(e,t,o,a,s,n,l,c,d,u,f,p){if(!F||t==="quote")return;function h(){var y,b,C;const g=(y=F==null?void 0:F.tags)==null?void 0:y.find(L=>L._id===e);g.personalBests??(g.personalBests={time:{},words:{},quote:{},zen:{},custom:{}}),(b=g.personalBests)[t]??(b[t]={[o]:[]}),(C=g.personalBests[t])[o]??(C[o]=[]);try{let L=!1;g.personalBests[t][o].forEach(S=>{(S.punctuation??!1)===a&&(S.numbers??!1)===s&&S.difficulty===l&&S.language===n&&(S.lazyMode===c||S.lazyMode===void 0&&!c)&&(L=!0,S.wpm=d,S.acc=u,S.raw=f,S.timestamp=Date.now(),S.consistency=p,S.lazyMode=c)}),L||g.personalBests[t][o].push({language:n,difficulty:l,lazyMode:c,punctuation:a,numbers:s,wpm:d,acc:u,raw:f,timestamp:Date.now(),consistency:p})}catch{g.personalBests={time:{},words:{},quote:{},zen:{},custom:{}},g.personalBests[t][o]=[{language:n,difficulty:l,lazyMode:c,punctuation:a,numbers:s,wpm:d,acc:u,raw:f,timestamp:Date.now(),consistency:p}]}}F!==null&&h()}async function $x(e,t,o,a,s=!1){var n,l,c;{const d=e,u=t,f=x();if(!f)return;f.lbMemory===void 0&&(f.lbMemory={time:{15:{english:0},60:{english:0}}}),f.lbMemory[d]===void 0&&(f.lbMemory[d]={15:{english:0},60:{english:0}}),f.lbMemory[d][u]===void 0&&(f.lbMemory[d][u]={});const p=(c=(l=(n=f.lbMemory)==null?void 0:n[d])==null?void 0:l[u])==null?void 0:c[o],h=f.lbMemory[d][u];h[o]=a,s&&p!==a&&await E.users.updateLeaderboardMemory({body:{mode:e,mode2:t,language:o,rank:a}}),kt(f)}}async function kb(e){if(B()){const t=await E.configs.save({body:e});t.status!==200&&m("Failed to save config: "+t.body.message,-1)}}async function Mx(){if(B()){const e=await E.configs.delete();e.status!==200&&m("Failed to reset config: "+e.body.message,-1)}}function Sb(e){const t=x();if(t){if(e.result!==void 0){if((t==null?void 0:t.results)!==void 0&&t.results.unshift(e.result),t.testActivity!==void 0&&t.testActivity.increment(new Date(e.result.timestamp)),t.typingStats===void 0){t.typingStats={timeTyping:0,startedTests:0,completedTests:0};const o=e.result.testDuration+e.result.incompleteTestSeconds-e.result.afkDuration;t.typingStats.timeTyping+=o,t.typingStats.startedTests+=e.result.restartCount+1,t.typingStats.completedTests+=1}e.isPb&&Tx(e.result.mode,e.result.mode2,e.result.punctuation,e.result.numbers,e.result.language,e.result.difficulty,e.result.lazyMode,e.result.wpm,e.result.acc,e.result.rawWpm,e.result.consistency)}e.xp!==void 0&&(t.xp===void 0&&(t.xp=0),t.xp+=e.xp),e.streak!==void 0&&(t.streak=e.streak,t.streak>t.maxStreak&&(t.maxStreak=t.streak)),kt(t,{dispatchEvent:!1})}}function Ax(e){const t=x();t&&(t.xp===void 0&&(t.xp=0),t.xp+=e,kt(t,{dispatchEvent:!1}))}function Ex(e){const t=x();t&&(t.inboxUnreadSize=e,kt(t))}function _x(e){const t=x();t&&(t.inventory===void 0&&(t.inventory={badges:[]}),t.inventory.badges.push(e),kt(t))}async function Ix(e){var o;if(!B()||F===void 0)return;if(e==="current")return F.testActivity;const t=new Date().getFullYear().toString();if(e===t)return(o=F.testActivity)==null?void 0:o.getFullYearCalendar();if(F.testActivityByYear===void 0){if(!tt())return;J();const a=await E.users.getTestActivity();if(a.status!==200){m("Error getting test activities: "+a.body.message,-1),K();return}F.testActivityByYear={};for(const s in a.body.data){if(s===t)continue;const n=a.body.data[s]??[],l=ef(new Date(parseInt(s),0,1),n.length);F.testActivityByYear[s]=new cr(n,l,vb,!0)}K()}return F.testActivityByYear[e]}async function Md(){return await Sd(()=>import("./vendor-sentry.BnicSrXf.js"),[])}let sc=!1,Tr=!1;async function Bx(){if(Tr){console.warn("Sentry already activated");return}Tr=!0,console.log("Activating Sentry");const e=await Md();e.init({release:Sn.clientVersion,dsn:"https://f50c25dc9dd75304a63776063896a39b@o4509236448133120.ingest.us.sentry.io/4509237217394688",sendDefaultPii:!0,environment:"production",integrations:[e.browserTracingIntegration(),e.replayIntegration({unmask:["#notificationCenter"],block:["#commandLine .modal .suggestions"]}),e.thirdPartyErrorFilterIntegration({filterKeys:["monkeytype-frontend"],behaviour:"drop-error-if-contains-third-party-frames"})],tracesSampleRate:.25,tracePropagationTargets:["localhost",/^https:\/\/api\.monkeytype\.com/],replaysSessionSampleRate:0,replaysOnErrorSampleRate:.5,ignoreErrors:["TypeError: can't access dead object","NotFoundError: Failed to execute 'removeChild' on 'Node': The node to be removed is not a child of this node.","NotFoundError: Failed to execute 'insertBefore' on 'Node': The node before which the new node is to be inserted is not a child of this node.","Error: There is no clipping info for given tab","Non-Error promise rejection captured","Object captured as promise rejection"],beforeSend(t){return sc&&console.debug("Sentry beforeSend",t),t},beforeBreadcrumb(t,o){return t.category==="console"&&t.level==="debug"?null:t}})}async function qx(e,t){if(!Tr)return;(await Md()).setUser({id:e,username:t})}async function Fx(){if(!Tr)return;(await Md()).setUser(null)}async function Mp(e){if(!Tr)return;(await Md()).captureException(e)}function Rx(){sc=!sc,console.debug("Sentry debug mode:",sc)}function Dx(e,t,o){let a=`Invalid value for ${e} (${t}). Please try to change this setting again.`;m(a,-1),console.error(a),Mp(new Error(a))}function xb(e,t,o){const a=o.safeParse(t).success;return a||Dx(e,t),a}const Tb=[];function be(e){Tb.push(e)}function Os(e,t,o,a,s){Tb.forEach(n=>{try{n(e,t,o,a,s)}catch(l){console.error("Config event subscriber threw an error"),console.error(l)}})}const Wx=[{name:"Prime Ape",description:"Paying for a monthly subscription",icon:"fa-dollar-sign",test:e=>e.isPremium===!0},{name:"Banned",description:"This account is banned",icon:"fa-gavel",color:"var(--error-color)",test:e=>e.banned===!0},{name:"LbOptOut",description:"This account has opted out of leaderboards",icon:"fa-crown",color:"var(--error-color)",test:e=>e.lbOptOut===!0}],Px={iconsOnly:!1};function zx(e){return Wx.filter(o=>o.test(e))}function Hx(e,t){const o=`<i class="fas ${e.icon}"></i>`;if(t.iconsOnly)return o;const a=[];return e.background!==void 0&&a.push(`background: ${e.background};`),(e==null?void 0:e.color)!==void 0&&a.push(`color: ${e.color};`),(e==null?void 0:e.customStyle)!==void 0&&a.push(e.customStyle),`<div class="flag" ${`aria-label="${e.description}" data-balloon-pos="right"`} style="${a.join("")}">${o}</div>`}function rl(e,t){const o={...Px,...t};return zx(e).map(a=>Hx(a,o)).join("")}function Ec(e){return Math.floor((Math.sqrt(392*e+22801)-53)/98)}function Ox(e){return 49*(e-1)+100}function Nx(e){return(49*Math.pow(e,2)+53*e-102)/2}function Lr(e){const t=Ec(e);return{level:t,levelCurrentXp:e-Nx(t),levelMaxXp:Ox(t)}}let Lt={bg:"#323437",main:"#e2b714",caret:"#e2b714",sub:"#646669",subAlt:"#2c2e31",text:"#d1d0c5",error:"#ca4754",errorExtra:"#7e2a33",colorfulError:"#ca4754",colorfulErrorExtra:"#7e2a33"};async function Kt(e){return Lt[e]||ll(),Lt[e]}async function hs(){return Lt.bg||ll(),Lt}function Ux(){Lt={bg:"",main:"",caret:"",sub:"",subAlt:"",text:"",error:"",errorExtra:"",colorfulError:"",colorfulErrorExtra:""}}function ll(){const e=getComputedStyle(document.body);Lt.bg=e.getPropertyValue("--bg-color").replace(" ",""),Lt.main=e.getPropertyValue("--main-color").replace(" ",""),Lt.caret=e.getPropertyValue("--caret-color").replace(" ",""),Lt.sub=e.getPropertyValue("--sub-color").replace(" ",""),Lt.subAlt=e.getPropertyValue("--sub-alt-color").replace(" ",""),Lt.text=e.getPropertyValue("--text-color").replace(" ",""),Lt.error=e.getPropertyValue("--error-color").replace(" ",""),Lt.errorExtra=e.getPropertyValue("--error-extra-color").replace(" ",""),Lt.colorfulError=e.getPropertyValue("--colorful-error-color").replace(" ",""),Lt.colorfulErrorExtra=e.getPropertyValue("--colorful-error-extra-color").replace(" ","")}let _c=!1;function Vx(){_c||(_c=!0,console.error("Slow timer, disabling animations"))}function $r(){_c=!1}function De(){return _c}let Ic=!1,Ue=!1,Lb=!1,Ms={currentXp:0,addedXp:0};const wa=i("nav .xpBar .xpBreakdown .total"),Lo=i("nav .xpBar .xpBreakdown .list"),ya=i("nav .level"),zo=i("nav .xpBar .bar"),ic=i("nav .xpBar");async function Kx(){if(Ue=!0,!Ic)return;Lb?wa.text(`+${Ms.addedXp}`):oo(Ms.addedXp,!0),Lo.stop(!0,!0).empty().addClass("hidden"),ya.text(Ec(Ms.currentXp+Ms.addedXp));const e=Lr(Ms.currentXp+Ms.addedXp),t=e.level+e.levelCurrentXp/e.levelMaxXp;zo.css("width",`${t%1*100}%`),await Le(2e3),Ic=!1,ic.stop(!0,!0).css("opacity",1).animate({opacity:0},De()?0:ge(250))}function Ig(e){const t=Lr(e),o=t.levelCurrentXp/t.levelMaxXp;ya.text(t.level),zo.css({width:o*100+"%"})}async function $b(e,t,o){Ue=!1,Ic=!0,Ms={currentXp:e,addedXp:t,breakdown:o},ya.text(Ec(e));const a=Lr(e),s=Lr(e+t),n=a.level+a.levelCurrentXp/a.levelMaxXp,l=s.level+s.levelCurrentXp/s.levelMaxXp,c=Lo;Lo.stop(!0,!0).css("opacity",0).empty(),ic.stop(!0,!0).css("opacity",0),wa.text("");const d=xo(ic,{opacity:"1"},De()?0:ge(125),"linear"),u=xo(Lo,{opacity:"1"},De()?0:ge(125),"linear");if(o!==void 0?(c.removeClass("hidden"),Promise.all([d,u])):c.addClass("hidden"),Ue)return;const f=jx(n,l),p=Gx(t,o);await Promise.all([f,p]),!Ue&&(await Le(5e3),!Ue&&(Ic=!1,ya.text(Ec(e+t)),ic.stop(!0,!0).css("opacity",1).animate({opacity:0},De()?0:ge(250))))}async function oo(e,t=!1){if(!t&&Ue)return;wa.text(`+${e}`);const o=(Math.random()*2-1)/4,a=(Math.random()+1)/2;wa.stop(!0,!0).css({transition:"initial",borderSpacing:100}).animate({borderSpacing:0},{step(s){wa.css("transform",`scale(${1+s/200*a}) rotate(${s/10*o}deg)`)},duration:ge(2e3),easing:"easeOutCubic",complete:()=>{wa.css({backgroundColor:"",transition:""})}})}async function to(e,t,o){if(Ue)return;if(t===void 0)Lo.append(`<div class="line" data-string='${e}'><div>${e}</div><div></div></div>`);else if(typeof t=="string")Lo.append(`
      <div class="line" data-string='${e}'>
      <div class="${o==null?void 0:o.extraClass}">${e}</div>
      <div class="${o==null?void 0:o.extraClass}">${t}</div>
      </div>`);else{const s=t===void 0?void 0:t>=0;Lo.append(`
      <div class="line" data-string='${e}'>

        <div class="${o==null?void 0:o.extraClass}">${e}</div>
        <div class="${s?"positive":"negative"} ${o==null?void 0:o.extraClass}">${s?"+":"-"}${Math.abs(t)}</div>
      </div>`)}if(o!=null&&o.noAnimation)return;const a=Lo.find(`.line[data-string='${e}']`);a.css("opacity",0),await xo(a,{opacity:"1"},ge(250),"swing")}async function Gx(e,t){if(Ue)return;if(Lo.css("opacity",1),!t){wa.text(`+${e}`);return}const o=ge(250);let a=0;Lo.empty(),Lo.removeClass("hidden"),wa.text("+0"),a+=t.base??0,wa.text(`+${a}`),await to("time typing",t.base,{noAnimation:!0}),await Le(o),Ce(t.fullAccuracy)?(await Le(o),a+=t.fullAccuracy,oo(a),await to("perfect",t.fullAccuracy)):Ce(t.corrected)&&(await Le(o),a+=t.corrected,oo(a),await to("clean",t.corrected)),!Ue&&(Ce(t.quote)?(await Le(o),a+=t.quote,oo(a),await to("quote",t.quote)):(Ce(t.punctuation)&&(await Le(o),a+=t.punctuation,oo(a),await to("punctuation",t.punctuation)),Ce(t.numbers)&&(await Le(o),a+=t.numbers,oo(a),await to("numbers",t.numbers))),!Ue&&(Ce(t.funbox)&&(await Le(o),a+=t.funbox,oo(a),await to("funbox",t.funbox)),!Ue&&(Ce(t.streak)&&(await Le(o),a+=t.streak,oo(a),await to("streak",t.streak)),!Ue&&(Ce(t.accPenalty)&&t.accPenalty>0&&(await Le(o),a-=t.accPenalty,oo(a),await to("accuracy penalty",t.accPenalty*-1)),!Ue&&(Ce(t.incomplete)&&t.incomplete>0&&(await Le(o),a+=t.incomplete,oo(a),await to("incomplete tests",t.incomplete)),!Ue&&(Ce(t.configMultiplier)&&(await Le(o),a*=t.configMultiplier,oo(a),await to("global multiplier",`x${t.configMultiplier}`)),!Ue&&(Ce(t.daily)&&(await Le(o),a+=t.daily,oo(a),await to("daily bonus",t.daily)),Lb=!0,!Ue&&await Le(o))))))))}async function jx(e,t){if(Ue)return;const o=t-e;if(zo.css("width",`${e%1*100}%`),t%1===0){if(await xo(zo,{width:"100%"},De()?0:ge(1e3),"easeOutExpo"),Ue)return;vu(),zo.css("width","0%")}else if(Math.floor(e)===Math.floor(t))await xo(zo,{width:`${t%1*100}%`},De()?0:ge(1e3),"easeOutExpo");else{const a=Math.min(1e3/o,200);let s=o,n=!1,l=a,c="linear",d=1-e%1;do{if(Ue)return;s-1<1&&(l=Tc(s-1,0,.5,1e3,200),c="easeOutQuad"),n&&(vu(),zo.css("width","0%"),d=1),await xo(zo,{width:"100%"},De()?0:ge(l),c),s-=d,n=!0}while(s>1);if(Ue||(vu(),zo.css("width","0%"),Ue))return;await xo(zo,{width:`${s%1*100}%`},De()?0:ge(1e3),"easeOutExpo")}}async function vu(){const e=await hs();ya.text(parseInt(ya.text())+1);const t=Math.random()*2-1,o=Math.random()+1;ya.stop(!0,!0).css({backgroundColor:e.main,borderSpacing:100,transition:"initial"}).animate({backgroundColor:e.sub,borderSpacing:0},{step(a){ya.css("transform",`scale(${1+a/200*o}) rotate(${a/10*t}deg)`)},duration:ge(2e3),easing:"easeOutCubic",complete:()=>{ya.css({backgroundColor:"",transition:""})}})}const Bg=new Map;function Il(e,t){const o=document.createElement("div");return o.classList.add("avatar"),e===null?t!=null&&t.loading?o.innerHTML='<div class="loading"><i class="fas fa-circle-notch fa-spin"><i></div>':o.innerHTML=`<div class="userIcon"><i class="${(t==null?void 0:t.userIcon)??"fas fa-user-circle"}"><i></div>`:o.innerHTML=`<div class="discordImage" style="background-image:url(${e}?size=${(t==null?void 0:t.size)??32})"></div>`,o}function Ad({discordId:e,discordAvatar:t},o){if(e===void 0||e===""||t===void 0||t==="")return Il(null,o);const a=Bg.get(t);if(a!==void 0)return Il(a,o);{const s=Il(null,{loading:!0});return Qx({discordId:e,discordAvatar:t}).then(n=>{Bg.set(t,n),s.replaceWith(Il(n,o))}),s}}async function Qx({discordId:e,discordAvatar:t}){try{const o=`https://cdn.discordapp.com/avatars/${e}/${t}.png`;return(await fetch(o,{method:"HEAD"})).ok?o:null}catch{}return null}function Yx(){i("nav .accountButtonAndMenu").addClass("hidden"),i("nav .textButton.view-login").addClass("hidden")}function Yo(e){i("nav .accountButtonAndMenu .spinner").css({opacity:e?"1":"0"}),i("nav .accountButtonAndMenu .avatar").css({opacity:e?"0":"1"})}function qg(e){i("header nav .view-account > .text").text(e)}function Fg(e){i("nav .textButton.view-account > .text").append(rl(e,{iconsOnly:!0}))}function sf(e){const t=Ad(e??{},{userIcon:"fas fa-fw fa-user"});i("header nav .view-account .avatar").replaceWith(t)}function Xx(){if(B()){const e=x();if(e===void 0)return;const{xp:t,name:o}=e;Yo(!1),qg(o),Fg(e??{}),Ig(t),sf(e),i("nav .accountButtonAndMenu .menu .items .goToProfile").attr("href",`/profile/${o}`),nn(i("nav .textButton.view-login"),i("nav .accountButtonAndMenu"),250)}else nn(i("nav .accountButtonAndMenu"),i("nav .textButton.view-login"),250,async()=>{qg(""),Fg({}),Ig(0),sf()})}var cy;const Zx=(cy=window.matchMedia("(pointer:coarse)"))==null?void 0:cy.matches;Zx&&i("nav .accountButtonAndMenu .textButton.view-account").attr("href","");sa(e=>{(e.type==="authStateChanged"&&!e.data.isUserSignedIn||e.type==="snapshotUpdated")&&Xx()});function Jx(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function Mb(e){return e.replace(/([A-Z])/g," $1").trim().toLowerCase()}function Ab(e){try{return e.charAt(e.length-1)}catch{return""}}function Rg(e,t,o){return t>e.length-1?e:e.substring(0,t)+o+e.substring(t+1)}function yi(e){return e.split(/ +/).map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function _t(e){return e.charAt(0).toUpperCase()+e.slice(1)}function wu(e,t){if(t=t.filter(a=>a!==""),t.length===0)return e;const o=new RegExp(`(?<!\\p{L})(?:${t.join("|")})(?!\\p{L})`,"gu");return e.replace(o,'<span class="highlight">$&</span>')}function ea(e,t=!1){let o="";return t?o=No(e):o=e,o.replace(/_/g," ")}function No(e){return e.replace(/_\d*k$/g,"")}function Eb(e){const t={"“":'"',"”":'"',"„":'"',"’":"'","‘":"'",",":",","—":"-","…":"...","«":"<<","»":">>","–":"-"," ":" "," ":" "," ":" ","᾽":"'"};return e.replace(/[“”’‘—,…«»–\u2007\u202F\u00A0]/g,o=>t[o]||"")}function Xo(e){const t=[];for(const o of e)t.push(o);return t}function eT(e){return e=e.replace(new RegExp("(?<!\\\\)\\\\t","g"),"	"),e=e.replace(/\\n/g,` 
`),e=e.replace(/([^\\]|^)\\n/gm,`$1
`),e=e.replace(/\\\\t/gm,"\\t"),e=e.replace(/\\\\n/gm,"\\n"),e}function tT(e){return!e||e.length===0?!1:/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/.test(e)}let nf=new Map;function oT(){nf.clear()}function Ed(e,t,o){if(e===void 0||e.length===0)return o?!t:t;const a=e.replace(/^[\p{P}\p{S}\s]+|[\p{P}\p{S}\s]+$/gu,"");if(a.length===0)return o?!t:t;const s=nf.get(a);if(s!==void 0)return o?!s:s;const n=tT(a);return nf.set(a,n),o?!n:n}function rf(e,t,o){var a;if(o.length===0)return{result:!0};if(e==="words"||e==="time")return t===0?o.filter(n=>{var l;return(l=n.properties)==null?void 0:l.includes("noInfiniteDuration")}).length>0?{result:!1,forcedConfigs:[e==="words"?10:15]}:{result:!0}:{result:!0};{const s={};for(const n of o)if(n.frontendForcedConfig)for(const l in n.frontendForcedConfig)s[l]===void 0?s[l]=n.frontendForcedConfig[l]:s[l]=Hy(s[l],n.frontendForcedConfig[l],!0);if(s[e]===void 0)return{result:!0};if(((a=s[e])==null?void 0:a.length)===0)throw new Error("No intersection of forced configs");return{result:(s[e]??[]).includes(t),forcedConfigs:s[e]}}}function _b(e,t,o=[],a=!1){let s=0;const n=kr(o);if(e==="mode"){let l=kr(o).filter(c=>{var d;return((d=c.frontendForcedConfig)==null?void 0:d.mode)!==void 0&&!c.frontendForcedConfig.mode.includes(t)});t==="zen"&&(l=l.concat(n.filter(c=>{const d=c.frontendFunctions??[],u=c.properties??[];return d.includes("getWord")||d.includes("pullSection")||d.includes("alterText")||d.includes("withWords")||u.includes("changesCapitalisation")||u.includes("nospace")||u.some(f=>f.startsWith("toPush:"))||u.includes("changesWordsVisibility")||u.includes("speaks")||u.includes("changesLayout")||u.includes("changesWordsFrequency")}))),(t==="quote"||t==="custom")&&(l=l.concat(n.filter(c=>{const d=c.frontendFunctions??[],u=c.properties??[];return d.includes("getWord")||d.includes("pullSection")||d.includes("withWords")||u.includes("changesWordsFrequency")}))),l.length>0&&(s+=1)}if(e==="words"||e==="time"){if(!rf(e,t,n).result)if(a)s+=1;else return m("Active funboxes do not support infinite tests",0),!1}else rf(e,t,n).result||(s+=1);return s>0?(a||m(`You can't set ${Mb(e)} to ${t.toString()} with currently active funboxes.`,0,{duration:5}),!1):!0}function Ib(e,t){console.log("cansetfunboxwithconfig",e,t.mode);let o=[...t.funbox,e];const a=[];for(const[s,n]of Object.entries(t))_b(s,n,o,!0)||a.push({key:s,value:n});if(a.length>0){const s=[];for(const n of a)s.push(`${_t(Mb(n.key))} cannot be set to ${n.value.toString()}.`);return m(`You can't enable ${e.replace(/_/g," ")}:<br>${s.join("<br>")}`,0,{duration:5,allowHTML:!0}),!1}else return!0}class Bt{constructor(t){this.key=t.key,this.schema=t.schema,this.fallback=t.fallback,this.migrate=t.migrate}get(){if(this.cache!==void 0)return console.debug(`LS ${this.key} Got cached value:`,this.cache),this.cache;console.debug(`LS ${this.key} Getting value from localStorage`);const t=window.localStorage.getItem(this.key);if(t===null)return console.debug(`LS ${this.key} No value found, returning fallback`),this.cache=this.fallback,this.cache;let o=!1;const{data:a,error:s}=wd(()=>kn(t,this.schema,{fallback:this.fallback,migrate:(n,l)=>(console.debug(`LS ${this.key} Schema validation failed`),o=!0,this.migrate?(console.debug(`LS ${this.key} Migrating from old format to new format`),this.cache=this.migrate(n,l),this.cache):(console.debug(`LS ${this.key} No migration function provided, returning fallback`),this.cache=this.fallback,this.cache))}));return s?(console.error(`LS ${this.key} Failed to parse from localStorage: ${s.message}`),window.localStorage.setItem(this.key,JSON.stringify(this.fallback)),this.cache=this.fallback,this.cache):((o||a===this.fallback)&&(console.debug(`LS ${this.key} Setting in localStorage`),window.localStorage.setItem(this.key,JSON.stringify(a))),console.debug(`LS ${this.key} Got value:`,a),this.cache=a,this.cache)}set(t){try{console.debug(`LS ${this.key} Parsing to set in localStorage`);const o=this.schema.parse(t);return console.debug(`LS ${this.key} Setting in localStorage`),window.localStorage.setItem(this.key,JSON.stringify(o)),this.cache=o,!0}catch(o){let a="Unknown error occurred";tS(o)?(console.error(o),a="Schema validation failed"):o.message.includes("exceeded the quota")&&(a="Local storage is full. Please clear some space and try again.");const s=`Failed to set ${this.key} in localStorage: ${a}`;return console.error(s),m(s,-1),!1}}}const Bb={punctuation:{icon:"fa-at",changeRequiresRestart:!0,overrideValue:({value:e,currentConfig:t})=>t.mode==="quote"?!1:e},numbers:{icon:"fa-hashtag",changeRequiresRestart:!0,overrideValue:({value:e,currentConfig:t})=>t.mode==="quote"?!1:e},words:{icon:"fa-font",displayString:"word count",changeRequiresRestart:!0,overrideConfig:({currentConfig:e})=>e.mode!=="words"?{mode:"words"}:{}},time:{icon:"fa-clock",changeRequiresRestart:!0,displayString:"time",overrideConfig:({currentConfig:e})=>e.mode!=="time"?{mode:"time"}:{}},mode:{icon:"fa-bars",changeRequiresRestart:!0,overrideConfig:({value:e})=>e==="custom"||e==="quote"||e==="zen"?{numbers:!1,punctuation:!1}:{},afterSet:({currentConfig:e})=>{e.mode==="zen"&&e.paceCaret!=="off"&&m("Pace caret will not work with zen mode.",0)}},quoteLength:{icon:"fa-quote-right",displayString:"quote length",changeRequiresRestart:!0,overrideConfig:({currentConfig:e})=>e.mode!=="quote"?{mode:"quote"}:{}},language:{icon:"fa-language",displayString:"language",changeRequiresRestart:!0},burstHeatmap:{icon:"fa-fire",displayString:"word burst heatmap",changeRequiresRestart:!1},difficulty:{icon:"fa-star",changeRequiresRestart:!0},quickRestart:{icon:"fa-redo-alt",displayString:"quick restart",changeRequiresRestart:!1},repeatQuotes:{icon:"fa-sync-alt",displayString:"repeat quotes",changeRequiresRestart:!1},blindMode:{icon:"fa-eye-slash",displayString:"blind mode",changeRequiresRestart:!1},alwaysShowWordsHistory:{icon:"fa-align-left",displayString:"always show words history",changeRequiresRestart:!1},singleListCommandLine:{icon:"fa-list",displayString:"single list command line",changeRequiresRestart:!1},minWpm:{icon:"fa-bomb",displayString:"min speed",changeRequiresRestart:!0},minWpmCustomSpeed:{icon:"fa-bomb",displayString:"min speed custom",changeRequiresRestart:!0,overrideConfig:({currentConfig:e})=>e.minWpm!=="custom"?{minWpm:"custom"}:{}},minAcc:{icon:"fa-bomb",displayString:"min accuracy",changeRequiresRestart:!0},minAccCustom:{icon:"fa-bomb",displayString:"min accuracy custom",changeRequiresRestart:!0,overrideConfig:({currentConfig:e})=>e.minAcc!=="custom"?{minAcc:"custom"}:{}},minBurst:{icon:"fa-bomb",displayString:"min word burst",changeRequiresRestart:!0},minBurstCustomSpeed:{icon:"fa-bomb",displayString:"min word burst custom speed",changeRequiresRestart:!0},britishEnglish:{icon:"fa-language",displayString:"british english",changeRequiresRestart:!0},funbox:{icon:"fa-gamepad",changeRequiresRestart:!0,isBlocked:({value:e,currentConfig:t})=>{if(!sl(e))return m(`${_t(e.join(", "))} is an invalid combination of funboxes`,0),!0;for(const o of e)if(!Ib(o,t))return m(`${e}" cannot be enabled with the current config`,0),!0;return!1}},customLayoutfluid:{icon:"fa-tint",displayString:"custom layoutfluid",changeRequiresRestart:!0,overrideValue:({value:e})=>Array.from(new Set(e))},customPolyglot:{icon:"fa-language",displayString:"custom polyglot",changeRequiresRestart:!1,overrideValue:({value:e})=>Array.from(new Set(e))},freedomMode:{icon:"fa-feather-alt",changeRequiresRestart:!1,displayString:"freedom mode",overrideConfig:({value:e})=>e?{confidenceMode:"off"}:{}},strictSpace:{icon:"fa-minus",displayString:"strict space",changeRequiresRestart:!0},oppositeShiftMode:{icon:"fa-exchange-alt",displayString:"opposite shift mode",changeRequiresRestart:!1},stopOnError:{icon:"fa-hand-paper",displayString:"stop on error",changeRequiresRestart:!0,overrideConfig:({value:e})=>e!=="off"?{confidenceMode:"off"}:{}},confidenceMode:{icon:"fa-backspace",displayString:"confidence mode",changeRequiresRestart:!1,overrideConfig:({value:e})=>e!=="off"?{freedomMode:!1,stopOnError:"off"}:{}},quickEnd:{icon:"fa-step-forward",displayString:"quick end",changeRequiresRestart:!1},indicateTypos:{icon:"fa-exclamation",displayString:"indicate typos",changeRequiresRestart:!1},hideExtraLetters:{icon:"fa-eye-slash",displayString:"hide extra letters",changeRequiresRestart:!1},lazyMode:{icon:"fa-couch",displayString:"lazy mode",changeRequiresRestart:!0},layout:{icon:"fa-keyboard",displayString:"layout",changeRequiresRestart:!0},codeUnindentOnBackspace:{icon:"fa-code",displayString:"code unindent on backspace",changeRequiresRestart:!0},soundVolume:{icon:"fa-volume-down",displayString:"sound volume",changeRequiresRestart:!1},playSoundOnClick:{icon:"fa-volume-up",displayString:"play sound on click",changeRequiresRestart:!1},playSoundOnError:{icon:"fa-volume-mute",displayString:"play sound on error",changeRequiresRestart:!1},playTimeWarning:{icon:"fa-exclamation-triangle",displayString:"play time warning",changeRequiresRestart:!1},smoothCaret:{icon:"fa-i-cursor",displayString:"smooth caret",changeRequiresRestart:!1},caretStyle:{icon:"fa-i-cursor",displayString:"caret style",changeRequiresRestart:!1},paceCaret:{icon:"fa-i-cursor",displayString:"pace caret",changeRequiresRestart:!1,isBlocked:({value:e})=>document.readyState==="complete"&&(e==="pb"||e==="tagPb")&&!B()?(m('Pace caret "pb" and "tag pb" are unavailable without an account',0),!0):!1},paceCaretCustomSpeed:{icon:"fa-i-cursor",displayString:"pace caret custom speed",changeRequiresRestart:!1,overrideConfig:({currentConfig:e})=>e.paceCaret!=="custom"?{paceCaret:"custom"}:{}},paceCaretStyle:{icon:"fa-i-cursor",displayString:"pace caret style",changeRequiresRestart:!1},repeatedPace:{icon:"fa-i-cursor",displayString:"repeated pace",changeRequiresRestart:!1},timerStyle:{icon:"fa-chart-pie",displayString:"timer style",changeRequiresRestart:!1},liveSpeedStyle:{icon:"fa-tachometer-alt",displayString:"live speed style",changeRequiresRestart:!1},liveAccStyle:{icon:"fa-tachometer-alt",displayString:"live accuracy style",changeRequiresRestart:!1},liveBurstStyle:{icon:"fa-tachometer-alt",displayString:"live word burst style",changeRequiresRestart:!1},timerColor:{icon:"fa-chart-pie",displayString:"timer color",changeRequiresRestart:!1},timerOpacity:{icon:"fa-chart-pie",displayString:"timer opacity",changeRequiresRestart:!1},highlightMode:{icon:"fa-highlighter",displayString:"highlight mode",changeRequiresRestart:!1},tapeMode:{icon:"fa-tape",triggerResize:!0,changeRequiresRestart:!1,displayString:"tape mode",overrideConfig:({value:e})=>e!=="off"?{showAllLines:!1}:{}},tapeMargin:{icon:"fa-tape",displayString:"tape margin",triggerResize:!0,changeRequiresRestart:!1},smoothLineScroll:{icon:"fa-align-left",displayString:"smooth line scroll",changeRequiresRestart:!1},showAllLines:{icon:"fa-align-left",changeRequiresRestart:!1,displayString:"show all lines",isBlocked:({value:e,currentConfig:t})=>e&&t.tapeMode!=="off"?(m("Show all lines doesn't support tape mode.",0),!0):!1},alwaysShowDecimalPlaces:{icon:"00",displayString:"always show decimal places",changeRequiresRestart:!1},typingSpeedUnit:{icon:"fa-tachometer-alt",displayString:"typing speed unit",changeRequiresRestart:!1},startGraphsAtZero:{icon:"fa-chart-line",displayString:"start graphs at zero",changeRequiresRestart:!1},maxLineWidth:{icon:"fa-text-width",changeRequiresRestart:!1,triggerResize:!0,displayString:"max line width"},fontSize:{icon:"fa-font",changeRequiresRestart:!1,triggerResize:!0,displayString:"font size"},fontFamily:{icon:"fa-font",displayString:"font family",changeRequiresRestart:!1},keymapMode:{icon:"fa-keyboard",displayString:"keymap mode",changeRequiresRestart:!1},keymapLayout:{icon:"fa-keyboard",displayString:"keymap layout",changeRequiresRestart:!1,overrideConfig:({currentConfig:e})=>e.keymapMode==="off"?{keymapMode:"static"}:{}},keymapStyle:{icon:"fa-keyboard",displayString:"keymap style",changeRequiresRestart:!1,overrideConfig:({currentConfig:e})=>e.keymapMode==="off"?{keymapMode:"static"}:{}},keymapLegendStyle:{icon:"fa-keyboard",displayString:"keymap legend style",changeRequiresRestart:!1,overrideConfig:({currentConfig:e})=>e.keymapMode==="off"?{keymapMode:"static"}:{}},keymapShowTopRow:{icon:"fa-keyboard",displayString:"keymap show top row",changeRequiresRestart:!1,overrideConfig:({currentConfig:e})=>e.keymapMode==="off"?{keymapMode:"static"}:{}},keymapSize:{icon:"fa-keyboard",triggerResize:!0,changeRequiresRestart:!1,displayString:"keymap size",overrideValue:({value:e})=>(e<.5&&(e=.5),e>3.5&&(e=3.5),Jl(e)),overrideConfig:({currentConfig:e})=>e.keymapMode==="off"?{keymapMode:"static"}:{}},flipTestColors:{icon:"fa-adjust",displayString:"flip test colors",changeRequiresRestart:!1},colorfulMode:{icon:"fa-fill-drip",displayString:"colorful mode",changeRequiresRestart:!1},customBackground:{icon:"fa-link",displayString:"URL background",changeRequiresRestart:!1,overrideValue:({value:e})=>e.trim()},customBackgroundSize:{icon:"fa-image",displayString:"custom background size",changeRequiresRestart:!1},customBackgroundFilter:{icon:"fa-image",displayString:"custom background filter",changeRequiresRestart:!1},autoSwitchTheme:{icon:"fa-palette",displayString:"auto switch theme",changeRequiresRestart:!1},themeLight:{icon:"fa-palette",displayString:"theme light",changeRequiresRestart:!1},themeDark:{icon:"fa-palette",displayString:"theme dark",changeRequiresRestart:!1},randomTheme:{icon:"fa-palette",changeRequiresRestart:!1,displayString:"random theme",isBlocked:({value:e})=>{var t;if(e==="custom"){const o=x();if(!B())return m("Random theme 'custom' is unavailable without an account",0),!0;if(!o)return m("Random theme 'custom' requires a snapshot to be set",0),!0;if(((t=o==null?void 0:o.customThemes)==null?void 0:t.length)===0)return m("Random theme 'custom' requires at least one custom theme to be saved",0),!0}return!1}},favThemes:{icon:"fa-palette",displayString:"favorite themes",changeRequiresRestart:!1},theme:{icon:"fa-palette",changeRequiresRestart:!1,overrideConfig:()=>({customTheme:!1})},customTheme:{icon:"fa-palette",displayString:"custom theme",changeRequiresRestart:!1},customThemeColors:{icon:"fa-palette",displayString:"custom theme colors",changeRequiresRestart:!1},showKeyTips:{icon:"fa-question",displayString:"show key tips",changeRequiresRestart:!1},showOutOfFocusWarning:{icon:"fa-exclamation",displayString:"show out of focus warning",changeRequiresRestart:!1},capsLockWarning:{icon:"fa-exclamation-triangle",displayString:"caps lock warning",changeRequiresRestart:!1},showAverage:{icon:"fa-chart-bar",displayString:"show average",changeRequiresRestart:!1},accountChart:{icon:"fa-chart-line",displayString:"account chart",changeRequiresRestart:!1,overrideValue:({value:e,currentValue:t})=>{if(e[0]==="off"&&e[1]==="off"){const o=e[0]===t[0]?0:1;e[o]="on"}return e}},monkey:{icon:"fa-egg",displayString:"monkey",changeRequiresRestart:!1},monkeyPowerLevel:{icon:"fa-egg",displayString:"monkey power level",changeRequiresRestart:!1},ads:{icon:"fa-ad",changeRequiresRestart:!1,overrideValue:({value:e})=>e,isBlocked:({value:e})=>!1,afterSet:({nosave:e})=>{e||(Pa(3),m("Ad settings changed. Refreshing...",0))}}},Ap=new Bt({key:"config",schema:il,fallback:Jo(),migrate:(e,t)=>Ry(e)?Ld(e):Jo()});let r={...Jo()},nc={};const aT=It(1e3,()=>{Object.keys(nc).length>0&&(Yo(!0),kb(nc).then(()=>{Yo(!1)})),nc={}});function Ep(e,t=!1,o=!1){if(t)return;Ap.set(r),o||(nc[e]=r[e],aT());const a=JSON.stringify(r);Os("saveToLocalStorage",a)}function xn(e=!1){console.log("saving full config to localStorage"),Ap.set(r),e||(Yo(!0),kb(r),Yo(!1));const t=JSON.stringify(r);Os("saveToLocalStorage",t)}function sT(){return Ee&&r.funbox.includes("no_quit")?(m("No quit funbox is active. Please finish the test.",0,{important:!0}),!0):!1}function A(e,t,o=!1){var l,c;const a=Bb[e];if(a===void 0)throw new Error(`Config metadata for key "${e}" is not defined.`);a.overrideValue&&(t=a.overrideValue({value:t,currentValue:r[e],currentConfig:r}));const s=r[e];if(a.changeRequiresRestart&&Ee&&r.funbox.includes("no_quit"))return m("No quit funbox is active. Please finish the test.",0,{important:!0}),console.warn(`Could not set config key "${e}" with value "${JSON.stringify(t)}" - no quit funbox active.`),!1;if((l=a.isBlocked)!=null&&l.call(a,{value:t,currentConfig:r}))return console.warn(`Could not set config key "${e}" with value "${JSON.stringify(t)}" - blocked.`),!1;const n=il.shape[e];if(!xb(a.displayString??e,t,n))return console.warn(`Could not set config key "${e}" with value "${JSON.stringify(t)}" - invalid value.`),!1;if(!_b(e,t,r.funbox))return console.warn(`Could not set config key "${e}" with value "${JSON.stringify(t)}" - funbox conflict.`),!1;if(a.overrideConfig){const d=a.overrideConfig({value:t,currentConfig:r});for(const u of lt(d)){const f=d[u];if(r[u]===f)continue;if(!A(u,f,o))throw new Error(`Failed to set config key "${u}" with value "${f}" for ${a.displayString} config override.`)}}return r[e]=t,o||Ep(e,o),Os(e,t,o,s),a.triggerResize&&!o&&Fk(),(c=a.afterSet)==null||c.call(a,{nosave:o||!1,currentConfig:r}),!0}function Sa(e,t){return A("numbers",e,t)}function cs(e,t){return A("punctuation",e,t)}function ut(e,t){return A("mode",e,t)}function iT(e,t){return A("playSoundOnError",e,t)}function nT(e,t){return A("playSoundOnClick",e,t)}function rT(e,t){return A("soundVolume",e,t)}function lT(e,t){return A("playTimeWarning",e,t)}function ua(e,t){return A("difficulty",e,t)}function Bc(e,t){return A("favThemes",e,t)}function Xa(e,t){return A("funbox",e,t)}function Yi(e,t){if(sT()||!Ib(e,r))return!1;let o=r.funbox;return o.includes(e)?o=o.filter(a=>a!==e):(o.push(e),o.sort()),xb("funbox",o,Oy)?(r.funbox=o,Ep("funbox",t),Os("funbox",r.funbox),!0):!1}function cT(e,t){return A("blindMode",e,t)}function _d(e,t){return A("accountChart",e,t)}function qb(e,t){return A("stopOnError",e,t)}function dT(e,t){return A("alwaysShowDecimalPlaces",e,t)}function uT(e,t){return A("typingSpeedUnit",e,t)}function fT(e,t){return A("showOutOfFocusWarning",e,t)}function pT(e,t){return A("paceCaret",e,t)}function mT(e,t){return A("repeatedPace",e,t)}function gT(e,t){return A("minWpm",e,t)}function hT(e,t){return A("minAcc",e,t)}function rc(e,t){return A("minBurst",e,t)}function Dg(e,t){return A("minBurstCustomSpeed",e,t)}function yT(e,t){return A("alwaysShowWordsHistory",e,t)}function bT(e,t){return A("singleListCommandLine",e,t)}function vT(e,t){return A("capsLockWarning",e,t)}function lf(e,t){return A("showAllLines",e,t)}function wT(e,t){return A("quickEnd",e,t)}function CT(e,t){return A("ads",e,t)}function kT(e,t){return A("repeatQuotes",e,t)}function ST(e,t){return A("flipTestColors",e,t)}function xT(e,t){return A("colorfulMode",e,t)}function TT(e,t){return A("strictSpace",e,t)}function LT(e,t){return A("oppositeShiftMode",e,t)}function $T(e,t){return A("caretStyle",e,t)}function MT(e,t){return A("paceCaretStyle",e,t)}function AT(e,t){return A("showAverage",e,t)}function Is(e,t){return A("highlightMode",e,t)}function ET(e,t){return A("tapeMode",e,t)}function _T(e,t){return A("tapeMargin",e,t)}function IT(e,t){return A("hideExtraLetters",e,t)}function BT(e,t){return A("timerStyle",e,t)}function qT(e,t){return A("liveSpeedStyle",e,t)}function FT(e,t){return A("liveAccStyle",e,t)}function RT(e,t){return A("liveBurstStyle",e,t)}function DT(e,t){return A("timerColor",e,t)}function WT(e,t){return A("timerOpacity",e,t)}function PT(e,t){return A("showKeyTips",e,t)}function Ca(e,t){return A("time",e,t)}function Id(e,t){return A("quoteLength",e,t)}function Xi(e){return A("quoteLength",[0,1,2,3],e)}function Zs(e,t){return A("words",e,t)}function zT(e,t){return A("smoothCaret",e,t)}function HT(e,t){return A("codeUnindentOnBackspace",e,t)}function OT(e,t){return A("startGraphsAtZero",e,t)}function NT(e,t){return A("smoothLineScroll",e,t)}function UT(e,t){return A("quickRestart",e,t)}function Fb(e,t){return A("fontFamily",e,t)}function VT(e,t){return A("freedomMode",e,t)}function KT(e,t){return A("confidenceMode",e,t)}function GT(e,t){return A("indicateTypos",e,t)}function Rb(e,t){return A("autoSwitchTheme",e,t)}function xa(e,t){return A("customTheme",e,t)}function _p(e,t){return A("theme",e,t)}function jT(e,t){return A("themeLight",e,t)}function QT(e,t){return A("themeDark",e,t)}function YT(e,t){return A("randomTheme",e,t)}function XT(e,t){return A("britishEnglish",e,t)}function qc(e,t){return A("lazyMode",e,t)}function dn(e,t){return A("customThemeColors",e,t)}function un(e,t){return A("language",e,t)}function wo(e,t){return A("keymapMode",e,t)}function ZT(e,t){return A("keymapLegendStyle",e,t)}function JT(e,t){return A("keymapStyle",e,t)}function Fs(e,t){return A("keymapLayout",e,t)}function eL(e,t){return A("keymapShowTopRow",e,t)}function Bd(e,t){return A("keymapSize",e,t)}function Ya(e,t){return A("layout",e,t)}function tL(e,t){return A("fontSize",e,t)}function oL(e,t){return A("maxLineWidth",e,t)}function aL(e,t){return A("customBackground",e,t)}function sL(e,t){return A("customLayoutfluid",e,t)}function iL(e,t){return A("customPolyglot",e,t)}function Db(e,t){return A("customBackgroundSize",e,t)}function Oi(e,t){return A("customBackgroundFilter",e,t)}function nL(e,t){return A("burstHeatmap",e,t)}const Wg=new Set(["keymapMode","minWpm","minAcc","minBurst","paceCaret","quoteLength","words","time","mode","numbers","punctuation","funbox"]);async function fn(e){if(e==null)return;const t=Ld(e);Os("fullConfigChange");const o=Jo();for(const n of lt(t))r[n]=o[n];const a=[],s=lt(t).filter(n=>!Wg.has(n));for(const n of[...s,...Wg]){const l=t[n];A(n,l,!0)||a.push(n)}for(const n of a)Ep(n);Os("configApplied",void 0,void 0,void 0,r),Os("fullConfigChangeFinished")}async function Ip(){await fn(Jo()),await Mx(),xn(!0)}async function rL(){console.log("loading localStorage config");const e=Ap.get();e===void 0?await Ip():(await fn(e),xn(!0)),lL()}function Pg(){const e={};return lt(r).filter(t=>r[t]!==Jo()[t]).forEach(t=>{e[t]=r[t]}),e}async function Wb(e){try{const t=kn(e,zy.strip(),{migrate:o=>{if(Array.isArray(o))throw new Error("Invalid config");return Ld(o)}});await fn(t),xn(),m("Done",1)}catch(t){const o=ie(t,"Failed to import settings");console.error(o),m(o,-1)}}const{promise:Pb,resolve:lL}=Wa();class cL{constructor(){this.list=[],this.sectionIndexList=[],this.length=0}get(t,o=!1){var a,s;return t===void 0?this.list:o?(s=(a=this.list[t])==null?void 0:a.replace(/[.?!":\-,]/g,""))==null?void 0:s.toLowerCase():this.list[t]}getCurrent(){return this.list[ce]??""}getLast(){return this.list[this.list.length-1]}push(t,o){this.list.push(t),this.sectionIndexList.push(o),this.length=this.list.length}reset(){this.list=[],this.sectionIndexList=[],this.length=this.list.length}clean(){for(const t of this.list)if(/ +/.test(t)){const o=this.list.indexOf(t),a=t.split(" ");this.list.splice(o,1);for(let s=0;s<a.length;s++)this.list.splice(o+s,0,a[s])}}}const _=new cL;let Mr=!1,Ar=!1,Bp=!1,X=null;function cf(e){X=e}function dL(e){Mr=e}function uL(e){Ar=e}function fL(e){Bp=e}const zb=new Set(["NumpadMultiply","NumpadSubtract","NumpadAdd","NumpadDecimal","NumpadEqual","NumpadDivide","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","IntlBackslash","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","Space","Enter","Tab","NoCode"]);class pL{constructor(){this.current="",this.history=[],this.koreanStatus=!1}reset(){this.current="",this.history=[]}resetHistory(){this.history=[]}setKoreanStatus(t){this.koreanStatus=t}getKoreanStatus(){return this.koreanStatus}pushHistory(){this.history.push(this.current),this.current=""}popHistory(){return this.history.pop()??""}getHistory(t){return t===void 0?this.history:this.history[t]}getHistoryLast(){return js(this.history)}}class mL{constructor(){this.current="",this.history=[]}reset(){this.history=[],this.current=""}getHistory(t){return this.history[t]}popHistory(){return this.history.pop()??""}pushHistory(){this.history.push(this.current),this.current=""}}let Ta={};const k=new pL,Ze=new mL;let Js=[],Fc=0,qd=0,La={},lo={correct:0,incorrect:0},ke={spacing:{first:-1,last:-1,array:[]},duration:{array:[]}},fa={total:0,lastStartTime:-1},ds=[],cl=[],qo=[],dl=[],Er={count:0,words:[]},ul=[],Rc=!0;function df(){Fc++}function Hb(){Rc=!1}function Ob(){Er.count++}function uf(e){Er.words.push(e)}function gL(e){qd=e}function Fd(){Js.push(Fc),Fc=0}function Rd(){ul.push(Rc),Rc=!0}function Dd(){dl.push(Er),Er={count:0,words:[]}}function Nb(e){e?lo.correct++:lo.incorrect++}function hL(e){var n,l;const t=V(ec(ke.duration.array)),o=Object.entries(Ta);o.sort((c,d)=>c[1].timestamp-d[1].timestamp);for(const c of o)Ub(e,c[0]);const a=(n=js(o))==null?void 0:n[0],s=(l=Ta[a])==null?void 0:l.index;a!==void 0&&s!==void 0&&(ke.duration.array[s]=t)}let _r=0;function Ub(e,t){if(!zb.has(t))return;t==="NoCode"&&(_r--,t="NoCode"+_r);const o=Ta[t];if(o===void 0)return;const a=Math.abs(o.timestamp-e);ke.duration.array[o.index]=a,console.debug("Keyup recorded",t,a),delete Ta[t],Vb(e)}function yL(e,t){var o;if(!zb.has(t)){console.debug("Key not tracked",t);return}if(t==="NoCode"&&(t="NoCode"+_r,_r++),Ta[t]!==void 0){console.debug("Key already down",t);return}if(Ta[t]={timestamp:e,index:ke.duration.array.length},ke.duration.array.push(0),Vb((o=Ta[t])==null?void 0:o.timestamp),ke.spacing.last!==-1){const a=Math.abs(e-ke.spacing.last);ke.spacing.array.push(V(a)),console.debug("Keydown recorded",t,a)}ke.spacing.last=e,ke.spacing.first===-1&&(ke.spacing.first=e,console.debug("First keydown recorded",t,e))}function Vb(e){Object.keys(Ta).length>1?fa.lastStartTime===-1&&(fa.lastStartTime=e):fa.lastStartTime!==-1&&(fa.total+=e-fa.lastStartTime,fa.lastStartTime=-1)}function bL(){ke={spacing:{first:-1,last:-1,array:[]},duration:{array:[]}},fa={total:0,lastStartTime:-1},Ta={},_r=0,console.debug("Keypress timings reset")}function Kb(e){Object.keys(La).includes(e)?La[e]++:La[e]=1}function Gb(e){ds.push(e)}function jb(e){cl.push(e)}function Qb(e){qo[ce]===void 0?qo.push(e):qo[ce]=e}function vL(){ds=[],cl=[],qo=[],Js=[],Fc=0,ul=[],Rc=!0,dl=[],Er={count:0,words:[]},qd=0,La={},lo={correct:0,incorrect:0},ke={spacing:{first:-1,last:-1,array:[]},duration:{array:[]}}}let Dc=!0;const jt=document.querySelector("#caret");function Yb(){Dc&&(jt.style.animationName="none",jt.style.opacity="1",Dc=!1)}function Xb(){Dc||(r.smoothCaret!=="off"&&!De()?jt.style.animationName="caretFlashSmooth":jt.style.animationName="caretFlashHard",Dc=!0)}function fl(){jt.classList.add("hidden")}function wL(e){if(!e){const o=document.querySelector("#words .word");if(o)e=o;else return 0}const t=window.getComputedStyle(e);return parseInt(t.marginRight)+parseInt(t.marginLeft)}function CL(e,t,o,a,s,n,l){const c=r.blindMode||r.hideExtraLetters;let d=0;const u=Ed(l,Ro,hi);if(r.tapeMode==="off"){let f=0;const p=o[n],h=o[s-1],g=o[n-1];u?n<=s&&p?f=p.offsetLeft+(e?0:a):c?f=((h==null?void 0:h.offsetLeft)??0)-(e?a:0):f=((g==null?void 0:g.offsetLeft)??0)-(e?a:0):n<s&&p?f=p.offsetLeft:c?f=((h==null?void 0:h.offsetLeft)??0)+((h==null?void 0:h.offsetWidth)??0):f=((g==null?void 0:g.offsetLeft)??0)+((g==null?void 0:g.offsetWidth)??0),d=t.offsetLeft+f}else if(d=(i(document.querySelector("#wordsWrapper")).width()??0)*(u?1-r.tapeMargin/100:r.tapeMargin/100)-(e&&u?a:0),r.tapeMode==="word"&&n>0){let h=0,g=0;for(let y=0;y<n&&!(c&&y>=s);y++){const b=i(o[y]).outerWidth(!0)??0;h+=b,b>0&&(g=b)}i(o[n]).outerWidth(!0)===0&&(h-=g),u&&(h*=-1),d+=h}return d}function kL(e,t,o,a,s){var l;let n=e==null?void 0:e.offsetWidth;if(n===void 0||o===0)n=wL(t);else if(n===0)for(let c=a;c>=0&&(n=(l=s[c])==null?void 0:l.offsetWidth,!n);c--);return n??0}async function Ea(e=!1){const t=window.getComputedStyle(jt),o=parseInt(t.width)||0,a=parseInt(t.height)||0,s=["block","outline","underline"].includes(r.caretStyle);let n=Xo(_.getCurrent()).length;const l=Xo(k.current).length;r.mode==="zen"&&(n=l);const c=document.querySelector(`#words .word[data-wordindex='${ce}']`);if(!c)return;const d=c.querySelectorAll("letter");if(!(d!=null&&d.length))return;const u=d[l],f=d[l-1],p=d[n-1],h=(nr(u==null?void 0:u.offsetHeight)??0)||(nr(f==null?void 0:f.offsetHeight)??0)||(nr(p==null?void 0:p.offsetHeight)??0)||r.fontSize*Ys(1),g=(u==null?void 0:u.offsetTop)??(f==null?void 0:f.offsetTop)??(p==null?void 0:p.offsetTop)??0,y=h-a;let b=c.offsetTop+g+y/2;r.caretStyle==="underline"&&(b=c.offsetTop+g-a/2);const C=kL(u,c,n,l,d),L=r.mode==="zen"?k.current:_.getCurrent(),q=CL(s,c,d,C,n,l,L)-(s?0:o/2),P=i(jt);P.css("display","block");const $={top:b-xd,left:q};s&&($.width=`${C}px`);const H=r.smoothCaret==="off"?0:r.smoothCaret==="slow"?150:r.smoothCaret==="medium"?100:r.smoothCaret==="fast"?85:0;P.stop(!0,!1).animate($,De()||e?0:H)}function SL(){jt.style.width="",jt.classList.remove("off","default","underline","outline","block","carrot","banana"),jt.classList.add(r.caretStyle)}be(e=>{e==="caretStyle"&&(SL(),Ea(!0)),e==="smoothCaret"&&(r.smoothCaret==="off"?jt.style.animationName="caretFlashHard":jt.style.animationName="caretFlashSmooth")});function xL(e=!1){jt.classList.remove("hidden"),Ea(e),Xb()}class Wn{constructor(t,o,a,s,n){this.unit=t,this.convertFactor=o,this.fullUnitString=a,this.histogramDataBucketSize=s,this.historyStepSize=n}fromWpm(t){return t*this.convertFactor}toWpm(t){return t/this.convertFactor}}const TL={wpm:new Wn("wpm",1,"Words per Minute",10,10),cpm:new Wn("cpm",5,"Characters per Minute",50,100),wps:new Wn("wps",1/60,"Words per Second",.5,2),cps:new Wn("cps",5/60,"Characters per Second",5,5),wph:new Wn("wph",60,"Words per Hour",250,1e3)};function gt(e){return TL[e]}const Cu={suffix:"",fallback:"-",showDecimalPlaces:void 0,rounding:Math.round};class LL{constructor(t){this.config=t}typingSpeed(t,o={}){const a={...Cu,...o};if(t==null)return a.fallback??"";const s=gt(this.config.typingSpeedUnit).fromWpm(t);return this.number(s,a)}percentage(t,o={}){const a={...Cu,...o};return a.suffix="%"+(a.suffix??""),this.number(t,a)}accuracy(t,o={}){return this.percentage(t,{rounding:Math.floor,...o})}decimals(t,o={}){const a={...Cu,...o};return this.number(t,a)}number(t,o){if(t==null)return o.fallback??"";const a=o.suffix??"";return(o.showDecimalPlaces!==void 0?o.showDecimalPlaces:this.config.alwaysShowDecimalPlaces)?V(t).toFixed(2)+a:(o.rounding??Math.round)(t).toString()+a}rank(t,o={}){const a={fallback:"-",...o};if(t==null)return a.fallback??"";let s="th";const n=t%10,l=t%100;return n===1&&l!==11&&(s="st"),n===2&&l!==12&&(s="nd"),n===3&&l!==13&&(s="rd"),t+s}}const N=new LL(r),Ir=document.querySelector("#liveStatsTextBottom .liveSpeed"),Br=document.querySelector("#liveStatsMini .speed");function $L(){Ir.innerHTML="0",Br.innerHTML="0"}function ML(e,t){let o=e;r.blindMode&&(o=t);const a=N.typingSpeed(o,{showDecimalPlaces:!1});Ir.innerHTML=a,Br.innerHTML=a}let Wc=!1;function qp(){r.liveSpeedStyle!=="off"&&Ee&&(Wc||(r.liveSpeedStyle==="mini"?i(Br).stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:1},125):i(Ir).stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:1},125),Wc=!0))}function Wd(){Wc&&(i(Ir).stop(!0,!1).animate({opacity:0},125,()=>{Ir.classList.add("hidden")}),i(Br).stop(!0,!1).animate({opacity:0},125,()=>{Br.classList.add("hidden")}),Wc=!1)}be((e,t)=>{e==="liveSpeedStyle"&&(t==="off"?Wd():qp())});const qr=document.querySelector("#liveStatsTextBottom .liveBurst"),Fr=document.querySelector("#liveStatsMini .burst");function AL(){qr.innerHTML="0",Fr.innerHTML="0"}async function EL(e){const t=N.typingSpeed(e,{showDecimalPlaces:!1});Fr.innerHTML=t,qr.innerHTML=t}let Pc=!1;function Fp(){r.liveBurstStyle!=="off"&&Ee&&(Pc||(r.liveBurstStyle==="mini"?i(Fr).stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:1},125):i(qr).stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:1},125),Pc=!0))}function Pd(){Pc&&(i(qr).stop(!0,!1).animate({opacity:0},125,()=>{i(qr).addClass("hidden")}),i(Fr).stop(!0,!1).animate({opacity:0},125,()=>{i(Fr).addClass("hidden")}),Pc=!1)}be((e,t)=>{e==="liveBurstStyle"&&(t==="off"?Pd():Fp())});const Rr=document.querySelector("#liveStatsTextBottom .liveAcc"),Dr=document.querySelector("#liveStatsMini .acc");function _L(e){let t=Math.floor(e);r.blindMode&&(t=100),Dr.innerHTML=t+"%",Rr.innerHTML=t+"%"}function IL(){Dr.innerHTML="100%",Rr.innerHTML="100%"}let zc=!1;function Rp(){r.liveAccStyle!=="off"&&Ee&&(zc||(r.liveAccStyle==="mini"?i(Dr).stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:1},125):i(Rr).stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:1},125),zc=!0))}function zd(){zc&&(i(Rr).stop(!0,!1).animate({opacity:0},125,()=>{i(Rr).addClass("hidden")}),i(Dr).stop(!0,!1).animate({opacity:0},125,()=>{i(Dr).addClass("hidden")}),zc=!1)}be((e,t)=>{e==="liveAccStyle"&&(t==="off"?zd():Rp())});const BL=D.record(D.string(),D.string()),qL=D.record(D.string(),D.object({text:D.string(),progress:D.number()})),Zb=new Bt({key:"customText",schema:BL,fallback:{}}),Jb=new Bt({key:"customTextLong",schema:qL,fallback:{}}),ev=oS.omit({textLen:!0}).extend({text:D.array(D.string()).min(1)}),zg={text:["The","quick","brown","fox","jumps","over","the","lazy","dog"],mode:"repeat",limit:{value:9,mode:"word"},pipeDelimiter:!1},ht=new Bt({key:"customTextSettings",schema:ev,fallback:zg,migrate:(e,t)=>{const o=structuredClone(zg);if(typeof e!="object"||e===null)return o;const a=o;return"text"in e&&D.array(D.string()).safeParse(a.text).success&&(a.text=e.text),a}});function pl(){return ht.get().text}function _a(e){const t=ht.get();ht.set({...t,text:e,limit:{value:e.length,mode:t.limit.mode}})}function lc(){return ht.get().mode}function pn(e){const t=ht.get();ht.set({...t,mode:e,limit:{value:t.text.length,mode:t.limit.mode}})}function Hg(){return ht.get().limit}function xe(){return ht.get().limit.value}function Te(){return ht.get().limit.mode}function Ko(e){const t=ht.get();ht.set({...t,limit:{value:e,mode:t.limit.mode}})}function $o(e){const t=ht.get();ht.set({...t,limit:{value:t.limit.value,mode:e}})}function ml(){return ht.get().pipeDelimiter}function ei(e){const t=ht.get();ht.set({...t,pipeDelimiter:e})}function Ia(){return ht.get()}function Hc(e,t=!1){if(t){const a=Tn()[e];if(a===void 0)throw new Error(`Custom text ${e} not found`);return a.text.split(/ +/)}else{const o=Hd()[e];if(o===void 0)throw new Error(`Custom text ${e} not found`);return o.split(/ +/)}}function FL(e,t,o=!1){if(o){const a=Tn();a[e]={text:"",progress:0};const s=a[e];if(s===void 0)throw new Error("Custom text not found");return typeof t=="string"?s.text=t:s.text=t.join(" "),Wp(a)}else{const a=Hd();return typeof t=="string"?a[e]=t:a[e]=t.join(" "),ov(a)}}function tv(e,t){const o=t?Tn():Hd();delete o[e],t?Wp(o):ov(o)}function Dp(e){const t=Tn()[e];if(t===void 0)throw new Error("Custom text not found");return t.progress??0}function ff(e,t){const o=Tn(),a=o[e];if(a===void 0)throw new Error("Custom text not found");a.progress=t,Wp(o)}function Hd(){return Zb.get()}function Tn(){return Jb.get()}function ov(e){return Zb.set(e)}function Wp(e){return Jb.set(e)}function pf(e=!1){return Object.keys(e?Tn():Hd())}let Pp=0;function gl(){return Pp}function RL(e){Pp=e}function DL(){Pp++}const mf=i("#barTimerProgress .bar"),av=i("#barTimerProgress .opacityWrapper"),Od=i("#liveStatsTextTop .timerProgress"),Wr=i("#liveStatsMini .time");function zp(){r.mode!=="zen"&&r.timerStyle==="bar"?av.stop(!0,!0).removeClass("hidden").css("opacity",0).animate({opacity:1},125):r.timerStyle==="text"?Od.stop(!0,!0).removeClass("hidden").css("opacity",0).animate({opacity:1},125):(r.mode==="zen"||r.timerStyle==="mini")&&Wr.stop(!0,!0).removeClass("hidden").css("opacity",0).animate({opacity:1},125)}function WL(){let e="0vw";(r.mode==="time"||r.mode==="custom"&&Te()==="time")&&(e="100vw"),mf.stop(!0,!0).animate({width:e},0),Wr.text("0"),Od.text("0")}function Nd(){av.stop(!0,!0).animate({opacity:0},125),Wr.stop(!0,!0).animate({opacity:0},125,()=>{Wr.addClass("hidden")}),Od.stop(!0,!0).animate({opacity:0},125)}const Ua=Od[0],Va=Wr[0];function Og(){return r.mode==="custom"&&Te()==="section"?_.sectionIndexList[ce]-1:k.getHistory().length}function hl(){const e=gl();if(r.mode==="time"||r.mode==="custom"&&Te()==="time"){let t=r.time;if(r.mode==="custom"&&Te()==="time"&&(t=xe()),r.timerStyle==="bar"){const o=100-(e+1)/t*100;mf.stop(!0,!0).animate({width:o+"vw"},De()?0:1e3,"linear")}else if(r.timerStyle==="text"){let o=rt(t-e);t===0&&(o=rt(e)),Ua!==null&&(Ua.innerHTML="<div>"+o+"</div>")}else if(r.timerStyle==="mini"){let o=rt(t-e);t===0&&(o=rt(e)),Va!==null&&(Va.innerHTML=o)}}else if(r.mode==="words"||r.mode==="custom"||r.mode==="quote"){let t=_.length;if(r.mode==="words"&&(t=r.words),r.mode==="custom"&&(t=xe()),r.mode==="quote"&&(t=(X==null?void 0:X.textSplit.length)??1),r.timerStyle==="bar"){const o=Math.floor((ce+1)/t*100);mf.stop(!0,!0).animate({width:o+"vw"},De()?0:250)}else r.timerStyle==="text"?t===0?Ua!==null&&(Ua.innerHTML=`<div>${k.getHistory().length}</div>`):Ua!==null&&(Ua.innerHTML=`<div>${Og()}/${t}</div>`):r.timerStyle==="mini"&&(t===0?Va!==null&&(Va.innerHTML=`${k.getHistory().length}`):Va!==null&&(Va.innerHTML=`${Og()}/${t}`))}else r.mode==="zen"&&(r.timerStyle==="text"?Ua!==null&&(Ua.innerHTML=`<div>${k.getHistory().length}</div>`):Va!==null&&(Va.innerHTML=`${k.getHistory().length}`))}function PL(){Ee&&(Nd(),hl(),r.timerStyle!=="off"&&setTimeout(()=>{zp()},125))}be((e,t)=>{e==="timerStyle"&&PL()});const Oc=new Map;function sv(e,t){zL(e);const o=requestAnimationFrame(()=>{Oc.delete(e),t()});Oc.set(e,o)}function zL(e){const t=Oc.get(e);t!==void 0&&(cancelAnimationFrame(t),Oc.delete(e))}const Ng=3;let Kn=!1,Ug=!1,Ho={};function HL(){if(Ug)return;const e="body, button, a",t=["app","header","footer","main","#bannerCenter","#notificationCenter","#capsWarning","#ad-vertical-right-wrapper","#ad-vertical-left-wrapper","#ad-footer-wrapper","#ad-footer-small-wrapper"].join(",");Ho.cursor=[...document.querySelectorAll(e)],Ho.focus=[...document.querySelectorAll(t)],Ug=!0}function Do(e,t=!1){sv("focus.set",()=>{if(HL(),e&&!Kn){if(Kn=!0,Ho.focus)for(const o of Ho.focus)o.classList.add("focus");if(!t&&Ho.cursor)for(const o of Ho.cursor)o.style.cursor="none";Yb(),qp(),Fp(),Rp(),zp()}else if(!e&&Kn){if(Kn=!1,Ho.focus)for(const o of Ho.focus)o.classList.remove("focus");if(Ho.cursor)for(const o of Ho.cursor)o.style.cursor="";Xb(),Wd(),Pd(),zd(),Nd()}})}i(document).on("mousemove",function(e){Qs()||Kn&&e.originalEvent&&(e.originalEvent.movementX>Ng||e.originalEvent.movementY>Ng)&&Do(!1)});const OL={title:"Minimum word burst...",configKey:"minBurst",list:[{id:"setMinBurstOff",display:"off",configValue:"off",exec:()=>{rc("off")}},{id:"setMinBurstFixed",display:"fixed...",configValue:"fixed",input:!0,exec:({input:e})=>{if(e===void 0||e==="")return;rc("fixed");const t=gt(r.typingSpeedUnit).toWpm(parseInt(e));Dg(t)}},{id:"setMinBurstFlex",display:"flex...",configValue:"flex",input:!0,exec:({input:e})=>{if(e===void 0||e==="")return;rc("flex");const t=gt(r.typingSpeedUnit).toWpm(parseInt(e));Dg(t)}}]},iv=[{id:"changeMinBurst",display:"Minimum word burst...",alias:"minimum",icon:"fa-bomb",subgroup:OL}],nv=[];function Ln(){i("#words, #koInputVisualContainer").css("transition","none").removeClass("blurred"),i(".outOfFocusWarning").addClass("hidden"),Rk(nv)}function rv(){nv.push(setTimeout(()=>{i("#words, #koInputVisualContainer").css("transition","0.25s").addClass("blurred"),i(".outOfFocusWarning").removeClass("hidden")},1e3))}const NL=window.fetch;async function UL(e){var t;try{if(!e)throw new Error("No URL");const o=await NL(e);if(o.ok){if(!((t=o.headers.get("content-type"))!=null&&t.startsWith("application/json")))throw new Error("Content is not JSON");return await o.json()}else throw new Error(`${o.status} ${o.statusText}`)}catch(o){throw console.error("Error fetching JSON: "+e,o),o}}function VL(e,t){const o=new Map;return async(...a)=>{const s=a[0];if(o.has(s)){const l=await o.get(s);if(l!==void 0)return l}const n=e.apply(null,a);return o.set(s,n),n}}const ys=VL(UL);async function Ns(e){return await ys(`/layouts/${e}.json`)}let Bl;async function $n(e){return(Bl===void 0||Bl.name!==e)&&(Bl=await ys(`/languages/${e}.json`)),Bl}async function KL(e){const t=await $n(e);return t.orderedByFrequency===!0?"yes":t.orderedByFrequency===!1?"no":"unknown"}async function GL(e){return await $n(e)}class lv{constructor(t,o,a){this.title=t,this.author=o,this.words=a}}async function cv(){return await ys("/challenges/_list.json")}async function jL(){return await ys("/about/supporters.json")}async function QL(){return await ys("/about/contributors.json")}async function YL(){const e=await ys("https://api.github.com/repos/monkeytypegame/monkeytype/releases?per_page=1");if(e[0]===void 0||e[0].name===void 0)throw new Error("No release found");return e[0].name}async function XL(){return ys("https://api.github.com/repos/monkeytypegame/monkeytype/releases?per_page=5")}function so(e,t,o){const a=Vg(e),s=Vg(t);if(a&&s){const n=a.a??1,l=s.a??1,c=Math.round(a.r*(1-o)+s.r*o),d=Math.round(a.g*(1-o)+s.g*o),u=Math.round(a.b*(1-o)+s.b*o),f=n*(1-o)+l*o;return a.a!==void 0||s.a!==void 0||f!==1?Kg(c,d,u,f):Kg(c,d,u)}else return"#ff00ffff"}function Vg(e){if(e.length!==4&&e.length!==5&&e.length!==7&&e.length!==9||!e.startsWith("#"))return;let t,o,a,s;if(e.length===4)t=+("0x"+e[1]+e[1]),o=+("0x"+e[2]+e[2]),a=+("0x"+e[3]+e[3]);else if(e.length===5)t=+("0x"+e[1]+e[1]),o=+("0x"+e[2]+e[2]),a=+("0x"+e[3]+e[3]),s=+("0x"+e[4]+e[4])/255;else if(e.length===7)t=+("0x"+e[1]+e[2]),o=+("0x"+e[3]+e[4]),a=+("0x"+e[5]+e[6]);else if(e.length===9)t=+("0x"+e[1]+e[2]),o=+("0x"+e[3]+e[4]),a=+("0x"+e[5]+e[6]),s=+("0x"+e[7]+e[8])/255;else return;const n={r:t,g:o,b:a};return s!==void 0&&(n.a=s),n}function Kg(e,t,o,a){const s=Math.round(e).toString(16).padStart(2,"0"),n=Math.round(t).toString(16).padStart(2,"0"),l=Math.round(o).toString(16).padStart(2,"0");if(a!==void 0){const c=Math.round(a*255).toString(16).padStart(2,"0");return`#${s}${n}${l}${c}`}return`#${s}${n}${l}`}function Nc(e){let t,o,a,s;e.length===4?(t="0x"+e[1]+e[1],o="0x"+e[2]+e[2],a="0x"+e[3]+e[3]):e.length===5?(t="0x"+e[1]+e[1],o="0x"+e[2]+e[2],a="0x"+e[3]+e[3],s=("0x"+e[4]+e[4])/255):e.length===7?(t="0x"+e[1]+e[2],o="0x"+e[3]+e[4],a="0x"+e[5]+e[6]):e.length===9?(t="0x"+e[1]+e[2],o="0x"+e[3]+e[4],a="0x"+e[5]+e[6],s=("0x"+e[7]+e[8])/255):(t=0,o=0,a=0),t/=255,o/=255,a/=255;const n=Math.min(t,o,a),l=Math.max(t,o,a),c=l-n;let d=0,u=0,f=0;c===0?d=0:l===t?d=(o-a)/c%6:l===o?d=(a-t)/c+2:d=(t-o)/c+4,d=Math.round(d*60),d<0&&(d+=360),f=(l+n)/2,u=c===0?0:c/(1-Math.abs(2*f-1)),u=+(u*100).toFixed(1),f=+(f*100).toFixed(1);const p={hue:d,sat:u,lgt:f,string:s!==void 0?`hsla(${d}, ${u}%, ${f}%, ${s.toFixed(3)})`:`hsl(${d}, ${u}%, ${f}%)`};return s!==void 0&&(p.alpha=s),p}function ZL(e){return Nc(e).lgt>=50}function dv(e){return Nc(e).lgt<50}function JL(e){const t=e.match(/^rgb\((\d+), \s*(\d+), \s*(\d+)\)$/);if(t===null||t.length<3)return;function o(a){return("0"+parseInt(a).toString(16)).slice(-2)}return"#"+o(t[1])+o(t[2])+o(t[3])}const Ud={composing:!1,startPos:-1};function Us(){return Ud.composing}function e$(){return Ud.startPos}function Hp(e){Ud.composing=e}function t$(e){Ud.startPos=e}const $t=16,uv=12,gf=$t/2,o$=uv/2,Gg=250;let Pt=[],ct,mn={},Uc=[],Vd=[],dr=[],Op=[],Ni=[],ql,Ti,fv=new Date,Pr=!1,pv=!1,hf=!0,Vc=!0,Fl=!1;async function a$(e,t){if(!pv||Ni!==void 0&&e===Ni[0]&&t===Ni[1]||!Pr&&!await i$()||e===void 0||t===void 0||e<0||t<0||t<e)return!1;t=Math.min(t,ct.length-1);const o=n$(e,t,Ro);for(let a=0;a<Pt.length;a++){const s=Vd[a],n=s.children[0];s.classList.remove("highlight-hidden"),!hf&&!Vc?(s.classList.add("withAnimation"),n.classList.add("withAnimation")):(s.classList.remove("withAnimation"),n.classList.remove("withAnimation"));const l=o[a];l&&(s.style.right=l.highlightRight+"px",n.style.left=l.inputContainerLeft+"px",s.style.left=l.highlightLeft+"px")}return hf=!1,Vc=!1,Ni=[e,t],!0}function s$(){for(const e of Vd)e.classList.add("highlight-hidden");Vc=!0,Ni=[]}function Np(){if(Pr){for(const e of Uc)e.remove();Vd=[],Uc=[],mn={},Pt=[],dr=[],Op=[],Pr=!1,hf=!0,Vc=!0,Ni=[]}}function mv(e){pv=e}async function i$(){if(Pr||Fl)return!1;Fl=!0;const e=new Date().getTime()-fv.getTime();if(e<Gg&&await new Promise(d=>setTimeout(d,Gg-e)),ql=i("#resultWordsHistory")[0],Ti=ql.getBoundingClientRect(),ct=i(ql).find(".words .word[input]"),ct.length===0)return Fl=!1,!1;let t=-1,o,a=0;mn[0]=0;for(let d=1;d<ct.length;d++){const u=ct[d],f=ct[d-1];u.offsetTop!==f.offsetTop&&(a++,o=ir([ct[t+1],f]),Pt.push({firstWordIndex:t+1,lastWordIndex:d-1,rect:o}),t=d-1),mn[d]=a}o=ir([ct[t+1],ct[ct.length-1]]),Pt.push({firstWordIndex:t+1,lastWordIndex:ct.length-1,rect:o});const s=Ti.width,n=Ti.height,l=Ti.top,c=Ti.left;return Pt.forEach(d=>{const u=document.createElement("div");u.classList.add("highlightContainer"),Uc.push(u);const f=d.rect.top-o$,p=d.rect.left-gf,h=f-l,g=p-c,y=d.rect.width+$t,b=d.rect.height+uv,C=d.rect.width,L=d.rect.height,S=h/n*100+"%",q=g/s*100+"%",P=y/s*100+"%",$=b/n*100+"%";u.style.width=P,u.style.top=S,u.style.left=q,u.style.height=$;const H=document.createElement("div"),R=document.createElement("div");R.style.top=d.rect.top-f+"px",R.style.left=d.rect.left-p+"px",R.style.width=C+"px",R.style.height=L+"px",H.className="highlight highlight-hidden",R.className="inputWordsContainer";for(let Pe=d.firstWordIndex;Pe<=d.lastWordIndex;Pe+=1){const j=ct[Pe],ne=j.getAttribute("input")??"";if(!ne)continue;const fe=document.createElement("div");let me;Ro?me=d.rect.left-Ti.left+$t:me=0,fe.style.left=j.offsetLeft+gf-me+"px",fe.innerHTML=ne.replace(/\t/g,"_").replace(/\n/g,"_").replace(/</g,"&lt").replace(/>/g,"&gt").slice(0,j.childElementCount),fe.className="inputWord",R.append(fe),Op.push(fe)}dr.push(R),Vd.push(H),H.append(R),u.append(H),ql.append(u)}),Pr=!0,Fl=!1,!0}function n$(e,t,o=!1){const a=mn[e],s=new Array(Pt.length).fill(null).map(()=>({highlightLeft:0,highlightRight:0,inputContainerLeft:0,inputContainerRight:0})),n=r$(e,t),l=ct[e],c=Pt[a],d=s[a],u=Uc[a],f=dr[a];if(l===void 0||c===void 0||d===void 0||u===void 0||f===void 0)return s;if(!o)d.highlightLeft=l.offsetLeft,d.highlightRight=c.rect.width-(d.highlightLeft+n)+$t;else{const p=u.offsetLeft;d.highlightRight=c.rect.width-(l.offsetLeft+l.offsetWidth)+p+gf,d.highlightLeft=c.rect.width-(d.highlightRight+n)+$t}o?d.inputContainerLeft=-1*(f.getBoundingClientRect().width-n-d.highlightRight):d.inputContainerLeft=-1*d.highlightLeft;for(let p=a-1;p>=0;p--){const h=s[p],g=s[p+1],y=Pt[p],b=dr[p];h===void 0||y===void 0||g===void 0||b===void 0||(o?(h.highlightRight=g.highlightRight+y.rect.width+$t,h.highlightLeft=y.rect.width-(h.highlightRight+n)+$t,h.inputContainerLeft=-1*(b.getBoundingClientRect().width-n-h.highlightRight)):(h.highlightLeft=g.highlightLeft+y.rect.width+$t,h.highlightRight=y.rect.width-(h.highlightLeft+n)+$t,h.inputContainerLeft=-1*h.highlightLeft))}for(let p=a+1;p<Pt.length;p++){const h=s[p],g=Pt[p-1],y=Pt[p],b=s[p-1],C=dr[p];h===void 0||g===void 0||y===void 0||b===void 0||C===void 0||(o?(h.highlightRight=-1*(g.rect.width-b.highlightRight+$t),h.highlightLeft=y.rect.width-(h.highlightRight+n)+$t,h.inputContainerLeft=-1*(C.getBoundingClientRect().width-n-h.highlightRight)):(h.highlightLeft=-1*(g.rect.width-b.highlightLeft+$t),h.highlightRight=y.rect.width-(h.highlightLeft+n)+$t,h.inputContainerLeft=-1*h.highlightLeft))}return s}function r$(e,t){var y,b;const o=mn[e],a=mn[t];if(o===void 0||a===void 0)return 0;const s=ct[e],n=ct[t],l=Op[t],c=ct[((y=Pt[o])==null?void 0:y.lastWordIndex)??-1],d=ct[((b=Pt[a])==null?void 0:b.firstWordIndex)??-1];if(s===void 0||n===void 0||l===void 0||c===void 0||d===void 0)return 0;if(o===a){const C=ir([s,n]),L=n.getBoundingClientRect(),S=l.getBoundingClientRect();let q=C.width+$t;return q-=L.width-S.width,q}const u=ir([s,c]),f=ir([d,n]);let p=u.width+f.width;for(let C=o+1;C<a;C++)p+=Pt[C].rect.width;p+=2*$t*(a-o);const h=n.getBoundingClientRect(),g=l.getBoundingClientRect();return p-=h.width-g.width,p}function l$(){fv=new Date}let gv="loading";function Z(){return gv}function jg(e){gv=e}let Pn=null;class Kc{constructor(t){this.words=t,this.length=this.words.length,this.shuffledIndexes=[],this.orderedIndex=0}resetIndexes(){this.orderedIndex=0,this.shuffledIndexes=[]}randomWord(t){return t==="zipf"?this.words[Dk(this.words.length)]:_o(this.words)}shuffledWord(){return this.shuffledIndexes.length===0&&this.generateShuffledIndexes(),this.words[this.shuffledIndexes.pop()]}generateShuffledIndexes(){this.shuffledIndexes=[];for(let t=0;t<this.length;t++)this.shuffledIndexes.push(t);rn(this.shuffledIndexes)}nextWord(){return this.orderedIndex>=this.length&&(this.orderedIndex=0),this.words[this.orderedIndex++]}}async function c$(e){return(Pn===null||e!==Pn.words)&&(Pn=new Kc(e)),Pn.resetIndexes(),Pn}function d$(){return Math.floor(Math.random()*256).toString(2).padStart(8,"0")}function u$(){const e=Ct(1,4);return Array.from({length:e},()=>Math.floor(Math.random()*256).toString(16).padStart(2,"0")).join("")}function f$(e){const t={a:".-",b:"-...",c:"-.-.",d:"-..",e:".",f:"..-.",g:"--.",h:"....",i:"..",j:".---",k:"-.-",l:".-..",m:"--",n:"-.",o:"---",p:".--.",q:"--.-",r:".-.",s:"...",t:"-",u:"..-",v:"...-",w:".--",x:"-..-",y:"-.--",z:"--..",0:"-----",1:".----",2:"..---",3:"...--",4:"....-",5:".....",6:"-....",7:"--...",8:"---..",9:"----.",".":".-.-.-",",":"--..--","?":"..--..","'":".----.","/":"-..-.","(":"-.--.",")":"-.--.-","&":".-...",":":"---...",";":"-.-.-.","=":"-...-","+":".-.-.","-":"-....-",_:"..--.-",'"':".-..-.",$:"...-..-","!":"-.-.--","@":".--.-."};let o="";const a=Jx(e);for(let s=0;s<a.length;s++){const n=t[a.toLowerCase()[s]];o+=n!==void 0?n+"/":""}return o}function p$(){const e=Ct(1,7);let t="";for(let o=0;o<e;o++)t+=String.fromCharCode(97+Ct(0,25));return t}function m$(){const e=Ct(1,10);let t="";for(let o=0;o<e;o++){const a=33+Ct(0,93);t+=String.fromCharCode(a)}return t}const g$=["`","~","!","@","#","$","%","^","&","*","(",")","-","_","=","+","{","}","[","]","'",'"',"/","\\","|","?",";",":",">","<",",","."];function h$(){const e=Ct(1,7);let t="";for(let o=0;o<e;o++)t+=_o(g$);return t}function hv(e){const t=Ct(1,e);let o="";for(let a=0;a<t;a++){let s;a===0?s=Ct(1,9):s=Ct(0,9),o+=s.toString()}return o}let Zi={};function Xe(e,t,o){Zi[e]??(Zi[e]={value:t,setFunction:o})}function yv(){Object.keys(Zi).forEach(e=>{const t=Zi[e];t.setFunction(t.value,!0)}),Zi={}}const bv=[];function y$(e){bv.push(e)}async function b$(e){bv.forEach(t=>{try{t(e)}catch(o){console.error("TTS event subscriber threw an error"),console.error(o)}})}let zn=!1,Rl=0,ku=0,Qg=0,Yg=3,Li=0,$i=0;function v$(e){ku--;let t=Math.round(Math.random()),o=Math.round(Math.random()*5-.5);return e?(zn=!!Math.round(Math.random()),zn?o=3:o=0):(zn?(Qg===t?Li++:Li=0,(Li>1||$i>0&&Li>0)&&(t=1-t,Li=0),Qg=t,o=t*(Rl+1)):(Yg===t?$i++:$i=0,($i>1||$i>0&&Li>0)&&(t=1-t,$i=0),Yg=t,o=3-t*(Rl+1)),zn=!zn,ku<0&&t===0&&(Rl=1-Rl,ku=Math.floor(Math.random()*3)+3)),o}function w$(e){const t=["←","↓","↑","→"];let o="";for(let a=0;a<4;a++)o+=t[v$(a===0&&e)];return o}function vv(){i("#typingTest #layoutfluidTimer").stop(!0,!0).animate({opacity:1},125)}function ur(){i("#typingTest #layoutfluidTimer").stop(!0,!0).animate({opacity:0},125)}function Su(e,t){i("#typingTest #layoutfluidTimer").text(`${_t(t)} in: ${e}s`)}function C$(e,t){const o=_t(t.replace(/_/g," "));let a=`${o} in: ${e} words`;e===1&&(a=`${o} starting next word`),i("#typingTest #layoutfluidTimer").text(a)}const Up=[];function k$(e){Up.push(e)}async function wv(e,t){Up.forEach(o=>{try{o("flash",e,t)}catch(a){console.error("Keymap flash event subscriber threw an error"),console.error(a)}})}async function Za(e){Up.forEach(t=>{try{t("highlight",e)}catch(o){console.error("Keymap highlight event subscriber threw an error"),console.error(o)}})}let Ka=null,cc=null;function S$(){i("#typingTest #memoryTimer").stop(!0,!0).animate({opacity:1},125)}function Cv(){i("#typingTest #memoryTimer").stop(!0,!0).animate({opacity:0},125)}function gn(){cc!==null&&(clearInterval(cc),cc=null),Ka=null,Cv()}function x$(e){gn(),Ka=e,Xg(Ka),S$(),cc=setInterval(()=>{Ka!==null&&(Ka-=1,Ka===0?Cv():Xg(Ka),Ka<=0&&(gn(),i("#wordsWrapper").addClass("hidden")))},1e3)}function Xg(e){i("#typingTest #memoryTimer").text(`Timer left to memorise all words: ${e}s`)}const T$=new Set(["—","_"," "]),L$=100,$$="https://poetrydb.org/random";class M$ extends lv{constructor(t,o,a){super(t,o,a),this.title=t,this.author=o,this.words=a,this.cleanUpText()}cleanUpText(){let t=0;const o=[];for(const a of this.words){let s="";for(const n of a)T$.has(n)||(s+=n);if(s!==""&&(o.push(s),t++,t===L$))break}this.words=o}}async function A$(){console.log("Getting poem");try{const o=(await(await fetch($$)).json())[0];if(!o)return!1;const a=[];return o.lines.forEach(s=>{s.split(/ +/).forEach(n=>{a.push(n)})}),new M$(o.title,o.author,a)}catch(e){return console.log(e),!1}}const Vp=Ny._def.values,kv={english:["english","english_1k","english_5k","english_10k","english_25k","english_450k","english_commonly_misspelled","english_contractions","english_doubleletter","english_shakespearean","english_old","english_medical"],spanish:["spanish","spanish_1k","spanish_10k","spanish_650k"],french:["french","french_1k","french_2k","french_10k","french_600k","french_bitoduc"],german:["german","german_1k","german_10k","german_250k"],swiss_german:["swiss_german","swiss_german_1k","swiss_german_2k"],portuguese:["portuguese","portuguese_1k","portuguese_3k","portuguese_5k","portuguese_320k","portuguese_550k","portuguese_acentos_e_cedilha"],arabic:["arabic","arabic_10k"],arabic_egypt:["arabic_egypt","arabic_egypt_1k"],arabic_morocco:["arabic_morocco"],italian:["italian","italian_1k","italian_7k","italian_60k","italian_280k"],friulian:["friulian"],latin:["latin"],afrikaans:["afrikaans","afrikaans_1k","afrikaans_10k"],mongolian:["mongolian","mongolian_10k"],korean:["korean","korean_1k","korean_5k"],khmer:["khmer"],marathi:["marathi"],chinese:["chinese_traditional","chinese_simplified","chinese_simplified_1k","chinese_simplified_5k","chinese_simplified_10k","chinese_simplified_50k"],russian:["russian","russian_1k","russian_5k","russian_10k","russian_25k","russian_50k","russian_375k","russian_contractions","russian_contractions_1k","russian_abbreviations"],polish:["polish","polish_2k","polish_5k","polish_10k","polish_20k","polish_40k","polish_200k"],czech:["czech","czech_1k","czech_10k"],slovak:["slovak","slovak_1k","slovak_10k"],ukrainian:["ukrainian","ukrainian_1k","ukrainian_10k","ukrainian_50k","ukrainian_endings"],ukrainian_latynka:["ukrainian_latynka","ukrainian_latynka_1k","ukrainian_latynka_10k","ukrainian_latynka_50k","ukrainian_latynka_endings"],lithuanian:["lithuanian","lithuanian_1k","lithuanian_3k"],indonesian:["indonesian","indonesian_1k","indonesian_10k"],kurdish_central:["kurdish_central","kurdish_central_2k","kurdish_central_4k"],greek:["greek","greek_1k","greek_5k","greek_10k","greek_25k"],greeklish:["greeklish","greeklish_1k","greeklish_5k","greeklish_10k","greeklish_25k"],turkish:["turkish","turkish_1k","turkish_5k"],irish:["irish"],galician:["galician"],thai:["thai","thai_1k","thai_5k","thai_10k","thai_20k","thai_50k","thai_60k"],tamil:["tamil","tamil_1k","tanglish","tamil_old"],kannada:["kannada"],telugu:["telugu","telugu_1k"],slovenian:["slovenian","slovenian_1k","slovenian_5k"],croatian:["croatian","croatian_1k"],dutch:["dutch","dutch_1k","dutch_10k"],filipino:["filipino","filipino_1k"],danish:["danish","danish_1k","danish_10k"],hungarian:["hungarian","hungarian_2k"],norwegian_bokmal:["norwegian_bokmal","norwegian_bokmal_1k","norwegian_bokmal_5k","norwegian_bokmal_10k","norwegian_bokmal_150k","norwegian_bokmal_600k"],norwegian_nynorsk:["norwegian_nynorsk","norwegian_nynorsk_1k","norwegian_nynorsk_5k","norwegian_nynorsk_10k","norwegian_nynorsk_100k","norwegian_nynorsk_400k"],hebrew:["hebrew","hebrew_1k","hebrew_5k","hebrew_10k"],icelandic:["icelandic","icelandic_1k"],malagasy:["malagasy","malagasy_1k"],malay:["malay","malay_1k"],romanian:["romanian","romanian_1k","romanian_5k","romanian_10k","romanian_25k","romanian_50k","romanian_100k","romanian_200k"],finnish:["finnish","finnish_1k","finnish_10k"],estonian:["estonian","estonian_1k","estonian_5k","estonian_10k"],udmurt:["udmurt"],welsh:["welsh","welsh_1k"],persian:["persian","persian_1k","persian_5k","persian_20k","persian_romanized"],kazakh:["kazakh","kazakh_1k"],vietnamese:["vietnamese","vietnamese_1k","vietnamese_5k"],jyutping:["jyutping"],pinyin:["pinyin","pinyin_1k","pinyin_10k"],hausa:["hausa","hausa_1k"],swedish:["swedish","swedish_1k","swedish_diacritics"],serbian:["serbian","serbian_latin","serbian_10k","serbian_latin_10k"],georgian:["georgian"],yoruba:["yoruba_1k"],swahili:["swahili_1k"],maori:["maori_1k"],catalan:["catalan","catalan_1k"],bulgarian:["bulgarian","bulgarian_latin"],bosnian:["bosnian","bosnian_4k"],esperanto:["esperanto","esperanto_1k","esperanto_10k","esperanto_25k","esperanto_36k","esperanto_x_sistemo","esperanto_x_sistemo_1k","esperanto_x_sistemo_10k","esperanto_x_sistemo_25k","esperanto_x_sistemo_36k","esperanto_h_sistemo","esperanto_h_sistemo_1k","esperanto_h_sistemo_10k","esperanto_h_sistemo_25k","esperanto_h_sistemo_36k"],bangla:["bangla","bangla_letters","bangla_10k"],urdu:["urdu","urdu_1k","urdu_5k","urdish"],albanian:["albanian","albanian_1k"],shona:["shona","shona_1k"],armenian:["armenian","armenian_1k","armenian_western","armenian_western_1k"],myanmar:["myanmar_burmese"],japanese:["japanese_hiragana","japanese_katakana","japanese_romaji","japanese_romaji_1k"],hindi:["hindi","hindi_1k","hinglish"],sanskrit:["sanskrit","sanskrit_roman"],gujarati:["gujarati","gujarati_1k"],nepali:["nepali","nepali_1k","nepali_romanized"],santali:["santali"],macedonian:["macedonian","macedonian_1k","macedonian_10k","macedonian_75k"],uzbek:["uzbek","uzbek_1k","uzbek_70k"],belarusian:["belarusian","belarusian_1k","belarusian_5k","belarusian_10k","belarusian_25k","belarusian_50k","belarusian_100k"],belarusian_lacinka:["belarusian_lacinka","belarusian_lacinka_1k"],tatar:["tatar","tatar_1k","tatar_5k","tatar_9k"],tatar_crimean:["tatar_crimean","tatar_crimean_1k","tatar_crimean_5k","tatar_crimean_10k","tatar_crimean_15k","tatar_crimean_cyrillic","tatar_crimean_cyrillic_1k","tatar_crimean_cyrillic_5k","tatar_crimean_cyrillic_10k","tatar_crimean_cyrillic_15k"],azerbaijani:["azerbaijani","azerbaijani_1k"],malayalam:["malayalam"],sinhala:["sinhala"],latvian:["latvian","latvian_1k"],maltese:["maltese","maltese_1k"],toki_pona:["toki_pona","toki_pona_ku_suli","toki_pona_ku_lili"],xhosa:["xhosa","xhosa_3k"],tibetan:["tibetan","tibetan_1k"],bashkir:["bashkir"],other:["lojban_gismu","lojban_cmavo","pig_latin","twitch_emotes","git","typing_of_the_dead","league_of_legends","docker_file"],amharic:["amharic","amharic_1k","amharic_5k"],oromo:["oromo","oromo_1k","oromo_5k"],wordle:["wordle","wordle_1k"],kyrgyz:["kyrgyz","kyrgyz_1k"],yiddish:["yiddish"],frisian:["frisian","frisian_1k"],pashto:["pashto"],euskera:["euskera"],klingon:["klingon","klingon_1k"],quenya:["quenya"],lorem_ipsum:["lorem_ipsum"],occitan:["occitan","occitan_1k","occitan_2k","occitan_5k","occitan_10k"],kabyle:["kabyle","kabyle_1k","kabyle_2k","kabyle_5k","kabyle_10k"],zulu:["zulu"],hawaiian:["hawaiian","hawaiian_1k"],code:["code_python","code_python_1k","code_python_2k","code_python_5k","code_c","code_css","code_csharp","code_c++","code_dart","code_brainfck","code_fsharp","code_javascript","code_javascript_1k","code_javascript_react","code_jule","code_julia","code_haskell","code_html","code_nim","code_nix","code_pascal","code_java","code_kotlin","code_go","code_rockstar","code_rust","code_ruby","code_r","code_r_2k","code_swift","code_scala","code_bash","code_powershell","code_lua","code_luau","code_latex","code_typst","code_matlab","code_sql","code_perl","code_php","code_vim","code_vimscript","code_opencl","code_visual_basic","code_arduino","code_systemverilog","code_elixir","code_gleam","code_zig","code_gdscript","code_gdscript_2","code_assembly","code_v","code_ook","code_typescript","code_cobol","code_common_lisp","code_odin","code_fortran","code_abap","code_abap_1k","code_yoptascript","code_cuda"],viossa:["viossa","viossa_njutro"]},Kp=Array.from(Object.keys(kv));function E$(e){return Kp.find(t=>t.includes(e))}async function _$(e){switch(e){case"english":return"en";case"spanish":return"es";case"french":return"fr";case"german":return"de";case"portuguese":return"pt";case"arabic":return"ar";case"italian":return"it";case"latin":return"la";case"afrikaans":return"af";case"korean":return"ko";case"russian":return"ru";case"polish":return"pl";case"czech":return"cs";case"slovak":return"sk";case"ukrainian":return"uk";case"lithuanian":return"lt";case"indonesian":return"id";case"greek":return"el";case"turkish":return"tr";case"thai":return"th";case"tamil":return"ta";case"slovenian":return"sl";case"croatian":return"hr";case"dutch":return"nl";case"danish":return"da";case"hungarian":return"hu";case"norwegian_bokmal":return"no";case"norwegian_nynorsk":return"nn";case"hebrew":return"he";case"malay":return"ms";case"romanian":return"ro";case"finnish":return"fi";case"estonian":return"et";case"welsh":return"cy";case"persian":return"fa";case"kazakh":return"kk";case"vietnamese":return"vi";case"swedish":return"sv";case"serbian":return"sr";case"georgian":return"ka";case"catalan":return"ca";case"bulgarian":return"bg";case"esperanto":return"eo";case"bangla":return"bn";case"urdu":return"ur";case"armenian":return"hy";case"myanmar":return"my";case"hindi":return"hi";case"macedonian":return"mk";case"uzbek":return"uz";case"belarusian":return"be";case"azerbaijani":return"az";case"latvian":return"lv";case"euskera":return"eu";default:return"en"}}const I$=D.object({query:D.object({pages:D.record(D.string(),D.object({extract:D.string()}))})});async function B$(e){J();let t="en";const o=E$(e);o!==void 0&&(t=await _$(o));const a=`https://${t}.wikipedia.org/api/rest_v1/page/random/summary`,s={title:"",author:""},n=await fetch(a);let l=0;if(n.status===200){const c=await n.json();s.title=c.title,s.author=c.author,l=c.pageid}return new Promise((c,d)=>{n.status!==200&&(K(),d(n.status));const u=`https://${t}.wikipedia.org/w/api.php?action=query&format=json&pageids=${l}&prop=extracts&exintro=true&origin=*`,f=new XMLHttpRequest;f.onload=()=>{if(f.readyState===4)if(f.status===200){const h=kn(f.responseText,I$).query.pages[l.toString()];if(!h){K(),d("Page not found");return}let g=h.extract;g=g.replace(/<\/p><p>+/g," "),g=Wk(g),g=g.replace(/\[\d+\]/gi,""),g=g.replace(/[\u200B-\u200D\uFEFF]/g,""),g=Eb(g),t==="en"&&(g=g.replace(/[^\x20-\x7E]+/g,"")),g=g.replace(/\s+/g," "),g=g.trim();const y=g.split(" "),b=new lv(s.title,s.author,y);K(),c(b)}else K(),d(f.status)},f.open("GET",u),f.send()})}const q$=50,F$=20,R$=5e3,fr={};class D${constructor(){this.average=0,this.count=0}update(t){this.count<q$&&this.count++;const o=1/this.count;this.average=t*o+this.average*(1-o)}}function W$(e,t){var s;const o=ke.spacing.array;if(o.length===0||typeof o=="string")return;let a=o[o.length-1];t||(a+=R$),e in fr||(fr[e]=new D$),(s=fr[e])==null||s.update(a)}function P$(e){let t=0,o=0;for(const a of e)a in fr&&(t+=fr[a].average,o++);return o===0?0:t/o}function z$(e){let t,o="";for(let a=0;a<F$;a++){const s=e.randomWord("normal"),n=P$(s);(a===0||t===void 0||n>t)&&(o=s,t=n)}return o}function Sv(e,t,o,a,s){const n=[],l=Math.round(e/t);for(let c=0;c<t;c++){let u=Ct(0,2**l-1).toString(o);if(a){const f=Math.ceil(l/Math.ceil(Math.log2(o)));u="0".repeat(Math.max(0,f-u.length))+u}n.push(u)}return n.join(s)}function Zg(e,t,o,a,s,n){const l=s.split(a).map(u=>parseInt(u,o)),c=Math.round(e/t);let d=n;for(let u=0;u<t;u++)d-=c,d<0&&(-d<=c?l[u]&=2**c-1^2**-d-1:l[u]=0);return l.map(u=>u.toString(o)).join(a)+"/"+n.toString()}function H$(){return Sv(32,4,10,!1,".")}function O$(){return Sv(128,8,16,!0,":")}function Jg(e){return e.includes(":")?Zg(128,8,16,":",e,Ct(16,32)*4):Zg(32,4,10,".",e,Ct(8,32))}function N$(e){const t=e.split("/");let o=t[0].split(":"),a="";o=o.map(f=>f.replace(/^0+/gm,""));let s=0,n=-1,l=-1,c=0,d=-1,u=-1;for(let f=0;f<o.length;f++)o[f]===""?(d===-1&&(d=f),c++):(u=f-1,s<c&&(s=c,n=d,l=u),c=0,d=-1,u=-1);return s<c&&(s=c,n=d,l=o.length-1),o=o.map((f,p)=>f===""?p>=n&&p<=l&&n!==l?":":"0":f),a=o.join(":"),a=a.replace(/:{3,}/gm,"::"),t.length>1&&(a+="/"+t[1]),a}class it extends Error{constructor(t){super(t),this.name="WordGenError"}}async function xu(e){const t=(k.current??"").slice(-1),o=_.getCurrent().slice(k.current.length-1,k.current.length),a=t===o;e.key==="Backspace"&&!a&&(k.current!==""||k.getHistory(ce-1)!==_.get(ce-1)||r.freedomMode)?i("#words").addClass("read_ahead_disabled"):e.key===" "&&i("#words").removeClass("read_ahead_disabled")}class U${constructor(){this.chars={},this.count=0}addChar(t){this.count++,t in this.chars?this.chars[t]++:this.chars[t]=1}randomChar(){const t=Ct(0,this.count-1);let o=0;for(const[a,s]of Object.entries(this.chars))if(o+=s,o>t)return a;return Object.keys(this.chars)[0]}}class V$ extends Kc{constructor(t){super(t),this.ngrams={},this.length=1/0;for(let o of t){o+=" ";let a="";for(const s of o)a in this.ngrams||(this.ngrams[a]=new U$),this.ngrams[a].addChar(s),a=(a+s).slice(-2)}}randomWord(){let t="";for(;;){const o=t.slice(-2),a=this.ngrams[o];if(!a){t="";continue}const s=a.randomChar();if(s===" ")break;t+=s}return t}}const K$={58008:{getWord(){let e=hv(7);return r.language.startsWith("kurdish")?e=Dy(e):r.language.startsWith("nepali")&&(e=Wy(e)),e},punctuateWord(e){if(e.length>3&&(Math.random()<.5&&(e=Rg(e,Ct(1,e.length-2),".")),Math.random()<.75)){const t=Ct(1,e.length-2);if(e[t-1]!=="."&&e[t+1]!=="."&&e[t+1]!=="0"){const o=_o(["/","*","-","+"]);e=Rg(e,t,o)}}return e},rememberSettings(){Xe("numbers",r.numbers,Sa)},handleChar(e){return e===`
`?" ":e}},simon_says:{applyConfig(){wo("next",!0)},rememberSettings(){Xe("keymapMode",r.keymapMode,wo)}},tts:{applyConfig(){wo("off",!0)},rememberSettings(){Xe("keymapMode",r.keymapMode,wo)},toggleScript(e){if(window.speechSynthesis===void 0){m("Failed to load text-to-speech script",-1);return}e[0]!==void 0&&b$(e[0])}},arrows:{getWord(e,t){return w$(t===0)},rememberSettings(){Xe("highlightMode",r.highlightMode,Is)},handleChar(e){return e==="a"||e==="ArrowLeft"||e==="j"?"←":e==="s"||e==="ArrowDown"||e==="k"?"↓":e==="w"||e==="ArrowUp"||e==="i"?"↑":e==="d"||e==="ArrowRight"||e==="l"?"→":e},isCharCorrect(e,t){return(e==="a"||e==="ArrowLeft"||e==="j")&&t==="←"||(e==="s"||e==="ArrowDown"||e==="k")&&t==="↓"||(e==="w"||e==="ArrowUp"||e==="i")&&t==="↑"||(e==="d"||e==="ArrowRight"||e==="l")&&t==="→"},async preventDefaultEvent(e){return["ArrowLeft","ArrowUp","ArrowRight","ArrowDown"].includes(e.key)},getWordHtml(e,t){let o="";return e==="↑"&&(t&&(o+="<letter>"),o+='<i class="fas fa-arrow-up"></i>',t&&(o+="</letter>")),e==="↓"&&(t&&(o+="<letter>"),o+='<i class="fas fa-arrow-down"></i>',t&&(o+="</letter>")),e==="←"&&(t&&(o+="<letter>"),o+='<i class="fas fa-arrow-left"></i>',t&&(o+="</letter>")),e==="→"&&(t&&(o+="<letter>"),o+='<i class="fas fa-arrow-right"></i>',t&&(o+="</letter>")),o}},rAnDoMcAsE:{alterText(e){let t=e[0];for(let o=1;o<e.length;o++)t[o-1]===t[o-1].toUpperCase()?t+=e[o].toLowerCase():t+=e[o].toUpperCase();return t}},backwards:{alterText(e){return e.split("").reverse().join("")}},capitals:{alterText(e){return yi(e)}},layout_mirror:{applyConfig(){let e=r.layout;r.layout==="default"&&(e="qwerty"),Ya(e,!0),Fs("overrideSync",!0)},rememberSettings(){Xe("keymapMode",r.keymapMode,wo),Xe("layout",r.layout,Ya)}},layoutfluid:{applyConfig(){const e=r.customLayoutfluid[0]??"qwerty";Ya(e,!0),Fs(e,!0)},rememberSettings(){Xe("keymapMode",r.keymapMode,wo),Xe("layout",r.layout,Ya),Xe("keymapLayout",r.keymapLayout,Fs)},handleSpace(){if(r.mode!=="time"){const e=r.customLayoutfluid,t=_.length,o=Math.floor(t/e.length),a=Math.floor((k.getHistory().length+1)/o),s=o-(ce+1)%o;e[a]?(s<=3&&e[a+1]?(vv(),C$(s,e[a+1])):ur(),s===o&&(Ya(e[a]),Fs(e[a]),s>3&&ur())):ur(),setTimeout(()=>{Za(_.getCurrent().charAt(k.current.length))},1)}},getResultContent(){return r.customLayoutfluid.join(" ")},restart(){this.applyConfig&&this.applyConfig(),setTimeout(()=>{Za(_.getCurrent().substring(k.current.length,k.current.length+1))},1)}},gibberish:{getWord(){return p$()}},ascii:{getWord(){return m$()}},specials:{getWord(){return h$()}},read_ahead_easy:{rememberSettings(){Xe("highlightMode",r.highlightMode,Is)},async handleKeydown(e){await xu(e)}},read_ahead:{rememberSettings(){Xe("highlightMode",r.highlightMode,Is)},async handleKeydown(e){await xu(e)}},read_ahead_hard:{rememberSettings(){Xe("highlightMode",r.highlightMode,Is)},async handleKeydown(e){await xu(e)}},memory:{applyConfig(){i("#wordsWrapper").addClass("hidden"),lf(!0,!0),r.keymapMode==="next"&&wo("react",!0)},rememberSettings(){Xe("mode",r.mode,ut),Xe("showAllLines",r.showAllLines,lf),r.keymapMode==="next"&&Xe("keymapMode",r.keymapMode,wo)},start(){gn(),i("#words").addClass("hidden")},restart(){x$(Math.round(Math.pow(_.length,1.2))),i("#words").removeClass("hidden"),r.keymapMode==="next"&&wo("react")}},nospace:{rememberSettings(){Xe("highlightMode",r.highlightMode,Is)}},poetry:{async pullSection(){return A$()}},wikipedia:{async pullSection(e){return B$((e??"")||"english")}},weakspot:{getWord(e){return e!==void 0?z$(e):""}},pseudolang:{async withWords(e){return e!==void 0?new V$(e):new Kc([])}},IPv4:{getWord(){return H$()},punctuateWord(e){let t=e;return Math.random()<.25&&(t=Jg(e)),t},rememberSettings(){Xe("numbers",r.numbers,Sa)}},IPv6:{getWord(){return O$()},punctuateWord(e){let t=e;return Math.random()<.25&&(t=Jg(e)),t.includes(":")&&(t=N$(t)),t},rememberSettings(){Xe("numbers",r.numbers,Sa)}},binary:{getWord(){return d$()}},hexadecimal:{getWord(){return u$()},punctuateWord(e){return`0x${e}`},rememberSettings(){Xe("punctuation",r.punctuation,cs)}},zipf:{getWordsFrequencyMode(){return"zipf"}},ddoouubblleedd:{alterText(e){return e.replace(/./gu,"$&$&")}},instant_messaging:{alterText(e){return e.toLowerCase().replace(/[.!?]$/g,`
`).replace(/[().'"]/g,"").replace(/\n+/g,`
`)}},morse:{alterText(e){return f$(e)}},underscore_spaces:{alterText(e,t,o){return t===o-1?e:e+"_"}},crt:{applyGlobalCSS(){if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){const t=navigator.userAgent.match(/.*Version\/([0-9]*)\.([0-9]*).*/),o=t!==null?parseInt(t[1]??"0"):0,a=t!==null?parseInt(t[2]??"0"):0;if(o<=16&&a<=5){m("CRT is not available on Safari 16.5 or earlier.",0,{duration:5}),Yi("crt");return}}i("body").append('<div id="scanline" />'),i("body").addClass("crtmode"),i("#globalFunBoxTheme").attr("href","funbox/crt.css")},clearGlobal(){i("#scanline").remove(),i("body").removeClass("crtmode"),i("#globalFunBoxTheme").attr("href","")}},ALL_CAPS:{alterText(e){return e.toUpperCase()}},polyglot:{async withWords(e){const t=r.customPolyglot.map(async s=>$n(s).catch(()=>(m(`Failed to load language: ${s}. It will be ignored.`,0),null))),o=(await Promise.all(t)).filter(s=>s!==null);if(o.length===0)throw Yi("polyglot"),new Error(`No valid languages found. Please check your polyglot languages config (${r.customPolyglot.join(", ")}).`);if(o.length===1){const s=o[0];throw un(s.name,!0),Yi("polyglot",!0),m(`Disabled polyglot funbox because only one valid language was found. Check your polyglot languages config (${r.customPolyglot.join(", ")}).`,0,{duration:7}),new it("")}const a=o.flatMap(s=>s.words);return rn(a),new Kc(a)}}};function G$(){return K$}const j$=aS(),Q$=G$(),yf={};for(const[e,t]of Object.entries(j$))yf[e]={...t,functions:Q$[e]};function bf(e){return Array.isArray(e)?e.map(o=>yf[o]):yf[e]}function za(){return bf(ho())}function ho(){return r.funbox??[]}function xv(e){return za().filter(t=>{var o;return(o=t.properties)==null?void 0:o.includes(e)})}function bs(e){return xv(e).length>0}function Tv(e){return ho().includes(e)}function yt(e){return za().filter(t=>{var o;return(o=t.functions)==null?void 0:o[e]})}function Lv(e){return yt(e).length>0}function Ha(e){const t=yt(e);if(t.length!==0){if(t.length===1)return t[0];throw new Error(`Expecting exactly one funbox implementing "${e} but found ${t.length}`)}}const Y$=It(250,async()=>{const e=await KL(r.language);e==="no"&&m(`${_t(ea(r.language))} does not support Zipf funbox, because the list is not ordered by frequency. Please try another word list.`,0,{duration:7}),e==="unknown"&&m(`${_t(ea(r.language))} may not support Zipf funbox, because we don't know if it's ordered by frequency or not. If you would like to add this label, please contact us.`,0,{duration:7})}),Kd=Pk(Z$,{rejectSkippedCalls:!1});be((e,t,o)=>{(e==="language"||e==="funbox")&&r.funbox.includes("zipf")&&Y$(),e==="fontSize"&&(i("#caret, #paceCaret, #liveStatsMini, #typingTest, #wordsInput").css("fontSize",t+"rem"),o||(Ln(),Cf())),["fontSize","fontFamily","blindMode","hideExtraLetters"].includes(e)&&Kd(),e==="theme"&&Ji(),t!==void 0&&(e==="highlightMode"&&Z()==="test"&&Gd(),["highlightMode","blindMode","indicateTypos","tapeMode","hideExtraLetters"].includes(e)&&Cf(),["tapeMode","tapeMargin"].includes(e)&&uM(),e==="showAllLines"&&(jp(!0),t===!1&&qv()),typeof t=="boolean"&&(e==="flipTestColors"&&tM(t),e==="colorfulMode"&&oM(t),e==="burstHeatmap"&&Ji()))});let vf=!1,wf=0,ti=!1;function $v(e){ti=e}function X$(){wf=0}function oi(){const e=document.querySelector("#wordsInput");if(e==null||e.blur(),e==null||e.focus({preventScroll:!0}),Ee)Mv(!0);else{const t=document.querySelector("#typingTest");Py(t)}}function Mv(e=!1){const t=document.querySelector("#wordsInput"),o=document.querySelector("#wordsWrapper");if(!t||!o)return;const a=o.offsetHeight,s=window.innerHeight;a<s||!(t.getBoundingClientRect().top>s/2)&&!e||t.scrollIntoView({block:"center"})}function bi(e){return document.querySelector(`#words .word[data-wordindex='${e}']`)}function Po(){return bi(ce)}function Gd(e,t=!1){const o=document.querySelector("#words .active");e||o==null||o.classList.add("typed"),r.mode==="zen"&&e?o==null||o.remove():o!==null&&!t&&o.classList.remove("active");const a=Po();if(a===null)throw new Error("activeWord is null - can't update active element");a.classList.add("active"),a.classList.remove("error"),a.classList.remove("typed"),a.offsetTop,Gp(),!t&&r.tapeMode!=="off"&&jd()}function Av(e,t,o,a=!0){const s=typeof o=="string",n=s?Xo(o):o;let l="",c=0;for(const d of e)for(const u of d){const f=t[u],p=`${u}`,h=s?n[u]:n[c++];l+=`<hint data-chars-index=${p} style="left:${f.offsetLeft+f.offsetWidth/2}px;">${h}</hint>`}return a&&(l=`<div class="hints">${l}</div>`),l}async function Ev(e,t,o){var c,d;const a=Ed(_.getCurrent(),Ro,hi);let s=!1,n=0,l=o.length;for(;n<l-1;){const u=o[n],f=o[n+1],p=((c=u.dataset.charsIndex)==null?void 0:c.split(","))??[],h=((d=f.dataset.charsIndex)==null?void 0:d.split(","))??[],g=parseInt(p[0]??"0"),y=parseInt(h[0]??"0");if(!e.some(R=>R.includes(g)&&R.includes(y))){n++,s=!1;continue}const C=t[g],L=t[y],S=C.offsetTop===L.offsetTop,q=a?f:u,P=a?u:f,$=q.offsetLeft+q.offsetWidth/2,H=P.offsetLeft-P.offsetWidth/2;if(S&&$>H){u.dataset.charsIndex=[...p,...h].join(",");const R=C.offsetLeft+(a?C.offsetWidth:0),Pe=f.offsetLeft-u.offsetLeft;u.style.left=R+Pe+"px",u.insertAdjacentHTML("beforeend",f.innerHTML),f.remove(),l--,s&&n>0&&n--}else n++;s=!0}}async function Z$(){var n;if(Z()!=="test"||de||r.indicateTypos!=="below")return;let e,t=[],o=[];const a=document.querySelectorAll(".hints > hint");for(const l of a){const c=l.parentElement;c!==e&&(await s(e,t,o),e=c,t=[],o=[]);const d=(n=l.dataset.charsIndex)==null?void 0:n.split(",").map(u=>parseInt(u));if(!(d===void 0||d.length===0)){for(const u of d){const f=t[t.length-1];f&&f[f.length-1]===u-1?f.push(u):t.push([u])}o.push(...Xo(l.innerHTML))}}await s(e,t,o);async function s(l,c,d){if(!l||c.length===0)return;const u=l.parentElement,f=u.querySelectorAll("letter");l.innerHTML=Av(c,f,d,!1);const p=u.getElementsByTagName("hint");await Ev(c,f,p)}}function _v(e,t){let o=!1,a=`<div class='word' data-wordindex='${t}'>`;const s=Ha("getWordHtml"),n=Xo(e);for(const l of n)s?a+=s.functions.getWordHtml(l,!0):l==="	"?a+=`<letter class='tabChar'><i class="fas fa-long-arrow-alt-right fa-fw"></i></letter>`:l===`
`?(o=!0,a+=`<letter class='nlChar'><i class="fas fa-level-down-alt fa-rotate-90 fa-fw"></i></letter>`):a+="<letter>"+l+"</letter>";return a+="</div>",o&&(a+="<div class='beforeNewline'></div><div class='newline'></div><div class='afterNewline'></div>"),a}function Cf(){var t,o,a;r.tapeMode!=="off"?(i("#words").addClass("tape"),i("#wordsWrapper").addClass("tape")):(i("#words").removeClass("tape"),i("#wordsWrapper").removeClass("tape")),r.blindMode?(i("#words").addClass("blind"),i("#wordsWrapper").addClass("blind")):(i("#words").removeClass("blind"),i("#wordsWrapper").removeClass("blind")),r.indicateTypos==="below"?(i("#words").addClass("indicateTyposBelow"),i("#wordsWrapper").addClass("indicateTyposBelow")):(i("#words").removeClass("indicateTyposBelow"),i("#wordsWrapper").removeClass("indicateTyposBelow")),r.hideExtraLetters?(i("#words").addClass("hideExtraLetters"),i("#wordsWrapper").addClass("hideExtraLetters")):(i("#words").removeClass("hideExtraLetters"),i("#wordsWrapper").removeClass("hideExtraLetters"));const e=((a=(o=(t=i("#words"))==null?void 0:t.attr("class"))==null?void 0:o.split(/\s+/))==null?void 0:a.filter(s=>!s.startsWith("highlight-")))??[];r.highlightMode!==null&&e.push("highlight-"+r.highlightMode.replaceAll("_","-")),i("#words").attr("class",e.join(" ")),Fv(),jp(!0),eM(Gp,[])}function J$(){if(i("#words").empty(),r.mode==="zen")Iv();else{let e="";for(let t=0;t<_.length;t++)e+=_v(_.get(t),t);i("#words").html(e)}Gd(void 0,!0),Cf(),setTimeout(()=>{Ea()},125)}function Iv(e=k.getHistory().length){i("#words").append(`<div class='word' data-wordindex='${e}'><letter class='invisible'>_</letter></div>`)}function Gp(){sv("test-ui.updateWordsInputPosition",()=>{if(Z()!=="test")return;const e=hi?!Ro:Ro,t=document.querySelector("#wordsInput"),o=document.querySelector("#wordsWrapper");if(!t||!o)return;const a=Po();if(!a){t.style.top="0px",t.style.left="0px";return}const s=Ys(r.fontSize),n=a.offsetTop+s/2-t.offsetHeight/2+1;r.tapeMode!=="off"?t.style.maxWidth=`${100-r.tapeMargin}%`:t.style.maxWidth="",a.offsetWidth<s?t.style.width=s+"px":t.style.width=a.offsetWidth+"px",t.style.top=n+"px",r.tapeMode!=="off"?t.style.left=`${o.offsetWidth*(r.tapeMargin/100)}px`:a.offsetWidth<s&&e?t.style.left=a.offsetLeft-s+"px":t.style.left=Math.max(0,a.offsetLeft)+"px",Mv()})}let Bv=Promise.resolve();async function qv(){var n;if(r.showAllLines)return;const{resolve:e,promise:t}=Wa();Bv=t;const o=Po();if(!o){e();return}const a=o.offsetTop;let s=a;for(let l=ce-1;l>=0;l--)if(s=((n=bi(l))==null?void 0:n.offsetTop)??a,s<a){await Qp(s,!0),e();return}e()}function jp(e=!1){var u;if(Z()!=="test"||de||!e&&r.mode!=="custom")return;const t=document.getElementById("wordsWrapper"),o=document.querySelector(".outOfFocusWarning"),a=Po();if(!a)return;t.classList.remove("hidden");const s=window.getComputedStyle(a),n=parseInt(s.marginTop)+parseInt(s.marginBottom),l=a.offsetHeight+n,c=r.mode==="time"||r.mode==="custom"&&Te()==="time"||r.mode==="custom"&&xe()===0;if(r.showAllLines&&!c)t.style.height="";else if(r.mode==="zen")t.style.height=l*2+"px";else if(r.tapeMode==="off"){let f=0,p=0,h=0,g=0;for(;f<3;){const y=bi(h);if(!y)break;const b=y.offsetTop;b>p&&(f++,g+=y.offsetHeight+n,p=b),h++}f<3&&(g=g*(3/f)),t.style.height=g+"px"}else if(Ar)t.style.height=l*3+"px";else{const f=((u=document.getElementById("words"))==null?void 0:u.offsetHeight)??l;t.style.height=f+"px"}o.style.maxHeight=l*3+"px"}function eM(e,t){const o=()=>{e(...t),Kd()};if(r.tapeMode!=="off")jd(!0,o);else{const a=document.getElementById("words"),s=a.querySelectorAll(".afterNewline");if(r.smoothLineScroll){const n=i(a);n.stop("leftMargin",!0,!1).animate({marginLeft:0},{duration:De()?0:125,queue:"leftMargin",complete:o}),n.dequeue("leftMargin"),i(s).stop(!0,!1).animate({marginLeft:0},De()?0:125)}else{a.style.marginLeft="0";for(const n of s)n.style.marginLeft="0";o()}}}function eh(e,t=_.length-1){i("#words").append(_v(e,t))}function tM(e){e?i("#words").addClass("flipped"):i("#words").removeClass("flipped")}function oM(e){e?i("#words").addClass("colorfulMode"):i("#words").removeClass("colorfulMode")}async function Mo(e){var c;const t=e??k.current,o=_.getCurrent();if(!o&&r.mode!=="zen")return;let a="";const s=Po();if(!s)return;const n=[];let l=!1;if(r.mode==="zen"){for(const d of k.current)d==="	"?a+=`<letter class='tabChar correct' style="opacity: 0"><i class="fas fa-long-arrow-alt-right fa-fw"></i></letter>`:d===`
`?(l=!0,a+=`<letter class='nlChar correct' style="opacity: 0"><i class="fas fa-level-down-alt fa-rotate-90 fa-fw"></i></letter>`):a+=`<letter class="correct">${d}</letter>`;k.current===""&&(a+="<letter class='invisible'>_</letter>")}else{let d=!1;const u=k.getKoreanStatus();if(u){const g=nt.disassemble(o).join(""),y=nt.disassemble(t).join(""),b=Ga.test(t)?t.search(Ga):y.length;t.search(Ga)<nt.d(g).length&&g.slice(0,b)===y.slice(0,b)&&(d=!0)}else{const g=Ga.test(t)?t.search(Ga):t.length;t.search(Ga)<o.length&&o.slice(0,g)===t.slice(0,g)&&(d=!0)}const f=Ha("getWordHtml"),p=Xo(t),h=Xo(o);for(let g=0;g<p.length;g++){const y=h[g]===p[g];let b=h[g],C="",L="";if(f){const S=f.functions.getWordHtml(b);S!==""&&(b=S)}else b==="	"?(C="tabChar",b='<i class="fas fa-long-arrow-alt-right fa-fw"></i>'):b===`
`&&(L="nlChar",b='<i class="fas fa-level-down-alt fa-rotate-90 fa-fw"></i>');if(y)a+=`<letter class="correct ${C}${L}">${b}</letter>`;else if(b!==void 0&&Us()&&g>=e$()&&!(u&&!d))a+=`<letter class="dead">${r.indicateTypos==="replace"?p[g]===" "?"_":p[g]:b}</letter>`;else if(b===void 0){let S=p[g];(S===" "||S==="	"||S===`
`)&&(S="_"),a+=`<letter class="incorrect extra ${C}${L}">${S}</letter>`}else if(a+=`<letter class="incorrect ${C}${L}">`+(r.indicateTypos==="replace"?p[g]===" "?"_":p[g]:b)+"</letter>",r.indicateTypos==="below"){const S=n[n.length-1];S&&S[S.length-1]===g-1?S.push(g):n.push([g])}}for(let g=p.length;g<h.length;g++){const y=h[g];(c=f==null?void 0:f.functions)!=null&&c.getWordHtml?a+=f.functions.getWordHtml(y,!0):y==="	"?a+=`<letter class='tabChar'><i class="fas fa-long-arrow-alt-right fa-fw"></i></letter>`:y===`
`?a+=`<letter class='nlChar'><i class="fas fa-level-down-alt fa-rotate-90 fa-fw"></i></letter>`:a+="<letter>"+y+"</letter>"}}if(s.innerHTML=a,n!=null&&n.length){const d=s.querySelectorAll("letter"),u=Av(n,d,t);s.insertAdjacentHTML("beforeend",u);const f=s.getElementsByTagName("hint");await Ev(n,d,f)}l&&i("#words").append("<div class='beforeNewline'></div><div class='newline'></div><div class='afterNewline'></div>"),r.tapeMode!=="off"&&jd()}function aM(e,t=!0){let o;if(e?o=e.querySelector("letter.nlChar"):o=document.querySelector("#words > .word > letter.nlChar"),!o||t&&o.classList.contains("incorrect"))return 0;const a=window.getComputedStyle(o),s=parseFloat(a.marginLeft)+parseFloat(a.marginRight);return o.offsetWidth+s}async function jd(e=!1,t){if(Z()!=="test"||de)return;await Bv;const o=hi?!Ro:Ro,a=document.querySelector("#wordsWrapper").offsetWidth,s=document.getElementById("words"),n=[...s.children],l=Po();if(!l)return;const c=s.getElementsByClassName("afterNewline");let d=0,u=0,f=!1,p,h=0;const g=[],y=[],b=[];for(const j of n)if(j.classList.contains("word")){p&&(h+=parseFloat(p.style.marginLeft));break}else j.classList.contains("afterNewline")&&(b.push(j),f=!0,p=j);let C;const L=n.indexOf(l),S=n.slice(0,L).filter(j=>j.classList.contains("afterNewline")).length;let q=c[S+1];q?C=n.indexOf(q):(q=c[S],q?C=n.indexOf(q):C=L-1);const P=parseFloat(window.getComputedStyle(l).marginRight);for(let j=0;j<=C;j++){const ne=n[j];if(ne.classList.contains("word")){f=!1;const fe=i(ne).outerWidth(!0)??0,me=Math.floor(ne.offsetLeft),St=Math.floor(ne.offsetWidth);!o&&me<0-St||o&&me>a?(b.push(ne),h+=fe):(u+=fe,j<L&&(d=u))}else if(ne.classList.contains("afterNewline")){if(f)continue;const fe=aM(n[j-3]);u-=fe+P,j<L&&(d=u);const me=3*s.offsetWidth;if(u<me)y.push(u),g.push(h);else{y.push(me),g.push(h),j<C&&(y.push(me),g.push(h));break}}}if(b.length>0&&!e){for(const ne of b)ne.remove();for(let ne=0;ne<g.length;ne++){const fe=c[ne],me=parseFloat(fe.style.marginLeft)||0;fe.style.marginLeft=`${me-(g[ne]??0)}px`}o&&(h*=-1);const j=parseFloat(s.style.marginLeft)||0;s.style.marginLeft=`${j+h}px`}let $=0;const H=k.current.length;if(r.tapeMode==="letter"&&H>0){const j=l.querySelectorAll("letter");let ne=0;for(let fe=0;fe<H;fe++){const me=j[fe];if((r.blindMode||r.hideExtraLetters)&&me.classList.contains("extra"))continue;const St=i(me).outerWidth(!0)??0;$+=St,St>0&&(ne=St)}i(j[H]).outerWidth(!0)===0&&($-=ne)}let R=a*(r.tapeMargin/100)-d-$;o&&(R=P-R);const Pe=i(s);if(r.smoothLineScroll){Pe.stop("leftMargin",!0,!1).animate({marginLeft:R},{duration:De()?0:125,queue:"leftMargin",complete:t}),Pe.dequeue("leftMargin");for(let j=0;j<y.length;j++){const ne=y[j]??0;i(c[j]).stop(!0,!1).animate({marginLeft:ne},De()?0:125)}}else{s.style.marginLeft=`${R}px`;for(let j=0;j<y.length;j++){const ne=y[j]??0;c[j].style.marginLeft=`${ne}px`}t&&t()}}function sM(){const e=gi(r,X);let t="";r.funbox.length>0&&(t=" "+r.funbox.join(" ")),i(".pageTest #premidTestMode").text(`${r.mode} ${e} ${ea(r.language)}${t}`),i(".pageTest #premidSecondsLeft").text(r.time)}function th(e){var o;const t=(o=document.getElementById("words"))==null?void 0:o.children;if(t!==void 0)for(let a=e;a>=0;a--){const s=t[a];!s||!s.isConnected||s.remove()}}let Tu=0;async function Qp(e,t=!1){const{resolve:o,promise:a}=Wa();if(wf>0||t){const s=e,n=document.getElementById("words"),l=Po();if(!l){o();return}const c=[...n.children],d=c.indexOf(l);let u;for(let h=d-1;h>=0;h--){const g=c[h];if(!g.classList.contains("hidden")&&Math.floor(g.offsetTop)<s){if(g.classList.contains("word")){u=h;break}else if(g.classList.contains("beforeNewline")){u=h+1;break}}}const f=i(l).outerHeight(!0),p=document.querySelector("#paceCaret");if(u===void 0)o();else if(r.smoothLineScroll){vf=!0,i(p).stop(!0,!1).animate({top:(p==null?void 0:p.offsetTop)-f},De()?0:125);const h=xd+f;bu(h),Tu++;const g={marginTop:`-${f*Tu}px`},y=i(n);y.stop("topMargin",!0,!1).animate(g,{duration:De()?0:125,queue:"topMargin",step:(b,C)=>{const L=(b-C.start)/(C.end-C.start);bu(h*(1-L))},complete:()=>{Tu=0,bu(0),l.offsetTop,th(u),n.style.marginTop="0",vf=!1,o()}}),y.dequeue("topMargin")}else th(u),p.style.top=`${p.offsetTop-f}px`,o()}return wf++,jp(),a}function iM(e){e?(i("#words").addClass("rightToLeftTest"),i("#resultWordsHistory .words").addClass("rightToLeftTest"),i("#resultReplay .words").addClass("rightToLeftTest")):(i("#words").removeClass("rightToLeftTest"),i("#resultWordsHistory .words").removeClass("rightToLeftTest"),i("#resultReplay .words").removeClass("rightToLeftTest"))}function nM(e){e||r.mode==="custom"||r.mode==="zen"?(i("#words").addClass("withLigatures"),i("#resultWordsHistory .words").addClass("withLigatures"),i("#resultReplay .words").addClass("withLigatures")):(i("#words").removeClass("withLigatures"),i("#resultWordsHistory .words").removeClass("withLigatures"),i("#resultReplay .words").removeClass("withLigatures"))}function rM(e,t,o,a,s,n,l){let c="";for(let d=0;d<e;d++){let u;try{u=l?nt.assemble(o.split(""))[d]:n[d]}catch{u=void 0}let f="";const p=l?nt.assemble(o.split("")):o;d+1===e&&p!==void 0&&p.length>t.length&&(f="extraCorrected"),r.mode==="zen"||s[d]!==void 0?r.mode==="zen"||a[d]===s[d]?u===a[d]||u===void 0?c+=`<letter class="correct ${f}">${a[d]}</letter>`:c+=`<letter class="corrected ${f}">`+a[d]+"</letter>":a[d]===k.current?c+=`<letter class='correct ${f}'>`+s[d]+"</letter>":a[d]===void 0?c+="<letter>"+s[d]+"</letter>":c+=`<letter class="incorrect ${f}">`+s[d]+"</letter>":c+='<letter class="incorrect extra">'+a[d]+"</letter>"}return c}async function lM(){i("#resultWordsHistory .words").empty();let e="";for(let t=0;t<k.getHistory().length+2;t++){const o=k.getHistory(t),a=Ze.getHistory(t),s=_.get(t),n=(o==null?void 0:o.match(/[\uac00-\ud7af]|[\u1100-\u11ff]|[\u3130-\u318f]|[\ua960-\ua97f]|[\ud7b0-\ud7ff]/g))!==null||(s==null?void 0:s.match(/[\uac00-\ud7af]|[\u1100-\u11ff]|[\u3130-\u318f]|[\ua960-\ua97f]|[\ud7b0-\ud7ff]/g))!==null;let l="";try{if(o===void 0||o==="")throw new Error("empty input word");const c=r.mode==="zen"?"":o!==s?"error":"";if(a!==void 0&&a!==""){const h=n?nt.assemble(a.split("")):a;l=`<div class='word nocursor ${c}' burst="${qo[t]}" input="${h.replace(/"/g,"&quot;").replace(/ /g,"_")}">`}else l=`<div class='word nocursor ${c}' burst="${qo[t]}" input="${o.replace(/"/g,"&quot;").replace(/ /g,"_")}">`;const d=Xo(o),u=Xo(s??""),f=Xo(a??"");let p;if(r.mode==="zen"||o.length>s.length?p=d.length:p=u.length,a===void 0)throw new Error("empty corrected word");l+=rM(p,o,a,d,u,f,n),l+="</div>"}catch{try{l="<div class='word'>";for(const d of s)l+="<letter>"+d+"</letter>";l+="</div>"}catch{l+="</div>"}}e+=l}return i("#resultWordsHistory .words").html(e),i("#showWordHistoryButton").addClass("loaded"),!0}function Yp(e=!1){de&&(l$(),i("#resultWordsHistory").stop(!0,!0).hasClass("hidden")?i("#resultWordsHistory .words .word").length===0?(i("#words").html('<div class="preloader"><i class="fas fa-fw fa-spin fa-circle-notch"></i></div>'),lM().then(()=>{r.burstHeatmap&&Ji(),i("#resultWordsHistory").removeClass("hidden").css("display","none").slideDown(e?0:250,()=>{r.burstHeatmap&&Ji()})})):(r.burstHeatmap&&Ji(),i("#resultWordsHistory").removeClass("hidden").css("display","none").slideDown(e?0:250)):i("#resultWordsHistory").slideUp(250,()=>{i("#resultWordsHistory").addClass("hidden")}))}async function Ji(){if(r.burstHeatmap){i("#resultWordsHistory .heatmapLegend").removeClass("hidden");let e=[...qo];e=e.filter(d=>d!==1/0),e=e.filter(d=>d<500);const t=gt(r.typingSpeedUnit);e.forEach((d,u)=>{e[u]=Math.round(t.fromWpm(d))});const o=await hs();let a=[o.colorfulError,so(o.colorfulError,o.text,.5),o.text,so(o.main,o.text,.5),o.main],s=o.sub;o.main===o.text&&(a=[o.colorfulError,so(o.colorfulError,o.text,.5),o.sub,so(o.sub,o.text,.5),o.main],s=o.subAlt);const n=e.sort((d,u)=>d-u),l=e.length,c=[{val:0,colorId:0},{val:n[l*.15|0],colorId:1},{val:n[l*.35|0],colorId:2},{val:n[l*.65|0],colorId:3},{val:n[l*.85|0],colorId:4}];c.forEach((d,u)=>{const f=c[u+1];let p="";u===0&&f?p=`<${Math.round(f.val)}`:u===4?p=`${Math.round(d.val)}+`:f&&(d.val!==f.val?p=`${Math.round(d.val)}-${Math.round(f.val)-1}`:p=`${Math.round(d.val)}-${Math.round(d.val)}`),i("#resultWordsHistory .heatmapLegend .box"+u).html(`<div>${p}</div>`)}),i("#resultWordsHistory .words .word").each((d,u)=>{const f=i(u).attr("burst");if(f===void 0)i(u).css("color",s);else{let p=parseInt(f);p=Math.round(gt(r.typingSpeedUnit).fromWpm(p)),c.forEach(h=>{p>=h.val&&(i(u).addClass("heatmapInherit"),i(u).css("color",a[h.colorId]))})}}),i("#resultWordsHistory .heatmapLegend .boxes .box").each((d,u)=>{i(u).css("background",a[d])})}else i("#resultWordsHistory .heatmapLegend").addClass("hidden"),i("#resultWordsHistory .words .word").removeClass("heatmapInherit"),i("#resultWordsHistory .words .word").css("color",""),i("#resultWordsHistory .heatmapLegend .boxes .box").css("color","")}function cM(e){i(bi(e)).addClass("error")}function dM(e){i(bi(e)).find("letter").addClass("correct")}function Fv(){let e={};r.tapeMode==="off"?r.maxLineWidth===0?e={"max-width":"100%"}:e={"max-width":r.maxLineWidth+"ch"}:r.maxLineWidth===0?e={"max-width":"100%"}:e={"max-width":"100%"};const t=i("#typingTest");t.css(e),r.maxLineWidth===0?t.removeClass("full-width-padding").addClass("content"):t.removeClass("content").addClass("full-width-padding")}function uM(){r.tapeMode==="off"?i("#liveStatsMini").css({"justify-content":"start","margin-left":"0.25em"}):i("#liveStatsMini").css({"justify-content":"center","margin-left":r.tapeMargin+"%"})}function fM(e){i("#barTimerProgress").css("opacity",parseFloat(e)),i("#liveStatsTextTop").css("opacity",parseFloat(e)),i("#liveStatsTextBottom").css("opacity",parseFloat(e)),i("#liveStatsMini").css("opacity",parseFloat(e))}function pM(e){i("#barTimerProgress").removeClass("timerSub"),i("#barTimerProgress").removeClass("timerText"),i("#barTimerProgress").removeClass("timerMain"),i("#liveStatsTextTop").removeClass("timerSub"),i("#liveStatsTextTop").removeClass("timerText"),i("#liveStatsTextTop").removeClass("timerMain"),i("#liveStatsTextBottom").removeClass("timerSub"),i("#liveStatsTextBottom").removeClass("timerText"),i("#liveStatsTextBottom").removeClass("timerMain"),i("#liveStatsMini").removeClass("timerSub"),i("#liveStatsMini").removeClass("timerText"),i("#liveStatsMini").removeClass("timerMain"),e==="main"?(i("#barTimerProgress").addClass("timerMain"),i("#liveStatsTextTop").addClass("timerMain"),i("#liveStatsTextBottom").addClass("timerMain"),i("#liveStatsMini").addClass("timerMain")):e==="sub"?(i("#barTimerProgress").addClass("timerSub"),i("#liveStatsTextTop").addClass("timerSub"),i("#liveStatsTextBottom").addClass("timerSub"),i("#liveStatsMini").addClass("timerSub")):e==="text"&&(i("#barTimerProgress").addClass("timerText"),i("#liveStatsTextTop").addClass("timerText"),i("#liveStatsTextBottom").addClass("timerText"),i("#liveStatsMini").addClass("timerText"))}i(".pageTest #copyWordsListButton").on("click",async()=>{let e;r.mode==="zen"?e=k.getHistory().join(" "):e=_.get().slice(0,k.getHistory().length).join(" "),await Rv(e)});i(".pageTest #copyMissedWordsListButton").on("click",async()=>{let e;r.mode==="zen"?e=k.getHistory().join(" "):e=Object.keys(La??{}).join(" "),await Rv(e)});async function Rv(e){try{await navigator.clipboard.writeText(e),m("Copied to clipboard",0,{duration:2})}catch(t){const o=ie(t,"Could not copy to clipboard");m(o,-1)}}i(".pageTest #toggleBurstHeatmap").on("click",async()=>{nL(!r.burstHeatmap),Np()});i(".pageTest #resultWordsHistory").on("mouseleave",".words .word",()=>{i(".wordInputHighlight").remove()});i(".pageTest #result #wpmChart").on("mouseleave",()=>{mv(!1),s$()});i(".pageTest #result #wpmChart").on("mouseenter",()=>{mv(!0)});i(".pageTest #resultWordsHistory").on("mouseenter",".words .word",e=>{if(de){const t=i(e.currentTarget).attr("input"),o=parseInt(i(e.currentTarget).attr("burst"));t!==void 0&&i(e.currentTarget).append(`<div class="wordInputHighlight withSpeed">
          <div class="text">
          ${t.replace(/\t/g,"_").replace(/\n/g,"_").replace(/</g,"&lt").replace(/>/g,"&gt")}
          </div>
          <div class="speed">
          ${N.typingSpeed(o,{showDecimalPlaces:!1})}
          ${r.typingSpeedUnit}
          </div>
          </div>`)}});addEventListener("resize",()=>{Np()});i("#wordsInput").on("focus",e=>{e.target===document.activeElement&&(!de&&r.showOutOfFocusWarning&&Ln(),xL(!0))});i("#wordsInput").on("focusout",()=>{!de&&r.showOutOfFocusWarning&&rv(),fl()});i(".pageTest").on("click","#showWordHistoryButton",()=>{Yp()});i("#wordsWrapper").on("click",()=>{oi()});be((e,t)=>{e==="quickRestart"&&(t==="off"?i(".pageTest #restartTestButton").removeClass("hidden"):i(".pageTest #restartTestButton").addClass("hidden")),e==="maxLineWidth"&&Fv(),e==="timerOpacity"&&fM(t),e==="timerColor"&&pM(t),e==="showOutOfFocusWarning"&&t===!1&&Ln()});let Xp=!1;function ee(){Xp=!0}function zr(){Xp=!1}function mM(){return Xp}let Dv="",Wv=!1;function Zp(){return Dv}function ta(){return Wv}function us(e,t){Dv=e,Wv=t}let Jp=!1,ai,Mn,kf,Sf,Hr,Or,si=!1,Pv;function gM(e){Pv=e}function zv(){const e={lastResult:Pv,start:ai,end:Mn,start3:Hr,end3:Or,afkHistory:ul,errorHistory:dl,wpmHistory:ds,rawHistory:cl,burstHistory:qo,keypressCountHistory:Js,currentBurstStart:qd,lastSecondNotRound:si,missedWords:La,accuracy:lo,keypressTimings:ke,keyOverlap:fa,wordsHistory:_.list.slice(0,k.getHistory().length),inputHistory:k.getHistory()};try{e.keypressTimings.spacing.average=ke.spacing.array.reduce((t,o)=>o+=t)/ke.spacing.array.length,e.keypressTimings.spacing.sd=rr(ke.spacing.array)}catch{}try{e.keypressTimings.duration.average=ke.duration.array.reduce((t,o)=>o+=t)/ke.duration.array.length,e.keypressTimings.duration.sd=rr(ke.duration.array)}catch{}return e}function hM(){ai=0,Mn=0,Jp=!1,si=!1}let em=0,Gc=0,tm=[];function om(){em++}function am(e){Gc+=e}function sm(e,t){tm.push({acc:e,seconds:t})}function Hv(){em=0,Gc=0,tm=[]}function Dl(){Jp=!0}function yl(e){return e===void 0?(Mn-ai)/1e3:(e-ai)/1e3}function im(e){const t=yl(Ee?performance.now():Mn),o=Nv(),a=V((o.correctWordChars+o.correctSpaces)*(60/t)/5),s=V((o.allCorrectChars+o.spaces+o.incorrectChars+o.extraChars)*(60/t)/5);return{wpm:e?a:Math.round(a),raw:e?s:Math.round(s)}}function oh(e){Mn=e,Sf=Date.now(),Or=new Date().getTime()}function yM(e){ai=e,kf=Date.now(),Hr=new Date().getTime()}function nm(e){let t=0;return e!==void 0&&(r.mode==="time"?t=Math.round(e)-Js.length:t=Math.ceil(e)-Js.length,t<0&&(t=0)),ul.filter(a=>a).length+t}function bM(){si=!0}function Ov(){var s,n;const e=k.getKoreanStatus(),t=(performance.now()-qd)/1e3;let o;if(o=e?$c.disassemble(k.current).length:k.current.length,o===0&&(o=e?((n=$c.disassemble(k.getHistoryLast()))==null?void 0:n.length)??0:((s=k.getHistoryLast())==null?void 0:s.length)??0),o===0)return 0;const a=V(o*(60/t)/5);return Math.round(a)}function bl(){const e=lo.correct/(lo.correct+lo.incorrect)*100;return isNaN(e)?100:e}function vM(){const e=yl();Js.splice(e),ds.splice(e),qo.splice(e),cl.splice(e)}function wM(){const e=k.getKoreanStatus();let t=[...k.getHistory()];return Ee&&t.push(k.current),e&&(t=t.map(o=>$c.disassemble(o).join(""))),t}function CM(){const e=k.getKoreanStatus();let t=[...r.mode==="zen"?k.getHistory():_.list];return Ee&&t.push(r.mode==="zen"?k.current:_.getCurrent()),e&&(t=t.map(o=>$c.disassemble(o).join(""))),t}function Nv(){let e=0,t=0,o=0,a=0,s=0,n=0,l=0;const c=wM(),d=CM();for(let u=0;u<c.length;u++){const f=c[u],p=d[u];if(f===p)e+=p.length,t+=p.length,u<c.length-1&&Ab(f)!==`
`&&l++;else if(f.length>=p.length)for(let h=0;h<f.length;h++)h<p.length?f[h]===p[h]?t++:o++:a++;else{const h={correct:0,incorrect:0,missed:0};for(let g=0;g<p.length;g++)g<f.length?f[g]===p[g]?h.correct++:h.incorrect++:h.missed++;t+=h.correct,o+=h.incorrect,u===c.length-1?h.incorrect===0&&(e+=h.correct):s+=h.missed}u<c.length-1&&n++}return bs("nospace")&&(n=0,l=0),{spaces:n,correctWordChars:e,allCorrectChars:t,incorrectChars:r.mode==="zen"?lo.incorrect:o,extraChars:a,missedChars:s,correctSpaces:l}}function kM(){console.debug("Calculating result stats");let e=yl();console.debug("Test seconds",e," (date based) ",(Sf-kf)/1e3," (performance.now based)",(Or-Hr)/1e3," (new Date based)"),console.debug("Test seconds",Jl(e)," (date based) ",Jl((Sf-kf)/1e3)," (performance.now based)",Jl((Or-Hr)/1e3)," (new Date based)"),r.mode!=="custom"&&(e=V(e),console.debug("Mode is not custom - rounding to 2. New time: ",e));const t=Nv(),{wpm:o,raw:a}=im(!0),s=V(bl()),n={wpm:isNaN(o)?0:o,wpmRaw:isNaN(a)?0:a,acc:s,correctChars:t.correctWordChars,incorrectChars:t.incorrectChars,missedChars:t.missedChars,extraChars:t.extraChars,allChars:t.allCorrectChars+t.spaces+t.incorrectChars+t.extraChars,time:V(e),spaces:t.spaces,correctSpaces:t.correctSpaces};return console.debug("Result stats",n),n}const $e={mode:null,punctuation:null,numbers:null,customText:null};function xf(e,t){if(r.mode==="zen")return!1;let o;e==="words"&&!t||e==="off"&&t?o=20:o=10;let a=[];e==="words"&&(Object.keys(La).forEach(p=>{const h=La[p];h!==void 0&&a.push([p,h])}),a.sort((p,h)=>h[1]-p[1]),a=a.slice(0,o));let s=[];if(e==="biwords"){for(let p=0;p<_.length;p++){const h=_.get(p),g=La[h];g!==void 0&&(p===0?s.push([h,"",g]):s.push([h,_.get(p-1),g]))}s.sort((p,h)=>h[2]-p[2]),s=s.slice(0,o)}if((e==="words"&&a.length===0||e==="biwords"&&s.length===0)&&!t)return m("You haven't missed any words",0),!1;let n=[];if(t){const p=_.get().slice(0,k.getHistory().length-1);n=p.map((h,g)=>[h,qo[g]??0]),n.sort((h,g)=>h[1]-g[1]),n=n.slice(0,Math.min(o,Math.round(p.length*.2))),n.length===0&&m("Test too short to classify slow words.",0)}if(a.length===0&&s.length===0&&n.length===0)return m("Could not start a new custom test",0),!1;const l=[];a.forEach(p=>{for(let h=0;h<p[1];h++)l.push(p[0])}),s.forEach(p=>{for(let h=0;h<p[2];h++)p[1]!==""?l.push(p[1]+" "+p[0]):l.push(p[0])}),n.forEach((p,h)=>{for(let g=0;g<n.length-h;g++)l.push(p[0])});const c=$e.mode===null?r.mode:$e.mode,d=$e.punctuation===null?r.punctuation:$e.punctuation,u=$e.numbers===null?r.numbers:$e.numbers;let f=null;return r.mode==="custom"&&(f=Ia()),ut("custom",!0),ei(!0),_a(l),$o("section"),pn("shuffle"),Ko((n.length+a.length+s.length)*5),us("practise",void 0),$e.mode=c,$e.punctuation=d,$e.numbers=u,$e.customText=f,!0}function rm(){$e.mode=null,$e.punctuation=null,$e.numbers=null,$e.customText=null}be(e=>{e==="mode"&&rm()});const ah=[["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal"],["KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash"],["KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote"],["KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash"],["Space"]],SM=new Set(["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyA","KeyS","KeyD","KeyF","KeyG","ShiftLeft","IntlBackslash","KeyZ","KeyX","KeyC","KeyV","KeyB","Space"]),xM=new Set(["Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","Backspace","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","Enter","KeyB","KeyN","KeyM","Comma","Period","Slash","ShiftRight","ArrowUp","ArrowLeft","ArrowDown","ArrowRight","NumpadMultiply","NumpadSubtract","NumpadAdd","NumpadDecimal","NumpadEqual","NumpadDivide","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","NumpadEnter","Space"]);function Uv(e,t){var c,d;const o=Object.values(t.keys),a=o.findIndex(u=>u.find(f=>f.includes(e))),s=o[a];if(s===void 0)return;const n=s.findIndex(u=>u.includes(e));if(n===-1)return;let l=(c=ah[a])==null?void 0:c[n];return t.type==="iso"&&(a===2&&n===11?l="Backslash":a===3&&n===0?l="IntlBackslash":a===3&&(l=(d=ah[3])==null?void 0:d[n-1])),l}function lm(e){const t=SM.has(e),o=xM.has(e);return{leftSide:t,rightSide:o}}function cm(e){const t=[11,10,10,10,10],o={row1:[...[...e.keys.row1.slice(0,t[0])].reverse(),...e.keys.row1.slice(t[0])],row2:[...[...e.keys.row2.slice(0,t[1])].reverse(),...e.keys.row2.slice(t[1])],row3:[...[...e.keys.row3.slice(0,t[2])].reverse(),...e.keys.row3.slice(t[2])],row4:[...[...e.keys.row4.slice(0,t[3])].reverse(),...e.keys.row4.slice(t[3])],row5:[...[...e.keys.row5.slice(0,t[4])].reverse(),...e.keys.row5.slice(t[4])]};return{...e,keys:o}}let fs=!1,ps=!1;i(document).on("keydown",e=>{e.code==="ShiftLeft"?(fs=!0,ps=!1):e.code==="ShiftRight"&&(fs=!1,ps=!0)});i(document).on("keyup",e=>{(e.code==="ShiftLeft"||e.code==="ShiftRight")&&(fs=!1,ps=!1)});function TM(){fs=!1,ps=!1}function Tf(e){if(!fs&&!ps||r.oppositeShiftMode==="off")return!0;const{leftSide:t,rightSide:o}=lm(e);return!!(!t&&!o||fs&&o||ps&&t)}let Qd=!1,Yd=!1;i(document).on("keydown",e=>{e.code==="AltLeft"?Qd=!0:e.code==="AltRight"&&(Yd=!0)});i(document).on("keyup",e=>{e.code==="AltLeft"?Qd=!1:e.code==="AltRight"&&(Yd=!1)});function LM(){Qd=!1,Yd=!1}function jc(...e){if(r.funbox.length!==0)for(const t of yt("toggleScript"))t.functions.toggleScript(e)}function $M(e){if(e.length===0)for(const t of yt("clearGlobal"))t.functions.clearGlobal();return yv(),Xa(e,!1),!0}function Vv(e){var t,o,a,s;if(!sl(ho(),e)&&!r.funbox.includes(e)){m(`${_t(e.replace(/_/g," "))} funbox is not compatible with the current funbox selection`,0);return}yv(),Yi(e,!1),ho().includes(e)?(s=(a=bf(e).functions)==null?void 0:a.applyGlobalCSS)==null||s.call(a):(o=(t=bf(e).functions)==null?void 0:t.clearGlobal)==null||o.call(t)}async function Ui(){var e,t,o,a;return i("body").attr("class",((a=(o=(t=(e=i("body"))==null?void 0:e.attr("class"))==null?void 0:t.split(/\s+/))==null?void 0:o.filter(s=>!s.startsWith("fb-")))==null?void 0:a.join(" "))??""),i(".funBoxTheme").remove(),i("#wordsWrapper").removeClass("hidden"),gn(),ee(),!0}async function Kv(e){if(e==null?e=r.funbox:r.funbox!==e&&(r.funbox=e),!sl(ho()))return m(ie(void 0,`Failed to activate funbox: funboxes ${r.funbox.map(s=>s.replace(/_/g," ")).join(", ")} are not compatible`),-1),Xa([],!0),await Ui(),!1;gn(),await AM(),await EM(),i("#wordsWrapper").removeClass("hidden");const{data:t,error:o}=await Qt(GL(r.language));if(o)return m(ie(o,"Failed to activate funbox"),-1),Xa([],!0),await Ui(),!1;if(t.ligatures&&bs("noLigatures")){m("Current language does not support this funbox mode",0),Xa([],!0),await Ui();return}let a=!0;for(const[s,n]of Object.entries(r)){const l=rf(s,n,za());if(!l.result&&!l.result)if(l.forcedConfigs&&l.forcedConfigs.length>0)s==="mode"&&ut(l.forcedConfigs[0]),s==="words"&&Zs(l.forcedConfigs[0]),s==="time"&&Ca(l.forcedConfigs[0]),s==="punctuation"&&cs(l.forcedConfigs[0]),s==="numbers"&&Sa(l.forcedConfigs[0]),s==="highlightMode"&&Is(l.forcedConfigs[0]);else{a=!1;break}}if(!a){r.funbox.length>1?m(`Failed to activate funboxes ${r.funbox}: no intersecting forced configs. Disabling funbox`,-1):m(`Failed to activate funbox ${r.funbox}: no forced configs. Disabling funbox`,-1),Xa([],!0),await Ui();return}ee();for(const s of yt("applyConfig"))s.functions.applyConfig();return!0}async function MM(){for(const e of yt("rememberSettings"))e.functions.rememberSettings()}async function AM(){var a;const e=i("body"),t=ho().map(s=>"fb-"+s.replaceAll("_","-")),o=((a=e==null?void 0:e.attr("class"))==null?void 0:a.split(/\s+/).filter(s=>!s.startsWith("fb-")))??[];return bs("ignoreReducedMotion")&&o.push("ignore-reduced-motion"),e.attr("class",[...new Set([...o,...t]).keys()].join(" ")),!0}async function EM(){i(".funBoxTheme").remove();for(const e of xv("hasCssFile")){const t=document.createElement("link");t.classList.add("funBoxTheme"),t.rel="stylesheet",t.href="funbox/"+e.name+".css",document.head.appendChild(t)}return!0}const en=document.querySelector("#capsWarning");let hn=!1,Qc=!1;function _M(){Qc||(en==null||en.classList.remove("hidden"),Qc=!0)}function IM(){Qc&&(en==null||en.classList.add("hidden"),Qc=!1)}function Gv(e){var o,a;const t=(a=(o=e==null?void 0:e.originalEvent)==null?void 0:o.getModifierState)==null?void 0:a.call(o,"CapsLock");t!==void 0&&(hn=t);try{r.capsLockWarning&&hn?_M():IM()}catch{}}i(document).on("keyup",Gv);i(document).on("keydown",e=>{zk()&&Gv(e)});const jv="~~",BM={keymapShowTopRow:!0,type:"matrix",keys:{row1:[],row2:[["s","S"],["t","T"],["p","P"],["h","H"],["*","*"],["f","F"],["p","P"],["l","L"],["t","T"],["d","D"]],row3:[["s","S"],["k","K"],["w","W"],["r","R"],["*","*"],["r","R"],["b","B"],["g","G"],["s","S"],["z","Z"]],row4:[["a","A"],["o","O"],["e","E"],["u","U"]],row5:[]}};function qM(e){if(r.mode!=="zen"){e===""&&(e=" ");try{i(".activeKey").removeClass("activeKey");let t;r.language.startsWith("korean")&&(e=nt.disassemble(e)[0]??e),e===" "?t="#keymap .keySpace":e==='"'?t=`#keymap .keymapKey[data-key*='${e}']`:t=`#keymap .keymapKey[data-key*="${e}"]`,i(t).addClass("activeKey")}catch(t){t instanceof Error&&console.log("could not update highlighted keymap key: "+t.message)}}}async function FM(e,t){if(e===void 0)return;e===" "?e="#keymap .keySpace":e==='"'?e=`#keymap .keymapKey[data-key*='${e}']`:e=`#keymap .keymapKey[data-key*="${e}"]`;const o=await hs();try{let a={color:o.bg,backgroundColor:o.sub,borderColor:o.sub};t||r.blindMode?a={color:o.bg,backgroundColor:o.main,borderColor:o.main}:a={color:o.bg,backgroundColor:o.error,borderColor:o.error},i(e).stop(!0,!0).css(a).animate({color:o.sub,backgroundColor:o.subAlt,borderColor:o.sub},De()?0:500,"easeOutExpo")}catch{}}function RM(){i("#keymap").addClass("hidden")}function DM(){i("#keymap").removeClass("hidden")}function WM(e){const{layoutData:t,rowId:o,isMatrix:a,showTopRow:s,isSteno:n,isISO:l,layoutNameDisplayString:c,isAlice:d}=e;let{rowKeys:u}=e,f=!1,p="",h="",g="";if(o==="row1"&&(a||r.keymapStyle==="staggered")&&(u=u.slice(1)),o==="row1"&&(!s||n))return"";if((o==="row2"||o==="row3"||o==="row4")&&!a&&!n&&(g+="<div></div>"),o==="row4"&&!l&&!a&&!n&&(g+="<div></div>"),a&&(o!=="row5"&&t.matrixShowRightColumn?g+='<div class="keymapKey"></div>':g+="<div></div>"),o==="row5"){if(n)return"";let y=c.replace(/_/g," "),b="";r.keymapLegendStyle==="blank"&&(b='style="display: none;"');const C=S=>Cr(S??[],[" "]);u.length===1&&C(u[0])&&(u[1]=u[0]??[]),u.length===1&&!C(u[0])&&(u[1]=[" "],u.reverse()),u.length>1&&!C(u[0])&&Cr(u[0],u[1])&&(u[0]=[" "]);const L=S=>S.some(q=>q!==" ");f=u.some(L),g+="<div></div>";for(let S=0;S<u.length;S++){const q=u[S];let P=q[0];r.keymapLegendStyle==="uppercase"&&(P=P.toUpperCase());const $=q.map(R=>R.replace('"',"&quot;"));let H=S<1?"left":"right";f&&!d&&(H=""),S===1&&(g+='<div class="keymapSplitSpacer"></div>',p+="-"),C($)?(g+=`<div class="keymapKey keySpace layoutIndicator ${H}">
              <div class="letter" ${b}>${y}</div>
            </div>`,p+="3",y=""):(g+=`<div class="keymapKey ${H}">
              <div class="letter">${P}</div>
            </div>`,p+="1")}}else for(let y=0;y<u.length;y++){if(o==="row2"&&y===12||o==="row4"&&a&&l&&y===0)continue;let b=10;if(t.matrixShowRightColumn&&(b=11),o==="row4"&&a&&l&&(b+=1),(r.keymapStyle==="matrix"||r.keymapStyle==="split_matrix")&&y>=b)continue;const C=u[y],L=o==="row3"&&(y===3||y===6);let S=C[0],q="";r.keymapLegendStyle==="blank"?q='style="display: none;"':r.keymapLegendStyle==="uppercase"&&(S=S.toUpperCase());let P="";o==="row1"&&y===0&&!a&&r.keymapStyle!=="staggered"&&(P=" invisible");const $=`<div class="keymapKey${P}" data-key="${C.map(R=>R.replace('"',"&quot;")).join(jv)}"><span class="letter" ${q}>${S}</span>${L?"<div class='bump'></div>":""}</div>`;let H="";(r.keymapStyle==="split"||r.keymapStyle==="split_matrix"||r.keymapStyle==="alice"||n)&&(o==="row4"&&n&&(y===0||y===2||y===4)?H+='<div class="keymapSplitSpacer"></div>':o==="row4"&&(r.keymapStyle==="split"||r.keymapStyle==="alice")&&l?y===6&&(H+='<div class="keymapSplitSpacer"></div>'):o==="row1"&&(r.keymapStyle==="split"||r.keymapStyle==="alice")?y===7&&(H+='<div class="keymapSplitSpacer"></div>'):o==="row4"&&a&&l?y===6&&(H+='<div class="keymapSplitSpacer"></div>'):y===5&&(H+='<div class="keymapSplitSpacer"></div>')),r.keymapStyle==="alice"&&o==="row4"&&(l&&y===6||!l&&y===5)&&(H+='<div class="extraKey"><span class="letter"></span></div>'),g+=H+$}if(o==="row5")h+=`<div
          class="row r5"
          data-row5-grid="${p}"
          data-row5-has-alpha="${f}"
        >${g}</div>`;else{const y=parseInt(o.replace("row",""));h+=`<div class="row r${y}">${g}</div>`}return h}async function Yc(){const e=r.keymapLayout==="overrideSync"?r.keymapLayout:r.layout;if(r.keymapMode!=="off"&&Z()==="test"&&e)try{let t=e,o;try{r.keymapLayout==="overrideSync"?r.layout==="default"?(o=await Ns("qwerty"),t="default"):(o=await Ns(r.layout),t=r.layout):(o=await Ns(r.keymapLayout),t=r.keymapLayout)}catch(f){m(ie(f,`Failed to load keymap ${e}`),-1);return}const a=Bp&&r.keymapMode==="next"||r.keymapShowTopRow==="always"||o.keymapShowTopRow&&r.keymapShowTopRow!=="never",s=r.keymapStyle==="matrix"||r.keymapStyle==="split_matrix",n=r.keymapStyle==="steno"||r.keymapStyle==="steno_matrix",l=r.keymapStyle==="alice";n&&(o=BM),ho().includes("layout_mirror")&&(o=cm(o));const d=o.type==="iso";let u="";for(const[f,p]of Object.entries(o.keys))u+=WM({layoutData:o,rowId:f,rowKeys:p,isMatrix:s,showTopRow:a,isSteno:n,isISO:d,layoutNameDisplayString:t,isAlice:l});i("#keymap").html(u),i("#keymap").removeClass("staggered"),i("#keymap").removeClass("matrix"),i("#keymap").removeClass("split"),i("#keymap").removeClass("split_matrix"),i("#keymap").removeClass("alice"),i("#keymap").removeClass("steno"),i("#keymap").removeClass("steno_matrix"),i("#keymap").addClass(r.keymapStyle)}catch(t){t instanceof Error&&console.log("something went wrong when changing layout, resettings: "+t.message)}}const PM=Hk(),zM=/^[^\p{L}\p{N}]{1}$/u;let Lu=[0,0];function HM(){const e=fs||ps,t=Qd||Yd,a=((PM?e||hn:e!==hn)?1:0)+(t?2:0),s=(e?1:0)+(t?2:0),[n,l]=Lu;if(!(n===a&&l===s))return Lu=[a,s],Lu}async function Qv(){const e=HM();if(e===void 0)return;const t=[...document.getElementsByClassName("keymapKey")].filter(d=>{const u=d.classList.contains("keymapKey"),f=!d.classList.contains("keySpace");return u&&f}),o=t.map(d=>{var u;return(u=d.dataset.key)==null?void 0:u.split(jv)});if(o.includes(void 0))return;const a=t.map(d=>d.childNodes[0]),[s,n]=e,l=r.keymapLayout==="overrideSync"?r.layout==="default"?"qwerty":r.layout:r.keymapLayout,c=await Ns(l).catch(()=>{});if(c===void 0){m("Failed to load keymap layout",-1);return}for(let d=0;d<o.length;d++){const u=o[d],f=a[d],p=u[0],h=u[1];if(f===void 0||u===void 0||p===void 0||h===void 0)continue;const g=[p,h].some(q=>zM.test(q??"")),y=Uv(p,c);if(y===void 0)return;const L=Tf(y)?g?n:s:0,S=u[L]??u[L-2];f.textContent=S??""}}let $u=!1;be(e=>{const t=()=>{i(".activeKey").removeClass("activeKey"),i(".keymapKey").attr("style",""),r.keymapMode==="off"?RM():DM()},o=()=>{i("#keymap").css("zoom",r.keymapSize)},a=()=>{let s=r.keymapLegendStyle;["lowercase","uppercase","blank","dynamic"].forEach(l=>{i(".keymapLegendStyle").removeClass(l)}),s=s||"lowercase",i(".keymapKey > .letter").css("display",""),i(".keymapKey > .letter").css("text-transform",""),s==="uppercase"&&i(".keymapKey > .letter").css("text-transform","capitalize"),s==="blank"&&i(".keymapKey > .letter").css("display","none"),i(".keymapLegendStyle").addClass(s)};e==="fullConfigChange"&&($u=!0),e==="fullConfigChangeFinished"&&($u=!1,Yc(),t(),o(),a()),!$u&&((e==="layout"&&r.keymapLayout==="overrideSync"||e==="keymapLayout"||e==="keymapStyle"||e==="keymapShowTopRow"||e==="keymapMode")&&Yc(),e==="keymapMode"&&t(),e==="keymapSize"&&o(),e==="keymapLegendStyle"&&a())});k$((e,t,o)=>{e==="highlight"&&qM(t),e==="flash"&&FM(t,o)});i(document).on("keydown",e=>{r.keymapLegendStyle==="dynamic"&&(e.code==="ShiftLeft"||e.code==="ShiftRight"||e.code==="AltRight"||e.code==="AltLeft")&&Qv()});i(document).on("keyup",e=>{r.keymapLegendStyle==="dynamic"&&(e.code==="ShiftLeft"||e.code==="ShiftRight"||e.code==="AltRight"||e.code==="AltLeft")&&Qv()});mo.register(qS,FS,RS,DS,WS,PS,zS,HS,OS,NS,US,VS,KS,GS);mo.defaults.animation.duration=0;mo.defaults.elements.line.tension=.5;mo.defaults.elements.line.fill="origin";class An extends mo{constructor(t,o){super(t,o)}async updateColors(){await NM(this)}getDataset(t){var o;return(o=this.data.datasets)==null?void 0:o.find(a=>a.yAxisID===t)}getScaleIds(){var t;return lt(((t=this.options)==null?void 0:t.scales)??{})}getScale(t){return this.options.scales[t]}}let sh;const ue=new An(document.querySelector("#wpmChart"),{type:"line",data:{labels:[],datasets:[{clip:!1,label:"wpm",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:3,yAxisID:"wpm",order:2,pointRadius:1},{clip:!1,label:"raw",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:2,yAxisID:"raw",borderDash:[8,8],order:3,pointRadius:0},{clip:!1,label:"errors",data:[],borderColor:"rgba(255, 125, 125, 1)",pointBackgroundColor:"rgba(255, 125, 125, 1)",borderWidth:2,order:1,yAxisID:"error",type:"scatter",pointStyle:"crossRot",pointRadius:function(e){const t=e.dataIndex;return(e.dataset.data[t]??0)<=0?0:3},pointHoverRadius:function(e){const t=e.dataIndex;return(e.dataset.data[t]??0)<=0?0:5}},{clip:!1,label:"burst",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:3,yAxisID:"burst",order:4,pointRadius:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{axis:"x",ticks:{autoSkip:!0,autoSkipPadding:20},display:!0,title:{display:!1,text:"Seconds"}},wpm:{axis:"y",display:!0,title:{display:!0,text:"Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!0}},raw:{axis:"y",display:!1,title:{display:!0,text:"Raw Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!1}},burst:{axis:"y",display:!1,title:{display:!0,text:"Burst Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!1}},error:{axis:"y",display:!0,position:"right",title:{display:!0,text:"Errors"},beginAtZero:!0,ticks:{precision:0,autoSkip:!0,autoSkipPadding:20},grid:{display:!1}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},mode:"index",intersect:!1,callbacks:{afterLabel:function(e){var t;if(sh===e)return"";sh=e;try{const o=Math.round(parseFloat(e.label))-1,a=(t=dl[o])==null?void 0:t.words,s=[...new Set(a)],n=s[0],l=js(s);if(n===void 0||l===void 0)return"";a$(n,l)}catch{}return""}}}}}});let Yv;const U=new An(document.querySelector(".pageAccount #accountHistoryChart"),{type:"line",data:{datasets:[{yAxisID:"wpm",data:[],fill:!1,borderWidth:0,order:3},{yAxisID:"pb",data:[],fill:!1,stepped:!0,pointRadius:0,pointHoverRadius:0,order:4},{yAxisID:"acc",fill:!1,data:[],pointStyle:"triangle",borderWidth:0,pointRadius:3.5,order:3},{yAxisID:"wpmAvgTen",data:[],fill:!1,pointRadius:0,pointHoverRadius:0,order:2},{yAxisID:"accAvgTen",data:[],fill:!1,pointRadius:0,pointHoverRadius:0,order:2},{yAxisID:"wpmAvgHundred",data:[],fill:!1,pointRadius:0,pointHoverRadius:0,order:1},{yAxisID:"accAvgHundred",label:"accAvgHundred",data:[],fill:!1,pointRadius:0,pointHoverRadius:0,order:1}]},options:{maintainAspectRatio:!1,hover:{mode:"nearest",intersect:!1},scales:{x:{axis:"x",type:"linear",reverse:!0,min:0,ticks:{stepSize:10},display:!1,grid:{display:!1}},wpm:{axis:"y",type:"linear",beginAtZero:!0,min:0,ticks:{stepSize:10},display:!0,title:{display:!0,text:"Words per Minute"},position:"right"},pb:{axis:"y",beginAtZero:!0,min:0,ticks:{stepSize:10},display:!1},acc:{axis:"y",beginAtZero:!0,min:0,max:100,reverse:!0,ticks:{stepSize:10},display:!0,title:{display:!0,text:"Accuracy"},grid:{display:!1},position:"left"},wpmAvgTen:{axis:"y",beginAtZero:!0,min:0,ticks:{stepSize:10},display:!1,grid:{display:!1}},accAvgTen:{axis:"y",beginAtZero:!0,min:0,max:100,reverse:!0,ticks:{stepSize:10},display:!1,grid:{display:!1}},wpmAvgHundred:{axis:"y",beginAtZero:!0,min:0,ticks:{stepSize:10},display:!1,grid:{display:!1}},accAvgHundred:{axis:"y",beginAtZero:!0,min:0,max:100,reverse:!0,ticks:{stepSize:10},display:!1,grid:{display:!1}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},enabled:!0,intersect:!1,external:function(e){e!==void 0&&(e.tooltip.options.displayColors=!1)},filter:function(e){return e.datasetIndex!==1&&e.datasetIndex!==3&&e.datasetIndex!==4&&e.datasetIndex!==5&&e.datasetIndex!==6},callbacks:{title:function(){return""},beforeLabel:function(e){if(e.datasetIndex!==0){const s=e.dataset.data[e.dataIndex];return`error rate: ${V(s.errorRate)}%
acc: ${V(100-s.errorRate)}%`}const t=e.dataset.data[e.dataIndex];let o=`${r.typingSpeedUnit}: ${t.wpm}
raw: ${t.raw}
acc: ${t.acc}

mode: ${t.mode} `;(t.mode==="time"||t.mode==="words")&&(o+=t.mode2);let a=t.difficulty;return a===void 0&&(a="normal"),o+=`
difficulty: ${a}`,o+=`
punctuation: ${t.punctuation}
language: ${t.language}${t.isPb?`

new personal best`:""}

date: ${te(new Date(t.timestamp),"dd MMM yyyy HH:mm")}`,o},label:function(){return""},afterLabel:function(e){return Yv=e.dataIndex,""}}}}}}),Ja=new An(document.querySelector(".pageAccount #accountActivityChart"),{type:"bar",data:{labels:[],datasets:[{yAxisID:"count",label:"Seconds",data:[],trendlineLinear:{style:"rgba(255,105,180, .8)",lineStyle:"dotted",width:2},order:3},{yAxisID:"avgWpm",label:"Average Wpm",data:[],type:"line",order:2,tension:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:"nearest",intersect:!1},scales:{x:{axis:"x",ticks:{autoSkip:!0,autoSkipPadding:20},type:"time",time:{unit:"day",displayFormats:{day:"d MMM"}},bounds:"ticks",display:!0,title:{display:!1,text:"Date"},offset:!0},count:{axis:"y",beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20,stepSize:1},display:!0,title:{display:!0,text:"Time typing (minutes)"}},avgWpm:{axis:"y",beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20,stepSize:10},display:!0,position:"right",title:{display:!0,text:"Average Wpm"},grid:{display:!1}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},intersect:!1,mode:"index",filter:e=>e.datasetIndex===0,callbacks:{title:function(e){const t=e[0],o=t.dataset.data[t.dataIndex];return te(new Date(o.x),"dd MMM yyyy")},beforeLabel:function(e){const t=e.dataset.data[e.dataIndex],o=gt(r.typingSpeedUnit);return`Time Typing: ${rt(Math.round(t.y*60),!0,!0)}
Tests Completed: ${t.amount}
Restarts per test: ${V((t.restarts??0)/(t.amount??0))}
Highest ${r.typingSpeedUnit.toUpperCase()}: ${V(o.fromWpm(t.maxWpm??0))}
Average ${r.typingSpeedUnit.toUpperCase()}: ${V(o.fromWpm(t.avgWpm??0))}
Average Accuracy: ${V(t.avgAcc??0)}%
Average Consistency: ${V(t.avgCon??0)}%`},label:function(){return""}}}}}}),tn=new An(document.querySelector(".pageAccount #accountHistogramChart"),{type:"bar",data:{labels:[],datasets:[{yAxisID:"count",label:"Tests",data:[]}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:"nearest",intersect:!1},scales:{x:{axis:"x",bounds:"ticks",display:!0,title:{display:!1,text:"Bucket"},offset:!0},count:{axis:"y",beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20,stepSize:10},display:!0,title:{display:!0,text:"Tests"}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},intersect:!1,mode:"index"}}}}),on=new An(document.querySelector(".pageAbout #publicStatsHistogramChart"),{type:"bar",data:{labels:[],datasets:[{yAxisID:"count",label:"Users",data:[]}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:"nearest",intersect:!1},scales:{x:{axis:"x",bounds:"ticks",display:!0,title:{display:!1,text:"Bucket"},offset:!0},count:{axis:"y",beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20,stepSize:10},display:!0,title:{display:!0,text:"Users"}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},intersect:!1,mode:"index"}}}}),Ut=new An(document.querySelector("#miniResultChartModal canvas"),{type:"line",data:{labels:[],datasets:[{label:"wpm",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:3,yAxisID:"wpm",order:2,pointRadius:1},{label:"burst",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:3,yAxisID:"burst",order:3,pointRadius:1},{label:"errors",data:[],borderColor:"rgba(255, 125, 125, 1)",pointBackgroundColor:"rgba(255, 125, 125, 1)",borderWidth:2,order:1,yAxisID:"error",type:"scatter",pointStyle:"crossRot",pointRadius:function(e){const t=e.dataIndex;return(e.dataset.data[t]??0)<=0?0:3},pointHoverRadius:function(e){const t=e.dataIndex;return(e.dataset.data[t]??0)<=0?0:5}}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{axis:"x",ticks:{autoSkip:!0,autoSkipPadding:20},display:!0,title:{display:!1,text:"Seconds"}},wpm:{axis:"y",display:!0,title:{display:!0,text:"Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!0}},burst:{axis:"y",display:!1,title:{display:!0,text:"Burst Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!1}},error:{display:!0,position:"right",title:{display:!0,text:"Errors"},beginAtZero:!0,ticks:{precision:0,autoSkip:!0,autoSkipPadding:20},grid:{display:!1}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},mode:"index",intersect:!1}}}});function OM(){Xv(!1),Zv(!1),Jv(!1),ew(!1)}function Xd(e,t){e?i(`.pageAccount ${t}`).addClass("active"):i(`.pageAccount ${t}`).removeClass("active")}function Xv(e=!0){const t=r.accountChart[0]==="on";Xd(t,".toggleResultsOnChart"),U.getDataset("wpm").hidden=!t,U.getDataset("pb").hidden=!t,U.getDataset("wpmAvgTen").hidden=!t,U.getDataset("wpmAvgHundred").hidden=!t,U.getScale("wpm").display=t,e&&U.updateColors()}function Zv(e=!0){const t=r.accountChart[0]==="on",o=r.accountChart[1]==="on";if(Xd(o,".toggleAccuracyOnChart"),U.getDataset("acc").hidden=!o,U.getDataset("accAvgTen").hidden=!o,U.getDataset("accAvgHundred").hidden=!o,U.getScale("acc").display=o,t)U.getScale("acc").min=0,U.getScale("accAvgTen").min=0,U.getScale("accAvgHundred").min=0;else{const a=Math.floor(Math.min(...U.getDataset("acc").data.map(s=>s.y))/5)*5;U.getScale("acc").min=a,U.getScale("accAvgTen").min=a,U.getScale("accAvgHundred").min=a}e&&U.updateColors()}function Jv(e=!0){const t=r.accountChart[0]==="on",o=r.accountChart[1]==="on",a=r.accountChart[2]==="on";Xd(a,".toggleAverage10OnChart"),o&&(U.getDataset("accAvgTen").hidden=!a),t&&(U.getDataset("wpmAvgTen").hidden=!a),e&&U.updateColors()}function ew(e=!0){const t=r.accountChart[0]==="on",o=r.accountChart[1]==="on",a=r.accountChart[3]==="on";Xd(a,".toggleAverage100OnChart"),o&&(U.getDataset("accAvgHundred").hidden=!a),t&&(U.getDataset("wpmAvgHundred").hidden=!a),e&&U.updateColors()}async function NM(e){var h,g;const t=await Kt("bg"),o=await Kt("sub"),a=await Kt("subAlt"),s=await Kt("main"),n=await Kt("error"),l=await Kt("text"),c=a;for(const y of lt(e.scales)){const b=e.getScale(y);b.grid.color=c,b.grid.tickColor=c,b.grid.borderColor=c,b.ticks.color=o,b.title.color=o}if(e.id===ue.id){const y=e,b=y.getDataset("wpm");b.backgroundColor="transparent",b.borderColor=s,b.pointBackgroundColor=s,b.pointBorderColor=s;const C=y.getDataset("raw");C.backgroundColor="transparent",C.borderColor=s+"99",C.pointBackgroundColor=s+"99",C.pointBorderColor=s+"99";const L=y.getDataset("error");L.backgroundColor=n,L.borderColor=n,L.pointBackgroundColor=n,L.pointBorderColor=n;const S=y.getDataset("burst");S.backgroundColor=so(a,a+"00",.5),S.borderColor=o,S.pointBackgroundColor=o,S.pointBorderColor=o,e.update("resize");return}if(e.id===Ut.id){const y=e,b=y.getDataset("wpm");b.backgroundColor="transparent",b.borderColor=s,b.pointBackgroundColor=s,b.pointBorderColor=s;const C=y.getDataset("error");C.backgroundColor=n,C.borderColor=n,C.pointBackgroundColor=n,C.pointBorderColor=n;const L=y.getDataset("burst");L.backgroundColor=so(a,a+"00",.75),L.borderColor=o,L.pointBackgroundColor=o,L.pointBorderColor=o,e.update("resize");return}e.data.datasets[0].borderColor=y=>{var L;return((L=y.raw)==null?void 0:L.isPb)?l:s},e.data.datasets[1]&&(e.data.datasets[1].borderColor=o),e.data.datasets[2]&&(e.data.datasets[2].borderColor=n);const d=e.data.datasets[0];((g=(h=e==null?void 0:e.data)==null?void 0:h.datasets[0])==null?void 0:g.type)===void 0?e.config.type==="line"?d.pointBackgroundColor=y=>{var L;return((L=y.raw)==null?void 0:L.isPb)?l:s}:e.config.type==="bar"&&(d.backgroundColor=s):e.data.datasets[0].type==="bar"?e.data.datasets[0].backgroundColor=s:e.data.datasets[0].type==="line"&&(d.pointBackgroundColor=s);const u=e.data.datasets[1];u!==void 0&&(u.type===void 0?e.config.type==="line"?u.pointBackgroundColor=o:e.config.type==="bar"&&(u.backgroundColor=o):(u==null?void 0:u.type)==="bar"?u.backgroundColor=o:u.type==="line"&&(u.pointBackgroundColor=o)),e.data.datasets.length===2&&(u.borderColor=()=>o);const f=e.data.datasets[2];if(e.data.datasets.length===7){f.borderColor=()=>o;const y=r.accountChart[2]==="on",b=r.accountChart[3]==="on",C=so(t,l,.2),L=so(t,s,.2),S=so(t,s,.4),q=so(t,o,.2),P=so(t,o,.4),[$,H,R,Pe,j,ne,fe]=e.data.datasets;if($===void 0||H===void 0||R===void 0||Pe===void 0||j===void 0||ne===void 0||fe===void 0)return;y&&b?($.pointBackgroundColor=L,H.borderColor=C,R.pointBackgroundColor=q,Pe.borderColor=S,j.borderColor=P,ne.borderColor=s,fe.borderColor=o):y&&!b||!y&&b?(H.borderColor=C,$.pointBackgroundColor=S,R.pointBackgroundColor=P,Pe.borderColor=s,ne.borderColor=s,j.borderColor=o,fe.borderColor=o):(H.borderColor=C,$.pointBackgroundColor=s,R.pointBackgroundColor=o)}const p=e.options;Object.keys(p.scales).forEach(y=>{const b=p.scales[y];b.ticks.color=o,b.title.color=o,b.grid.color=c,b.grid.tickColor=c,b.grid.borderColor=c});try{d.trendlineLinear.style=o}catch{}e.options.plugins.annotation.annotations.forEach(y=>{y.id!=="funbox-label"&&(y.borderColor=o),y.label.backgroundColor=o,y.label.color=t}),e.update("none")}function UM(e){mo.defaults.font.family=e.replace(/_/g," ")}function tw(){ll(),ue.updateColors(),U.updateColors(),tn.updateColors(),on.updateColors(),Ja.updateColors(),Ut.updateColors()}be((e,t)=>{e==="accountChart"&&Z()==="account"&&(Xv(),Zv(),Jv(),ew()),e==="fontFamily"&&UM(t)});const Ae={blur:{value:0,default:0},brightness:{value:1,default:1},saturate:{value:1,default:1},opacity:{value:1,default:1}};function VM(){let e="";return Object.keys(Ae).forEach(t=>{const o=t;Ae[o].value!==Ae[o].default&&(e+=`${t}(${Ae[o].value}${t==="blur"?"rem":""}) `)}),e}function En(){const t={filter:VM(),width:`calc(100% + ${Ae.blur.value*4}rem)`,height:`calc(100% + ${Ae.blur.value*4}rem)`,left:`-${Ae.blur.value*2}rem`,top:`-${Ae.blur.value*2}rem`,position:"absolute"};i(".customBackground img").css(t)}function KM(){i(".section[data-config-name='customBackgroundFilter'] .blur input").val(Ae.blur.value),i(".section[data-config-name='customBackgroundFilter'] .brightness input").val(Ae.brightness.value),i(".section[data-config-name='customBackgroundFilter'] .saturate input").val(Ae.saturate.value),i(".section[data-config-name='customBackgroundFilter'] .opacity input").val(Ae.opacity.value)}function vl(){i(".section[data-config-name='customBackgroundFilter'] .blur .value").html(Ae.blur.value.toFixed(1)),i(".section[data-config-name='customBackgroundFilter'] .brightness .value").html(Ae.brightness.value.toFixed(1)),i(".section[data-config-name='customBackgroundFilter'] .saturate .value").html(Ae.saturate.value.toFixed(1)),i(".section[data-config-name='customBackgroundFilter'] .opacity .value").html(Ae.opacity.value.toFixed(1))}function ow(){KM(),vl()}function GM(e){Ae.blur.value=e[0],Ae.brightness.value=e[1],Ae.saturate.value=e[2],Ae.opacity.value=e[3],ow()}i(".section[data-config-name='customBackgroundFilter'] .blur input").on("input",()=>{Ae.blur.value=parseFloat(i(".section[data-config-name='customBackgroundFilter'] .blur input").val()),vl(),En()});i(".section[data-config-name='customBackgroundFilter'] .brightness input").on("input",()=>{Ae.brightness.value=parseFloat(i(".section[data-config-name='customBackgroundFilter'] .brightness input").val()),vl(),En()});i(".section[data-config-name='customBackgroundFilter'] .saturate input").on("input",()=>{Ae.saturate.value=parseFloat(i(".section[data-config-name='customBackgroundFilter'] .saturate input").val()),vl(),En()});i(".section[data-config-name='customBackgroundFilter'] .opacity input").on("input",()=>{Ae.opacity.value=parseFloat(i(".section[data-config-name='customBackgroundFilter'] .opacity input").val()),vl(),En()});i(".section[data-config-name='customBackgroundFilter'] input").on("input",()=>{jM()});const jM=It(2e3,async()=>{const e=Object.keys(Ae).map(t=>Ae[t].value);Oi(e,!1)});be((e,t)=>{e==="customBackgroundFilter"&&t&&(GM(t),En())});const ih={8008:{bgColor:"#333a45",mainColor:"#f44c7f",subColor:"#939eae",textColor:"#e9ecf0"},9009:{bgColor:"#eeebe2",mainColor:"#080909",subColor:"#99947f",textColor:"#080909"},dark_note:{bgColor:"#1f1f1f",mainColor:"#f2c17b",subColor:"#768f95",textColor:"#d2dff4"},viridescent:{bgColor:"#2c3333",mainColor:"#95d5b2",subColor:"#84a98c",textColor:"#e9f5db"},dark:{bgColor:"#111",mainColor:"#eee",subColor:"#444",textColor:"#eee"},phantom:{bgColor:"#1a1b26",mainColor:"#7aa2f7",subColor:"#414868",textColor:"#c0caf5"},muted:{bgColor:"#525252",mainColor:"#c5b4e3",subColor:"#939eae",textColor:"#b1e4e3"},dark_magic_girl:{bgColor:"#091f2c",mainColor:"#f5b1cc",subColor:"#93e8d3",textColor:"#a288d9"},carbon:{bgColor:"#313131",mainColor:"#f66e0d",subColor:"#616161",textColor:"#f5e6c8"},vesper:{bgColor:"#101010",mainColor:"#ffc799",subColor:"#99ffe4",textColor:"#ffffff"},our_theme:{bgColor:"#ce1226",mainColor:"#fcd116",subColor:"#6d0f19",textColor:"#ffffff"},dots:{bgColor:"#121520",mainColor:"#fff",subColor:"#676e8a",textColor:"#fff"},nautilus:{bgColor:"#132237",mainColor:"#ebb723",subColor:"#0b4c6c",textColor:"#1cbaac"},serika:{bgColor:"#e1e1e3",mainColor:"#e2b714",subColor:"#aaaeb3",textColor:"#323437"},serika_dark:{bgColor:"#323437",mainColor:"#e2b714",subColor:"#646669",textColor:"#d1d0c5"},bushido:{bgColor:"#242933",mainColor:"#ec4c56",subColor:"#596172",textColor:"#f6f0e9"},red_samurai:{bgColor:"#84202c",mainColor:"#c79e6e",subColor:"#55131b",textColor:"#e2dad0"},rgb:{bgColor:"#111",mainColor:"#eee",subColor:"#444",textColor:"#eee"},oblivion:{bgColor:"#313231",mainColor:"#a5a096",subColor:"#5d6263",textColor:"#f7f5f1"},magic_girl:{bgColor:"#ffffff",mainColor:"#f5b1cc",subColor:"#93e8d3",textColor:"#00ac8c"},metropolis:{bgColor:"#0f1f2c",mainColor:"#56c3b7",subColor:"#326984",textColor:"#e4edf1"},mountain:{bgColor:"#0f0f0f",mainColor:"#e7e7e7",subColor:"#4c4c4c",textColor:"#e7e7e7"},laser:{bgColor:"#221b44",mainColor:"#009eaf",subColor:"#b82356",textColor:"#dbe7e8"},retro:{bgColor:"#dad3c1",mainColor:"#1d1b17",subColor:"#918b7d",textColor:"#1d1b17"},dracula:{bgColor:"#282a36",mainColor:"#bd93f9",subColor:"#6272a4",textColor:"#f8f8f2"},nord:{bgColor:"#242933",mainColor:"#88C0D0",subColor:"#2E3440",textColor:"#88C0D0"},mr_sleeves:{bgColor:"#d1d7da",mainColor:"#daa99b",subColor:"#9a9fa1",textColor:"#1d1d1d"},olivia:{bgColor:"#1c1b1d",mainColor:"#deaf9d",subColor:"#4e3e3e",textColor:"#f2efed"},bliss:{bgColor:"#262727",mainColor:"#f0d3c9",subColor:"#665957",textColor:"#fff"},mizu:{bgColor:"#afcbdd",mainColor:"#fcfbf6",subColor:"#85a5bb",textColor:"#1a2633"},metaverse:{bgColor:"#232323",mainColor:"#d82934",subColor:"#5e5e5e",textColor:"#e8e8e8"},shadow:{bgColor:"#000",mainColor:"#eee",subColor:"#444",textColor:"#eee"},mint:{bgColor:"#05385b",mainColor:"#5cdb95",subColor:"#20688a",textColor:"#edf5e1"},miami:{bgColor:"#f35588",mainColor:"#05dfd7",subColor:"#94294c",textColor:"#f0e9ec"},miami_nights:{bgColor:"#18181a",mainColor:"#e4609b",subColor:"#47bac0",textColor:"#fff"},modern_dolch:{bgColor:"#2d2e30",mainColor:"#7eddd3",subColor:"#54585c",textColor:"#e3e6eb"},botanical:{bgColor:"#7b9c98",mainColor:"#eaf1f3",subColor:"#495755",textColor:"#eaf1f3"},bingsu:{bgColor:"#b8a7aa",mainColor:"#83616e",subColor:"#48373d",textColor:"#ebe6ea"},terminal:{bgColor:"#191a1b",mainColor:"#79a617",subColor:"#48494b",textColor:"#e7eae0"},lavender:{bgColor:"#ada6c2",mainColor:"#e4e3e9",subColor:"#e4e3e9",textColor:"#2f2a41"},taro:{bgColor:"#b3baff",mainColor:"#130f1a",subColor:"#6f6c91",textColor:"#130f1a"},striker:{bgColor:"#124883",mainColor:"#d7dcda",subColor:"#0f2d4e",textColor:"#d6dbd9"},gruvbox_dark:{bgColor:"#282828",mainColor:"#d79921",subColor:"#665c54",textColor:"#ebdbb2"},gruvbox_light:{bgColor:"#fbf1c7",mainColor:"#689d6a",subColor:"#a89984",textColor:"#3c3836"},monokai:{bgColor:"#272822",mainColor:"#a6e22e",subColor:"#e6db74",textColor:"#e2e2dc"},sonokai:{bgColor:"#2c2e34",mainColor:"#9ed072",subColor:"#e7c664",textColor:"#e2e2e3"},camping:{bgColor:"#faf1e4",mainColor:"#618c56",subColor:"#c2b8aa",textColor:"#3c403b"},voc:{bgColor:"#190618",mainColor:"#e0caac",subColor:"#4c1e48",textColor:"#eeeae4"},vaporwave:{bgColor:"#a4a7ea",mainColor:"#e368da",subColor:"#7c7faf",textColor:"#f1ebf1"},pulse:{bgColor:"#181818",mainColor:"#17b8bd",subColor:"#53565a",textColor:"#e5f4f4"},matrix:{bgColor:"#000000",mainColor:"#15ff00",subColor:"#006500",textColor:"#d1ffcd"},olive:{bgColor:"#e9e5cc",mainColor:"#92946f",subColor:"#b7b39e",textColor:"#373731"},strawberry:{bgColor:"#f37f83",mainColor:"#fcfcf8",subColor:"#e53c58",textColor:"#fcfcf8"},night_runner:{bgColor:"#212121",mainColor:"#feff04",subColor:"#5c4a9c",textColor:"#e8e8e8"},cyberspace:{bgColor:"#181c18",mainColor:"#00ce7c",subColor:"#9578d3",textColor:"#c2fbe1"},joker:{bgColor:"#1a0e25",mainColor:"#99de1e",subColor:"#7554a3",textColor:"#e9e2f5"},dualshot:{bgColor:"#737373",mainColor:"#212222",subColor:"#aaaaaa",textColor:"#212222"},solarized_dark:{bgColor:"#002b36",mainColor:"#859900",subColor:"#2aa198",textColor:"#268bd2"},solarized_light:{bgColor:"#fdf6e3",mainColor:"#859900",subColor:"#2aa198",textColor:"#181819"},solarized_osaka:{bgColor:"#00141a",mainColor:"#859900",subColor:"#2aa198",textColor:"#b58900"},terra:{bgColor:"#0c100e",mainColor:"#89c559",subColor:"#436029",textColor:"#f0edd1"},red_dragon:{bgColor:"#1a0b0c",mainColor:"#ff3a32",subColor:"#e2a528",textColor:"#4a4d4e"},hammerhead:{bgColor:"#030613",mainColor:"#4fcdb9",subColor:"#213c53",textColor:"#e2f1f5"},future_funk:{bgColor:"#2e1a47",mainColor:"#f7f2ea",subColor:"#c18fff",textColor:"#f7f2ea"},milkshake:{bgColor:"#ffffff",mainColor:"#212b43",subColor:"#62cfe6",textColor:"#212b43"},aether:{bgColor:"#101820",mainColor:"#eedaea",subColor:"#cf6bdd",textColor:"#eedaea"},froyo:{bgColor:"#e1dacb",mainColor:"#7b7d7d",subColor:"#b29c5e",textColor:"#7b7d7d"},retrocast:{bgColor:"#07737a",mainColor:"#88dbdf",subColor:"#f3e03b",textColor:"#ffffff"},luna:{bgColor:"#221c35",mainColor:"#f67599",subColor:"#5a3a7e",textColor:"#ffe3eb"},graen:{bgColor:"#303c36",mainColor:"#a59682",subColor:"#181d1a",textColor:"#a59682"},bento:{bgColor:"#2d394d",mainColor:"#ff7a90",subColor:"#4a768d",textColor:"#fffaf8"},watermelon:{bgColor:"#1f4437",mainColor:"#d6686f",subColor:"#3e7a65",textColor:"#cdc6bc"},menthol:{bgColor:"#00c18c",mainColor:"#ffffff",subColor:"#186544",textColor:"#ffffff"},ishtar:{bgColor:"#202020",mainColor:"#91170c",subColor:"#847869",textColor:"#fae1c3"},mashu:{bgColor:"#2b2b2c",mainColor:"#76689a",subColor:"#d8a0a6",textColor:"#f1e2e4"},deku:{bgColor:"#058b8c",mainColor:"#b63530",subColor:"#255458",textColor:"#f7f2ea"},honey:{bgColor:"#f2aa00",mainColor:"#fff546",subColor:"#a66b00",textColor:"#f3eecb"},shoko:{bgColor:"#ced7e0",mainColor:"#81c4dd",subColor:"#7599b1",textColor:"#3b4c58"},norse:{bgColor:"#242425",mainColor:"#2b5f6d",subColor:"#505b5e",textColor:"#ccc2b1"},matcha_moccha:{bgColor:"#523525",mainColor:"#7ec160",subColor:"#9e6749",textColor:"#ecddcc"},cafe:{bgColor:"#ceb18d",mainColor:"#14120f",subColor:"#d4d2d1",textColor:"#14120f"},alpine:{bgColor:"#6c687f",mainColor:"#ffffff",subColor:"#9994b8",textColor:"#ffffff"},superuser:{bgColor:"#262a33",mainColor:"#43ffaf",subColor:"#526777",textColor:"#e5f7ef"},ms_cupcakes:{bgColor:"#ffffff",mainColor:"#5ed5f3",subColor:"#d64090",textColor:"#0a282f"},dollar:{bgColor:"#e4e4d4",mainColor:"#6b886b",subColor:"#8a9b69",textColor:"#555a56"},lime:{bgColor:"#7c878e",mainColor:"#93c247",subColor:"#4b5257",textColor:"#bfcfdc"},sweden:{bgColor:"#0058a3",mainColor:"#ffcc02",subColor:"#57abdb",textColor:"#ffffff"},wavez:{bgColor:"#1c292f",mainColor:"#6bde3b",subColor:"#1f5e6b",textColor:"#e9efe6"},nebula:{bgColor:"#212135",mainColor:"#be3c88",subColor:"#19b3b8",textColor:"#838686"},lil_dragon:{bgColor:"#ebe1ef",mainColor:"#8a5bd6",subColor:"#a28db8",textColor:"#212b43"},pastel:{bgColor:"#e0b2bd",mainColor:"#fbf4b6",subColor:"#b4e9ff",textColor:"#6d5c6f"},alduin:{bgColor:"#1c1c1c",mainColor:"#dfd7af",subColor:"#444444",textColor:"#f5f3ed"},paper:{bgColor:"#eeeeee",mainColor:"#444444",subColor:"#b2b2b2",textColor:"#444444"},fundamentals:{bgColor:"#727474",mainColor:"#7fa482",subColor:"#cac4be",textColor:"#131313"},drowning:{bgColor:"#191826",mainColor:"#4a6fb5",subColor:"#50688c",textColor:"#9393a7"},iceberg_dark:{bgColor:"#161821",mainColor:"#84a0c6",subColor:"#595e76",textColor:"#c6c8d1"},iceberg_light:{bgColor:"#e8e9ec",mainColor:"#2d539e",subColor:"#adb1c4",textColor:"#33374c"},onedark:{bgColor:"#2f343f",mainColor:"#61afef",subColor:"#eceff4",textColor:"#98c379"},darling:{bgColor:"#fec8cd",mainColor:"#ffffff",subColor:"#a30000",textColor:"#ffffff"},repose_dark:{bgColor:"#2f3338",mainColor:"#d6d2bc",subColor:"#8f8e84",textColor:"#d6d2bc"},repose_light:{bgColor:"#efead0",mainColor:"#5f605e",subColor:"#8f8e84",textColor:"#333538"},horizon:{bgColor:"#1c1e26",mainColor:"#c4a88a",subColor:"#db886f",textColor:"#bbbbbb"},rudy:{bgColor:"#1a2b3e",mainColor:"#af8f5c",subColor:"#3a506c",textColor:"#c9c8bf"},stealth:{bgColor:"#010203",mainColor:"#383e42",subColor:"#5e676e",textColor:"#383e42"},"80s_after_dark":{bgColor:"#1b1d36",mainColor:"#fca6d1",subColor:"#99d6ea",textColor:"#e1e7ec"},arch:{bgColor:"#0c0d11",mainColor:"#7ebab5",subColor:"#454864",textColor:"#f6f5f5"},rose_pine:{bgColor:"#1f1d27",mainColor:"#9ccfd8",subColor:"#c4a7e7",textColor:"#e0def4"},rose_pine_moon:{bgColor:"#2a273f",mainColor:"#9ccfd8",subColor:"#c4a7e7",textColor:"#e0def4"},rose_pine_dawn:{bgColor:"#fffaf3",mainColor:"#56949f",subColor:"#c4a7e7",textColor:"#286983"},copper:{bgColor:"#442f29",mainColor:"#b46a55",subColor:"#7ebab5",textColor:"#e7e0de"},grand_prix:{bgColor:"#36475c",mainColor:"#c0d036",subColor:"#5c6c80",textColor:"#c1c7d7"},peaches:{bgColor:"#e0d7c1",mainColor:"#dd7a5f",subColor:"#e7b28e",textColor:"#5f4c41"},bouquet:{bgColor:"#173f35",mainColor:"#eaa09c",subColor:"#408e7b",textColor:"#e9e0d2"},midnight:{bgColor:"#0b0e13",mainColor:"#60759f",subColor:"#394760",textColor:"#9fadc6"},blueberry_light:{bgColor:"#dae0f5",mainColor:"#506477",subColor:"#92a4be",textColor:"#678198"},blueberry_dark:{bgColor:"#212b42",mainColor:"#add7ff",subColor:"#5c7da5",textColor:"#91b4d5"},fledgling:{bgColor:"#3b363f",mainColor:"#fc6e83",subColor:"#8e5568",textColor:"#e6d5d3"},ez_mode:{bgColor:"#0068c6",mainColor:"#fa62d5",subColor:"#138bf7",textColor:"#ffffff"},vscode:{bgColor:"#1e1e1e",mainColor:"#007acc",subColor:"#4d4d4d",textColor:"#d4d4d4"},material:{bgColor:"#263238",mainColor:"#80cbc4",subColor:"#4c6772",textColor:"#e6edf3"},godspeed:{bgColor:"#eae4cf",mainColor:"#9abbcd",subColor:"#ada998",textColor:"#646669"},witch_girl:{bgColor:"#f3dbda",mainColor:"#56786a",subColor:"#ddb4a7",textColor:"#56786a"},terror_below:{bgColor:"#0b1e1a",mainColor:"#66ac92",subColor:"#015c53",textColor:"#dceae5"},sewing_tin:{bgColor:"#241963",mainColor:"#f2ce83",subColor:"#446ad5",textColor:"#ffffff"},soaring_skies:{bgColor:"#fff9f2",mainColor:"#55c6f0",subColor:"#1e107a",textColor:"#1d1e1e"},sewing_tin_light:{bgColor:"#ffffff",mainColor:"#2d2076",subColor:"#385eca",textColor:"#2d2076"},chaos_theory:{bgColor:"#141221",mainColor:"#fd77d7",subColor:"#676e8a",textColor:"#dde5ed"},hanok:{bgColor:"#d8d2c3",mainColor:"#513a2a",subColor:"#8b6f5c",textColor:"#393b3b"},comfy:{bgColor:"#4a5b6e",mainColor:"#f8cdc6",subColor:"#9ec1cc",textColor:"#f5efee"},tiramisu:{bgColor:"#cfc6b9",mainColor:"#c0976f",subColor:"#c0976f",textColor:"#7d5448"},diner:{bgColor:"#537997",mainColor:"#c3af5b",subColor:"#445c7f",textColor:"#dfdbc8"},modern_ink:{bgColor:"#ffffff",mainColor:"#ff360d",subColor:"#b7b7b7",textColor:"#000000"},dev:{bgColor:"#1b2028",mainColor:"#23a9d5",subColor:"#4b5975",textColor:"#ccccb5"},moonlight:{bgColor:"#191f28",mainColor:"#c69f68",subColor:"#4b5975",textColor:"#ccccb5"},pink_lemonade:{bgColor:"#f6d992",mainColor:"#f6a192",subColor:"#f6b092",textColor:"#fcfcf8"},creamsicle:{bgColor:"#ff9869",mainColor:"#fcfcf8",subColor:"#ff661f",textColor:"#fcfcf8"},beach:{bgColor:"#ffeead",mainColor:"#96ceb4",subColor:"#ffcc5c",textColor:"#5b7869"},desert_oasis:{bgColor:"#fff2d5",mainColor:"#d19d01",subColor:"#0061fe",textColor:"#332800"},frozen_llama:{bgColor:"#9bf2ea",mainColor:"#6d44a6",subColor:"#b690fd",textColor:"#ffffff"},ryujinscales:{bgColor:"#081426",mainColor:"#f17754",subColor:"#ffbc90",textColor:"#ffe4bc"},trackday:{bgColor:"#464d66",mainColor:"#e0513e",subColor:"#5c7eb9",textColor:"#cfcfcf"},fruit_chew:{bgColor:"#d6d3d6",mainColor:"#5c1e5f",subColor:"#b49cb5",textColor:"#282528"},evil_eye:{bgColor:"#0084c2",mainColor:"#f7f2ea",subColor:"#01589f",textColor:"#171718"},trance:{bgColor:"#00021b",mainColor:"#e51376",subColor:"#3c4c79",textColor:"#fff"},fire:{bgColor:"#0f0000",mainColor:"#b31313",subColor:"#683434",textColor:"#ffffff"},aurora:{bgColor:"#011926",mainColor:"#00e980",subColor:"#245c69",textColor:"#fff"},leather:{bgColor:"#a86948",mainColor:"#ffe4bc",subColor:"#81482b",textColor:"#ffe4bc"},fleuriste:{bgColor:"#c6b294",mainColor:"#405a52",subColor:"#64374d",textColor:"#091914"},dmg:{bgColor:"#dadbdc",mainColor:"#ae185e",subColor:"#3846b1",textColor:"#414141"},catppuccin:{bgColor:"#1e1e2e",mainColor:"#cba6f7",subColor:"#7f849c",textColor:"#cdd6f4"},snes:{bgColor:"#bfbec2",mainColor:"#553d94",subColor:"#9f8ad4",textColor:"#2e2e2e"},passion_fruit:{bgColor:"#7c2142",mainColor:"#f4a3b4",subColor:"#9994b8",textColor:"#ffffff"},blue_dolphin:{bgColor:"#003950",mainColor:"#ffcefb",subColor:"#00e4ff",textColor:"#82eaff"},mexican:{bgColor:"#f8ad34",mainColor:"#b12189",subColor:"#333",textColor:"#eee"},husqy:{bgColor:"#000000",mainColor:"#c58aff",subColor:"#972fff",textColor:"#ebd7ff"},peach_blossom:{bgColor:"#292929",mainColor:"#99b898",subColor:"#616161",textColor:"#fecea8"},dino:{bgColor:"#ffffff",mainColor:"#40d672",subColor:"#d5d5d5",textColor:"#1d221f"},tron_orange:{bgColor:"#0d1c1c",mainColor:"#f0e800",subColor:"#ff6600",textColor:"#ffffff"},hedge:{bgColor:"#415e31",mainColor:"#6a994e",subColor:"#ede5b4",textColor:"#f7f1d6"},modern_dolch_light:{bgColor:"#dbdbdb",mainColor:"#8fd1c3",subColor:"#acacac",textColor:"#454545"},iv_spade:{bgColor:"#0c0c0c",mainColor:"#b7976a",subColor:"#404040",textColor:"#d3c2c3"},iv_clover:{bgColor:"#a0a0a0",mainColor:"#573e40",subColor:"#353535",textColor:"#3b2d3b"},cheesecake:{bgColor:"#fdf0d5",mainColor:"#8e2949",subColor:"#d91c81",textColor:"#3a3335"},earthsong:{bgColor:"#292521",mainColor:"#509452",subColor:"#f5ae2d",textColor:"#e6c7a8"},purpleish:{bgColor:"#1e1e32",mainColor:"#7a52cc",subColor:"#3d3d66",textColor:"#7a52cc"},nord_light:{bgColor:"#eceff4",mainColor:"#8fbcbb",subColor:"#6a7791",textColor:"#8fbcbb"},slambook:{bgColor:"#FFFDDE",mainColor:"#13005A",subColor:"#1c82adc4",textColor:"#125d98"},breeze:{bgColor:"#e8d5c4",mainColor:"#7d67a9",subColor:"#3a98b9",textColor:"#1b4c5e"},cherry_blossom:{bgColor:"#323437",mainColor:"#d65ccc",subColor:"#787d82",textColor:"#d1d0c5"},everblush:{bgColor:"#141b1e",mainColor:"#8ccf7e",subColor:"#838887",textColor:"#dadada"},grape:{bgColor:"#2c003e",mainColor:"#ff8f00",subColor:"#651e56",textColor:"#fff"},rainbow_trail:{bgColor:"#f5f5f5",mainColor:"#363636",subColor:"#4f4f4f",textColor:"#1f1f1f"},tangerine:{bgColor:"#ffede0",mainColor:"#fe5503",subColor:"#ff9562",textColor:"#3d1705"},macroblank:{bgColor:"#b2d2c8",mainColor:"#c13117",subColor:"#717977",textColor:"#490909"},anti_hero:{bgColor:"#00002e",mainColor:"#ffadad",subColor:"#ff3d8b",textColor:"#f1deef"},incognito:{bgColor:"#0e0e0e",mainColor:"#ff9900",subColor:"#2f2f2f",textColor:"#c6c6c6"},discord:{bgColor:"#313338",mainColor:"#5a65ea",subColor:"#565861",textColor:"#dcdee3"},cy_red:{bgColor:"#6e2626",mainColor:"#e55050",subColor:"#ff6060",textColor:"#ffaaaa"},floret:{bgColor:"#00272c",mainColor:" #ffdd6d",subColor:"#779097",textColor:"#E5E5E5"},lilac_mist:{bgColor:"#fffbfe",mainColor:"#b94189",subColor:"#e094c2",textColor:"#5c2954"},terrazzo:{bgColor:"#f1e5da",mainColor:"#e0794e",subColor:"#688e8f",textColor:"#023e3b"},suisei:{bgColor:"#3b4a62",mainColor:"#bef0ff",subColor:"#fe9841",textColor:"#dbdeeb"},github:{bgColor:"#212830",mainColor:"#41ce5c",subColor:"#788386",textColor:"#ccdae6"},sunset:{bgColor:"#211e24",mainColor:"#f79777",subColor:"#5b578e",textColor:"#f4e0c9"}},wl=Object.keys(ih).sort().map(e=>({...ih[e],name:e})),QM=[...wl.sort((e,t)=>{const o=Nc(e.bgColor);return Nc(t.bgColor).lgt-o.lgt})];class YM{constructor(t="file-storage-db"){this.dbPromise=jS(t,1,{upgrade(o){o.objectStoreNames.contains("files")||o.createObjectStore("files")}})}async storeFile(t,o){await(await this.dbPromise).put("files",o,t)}async getFile(t){return(await this.dbPromise).get("files",t)}async deleteFile(t){await(await this.dbPromise).delete("files",t)}async listFilenames(){return(await this.dbPromise).getAllKeys("files")}async hasFile(t){return await this.getFile(t)!==void 0}}const et=new YM;let Ve=null,Lf=!1,Di=0;const Ba=["--bg-color","--main-color","--caret-color","--sub-color","--sub-alt-color","--text-color","--error-color","--error-extra-color","--colorful-error-color","--colorful-error-extra-color"];async function XM(){setTimeout(async()=>{let e,t;t=await Kt("bg"),e=await Kt("main"),t===e&&(t="#111",e="#eee");const o=`
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
  <style>
    #bg{fill:${t};}
    path{fill:${e};}
  </style>
  <g>
    <path id="bg" d="M0 16Q0 0 16 0h32q16 0 16 16v32q0 16-16 16H16Q0 64 0 48"/>
    <path d="M9.09 24.1v21.2h5.12V33.1q.256-4.61 4.48-4.61 3.46.384 3.46 3.84v12.9h5.12v-11.5q-.128-5.25 4.48-5.25 3.46.384 3.46 3.84v12.9h5.12v-12.2q0-9.47-7.04-9.47-4.22 0-7.04 3.46-2.18-3.46-6.02-3.46-3.46 0-6.02 2.43v-2.05M47 18.9v5.12h-4.61v5.12H47v16.1h5.12v-16.1h4.61v-5.12h-4.61V18.9"/>
  </g>
</svg>`;i("#favicon").attr("href","data:image/svg+xml;base64,"+btoa(o))},125)}function ZM(){console.debug("Theme controller clearing custom theme");for(const e of Ba)document.documentElement.style.setProperty(e,"")}let Hn=[];async function aw(e){return new Promise(t=>{function o(){console.debug("Theme controller swapping elements");const n=i("#currentTheme"),l=i("#nextTheme");if(l.length===0){console.debug("Theme controller failed to swap elements, next is missing");return}n.remove(),l.attr("id","currentTheme")}console.debug("Theme controller loading style",e),Hn.push(setTimeout(()=>{J()},100)),i("#nextTheme").remove();const a=document.querySelector("#currentTheme"),s=document.createElement("link");s.type="text/css",s.rel="stylesheet",s.id="nextTheme",s.onload=()=>{console.debug("Theme controller loaded style",e),K(),o(),Hn.map(n=>clearTimeout(n)),Hn=[],i("#keymap .keymapKey").stop(!0,!0).removeAttr("style"),t()},s.onerror=n=>{console.debug("Theme controller failed to load style",e,n),console.error(`Failed to load theme ${e}`,n),K(),m("Failed to load theme",0),o(),Hn.map(l=>clearTimeout(l)),Hn=[],i("#keymap .keymapKey").stop(!0,!0).removeAttr("style"),t()},e==="custom"?s.href="/themes/serika_dark.css":s.href=`/themes/${e}.css`,a===null?(console.debug("Theme controller appending link to the head",s),document.head.appendChild(s)):(console.debug("Theme controller inserting link after current theme",s),a.after(s))})}async function ss(e,t,o=!1){console.debug("Theme controller applying theme",e,t,o);const a=t?"custom":e;if(r.customTheme&&!o||t){const n=t??r.customThemeColors;for(let l=0;l<Ba.length;l++){const c=Ba[l];document.documentElement.style.setProperty(c,n[l])}}Ux(),i(".keymapKey").attr("style",""),await aw(a),a!=="custom"&&ZM(),ll();const s=await hs();i(".keymapKey").attr("style",""),tw(),XM(),i("#metaThemeColor").attr("content",s.bg),sw(o?e:void 0),dv(await Kt("bg"))?i("body").addClass("darkMode"):i("body").removeClass("darkMode")}function sw(e){const t=document.querySelector("footer .right .current-theme"),o=t==null?void 0:t.querySelector(".text"),a=t==null?void 0:t.querySelector(".favIndicator");if(!(t instanceof HTMLElement)||!(o instanceof HTMLElement)||!(a instanceof HTMLElement))return;let s=r.theme;if(Ve!==null&&(s=Ve),r.customTheme&&(s="custom"),e!==void 0&&e!==""&&(s=e),s=s.replace(/_/g," "),o.innerText=s,r.customTheme){a.style.display="none";return}a.style.display="";const l=e??Ve??r.theme;l!==null&&r.favThemes.includes(l)?a.style.display="block":a.style.display="none"}let pr=null;function dm(e,t){pr={theme:e,colors:t},JM()}const JM=It(250,()=>{pr&&(Lf=!0,ss(pr.theme,pr.colors,!0))});async function Tt(e,t=!1){console.debug("Theme controller setting theme",e,t),await ss(e,void 0,t),!t&&r.autoSwitchTheme&&(Rb(!1),m("Auto switch theme disabled",0))}async function Nr(e=!0){pr=null,Lf&&(Lf=!1,e&&(Ve!==null?await ss(Ve):r.customTheme?await ss("custom"):await ss(r.theme)))}let io=[];async function iw(){var t,o;const e=wl;r.randomTheme==="fav"&&r.favThemes.length>0?io=r.favThemes:r.randomTheme==="light"?io=e.filter(a=>ZL(a.bgColor)).map(a=>a.name):r.randomTheme==="dark"?io=e.filter(a=>dv(a.bgColor)).map(a=>a.name):r.randomTheme==="on"?io=e.map(a=>a.name):r.randomTheme==="custom"&&x()&&(io=((o=(t=x())==null?void 0:t.customThemes)==null?void 0:o.map(a=>a._id))??[]),rn(io),Di=0}async function nw(){var t,o,a,s,n;if(io.length===0&&(await iw(),io.length===0))return;Ve=io[Di],Di++,Di>=io.length&&(rn(io),Di=0);let e;if(r.randomTheme==="custom"){const l=(o=(t=x())==null?void 0:t.customThemes)==null?void 0:o.find(c=>c._id===Ve);e=l==null?void 0:l.colors,Ve="custom"}if(xa(!1,!0),await ss(Ve,e),Di>=io.length){let l=Ve.replace(/_/g," ");r.randomTheme==="custom"&&(l=(((n=(s=(a=x())==null?void 0:a.customThemes)==null?void 0:s.find(c=>c._id===Ve))==null?void 0:n.name)??"custom").replace(/_/g," ")),m(l,0)}}async function Mu(){Ve!==null&&(Ve=null,r.customTheme?await ss("custom"):await ss(r.theme))}function rw(){r.customBackgroundSize==="max"?i(".customBackground img").css({objectFit:""}):i(".customBackground img").css({objectFit:r.customBackgroundSize})}async function yn(){let e=r.customBackground;i(".pageSettings .section[data-config-name='customBackgroundSize'] input[type='text']").val(e);const t=await et.getFile("LocalBackgroundFile");if(t!==void 0&&(e=t),i(".pageSettings .section[data-config-name='customBackgroundFilter']").addClass("hidden"),e==="")i("#words").removeClass("noErrorBorder"),i("#resultWordsHistory").removeClass("noErrorBorder"),i(".customBackground img").remove();else{i("#words").addClass("noErrorBorder"),i("#resultWordsHistory").addClass("noErrorBorder");const o=document.querySelector(".customBackground"),a=document.createElement("img");a.setAttribute("src",e),a.setAttribute("onError","javascript:this.style.display='none'; window.dispatchEvent(new Event('customBackgroundFailed'))"),a.onload=()=>{i(".pageSettings .section[data-config-name='customBackgroundFilter']").removeClass("hidden")},o==null||o.replaceChildren(a),En(),rw()}}async function Ur(){let e=r.fontFamily.replace(/_/g," ");const t=await et.getFile("LocalFontFamilyFile");t===void 0?i(".customFont").empty():(e="LOCALCUSTOM",i(".customFont").html(`
      @font-face{ 
        font-family: LOCALCUSTOM;
        src: url(${t});
        font-weight: 400;
        font-style: normal;
        font-display: block;
      }`)),document.documentElement.style.setProperty("--font",`"${e}", "Roboto Mono", "Vazirmatn", monospace`)}var dy,Zl,uy;(uy=(Zl=(dy=window.matchMedia)==null?void 0:dy.call(window,"(prefers-color-scheme: dark)"))==null?void 0:Zl.addEventListener)==null||uy.call(Zl,"change",e=>{!r.autoSwitchTheme||r.customTheme||(e.matches?Tt(r.themeDark,!0):Tt(r.themeLight,!0))});let Au=!1;be(async(e,t,o)=>{var a,s,n;e==="fullConfigChange"&&(Au=!0),e==="fullConfigChangeFinished"&&(Au=!1,await Mu(),await Nr(!1),r.autoSwitchTheme?(a=window.matchMedia)!=null&&a.call(window,"(prefers-color-scheme: dark)").matches?await Tt(r.themeDark,!0):await Tt(r.themeLight,!0):r.customTheme?await Tt("custom"):await Tt(r.theme),await yn()),!Au&&(e==="randomTheme"&&iw(),e==="customTheme"&&(t?await Tt("custom"):await Tt(r.theme)),e==="customThemeColors"&&(o?dm("custom"):await Tt("custom")),e==="theme"&&(await Mu(),await Nr(!1),await Tt(t)),e==="randomTheme"&&t==="off"&&await Mu(),e==="customBackground"&&await yn(),e==="customBackgroundSize"&&rw(),e==="autoSwitchTheme"&&(t?(s=window.matchMedia)!=null&&s.call(window,"(prefers-color-scheme: dark)").matches?await Tt(r.themeDark,!0):await Tt(r.themeLight,!0):await Tt(r.theme)),e==="themeLight"&&r.autoSwitchTheme&&!((n=window.matchMedia)!=null&&n.call(window,"(prefers-color-scheme: dark)").matches)&&!o&&await Tt(r.themeLight,!0),e==="themeDark"&&r.autoSwitchTheme&&window.matchMedia!==void 0&&window.matchMedia("(prefers-color-scheme: dark)").matches&&!o&&await Tt(r.themeDark,!0),["theme","customTheme","customThemeColors","randomTheme","favThemes"].includes(e)&&sw())});window.addEventListener("customBackgroundFailed",()=>{m("Custom background link is either temporarily unavailable or expired. Please make sure the URL is correct or change it",0,{duration:5})});let O=null,$f=0;function eA(e){(!Xs||Xs&&e>$f)&&($f=e)}async function tA(){var n;if(r.paceCaret==="off"&&!Xs||(i("#paceCaret").hasClass("hidden")||i("#paceCaret").addClass("hidden"),r.mode==="zen"))return;const e=i("#paceCaret"),t=(n=document==null?void 0:document.querySelector("#words .word"))==null?void 0:n.querySelector("letter"),o=i(t).height();if(t===void 0||o===void 0)return;const a=_.get((O==null?void 0:O.currentWordIndex)??0),s=Ed(a,Ro,hi);e.stop(!0,!0).animate({top:t.offsetTop-o/4,left:t.offsetLeft+(s?t.offsetWidth:0)},0,"linear")}async function Xc(){var n;i("#paceCaret").addClass("hidden");const e=gi(r,X);let t=0;if(r.paceCaret==="pb"?t=((n=await xr(r.mode,e,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode,za()))==null?void 0:n.wpm)??0:r.paceCaret==="tagPb"?t=await xx(r.mode,e,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode):r.paceCaret==="average"?([t]=await wb(r.mode,e,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode),t=Math.round(t)):r.paceCaret==="daily"?(t=await Sx(r.mode,e,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode),t=Math.round(t)):r.paceCaret==="custom"?t=r.paceCaretCustomSpeed:(r.paceCaret==="last"||Xs)&&(t=$f),t===void 0||t<1||Number.isNaN(t)){O=null;return}const o=t*5,a=o/60,s=60/o;O={wpm:t,cps:a,spc:s,correction:0,currentWordIndex:0,currentLetterIndex:-1,wordsStatus:{},timeout:null},await tA()}async function lw(e){if(!(O===null||!Ee||de)){try{if(O.currentLetterIndex++,O.currentLetterIndex>=_.get(O.currentWordIndex).length&&(O.currentLetterIndex=-1,O.currentWordIndex++),!r.blindMode){if(O.correction<0)for(;O.correction<0;)O.currentLetterIndex--,O.currentLetterIndex<=-2&&(O.currentLetterIndex=_.get(O.currentWordIndex-1).length-1,O.currentWordIndex--),O.correction++;else if(O.correction>0)for(;O.correction>0;)O.currentLetterIndex++,O.currentLetterIndex>=_.get(O.currentWordIndex).length&&(O.currentLetterIndex=-1,O.currentWordIndex++),O.correction--}}catch{O=null,i("#paceCaret").addClass("hidden");return}try{const t=i("#paceCaret");let o,a,s;try{const l=document.querySelector(`#words .word[data-wordindex='${O.currentWordIndex}']`);if(!l)throw new Error("Word element not found");O.currentLetterIndex===-1?o=l.querySelectorAll("letter")[0]:o=l.querySelectorAll("letter")[O.currentLetterIndex];const c=i(o).height(),d=i(o).width(),u=t.width();if(c===void 0||d===void 0||u===void 0)throw new Error("Undefined current letter height, width or caret width.");const f=_.get(O.currentWordIndex),p=Ed(f,Ro,hi);a=l.offsetTop+o.offsetTop-r.fontSize*Ys(1)*.1,O.currentLetterIndex===-1?s=l.offsetLeft+o.offsetLeft-u/2+(p?d:0):s=l.offsetLeft+o.offsetLeft-u/2+(p?0:d),t.removeClass("hidden")}catch{t.addClass("hidden")}const n=e-performance.now();a!==void 0&&(i("#paceCaret").css({top:a-xd}),r.smoothCaret!=="off"?t.stop(!0,!0).animate({left:s},De()?0:n,"linear"):t.stop(!0,!0).animate({left:s},0,"linear")),O.timeout=setTimeout(()=>{lw(e+((O==null?void 0:O.spc)??0)*1e3).catch(()=>{O=null})},n)}catch(t){console.error(t),i("#paceCaret").addClass("hidden")}}}function oA(){(O==null?void 0:O.timeout)!==null&&(O==null?void 0:O.timeout)!==void 0&&clearTimeout(O.timeout),O=null}function nh(e,t){e?O!==null&&O.wordsStatus[ce]===!0&&!r.blindMode&&(O.wordsStatus[ce]=void 0,O.correction-=t.length+1):O!==null&&O.wordsStatus[ce]===void 0&&!r.blindMode&&(O.wordsStatus[ce]=!0,O.correction+=t.length+1)}function aA(){lw(performance.now()+((O==null?void 0:O.spc)??0)*1e3)}function sA(){const e=i("#paceCaret");e.removeClass(["off","default","underline","outline","block","carrot","banana"]),e.addClass(r.paceCaretStyle)}be(e=>{e==="paceCaret"&&Xc(),e==="paceCaretStyle"&&sA()});be(e=>{e==="monkey"&&Ee&&(r.monkey?i("#monkey").removeClass("hidden"):i("#monkey").addClass("hidden"))});let no=!1,ro=!1;const dt={left:!1,right:!1,last:"right"},Eu={"00":document.querySelector("#monkey .up"),"01":document.querySelector("#monkey .right"),10:document.querySelector("#monkey .left"),11:document.querySelector("#monkey .both")},_u={"00":document.querySelector("#monkey .fast .up"),"01":document.querySelector("#monkey .fast .right"),10:document.querySelector("#monkey .fast .left"),11:document.querySelector("#monkey .fast .both")};function rh(e){return e?"1":"0"}function cw(){var e,t,o;if(r.monkey&&!((e=document.querySelector("#monkey"))!=null&&e.classList.contains("hidden"))){Object.keys(Eu).forEach(s=>{var n;(n=Eu[s])==null||n.classList.add("hidden")}),Object.keys(_u).forEach(s=>{var n;(n=_u[s])==null||n.classList.add("hidden")});const a=`${rh(no)}${rh(ro)}`;(t=Eu[a])==null||t.classList.remove("hidden"),(o=_u[a])==null||o.classList.remove("hidden")}}function iA(e){if(!r.monkey)return;const t=Tc(e,130,180,0,1);i("#monkey .fast").animate({opacity:t},1e3);let o=Tc(e,130,180,.25,.01);o===.25&&(o=0),i("#monkey").css({animationDuration:o+"s"})}function nA(e){if(!r.monkey)return;const{leftSide:t,rightSide:o}=lm(e.code);t&&o?dt.last==="left"?ro?no||(no=!0,dt.last="left",dt.left=!0):(ro=!0,dt.last="right",dt.right=!0):no?ro||(ro=!0,dt.last="right",dt.right=!0):(no=!0,dt.last="left",dt.left=!0):(no=no||t,ro=ro||o),cw()}function rA(e){if(!r.monkey)return;const{leftSide:t,rightSide:o}=lm(e.code);t&&o?dt.left&&dt.last==="left"?(no=!1,dt.left=!1):dt.right&&dt.last==="right"?(ro=!1,dt.right=!1):(no=no&&!dt.left,ro=ro&&!dt.right):(no=no&&!t,ro=ro&&!o),cw()}function lA(){r.monkey&&i("#monkey").css("opacity",0).removeClass("hidden").animate({opacity:1},125)}function dw(){i("#monkey").css("opacity",1).animate({opacity:1},125,()=>{i("#monkey").addClass("hidden"),i("#monkey .fast").stop(!0,!0).css("opacity",0),i("#monkey").stop(!0,!0).css({animationDuration:"0s"})})}const uw=[];function cA(e){uw.push(e)}function Vr(e,t,o){uw.forEach(a=>{try{a(e,t,o)}catch(s){console.error("Timer event subscriber threw an error"),console.error(s)}})}async function um(){return await Sd(()=>import("./vendor.DwUKJXLy.js").then(e=>e.h),__vite__mapDeps([0,1,2]))}let ao=null,ii=null,Zc=null;async function dA(){const e=(await um()).Howl;Zc===null&&(Zc=new e({src:"../sound/timeWarning.wav"}))}async function fw(){const e=(await um()).Howl;ao===null&&(ao={1:[{sounds:[new e({src:"../sound/error1/error1_1.wav"}),new e({src:"../sound/error1/error1_1.wav"})],counter:0}],2:[{sounds:[new e({src:"../sound/error2/error2_1.wav"}),new e({src:"../sound/error2/error2_1.wav"})],counter:0}],3:[{sounds:[new e({src:"../sound/error3/error3_1.wav"}),new e({src:"../sound/error3/error3_1.wav"})],counter:0}],4:[{sounds:[new e({src:"../sound/error4/error4_1.wav"}),new e({src:"../sound/error4/error4_1.wav"})],counter:0},{sounds:[new e({src:"../sound/error4/error4_2.wav"}),new e({src:"../sound/error4/error4_2.wav"})],counter:0}]},Howler.volume(r.soundVolume))}async function Zd(){const e=(await um()).Howl;ii===null&&(ii={1:[{sounds:[new e({src:"../sound/click1/click1_1.wav"}),new e({src:"../sound/click1/click1_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click1/click1_2.wav"}),new e({src:"../sound/click1/click1_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click1/click1_3.wav"}),new e({src:"../sound/click1/click1_3.wav"})],counter:0}],2:[{sounds:[new e({src:"../sound/click2/click2_1.wav"}),new e({src:"../sound/click2/click2_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click2/click2_2.wav"}),new e({src:"../sound/click2/click2_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click2/click2_3.wav"}),new e({src:"../sound/click2/click2_3.wav"})],counter:0}],3:[{sounds:[new e({src:"../sound/click3/click3_1.wav"}),new e({src:"../sound/click3/click3_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click3/click3_2.wav"}),new e({src:"../sound/click3/click3_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click3/click3_3.wav"}),new e({src:"../sound/click3/click3_3.wav"})],counter:0}],4:[{sounds:[new e({src:"../sound/click4/click4_1.wav"}),new e({src:"../sound/click4/click4_11.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_2.wav"}),new e({src:"../sound/click4/click4_22.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_3.wav"}),new e({src:"../sound/click4/click4_33.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_4.wav"}),new e({src:"../sound/click4/click4_44.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_5.wav"}),new e({src:"../sound/click4/click4_55.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_6.wav"}),new e({src:"../sound/click4/click4_66.wav"})],counter:0}],5:[{sounds:[new e({src:"../sound/click5/click5_1.wav"}),new e({src:"../sound/click5/click5_11.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_2.wav"}),new e({src:"../sound/click5/click5_22.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_3.wav"}),new e({src:"../sound/click5/click5_33.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_4.wav"}),new e({src:"../sound/click5/click5_44.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_5.wav"}),new e({src:"../sound/click5/click5_55.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_6.wav"}),new e({src:"../sound/click5/click5_66.wav"})],counter:0}],6:[{sounds:[new e({src:"../sound/click6/click6_1.wav"}),new e({src:"../sound/click6/click6_11.wav"})],counter:0},{sounds:[new e({src:"../sound/click6/click6_2.wav"}),new e({src:"../sound/click6/click6_22.wav"})],counter:0},{sounds:[new e({src:"../sound/click6/click6_3.wav"}),new e({src:"../sound/click6/click6_33.wav"})],counter:0}],7:[{sounds:[new e({src:"../sound/click7/click7_1.wav"}),new e({src:"../sound/click7/click7_11.wav"})],counter:0},{sounds:[new e({src:"../sound/click7/click7_2.wav"}),new e({src:"../sound/click7/click7_22.wav"})],counter:0},{sounds:[new e({src:"../sound/click7/click7_3.wav"}),new e({src:"../sound/click7/click7_33.wav"})],counter:0}],14:[{sounds:[new e({src:"../sound/click14/click14_1.wav"}),new e({src:"../sound/click14/click14_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_2.wav"}),new e({src:"../sound/click14/click14_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_3.wav"}),new e({src:"../sound/click14/click14_3.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_4.wav"}),new e({src:"../sound/click14/click14_4.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_5.wav"}),new e({src:"../sound/click14/click14_5.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_6.wav"}),new e({src:"../sound/click14/click14_6.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_7.wav"}),new e({src:"../sound/click14/click14_7.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_8.wav"}),new e({src:"../sound/click14/click14_8.wav"})],counter:0}],15:[{sounds:[new e({src:"../sound/click15/click15_1.wav"}),new e({src:"../sound/click15/click15_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click15/click15_2.wav"}),new e({src:"../sound/click15/click15_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click15/click15_3.wav"}),new e({src:"../sound/click15/click15_3.wav"})],counter:0},{sounds:[new e({src:"../sound/click15/click15_4.wav"}),new e({src:"../sound/click15/click15_4.wav"})],counter:0},{sounds:[new e({src:"../sound/click15/click15_5.wav"}),new e({src:"../sound/click15/click15_5.wav"})],counter:0}]},Howler.volume(r.soundVolume))}async function uA(e){var a,s,n,l,c,d;if(["8","9","10","11"].includes(e)){gw("KeyQ",fm[e]);return}if(["12","13"].includes(e)){Mf[e].preview();return}ii===null&&await Zd();const t=ii;Object.keys(t).includes(e)&&((n=(s=(a=t==null?void 0:t[e])==null?void 0:a[0])==null?void 0:s.sounds[0])==null||n.seek(0),(d=(c=(l=t==null?void 0:t[e])==null?void 0:l[0])==null?void 0:c.sounds[0])==null||d.play())}async function fA(e){var a,s,n,l,c,d;ao===null&&await fw(),Object.keys(ao).includes(e)&&((n=(s=(a=ao==null?void 0:ao[e])==null?void 0:a[0])==null?void 0:s.sounds[0])==null||n.seek(0),(d=(c=(l=ao==null?void 0:ao[e])==null?void 0:l[0])==null?void 0:c.sounds[0])==null||d.play())}let Gn="KeyA";i(document).on("keydown",e=>{Gn=e.code||"KeyA"});const oe={C:[16.35,32.7,65.41,130.81,261.63,523.25,1046.5,2093,4186.01],Db:[17.32,34.65,69.3,138.59,277.18,554.37,1108.73,2217.46,4434.92],D:[18.35,36.71,73.42,146.83,293.66,587.33,1174.66,2349.32,4698.64],Eb:[19.45,38.89,77.78,155.56,311.13,622.25,1244.51,2489.02,4978.03],E:[20.6,41.2,82.41,164.81,329.63,659.26,1318.51,2637.02],F:[21.83,43.65,87.31,174.61,349.23,698.46,1396.91,2793.83],Gb:[23.12,46.25,92.5,185,369.99,739.99,1479.98,2959.96],G:[24.5,49,98,196,392,783.99,1567.98,3135.96],Ab:[25.96,51.91,103.83,207.65,415.3,830.61,1661.22,3322.44],A:[27.5,55,110,220,440,880,1760,3520],Bb:[29.14,58.27,116.54,233.08,466.16,932.33,1864.66,3729.31],B:[30.87,61.74,123.47,246.94,493.88,987.77,1975.53,3951.07]};function se(e,t=0){return o=>e[o+t]??0}const Wl={KeyZ:se(oe.C),KeyS:se(oe.Db),KeyX:se(oe.D),KeyD:se(oe.Eb),KeyC:se(oe.E),KeyV:se(oe.F),KeyG:se(oe.Gb),KeyB:se(oe.G),KeyH:se(oe.Ab),KeyN:se(oe.A),KeyJ:se(oe.Bb),KeyM:se(oe.B),Comma:se(oe.C,1),KeyL:se(oe.Db,1),Period:se(oe.D,1),Semicolon:se(oe.Eb,1),Slash:se(oe.E,1),KeyQ:se(oe.C,1),Digit2:se(oe.Db,1),KeyW:se(oe.D,1),Digit3:se(oe.Eb,1),KeyE:se(oe.E,1),KeyR:se(oe.F,1),Digit5:se(oe.Gb,1),KeyT:se(oe.G,1),Digit6:se(oe.Ab,1),KeyY:se(oe.A,1),Digit7:se(oe.Bb,1),KeyU:se(oe.B,1),KeyI:se(oe.C,2),Digit9:se(oe.Db,2),KeyO:se(oe.D,2),Digit0:se(oe.Eb,2),KeyP:se(oe.E,2),BracketLeft:se(oe.F,2),Equal:se(oe.Gb,2),BracketRight:se(oe.G,2)},fm={8:"sine",9:"sawtooth",10:"square",11:"triangle"};let Je;function pw(){if(Je!==null)try{Je=new AudioContext}catch(e){Je=null,console.error(e),m(ie(e,"Error initializing audio context")+". Notes will not play.",-1)}}const lh={pentatonic:["C","D","E","G","A"],wholetone:["C","D","E","Gb","Ab","Bb"]};function ch(e){const t={octave:4,direction:1};return async()=>{ii===null&&await Zd(),mw(e,t)}}const dh={position:0,octave:4,direction:1},Mf={12:{name:"pentatonic",preview:ch("pentatonic"),meta:dh},13:{name:"wholetone",preview:ch("wholetone"),meta:dh}};function mw(e,t){if(Je===void 0&&pw(),!Je)return;const o=Ct(0,lh[e].length-1);Math.random()<.5&&(t.octave+=t.direction),t.octave>=6&&(t.direction=-1),t.octave<=4&&(t.direction=1);const a=lh[e][o],s=oe[a][t.octave],n=Je.createOscillator(),l=Je.createGain();n.type="sine",l.gain.value=r.soundVolume/10,n.connect(l),l.connect(Je.destination),n.frequency.value=s,n.start(Je.currentTime),l.gain.setTargetAtTime(0,Je.currentTime,.3),n.stop(Je.currentTime+2)}async function Jc(){Zc===null&&await dA();const e=Zc;e.stop(),e.seek(0),e.play()}function gw(e,t){var c;if(Je===void 0&&pw(),!Je||(Gn=e??Gn,!(Gn in Wl)))return;const a=3+(fs||ps||hn?1:0),s=(c=Wl[Gn])==null?void 0:c.call(Wl,a),n=Je.createOscillator(),l=Je.createGain();n.type=t??fm[r.playSoundOnClick],l.gain.value=r.soundVolume/10,n.connect(l),l.connect(Je.destination),n.frequency.value=s,n.start(Je.currentTime),l.gain.setTargetAtTime(0,Je.currentTime,.15),n.stop(Je.currentTime+.5)}async function Wo(e){if(r.playSoundOnClick==="off")return;if(r.playSoundOnClick in Mf){const{name:s,meta:n}=Mf[r.playSoundOnClick];mw(s,n);return}if(r.playSoundOnClick in fm){gw(e??void 0);return}ii===null&&await Zd();const t=ii[r.playSoundOnClick];if(t===void 0)throw new Error("Invalid click sound ID");const o=_o(t),a=o.sounds[o.counter];o.counter++,o.counter===2&&(o.counter=0),a.seek(0),a.play()}async function Cl(){if(r.playSoundOnError==="off")return;ao===null&&await fw();const e=ao[r.playSoundOnError];if(e===void 0)throw new Error("Invalid error sound ID");const t=_o(e),o=t.sounds[t.counter];t.counter++,t.counter===2&&(t.counter=0),o.seek(0),o.play()}function pA(e){try{Howler.volume(e)}catch{}}be((e,t)=>{e==="playSoundOnClick"&&t!=="off"&&Zd(),e==="soundVolume"&&pA(parseFloat(t))});let Rs=0,Ao=null;const Pl=1e3;let zl=0,Ie=!1;function mA(){Ie=!0}function pm(){RL(0),Ao!==null&&clearTimeout(Ao)}function gA(){Ie&&console.time("premid");const e=document.querySelector("#premidSecondsLeft");e!==null&&(e.innerHTML=(r.time-gl()).toString()),Ie&&console.timeEnd("premid")}function hA(){Ie&&console.time("timer progress update"),(r.mode==="time"||r.mode==="custom"&&Te()==="time")&&hl(),Ie&&console.timeEnd("timer progress update")}function yA(){Ie&&console.time("calculate wpm and raw");const e=im();return Ie&&console.timeEnd("calculate wpm and raw"),Ie&&console.time("update live wpm"),ML(e.wpm,e.raw),Ie&&console.timeEnd("update live wpm"),Ie&&console.time("push to history"),Gb(e.wpm),jb(e.raw),Ie&&console.timeEnd("push to history"),e}function bA(e){Ie&&console.time("update monkey");const t=r.blindMode?e.raw:e.wpm;iA(t),Ie&&console.timeEnd("update monkey")}function vA(){Ie&&console.time("calculate acc");const e=V(bl());return Ie&&console.timeEnd("calculate acc"),e}function wA(){if(Ie&&console.time("layoutfluid"),r.funbox.includes("layoutfluid")&&r.mode==="time"){const e=r.customLayoutfluid,t=r.time/e.length,o=gl(),a=Math.floor(o/t),s=e[a],n=[];for(let l=1;l<e.length;l++)n.push(Math.floor(t*l));n.includes(o+3)?(vv(),Su(3,e[a+1])):n.includes(o+2)?Su(2,e[a+1]):n.includes(o+1)&&Su(1,e[a+1]),r.layout!==s&&s!==void 0&&(ur(),Ya(s,!0),Fs(s,!0))}Ie&&console.timeEnd("layoutfluid")}function CA(e,t){return Ie&&console.time("fail conditions"),Fd(),Dd(),Rd(),r.minWpm==="custom"&&e.wpm<r.minWpmCustomSpeed&&ce>3?(Ao!==null&&clearTimeout(Ao),$r(),Rs=0,Vr("fail","min speed"),!0):r.minAcc==="custom"&&t<r.minAccCustom?(Ao!==null&&clearTimeout(Ao),$r(),Rs=0,Vr("fail","min accuracy"),!0):(Ie&&console.timeEnd("fail conditions"),!1)}function kA(){Ie&&console.time("times up check");let e;if(r.mode==="time"?e=r.time:r.mode==="custom"&&Te()==="time"&&(e=xe()),e!==void 0&&e!==0&&gl()>=e){Ao!==null&&clearTimeout(Ao),fl(),k.pushHistory(),Ze.pushHistory(),$r(),Rs=0,Vr("finish");return}Ie&&console.timeEnd("times up check")}function SA(){Ie&&console.time("play timer warning");let e;r.mode==="time"?e=r.time:r.mode==="custom"&&Te()==="time"&&(e=xe()),e!==void 0&&gl()===e-parseInt(r.playTimeWarning,10)&&Jc(),Ie&&console.timeEnd("play timer warning")}let Af=[];function xA(){return Af}async function TA(){Ie&&console.time("timer step -----------------------------"),DL(),gA(),hA(),r.playTimeWarning!=="off"&&SA();const e=yA(),t=vA();bA(e),wA(),CA(e,t)||kA(),Ie&&console.timeEnd("timer step -----------------------------")}async function LA(){$r(),Rs=0,Af=[],zl=ai+Pl,function e(){const t=zl-performance.now();Af.push({dateNow:Date.now(),now:performance.now(),expected:zl,nextDelay:t}),(r.mode==="time"&&r.time<130&&r.time>0||r.mode==="words"&&r.words<250&&r.words>0)&&(t<Pl/2&&Vx(),t<Pl/10&&(Rs++,Rs>5&&(m('This could be caused by "efficiency mode" on Microsoft Edge.'),m("Stopping the test due to bad performance. This would cause test calculations to be incorrect. If this happens a lot, please report this.",-1),Vr("fail","slow timer")))),Ao=setTimeout(function(){if(!Ee){Ao!==null&&clearTimeout(Ao),$r(),Rs=0;return}TA(),zl+=Pl,e()},t)}()}let mm=[],Go=[],hw=0,gm=!0,Uo=0,wt=0,ni=0,kl=0,ed=[],Ef=[];var fy;const pt=(fy=document.getElementById("playpauseReplayButton"))==null?void 0:fy.children[0];function _f(e){mm=e}function hm(){const e=document.getElementById("replayWords");if(e===null)return;e.innerHTML="";let t=0;Go.forEach(o=>{o.action==="backWord"?t--:(o.action==="submitCorrectWord"||o.action==="submitErrorWord")&&t++}),mm.forEach((o,a)=>{if(a>t)return;const s=document.createElement("div");s.className="word";for(const n of o){const l=document.createElement("letter");l.innerHTML=n,s.appendChild(l)}e.appendChild(s)})}function Sl(){var e;ed.forEach(t=>{clearTimeout(t)}),ed=[],Ef.forEach(t=>{clearTimeout(t)}),Ef=[],kl=wt,ni=Uo,pt!==void 0&&(pt.className="fas fa-play",(e=pt.parentNode)==null||e.setAttribute("aria-label","Resume replay"))}function Mi(e=!1){e&&r.playSoundOnError!=="off"?Cl():Wo()}function yw(e,t=!1){var a,s,n,l;let o=(a=document.getElementById("replayWords"))==null?void 0:a.children[Uo];if(o!==void 0){if(e.action==="correctLetter")t||Mi(),(s=o.children[wt])==null||s.classList.add("correct"),wt++;else if(e.action==="incorrectLetter"){t||Mi(!0);let c;wt>=o.children.length&&(c=document.createElement("letter"),c==null||c.classList.add("extra"),c.innerHTML=((n=e.value)==null?void 0:n.toString())??"",o.appendChild(c)),c=o.children[wt],c==null||c.classList.add("incorrect"),wt++}else if(e.action==="setLetterIndex"&&typeof e.value=="number"){t||Mi(),wt=e.value;for(const c of[...o.children].slice(wt))c!=null&&c.classList.contains("extra")?c.remove():c.className=""}else if(e.action==="submitCorrectWord")t||Mi(),Uo++,wt=0;else if(e.action==="submitErrorWord")t||Mi(!0),o==null||o.classList.add("error"),Uo++,wt=0;else if(e.action==="backWord"){t||Mi(),Uo--;const c=document.getElementById("replayWords");for(c!==null&&(o=c.children[Uo]),wt=o.children.length;((l=o.children[wt-1])==null?void 0:l.className)==="";)wt--;o==null||o.classList.remove("error")}}}function ym(){var a;let e=0;wt=0,Uo=0,Go.forEach((s,n)=>{(Uo<ni||Uo===ni&&wt<kl)&&(yw(s,!0),e=n+1)});const t=(a=Go[e])==null?void 0:a.time;if(t===void 0)throw new Error("Failed to load old replay: datatime is undefined");const o=Math.floor(t/1e3);return vw(o),e}function bw(){var e;i("#resultReplay").stop(!0,!0).hasClass("hidden")?(hm(),ym(),i("#watchReplayButton").hasClass("loaded")?i("#resultReplay").removeClass("hidden").css("display","none").slideDown(250):(i("#words").html('<div class="preloader"><i class="fas fa-fw fa-spin fa-circle-notch"></i></div>'),i("#resultReplay").removeClass("hidden").css("display","none").slideDown(250))):(((e=pt==null?void 0:pt.parentNode)==null?void 0:e.getAttribute("aria-label"))!=="Start replay"&&Sl(),i("#resultReplay").slideUp(250,()=>{i("#resultReplay").addClass("hidden")}))}function $A(){i("#resultReplay").stop(!0,!0).hasClass("hidden")||bw(),i("#replayStats").text(""),Go=[],hw=performance.now(),gm=!0,kl=0,ni=0}function bm(){gm=!1}function Vs(e,t){if(!gm)return;const o=performance.now()-hw;Go.push({action:e,value:t,time:o})}function vw(e){const o=`${ds[e-1]??0}wpm	${e}s`;i("#replayStats").text(o)}function MA(){var s,n;if(wt=0,Uo=0,pt===void 0)return;pt.className="fas fa-pause",(s=pt.parentNode)==null||s.setAttribute("aria-label","Pause replay"),hm();const e=ym(),t=(n=Go[e])==null?void 0:n.time;if(t===void 0)throw new Error("Failed to play replay: lastTime is undefined");let o=Math.round(t/1e3);const a=Math.round(js(Go).time/1e3);for(;o<=a;){const l=o;Ef.push(setTimeout(()=>{vw(l)},l*1e3-t)),o++}Go.forEach((l,c)=>{c<e||ed.push(setTimeout(()=>{yw(l)},l.time-t))}),ed.push(setTimeout(()=>{kl=0,ni=0,pt.className="fas fa-play",pt.parentNode.setAttribute("aria-label","Start replay")},js(Go).time-t))}function AA(){return JSON.stringify({replayData:Go,wordsList:mm})}i(".pageTest #playpauseReplayButton").on("click",()=>{(pt==null?void 0:pt.className)==="fas fa-play"?MA():(pt==null?void 0:pt.className)==="fas fa-pause"&&Sl()});i("#replayWords").on("click","letter",e=>{Sl();const t=document.querySelector("#replayWords"),o=[...(t==null?void 0:t.children)??[]];ni=o.indexOf(e.target.parentNode),kl=[...o[ni].children].indexOf(e.target),hm(),ym()});i(".pageTest").on("click","#watchReplayButton",()=>{bw()});let Kr=0,vm=!1,ww;function EA(e){if(vm&&new Date().getDate()>ww){Kr=e;return}Kr+=e}function _A(){return rt(Math.round(Kr),!0,!0)+(vm?" today":" session")}function IA(){const e=new Date;e.setSeconds(0),e.setMinutes(0),e.setHours(0),e.setMilliseconds(0),ww=e.getDate();const t=e.getTime();Kr=0;const o=x();if(!o)return;const a=o.results;a==null||a.forEach(s=>{const n=new Date(s.timestamp);n.setSeconds(0),n.setMinutes(0),n.setHours(0),n.setMilliseconds(0),n.getTime()>=t&&(Kr+=s.testDuration+s.incompleteTestSeconds-s.afkDuration)}),vm=!0}let If=!1;function Cw(){Wt&&!If&&!Ot&&(m("Challenge cleared",0),mb(null))}function BA(e,t,o){var l;let a=!0,s=[];const n=e.afkDuration/e.testDuration*100;if(t[o]===void 0)throw new Error("Requirement value is undefined");if(o==="wpm"&&t.wpm){const c=t.wpm;"exact"in c?Math.round(e.wpm)!==c.exact&&(a=!1,s.push(`WPM not ${c.exact}`)):"min"in c&&e.wpm<c.min&&(a=!1,s.push(`WPM below ${c.min}`))}else if(o==="acc"&&t.acc){const c=t.acc;"exact"in c?e.acc!==c.exact&&(a=!1,s.push(`Accuracy not ${c.exact}`)):"min"in c&&e.acc<c.min&&(a=!1,s.push(`Accuracy below ${c.min}`))}else if(o==="afk"&&t.afk){const c=t.afk;c.max&&Math.round(n)>c.max&&(a=!1,s.push(`AFK percentage above ${c.max}`))}else if(o==="time"&&t.time){const c=t.time;c.min&&Math.round(e.testDuration)<c.min&&(a=!1,s.push(`Test time below ${c.min}`))}else if(o==="funbox"&&t.funbox){const c=t.funbox.exact;if(c===void 0)throw new Error("Funbox mode is undefined");if(!gs(c,e.funbox)){a=!1;for(const d of c)(l=e.funbox)!=null&&l.includes(d)||s.push(`${d} funbox not active`);if(e.funbox!==void 0&&e.funbox.length>0)for(const d of e.funbox)c.includes(d)||s.push(`${d} funbox active`)}}else if(o==="raw"&&t.raw){const c=t.raw;c.exact&&Math.round(e.rawWpm)!==c.exact&&(a=!1,s.push(`Raw WPM not ${c.exact}`))}else if(o==="con"&&t.con){const c=t.con;c.exact&&Math.round(e.consistency)!==c.exact&&(a=!1,s.push(`Consistency not ${c.exact}`))}else if(o==="config"&&t.config){const c=t.config;for(const d of lt(c)){const u=c[d];r[d]!==u&&(a=!1,s.push(`${d} not set to ${u}`))}}return[a,s]}function qA(e){if(!Wt)return null;try{if(e.afkDuration/e.testDuration*100>10)return m("Challenge failed: AFK time is greater than 10%",0),null;if(Wt.requirements===void 0)return m(`${Wt.display} challenge passed!`,1),Wt.name;{let o=!0;const a=[];for(const s of lt(Wt.requirements)){const[n,l]=BA(e,Wt.requirements,s);n||(o=!1),a.push(...l)}return o?(Wt.autoRole&&m("You will receive a role shortly. Please don't post a screenshot in challenge submissions.",1,{duration:5}),m(`${Wt.display} challenge passed!`,1),Wt.name):(m(`${Wt.display} challenge failed: ${a.join(", ")}`,0),null)}}catch(t){return console.error(t),m(`Something went wrong when verifying challenge: ${t.message}`,0),null}}async function kw(e){If=!0,Xa([]);const{data:t,error:o}=await Qt(cv());if(o){const n=ie(o,"Failed to setup challenge");return m(n,-1),ee(),setTimeout(()=>{i("header .config").removeClass("hidden"),i(".page.pageTest").removeClass("hidden")},250),!1}const a=t.find(n=>n.name.toLowerCase()===e.toLowerCase());let s;try{if(a===void 0)return m("Challenge not found",0),ee(),setTimeout(()=>{i("header .config").removeClass("hidden"),i(".page.pageTest").removeClass("hidden")},250),!1;if(a.type==="customTime")Ca(a.parameters[0],!0),ut("time",!0),ua("normal",!0),a.name==="englishMaster"&&(un("english_10k",!0),Sa(!0,!0),cs(!0,!0));else if(a.type==="customWords")Zs(a.parameters[0],!0),ut("words",!0),ua("normal",!0);else if(a.type==="customText")_a(a.parameters[0].split(" ")),pn(a.parameters[1]),Ko(a.parameters[2]),$o(a.parameters[3]),ei(a.parameters[4]),ut("custom",!0),ua("normal",!0);else if(a.type==="script"){J();const n=await fetch("/challenges/"+a.parameters[0]);if(K(),n.status!==200)throw new Error(`${n.status} ${n.statusText}`);let c=(await n.text()).trim();c=c.replace(/[\n\r\t ]/gm," "),c=c.replace(/ +/gm," "),_a(c.split(" ")),pn("repeat"),$o("word"),ei(!1),ut("custom",!0),ua("normal",!0),a.parameters[1]!==null&&_p(a.parameters[1]),a.parameters[2]!==null&&Kv(a.parameters[2])}else a.type==="accuracy"?(Ca(0,!0),ut("time",!0),ua("master",!0)):a.type==="funbox"?(Xa(a.parameters[0],!0),ua("normal",!0),a.parameters[1]==="words"?Zs(a.parameters[2],!0):a.parameters[1]==="time"&&Ca(a.parameters[2],!0),ut(a.parameters[1],!0),a.parameters[3]!==void 0&&ua(a.parameters[3],!0)):a.type==="special"&&a.name==="semimak"&&(ut("time",!0),Ca(120,!0),un("english_10k",!0),cs(!0,!0),qb("word",!0),Ya("semimak",!0),Fs("overrideSync",!0),wo("static",!0));return ee(),s=a.message,i("header .config").removeClass("hidden"),i(".page.pageTest").removeClass("hidden"),m(s===void 0?`Challenge '${a.display}' loaded.`:"Challenge loaded. "+s,0),mb(a),If=!1,!0}catch(n){return m(ie(n,"Failed to load challenge"),-1),!1}}be(e=>{["difficulty","numbers","punctuation","mode","funbox","paceCaret","showAllLines","showLiveWpm","highlightMode","time","words","keymapMode","keymapLayout","layout"].includes(e)&&Cw()});const Jd=new Map;function Xt(e,t=!0){const o=document.getElementById(e)??void 0;if(o===void 0)throw new Error(`Element with id ${e} not found`);Jd.set(e,o),t&&Et(e)}function Et(e){const t=Jd.get(e);t?t.remove():Xt(e,!0)}const FA={popups:document.getElementById("popups"),main:document.querySelector("main")};function Yt(e,t){const o=Jd.get(e);FA[t].append(o)}function RA(e){return Jd.has(e)}const Hl=125,Ol=.75;class re{constructor(t){var s,n;this.open=!1,this.setupRan=!1,t.dialogId.startsWith("#")&&(t.dialogId=t.dialogId.slice(1)),this.skeletonAppendParent=t.appendTo??"popups",RA(t.dialogId)&&Yt(t.dialogId,this.skeletonAppendParent);const o=document.getElementById(t.dialogId),a=document.querySelector(`#${t.dialogId} > .modal`);if(o===null)throw new Error(`Dialog element with id ${t.dialogId} not found`);if(!(o instanceof HTMLDialogElement))throw new Error("Animated dialog must be an HTMLDialogElement");if(o===null)throw new Error(`Dialog element with id ${t.dialogId} not found`);if(a===null)throw new Error(`Div element inside #${t.dialogId} with class 'modal' not found`);this.dialogId=t.dialogId,this.wrapperEl=o,this.modalEl=a,this.customShowAnimations=(s=t.customAnimations)==null?void 0:s.show,this.customHideAnimations=(n=t.customAnimations)==null?void 0:n.hide,this.previousModalInChain=void 0,this.showOptionsWhenInChain=t.showOptionsWhenInChain,this.customEscapeHandler=t==null?void 0:t.customEscapeHandler,this.customWrapperClickHandler=t==null?void 0:t.customWrapperClickHandler,this.setup=t==null?void 0:t.setup,this.cleanup=t==null?void 0:t.cleanup,Xt(this.dialogId)}getPreviousModalInChain(){return this.previousModalInChain}async runSetup(){this.wrapperEl.addEventListener("keydown",async t=>{var o;t.key==="Escape"&&Io(this.dialogId)&&(t.preventDefault(),t.stopPropagation(),this.customEscapeHandler!==void 0?(this.customEscapeHandler(t),(o=this.cleanup)==null||o.call(this)):await this.hide())}),this.wrapperEl.addEventListener("mousedown",async t=>{var o;t.target===this.wrapperEl&&(this.customWrapperClickHandler!==void 0?(this.customWrapperClickHandler(t),(o=this.cleanup)==null||o.call(this)):await this.hide())}),this.setup!==void 0&&await this.setup(this.modalEl)}getDialogId(){return this.dialogId}getWrapper(){return this.wrapperEl}getModal(){return this.modalEl}isOpen(){return this.open}focusFirstInput(t){const a=[...this.modalEl.querySelectorAll("input")].find(s=>!s.classList.contains("hidden"));a!=null?t===!0?a.focus():t==="focusAndSelect"?(a.focus(),a.select()):this.wrapperEl.focus():this.wrapperEl.focus()}async show(t){return new Promise(async o=>{var d,u,f,p,h,g,y,b,C,L,S,q,P;if(this.open){o();return}if(Yt(this.dialogId,this.skeletonAppendParent),this.setupRan||(await this.runSetup(),this.setupRan=!0),Io(this.dialogId)){o();return}const a=ge((((u=(d=t==null?void 0:t.customAnimation)==null?void 0:d.modal)==null?void 0:u.durationMs)??(t==null?void 0:t.animationDurationMs)??((p=(f=this.customShowAnimations)==null?void 0:f.modal)==null?void 0:p.durationMs)??Hl)*((t==null?void 0:t.modalChain)!==void 0?Ol:1));(t==null?void 0:t.modalChain)!==void 0&&(this.previousModalInChain=t.modalChain,await this.previousModalInChain.hide({animationMode:"modalOnly",animationDurationMs:a,dontShowPreviousModalInchain:t.modalChain.previousModalInChain!==void 0})),this.open=!0,(t==null?void 0:t.mode)==="dialog"?this.wrapperEl.show():((t==null?void 0:t.mode)==="modal"||(t==null?void 0:t.mode)===void 0)&&this.wrapperEl.showModal(),await((h=t==null?void 0:t.beforeAnimation)==null?void 0:h.call(t,this.modalEl,t==null?void 0:t.modalChainData)),setTimeout(async()=>{this.focusFirstInput(t==null?void 0:t.focusFirstInput)},1);const s=((g=t==null?void 0:t.customAnimation)==null?void 0:g.modal)??((y=this.customShowAnimations)==null?void 0:y.modal),n=((b=t==null?void 0:t.customAnimation)==null?void 0:b.wrapper)??((C=this.customShowAnimations)==null?void 0:C.wrapper)??{from:{opacity:"0"},to:{opacity:"1"},easing:"swing"},l=ge(((S=(L=t==null?void 0:t.customAnimation)==null?void 0:L.wrapper)==null?void 0:S.durationMs)??((P=(q=this.customShowAnimations)==null?void 0:q.wrapper)==null?void 0:P.durationMs)??Hl),c=this.previousModalInChain!==void 0?"modalOnly":(t==null?void 0:t.animationMode)??"both";i(this.modalEl).stop(!0,!1),i(this.wrapperEl).stop(!0,!1),c==="both"||c==="none"?(s!=null&&s.from?(i(this.modalEl).css(s.from),i(this.modalEl).animate(s.to,c==="none"?0:a,s.easing??"swing")):i(this.modalEl).css("opacity","1"),i(this.wrapperEl).css(n.from),i(this.wrapperEl).removeClass("hidden").css("opacity","0").animate(n.to??{opacity:1},c==="none"?0:l,n.easing??"swing",async()=>{var $;this.focusFirstInput(t==null?void 0:t.focusFirstInput),await(($=t==null?void 0:t.afterAnimation)==null?void 0:$.call(t,this.modalEl,t==null?void 0:t.modalChainData)),o()})):c==="modalOnly"&&(i(this.wrapperEl).removeClass("hidden").css("opacity","1"),s!=null&&s.from?i(this.modalEl).css(s.from):i(this.modalEl).css("opacity","0"),i(this.modalEl).animate((s==null?void 0:s.to)??{opacity:1},a,(s==null?void 0:s.easing)??"swing",async()=>{var $;this.focusFirstInput(t==null?void 0:t.focusFirstInput),await(($=t==null?void 0:t.afterAnimation)==null?void 0:$.call(t,this.modalEl,t==null?void 0:t.modalChainData)),o()}))})}async hide(t){return new Promise(async o=>{var d,u,f,p,h,g,y,b,C,L,S,q,P;if(!Io(this.dialogId)){o();return}t!=null&&t.clearModalChain&&(this.previousModalInChain=void 0),await((d=t==null?void 0:t.beforeAnimation)==null?void 0:d.call(t,this.modalEl));const a=((u=t==null?void 0:t.customAnimation)==null?void 0:u.modal)??((f=this.customHideAnimations)==null?void 0:f.modal),s=ge((((h=(p=t==null?void 0:t.customAnimation)==null?void 0:p.modal)==null?void 0:h.durationMs)??(t==null?void 0:t.animationDurationMs)??((y=(g=this.customHideAnimations)==null?void 0:g.modal)==null?void 0:y.durationMs)??Hl)*(this.previousModalInChain!==void 0?Ol:1)),n=((b=t==null?void 0:t.customAnimation)==null?void 0:b.wrapper)??((C=this.customHideAnimations)==null?void 0:C.wrapper)??{from:{opacity:"1"},to:{opacity:"0"},easing:"swing"},l=ge(((S=(L=t==null?void 0:t.customAnimation)==null?void 0:L.wrapper)==null?void 0:S.durationMs)??((P=(q=this.customHideAnimations)==null?void 0:q.wrapper)==null?void 0:P.durationMs)??Hl),c=this.previousModalInChain!==void 0?"modalOnly":(t==null?void 0:t.animationMode)??"both";i(this.modalEl).stop(!0,!1),i(this.wrapperEl).stop(!0,!1),c==="both"||c==="none"?(a!=null&&a.from?(i(this.modalEl).css(a.from),i(this.modalEl).animate(a.to,c==="none"?0:s,a.easing??"swing")):i(this.modalEl).css("opacity","1"),i(this.wrapperEl).css(n.from),i(this.wrapperEl).css("opacity","1").animate((n==null?void 0:n.to)??{opacity:0},c==="none"?0:l,(n==null?void 0:n.easing)??"swing",async()=>{var $,H;this.wrapperEl.close(),this.wrapperEl.classList.add("hidden"),Et(this.dialogId),this.open=!1,await(($=t==null?void 0:t.afterAnimation)==null?void 0:$.call(t,this.modalEl)),(H=this.cleanup)==null||H.call(this),this.previousModalInChain!==void 0&&!(t!=null&&t.dontShowPreviousModalInchain)&&(await this.previousModalInChain.show({animationMode:"modalOnly",modalChainData:t==null?void 0:t.modalChainData,animationDurationMs:s*Ol,...this.previousModalInChain.showOptionsWhenInChain}),this.previousModalInChain=void 0),o()})):c==="modalOnly"&&(i(this.wrapperEl).removeClass("hidden").css("opacity","1"),a!=null&&a.from?i(this.modalEl).css(a.from):i(this.modalEl).css("opacity","1"),i(this.modalEl).animate((a==null?void 0:a.to)??{opacity:0},s,(a==null?void 0:a.easing)??"swing",async()=>{var $,H;this.wrapperEl.close(),i(this.wrapperEl).addClass("hidden").css("opacity","0"),Et(this.dialogId),this.open=!1,await(($=t==null?void 0:t.afterAnimation)==null?void 0:$.call(t,this.modalEl)),(H=this.cleanup)==null||H.call(this),this.previousModalInChain!==void 0&&!(t!=null&&t.dontShowPreviousModalInchain)&&(await this.previousModalInChain.show({animationMode:"modalOnly",modalChainData:t==null?void 0:t.modalChainData,animationDurationMs:s*Ol,...this.previousModalInChain.showOptionsWhenInChain}),this.previousModalInChain=void 0),o()}))})}destroy(){var t;this.wrapperEl.close(),this.wrapperEl.classList.add("hidden"),(t=this.cleanup)==null||t.call(this),Et(this.dialogId),this.open=!1}}let Co=0,le=null,Se=null;function DA(){le=null}function WA(){i("#quoteRateModal .quote .text").text("-"),i("#quoteRateModal .quote .source .val").text("-"),i("#quoteRateModal .quote .id .val").text("-"),i("#quoteRateModal .quote .length .val").text("-"),i("#quoteRateModal .ratingCount .val").text("-"),i("#quoteRateModal .ratingAverage .val").text("-")}function Sw(e){return Ce(e.ratings)&&Ce(e.totalRating)&&e.ratings>0&&e.totalRating>0?Math.round(e.totalRating/e.ratings*10)/10:0}async function xw(e){if(!e)return;Se=e;const t=await E.quotes.getRating({query:{quoteId:Se.id,language:Se.language}});if(K(),t.status!==200){m("Failed to get quote ratings: "+t.body.message,-1);return}return t.body.data===null?{}:(le=t.body.data,le!==void 0&&le.average===void 0&&(le.average=Sw(le)),le)}function dc(e){const t=e??Co;i("#quoteRateModal .star").removeClass("active");for(let o=1;o<=t;o++)i(`#quoteRateModal .star[data-rating=${o}]`).addClass("active")}async function PA(){var e;le||await xw(),i("#quoteRateModal .ratingCount .val").text((le==null?void 0:le.ratings)??"0"),i("#quoteRateModal .ratingAverage .val").text(((e=le==null?void 0:le.average)==null?void 0:e.toFixed(1))??"-")}function zA(){if(!Se)return;let e;Se.group===0?e="short":Se.group===1?e="medium":Se.group===2?e="long":Se.group===3&&(e="thicc"),i("#quoteRateModal .quote .text").text(Se.text),i("#quoteRateModal .quote .source .val").text(Se.source),i("#quoteRateModal .quote .id .val").text(Se.id),i("#quoteRateModal .quote .length .val").text(e),PA()}function HA(e,t){Tw.show({...t,beforeAnimation:async()=>{var s,n;WA(),Se=e,Co=0;const o=x(),a=(n=(s=o==null?void 0:o.quoteRatings)==null?void 0:s[Se.language])==null?void 0:n[Se.id];Ce(a)&&(Co=a),dc(),zA()}})}function OA(e=!1){Tw.hide({clearModalChain:e})}async function NA(){var s,n;if(Co===0){m("Please select a rating");return}if(!Se)return;OA(!0);const e=await E.quotes.addRating({body:{quoteId:Se.id,language:Se.language,rating:Co}});if(K(),e.status!==200){m("Failed to submit quote rating: "+e.body.message,-1);return}const t=x();if(!t)return;const o=t.quoteRatings??{},a=(o==null?void 0:o[Se.language])??{};if(Ce(a==null?void 0:a[Se.id])){const l=(s=o[Se.language])==null?void 0:s[Se.id],c=Co-l;a[Se.id]=Co,le={ratings:le==null?void 0:le.ratings,totalRating:isNaN(le==null?void 0:le.totalRating)?0:(le==null?void 0:le.totalRating)+c,quoteId:Se.id,language:Se.language},m("Rating updated",1)}else a[Se.id]=Co,Ce(le==null?void 0:le.ratings)&&Ce(le.totalRating)?(le.ratings++,le.totalRating+=Co):le={ratings:1,totalRating:Co,quoteId:Se.id,language:Se.language},m("Rating submitted",1);t.quoteRatings=o,kt(t),le.average=Sw(le),i(".pageTest #result #rateQuoteButton .rating").text((n=le.average)==null?void 0:n.toFixed(1)),i(".pageTest #result #rateQuoteButton .icon").removeClass("far"),i(".pageTest #result #rateQuoteButton .icon").addClass("fas")}async function UA(e){var o;(o=e.querySelector(".submitButton"))==null||o.addEventListener("click",()=>{NA()});const t=e.querySelectorAll(".stars button.star");for(const a of t)a.addEventListener("click",s=>{Co=parseInt(s.currentTarget.getAttribute("data-rating")),dc()}),a.addEventListener("mouseenter",s=>{const n=parseInt(s.currentTarget.getAttribute("data-rating"));dc(n)}),a.addEventListener("mouseleave",()=>{dc()})}const Tw=new re({dialogId:"quoteRateModal",setup:UA}),VA=[{type:"leaderboard_atf",selectorId:"ad-result-wrapper"},{type:"med_rect_btf",selectorId:"ad-result-small-wrapper"}],KA=[{type:"leaderboard_atf",selectorId:"ad-result-wrapper"},{type:"med_rect_btf",selectorId:"ad-result-small-wrapper"},{type:"sky_btf",selectorId:"ad-vertical-right-wrapper"},{type:"sky_btf",selectorId:"ad-vertical-left-wrapper"}],GA=[{type:"leaderboard_atf",selectorId:"ad-result-wrapper"},{type:"med_rect_btf",selectorId:"ad-result-small-wrapper"},{type:"sky_btf",selectorId:"ad-vertical-right-wrapper"},{type:"sky_btf",selectorId:"ad-vertical-left-wrapper"},{type:"leaderboard_btf",selectorId:"ad-footer-wrapper"},{type:"med_rect_btf",selectorId:"ad-footer-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-about-1-wrapper"},{type:"med_rect_btf",selectorId:"ad-about-1-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-about-2-wrapper"},{type:"med_rect_btf",selectorId:"ad-about-2-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-settings-1-wrapper"},{type:"med_rect_btf",selectorId:"ad-settings-1-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-settings-2-wrapper"},{type:"med_rect_btf",selectorId:"ad-settings-2-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-settings-3-wrapper"},{type:"med_rect_btf",selectorId:"ad-settings-3-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-account-1-wrapper"},{type:"med_rect_btf",selectorId:"ad-account-1-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-account-2-wrapper"},{type:"med_rect_btf",selectorId:"ad-account-2-small-wrapper"}];let eu=!1;function jA(){const e="1024888",t="74058";window.ramp={que:[],passiveMode:!0,forcePath:"320x50-test",onReady:()=>{eu=!0,tu()}};const o=document.getElementsByTagName("head")[0],a=document.createElement("script");a.setAttribute("async",!0),a.src=`//cdn.intergient.com/${e}/${t}/ramp.js`,o.appendChild(a),window._pwGA4PageviewId="".concat(Date.now()),window.dataLayer=window.dataLayer||[],window.gtag=window.gtag||function(){dataLayer.push(arguments)},gtag("js",new Date),gtag("config","G-KETCPNHRJF",{send_page_view:!1}),gtag("event","ramp_js",{send_to:"G-KETCPNHRJF",pageview_id:window._pwGA4PageviewId})}function Lw(){let e;r.ads==="result"?e=VA:r.ads==="on"?e=KA:r.ads==="sellout"&&(e=GA);const t=[];for(const o of e){const a=document.querySelector(`#${o.selectorId}`);a&&window.getComputedStyle(a).display!=="none"&&a.offsetParent!==null&&t.push(o)}return t}async function tu(){if(eu){if(Z()==="test"&&!de){ramp.destroyUnits("all");return}await ramp.destroyUnits("all"),await ramp.addUnits(Lw()),await ramp.displayUnits()}}async function QA(){}function YA(){eu&&ramp.destroyUnits("all")}async function XA(){if(!eu)return;const e=Lw();await ramp.addUnits(e),await ramp.displayUnits()}const ZA=900;let Nl=!0;const JA=1330;let Ul=!0,xl=!1,ou,Gr;function $w(){jA(),setInterval(()=>{Ee||QA()},6e4),xl=!0}function e2(){Bf(),Mw(),t2()}function Bf(){i("#ad-footer-wrapper").remove(),i("#ad-footer-small-wrapper").remove(),i("#ad-about-1-wrapper").remove(),i("#ad-about-1-small-wrapper").remove(),i("#ad-about-2-wrapper").remove(),i("#ad-about-2-small-wrapper").remove(),i("#ad-settings-1-wrapper").remove(),i("#ad-settings-1-small-wrapper").remove(),i("#ad-settings-2-wrapper").remove(),i("#ad-settings-2-small-wrapper").remove(),i("#ad-settings-3-wrapper").remove(),i("#ad-settings-3-small-wrapper").remove(),i("#ad-account-1-wrapper").remove(),i("#ad-account-1-small-wrapper").remove(),i("#ad-account-2-wrapper").remove(),i("#ad-account-2-small-wrapper").remove()}function Mw(){i("#ad-vertical-right-wrapper").remove(),i("#ad-vertical-left-wrapper").remove()}function t2(){i("#ad-result-wrapper").remove(),i("#ad-result-small-wrapper").remove()}function o2(){}function Aw(e=!1){const t=Nl;window.innerWidth>ZA?Nl=!0:Nl=!1,!e&&(r.ads==="off"||!xl||t!==Nl&&tu())}function Ew(e=!1){const t=Ul;window.innerWidth>JA?Ul=!0:Ul=!1,!e&&(r.ads==="off"||!xl||t!==Ul&&tu())}async function wm(){return new Promise(e=>{window.ramp===void 0&&(ou=!0),e()})}async function Cm(){return new Promise(e=>{if(Gr===void 0){Gr=!1,e();return}e()})}async function a2(){return r.ads==="off"?!1:xl?(await wm(),await Cm(),ou||Gr?!1:tu()):($w(),!0)}async function s2(){if(r.ads!=="off"){if(xl||$w(),await wm(),await Cm(),ou){i("#ad-result-wrapper .iconAndText .text").html(`
    Using an ad blocker? No worries
    <div class="smalltext">
      We understand ads can be annoying
      <br />
      You can
      <i>disable all ads</i>
      in the settings
    </div>
    `);return}if(Gr){i("#ad-result-wrapper .iconAndText .text").html(`
    Ads not working? Ooops
    <div class="smalltext">
      You may have a cookie popup blocker enabled - ads will not show without your consent
      <br />
      You can also 
      <i>disable all ads</i>
      in the settings if you wish
    </div>
    `);return}XA()}}function td(e){e?(i("#ad-vertical-left-wrapper").removeClass("testPage"),i("#ad-vertical-right-wrapper").removeClass("testPage"),i("#ad-footer-wrapper").removeClass("testPage"),i("#ad-footer-small-wrapper").removeClass("testPage")):(i("#ad-vertical-left-wrapper").addClass("testPage"),i("#ad-vertical-right-wrapper").addClass("testPage"),i("#ad-footer-wrapper").addClass("testPage"),i("#ad-footer-small-wrapper").addClass("testPage"))}function i2(){ramp.showCmpModal()}function n2(){YA()}const r2=It(500,o2),l2=It(500,Aw),c2=It(500,Ew);i(window).on("resize",()=>{r2(),l2(),c2()});be((e,t)=>{e==="ads"&&(t==="off"?e2():t==="result"?(Bf(),Mw()):t==="on"&&Bf())});F1(()=>{});i(()=>{Aw(!0),Ew()});window.onerror=function(e){};const Iu={quotes:[],length:0,language:null,groups:[]};class d2{constructor(){this.quoteCollection=Iu,this.quoteQueue=[],this.queueIndex=0}async getQuotes(t,o){var s,n;const a=No(t);if(this.quoteCollection.language!==a){const{data:l,error:c}=await Qt(ys(`quotes/${a}.json`));if(c){if(c instanceof Error&&((s=c==null?void 0:c.message)!=null&&s.includes("404")||(n=c==null?void 0:c.message)!=null&&n.includes("Content is not JSON")))return Iu;throw c}if(l.quotes===void 0||l.quotes.length===0)return Iu;this.quoteCollection={quotes:[],length:l.quotes.length,groups:[],language:l.language},l.quotes.forEach(d=>{const u={text:d.text,britishText:d.britishText,source:d.source,length:d.length,id:d.id,language:l.language,group:0};this.quoteCollection.quotes.push(u)}),l.groups.forEach((d,u)=>{const f=d[0],p=d[1];this.quoteCollection.groups[u]=this.quoteCollection.quotes.filter(h=>h.length>=f&&h.length<=p?(h.group=u,!0):!1)}),o!==void 0&&this.updateQuoteQueue(o)}return this.quoteCollection}getQuoteById(t){return this.quoteCollection.quotes.find(a=>a.id===t)}updateQuoteQueue(t){this.quoteQueue=[],t.forEach(o=>{var a;o<0||(a=this.quoteCollection.groups[o])==null||a.forEach(s=>{this.quoteQueue.push(s)})}),rn(this.quoteQueue),this.queueIndex=0}getRandomQuote(){if(this.quoteQueue.length===0)return null;this.queueIndex>=this.quoteQueue.length&&(this.queueIndex=0,rn(this.quoteQueue));const t=this.quoteQueue[this.queueIndex];return this.queueIndex+=1,t}getRandomFavoriteQuote(t){const o=x();if(!o)return null;const a=No(t),s=[],{favoriteQuotes:n}=o;if(n===void 0||(Object.keys(n).forEach(d=>{No(d)===a&&s.push(...n[d]??[])}),s.length===0))return null;const l=_o(s);return this.getQuoteById(parseInt(l,10))??null}isQuoteFavorite({language:t,id:o}){const a=x();if(!a)return!1;const{favoriteQuotes:s}=a;if(s===void 0)return!1;const n=No(t);return Object.keys(s).find(c=>n!==No(c)?!1:(s[c]??[]).includes(o.toString()))!==void 0}async setQuoteFavorite(t,o){var s,n,l,c,d;const a=x();if(!a)throw new Error("Snapshot is not available");if(o){const u=await E.users.addQuoteToFavorites({body:{language:t.language,quoteId:`${t.id}`}});if(u.status===200)a.favoriteQuotes===void 0&&(a.favoriteQuotes={}),a.favoriteQuotes[t.language]||(a.favoriteQuotes[t.language]=[]),(d=a.favoriteQuotes[t.language])==null||d.push(`${t.id}`);else throw new Error(u.body.message)}else{const u=await E.users.removeQuoteFromFavorites({body:{language:t.language,quoteId:`${t.id}`}});if(u.status===200){const f=(n=(s=a.favoriteQuotes)==null?void 0:s[t.language])==null?void 0:n.indexOf(`${t.id}`);(c=(l=a.favoriteQuotes)==null?void 0:l[t.language])==null||c.splice(f,1)}else throw new Error(u.body.message)}}}const mt=new d2;be((e,t)=>{e==="quoteLength"&&mt.updateQuoteQueue(t)});let _w=!1;function uh(){return _w}function u2(){_w=!0,console.log("Glarses Mode On - test result will be hidden. You can check the stats in the console (here)"),console.log("To disable Glarses Mode refresh the page.")}function f2(){qf=!1,i("#result .stats .wpm .crown").css("opacity",0).addClass("hidden")}let qf=!1,Iw="normal";function p2(){return Iw}function Bw(){if(qf)return;qf=!0,i("#result .stats .wpm .crown").removeClass("hidden").css("opacity","0").animate({opacity:1},ge(250),"easeOutCubic")}function qw(e){Iw=e;const t=i("#result .stats .wpm .crown");t.removeClass("ineligible"),t.removeClass("pending"),t.removeClass("error"),t.removeClass("warning"),t.addClass(e)}function m2(){i("#testConfig").removeClass("invisible"),i("#mobileTestConfigButton").removeClass("invisible")}function g2(){i("#testConfig").addClass("invisible"),i("#mobileTestConfigButton").addClass("invisible")}async function Fw(){i("#testConfig .mode .textButton").removeClass("active"),i("#testConfig .mode .textButton[mode='"+r.mode+"']").addClass("active"),i("#testConfig .puncAndNum").addClass("hidden"),i("#testConfig .spacer").css("transition","none").addClass("scrolled"),i("#testConfig .time").addClass("hidden"),i("#testConfig .wordCount").addClass("hidden"),i("#testConfig .customText").addClass("hidden"),i("#testConfig .quoteLength").addClass("hidden"),i("#testConfig .zen").addClass("hidden"),r.mode==="time"?(i("#testConfig .puncAndNum").removeClass("hidden").css({width:"",opacity:""}),i("#testConfig .leftSpacer").removeClass("scrolled"),i("#testConfig .rightSpacer").removeClass("scrolled"),i("#testConfig .time").removeClass("hidden"),ja("time",r.time)):r.mode==="words"?(i("#testConfig .puncAndNum").removeClass("hidden").css({width:"",opacity:""}),i("#testConfig .leftSpacer").removeClass("scrolled"),i("#testConfig .rightSpacer").removeClass("scrolled"),i("#testConfig .wordCount").removeClass("hidden"),ja("words",r.words)):r.mode==="quote"?(i("#testConfig .rightSpacer").removeClass("scrolled"),i("#testConfig .quoteLength").removeClass("hidden"),ja("quoteLength",r.quoteLength)):r.mode==="custom"&&(i("#testConfig .puncAndNum").removeClass("hidden").css({width:"",opacity:""}),i("#testConfig .leftSpacer").removeClass("scrolled"),i("#testConfig .rightSpacer").removeClass("scrolled"),i("#testConfig .customText").removeClass("hidden")),ja("quoteLength",r.quoteLength),ja("numbers",r.numbers),ja("punctuation",r.punctuation),setTimeout(()=>{i("#testConfig .spacer").css("transition","")},125)}async function h2(e,t){var y,b,C;if(e===t)return;y2(t);let o;r.mode==="time"?o=r.time:r.mode==="words"?o=r.words:r.mode==="quote"&&(o=r.quoteLength),o!==void 0&&ja(r.mode,o);const a={time:"time",words:"wordCount",custom:"customText",quote:"quoteLength",zen:"zen"},s=ge(250),n={both:"easeInOutSine",in:"easeInSine",out:"easeOutSine"},l={time:!0,words:!0,custom:!0,quote:!1,zen:!1},c=i("#testConfig .puncAndNum");if(l[t]!==l[e]){l[t]?i("#testConfig .leftSpacer").removeClass("scrolled"):i("#testConfig .leftSpacer").addClass("scrolled"),c.css({width:"unset",opacity:1}).removeClass("hidden");const L=Math.round(((y=c[0])==null?void 0:y.getBoundingClientRect().width)??0);c.stop(!0,!1).css({width:l[e]?L:0,opacity:l[e]?1:0}).animate({width:l[t]?L:0,opacity:l[t]?1:0},s,n.both,()=>{l[t]?c.css("width","unset"):c.addClass("hidden")})}t==="zen"?i("#testConfig .rightSpacer").addClass("scrolled"):i("#testConfig .rightSpacer").removeClass("scrolled");const d=i(`#testConfig .${a[t]}`),u=i(`#testConfig .${a[e]}`),f=Math.round(((b=u[0])==null?void 0:b.getBoundingClientRect().width)??0);u.addClass("hidden"),d.removeClass("hidden");const p=Math.round(((C=d[0])==null?void 0:C.getBoundingClientRect().width)??0);u.removeClass("hidden"),d.addClass("hidden");const g=(p-f)/2;u.stop(!0,!1).css({opacity:1,width:f}).animate({width:f+g,opacity:0},s/2,n.in,()=>{u.css({opacity:1,width:"unset"}).addClass("hidden"),d.css({opacity:0,width:f+g}).removeClass("hidden").stop(!0,!1).animate({opacity:1,width:p},s/2,n.out,()=>{d.css("width","unset")})})}function y2(e){i("#testConfig .mode .textButton").removeClass("active"),i("#testConfig .mode .textButton[mode='"+e+"']").addClass("active")}function ja(e,t){if(e==="time"){i("#testConfig .time .textButton").removeClass("active");const o=[15,30,60,120].includes(t)?t:"custom";i("#testConfig .time .textButton[timeConfig='"+o+"']").addClass("active")}else if(e==="words"){i("#testConfig .wordCount .textButton").removeClass("active");const o=[10,25,50,100,200].includes(t)?t:"custom";i("#testConfig .wordCount .textButton[wordCount='"+o+"']").addClass("active")}else e==="quoteLength"?(i("#testConfig .quoteLength .textButton").removeClass("active"),gs(t,[0,1,2,3])?i("#testConfig .quoteLength .textButton[quotelength='all']").addClass("active"):t.forEach(o=>{i("#testConfig .quoteLength .textButton[quoteLength='"+o+"']").addClass("active")})):e==="numbers"?t===!1?i("#testConfig .numbersMode.textButton").removeClass("active"):i("#testConfig .numbersMode.textButton").addClass("active"):e==="punctuation"&&(t===!1?i("#testConfig .punctuationMode.textButton").removeClass("active"):i("#testConfig .punctuationMode.textButton").addClass("active"))}function b2(){i("#testConfig .quoteLength .favorite").removeClass("hidden")}function v2(){i("#testConfig .quoteLength .favorite").addClass("hidden")}let Bu=!1;be((e,t,o,a)=>{e==="fullConfigChange"&&(Bu=!0),e==="fullConfigChangeFinished"&&(Bu=!1,Fw()),!Bu&&Z()==="test"&&(e==="mode"?h2(a,t):["time","quoteLength","words","numbers","punctuation"].includes(e)&&t!==void 0&&ja(e,t))});sa(e=>{e.type==="authStateChanged"&&(e.data.isUserSignedIn?b2():v2())});function au(e,t,o,a,s){const n=e==="words"&&(t>=1e3||t===0),l=e==="time"&&(o>=900||o===0),c=e==="custom"&&s,d=e==="custom"&&(a.limit.mode==="word"||a.limit.mode==="section")&&(a.limit.value>=1e3||a.limit.value===0),u=e==="custom"&&a.limit.mode==="time"&&(a.limit.value>=900||a.limit.value===0);return!(n||l||c||d||u)}let M,Oo,uc=!0,da,Wi="";function w2(){uc=!uc,m(uc?"on":"off",1),de&&km().then(()=>{ue.update("resize")})}let qa=[];async function km(){var u;if(M.chartData==="toolong")return;const e=gt(r.typingSpeedUnit);ue.getScale("wpm").title.text=e.fullUnitString;let t=[];for(let f=1;f<=ds.length;f++)si&&f===ds.length?t.push(V(M.testDuration).toString()):t.push(f.toString());const o=[...M.chartData.wpm.map(f=>V(e.fromWpm(f)))],a=[...cl.map(f=>V(e.fromWpm(f)))],s=Math.max(...M.chartData.burst)*.25,l=[...Ok(M.chartData.burst,1,uc?s:0).map(f=>V(e.fromWpm(f)))];r.mode!=="time"&&si&&M.testDuration%1<.5&&(t.pop(),o.pop(),a.pop()),Oo=Math.max(Math.max(...o),Math.max(...a),Math.max(...l));let c=0;r.startGraphsAtZero||(c=Math.min(Math.min(...o),Math.min(...a),Math.min(...l)),c=Math.floor(c/10)*10);const d=await Kt("sub");if(r.funbox.length>0){let f="";for(const p of za())f+=p.name,(u=p.functions)!=null&&u.getResultContent&&(f+="("+p.functions.getResultContent()+")"),f+=" ";f=f.trimEnd(),qa.push({display:!0,id:"funbox-label",type:"line",scaleID:"wpm",value:ue.getScale("wpm").min,borderColor:"transparent",borderWidth:1,borderDash:[2,2],label:{backgroundColor:"transparent",font:{family:r.fontFamily.replace(/_/g," "),size:11,style:"normal",weight:mo.defaults.font.weight,lineHeight:mo.defaults.font.lineHeight},color:d,padding:3,borderRadius:3,position:"start",display:!0,content:`${f}`}})}ue.data.labels=t,ue.getDataset("wpm").data=o,ue.getDataset("wpm").label=r.typingSpeedUnit,ue.getScale("wpm").min=c,ue.getScale("wpm").max=Oo,ue.getDataset("raw").data=a,ue.getScale("raw").min=c,ue.getScale("raw").max=Oo,ue.getDataset("burst").data=l,ue.getScale("burst").min=c,ue.getScale("burst").max=Oo,ue.getDataset("error").data=M.chartData.err,ue.getScale("error").max=Math.max(...M.chartData.err)}async function Rw(){const e=await hs(),t=await xr(M.mode,M.mode2,M.punctuation??!1,M.numbers??!1,M.language,M.difficulty,M.lazyMode??!1,kr(M.funbox)),o=(t==null?void 0:t.wpm)??0;if(o===0)return;const a=gt(r.typingSpeedUnit),s=V(a.fromWpm(o)).toFixed(2);qa.push({display:!0,type:"line",id:"lpb",scaleID:"wpm",value:s,borderColor:e.sub+"55",borderWidth:1,label:{backgroundColor:e.sub,font:{family:r.fontFamily.replace(/_/g," "),size:11,style:"normal",weight:mo.defaults.font.weight,lineHeight:mo.defaults.font.lineHeight},color:e.bg,padding:3,borderRadius:3,position:"center",content:` PB: ${s} `,display:!0}});const n=a.fromWpm(20);Oo>=parseFloat(s)-n&&Oo<=parseFloat(s)+n&&(Oo=Math.round(parseFloat(s)+n)),ue.getScale("wpm").max=Oo,ue.getScale("raw").max=Oo,ue.getScale("burst").max=Oo}function Dw(){let e=!1;if(M.wpm>=1e3&&(e=!0),i("#result .stats .wpm .top .text").text(r.typingSpeedUnit),e?i("#result .stats .wpm .bottom").text("Infinite"):i("#result .stats .wpm .bottom").text(N.typingSpeed(M.wpm)),i("#result .stats .raw .bottom").text(N.typingSpeed(M.rawWpm)),i("#result .stats .acc .bottom").text(M.acc===100?"100%":N.accuracy(M.acc)),r.alwaysShowDecimalPlaces){r.typingSpeedUnit!=="wpm"?(i("#result .stats .wpm .bottom").attr("aria-label",M.wpm.toFixed(2)+" wpm"),i("#result .stats .raw .bottom").attr("aria-label",M.rawWpm.toFixed(2)+" wpm")):(i("#result .stats .wpm .bottom").removeAttr("aria-label"),i("#result .stats .raw .bottom").removeAttr("aria-label"));let t=V(M.testDuration).toFixed(2)+"s";M.testDuration>61&&(t=rt(V(M.testDuration))),i("#result .stats .time .bottom .text").text(t),i("#result .stats .acc .bottom").attr("aria-label",`${lo.correct} correct
${lo.incorrect} incorrect`)}else{const t={showDecimalPlaces:!0,suffix:` ${r.typingSpeedUnit}`};let o=N.typingSpeed(M.wpm,t),a=N.typingSpeed(M.rawWpm,t);r.typingSpeedUnit!=="wpm"&&(o+=" ("+M.wpm.toFixed(2)+" wpm)",a+=" ("+M.rawWpm.toFixed(2)+" wpm)"),i("#result .stats .wpm .bottom").attr("aria-label",o),i("#result .stats .raw .bottom").attr("aria-label",a),i("#result .stats .acc .bottom").attr("aria-label",`${M.acc===100?"100%":N.percentage(M.acc,{showDecimalPlaces:!0})}
${lo.correct} correct
${lo.incorrect} incorrect`).attr("data-balloon-break","")}}function C2(){i("#result .stats .consistency .bottom").text(N.percentage(M.consistency)),r.alwaysShowDecimalPlaces?i("#result .stats .consistency .bottom").attr("aria-label",N.percentage(M.keyConsistency,{showDecimalPlaces:!0,suffix:" key"})):i("#result .stats .consistency .bottom").attr("aria-label",`${M.consistency}% (${M.keyConsistency}% key)`)}function k2(){const e=V(M.afkDuration/M.testDuration*100);if(i("#result .stats .time .bottom .afk").text(""),e>0&&i("#result .stats .time .bottom .afk").text(e+"% afk"),i("#result .stats .time .bottom").attr("aria-label",`${M.afkDuration}s afk ${e}%`),r.alwaysShowDecimalPlaces){let t=V(M.testDuration).toFixed(2)+"s";M.testDuration>61&&(t=rt(V(M.testDuration))),i("#result .stats .time .bottom .text").text(t)}else{let t=Math.round(M.testDuration)+"s";M.testDuration>61&&(t=rt(Math.round(M.testDuration))),i("#result .stats .time .bottom .text").text(t),i("#result .stats .time .bottom").attr("aria-label",`${V(M.testDuration)}s (${M.afkDuration}s afk ${e}%)`)}}function S2(){i("#result .stats .time .bottom .timeToday").text(_A())}function x2(){i("#result .stats .key .bottom").text(M.charStats[0]+"/"+M.charStats[1]+"/"+M.charStats[2]+"/"+M.charStats[3])}function fc(e){Bw(),qw(e)}function mr(e,t=!1){i("#result .stats .wpm .crown").attr("aria-label",e),i("#result .stats .wpm .crown").attr("data-balloon-length",t?"medium":"")}async function T2(e){if(r.mode==="quote"||e){Ff();return}let t=0;const o=await Ww();if(console.debug("Result can get PB:",o.value,o.reason??""),o.value){const a=await xr(r.mode,M.mode2,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode,za()),s=(a==null?void 0:a.wpm)??0;t=M.wpm-s,console.debug("Local PB",a,"diff",t),t<=0?(Ff(),console.debug("Hiding crown")):(console.debug("Showing pending crown"),fc("pending"),mr("+"+N.typingSpeed(t,{showDecimalPlaces:!0})))}else{const a=await xr(r.mode,M.mode2,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode,[]),s=(a==null?void 0:a.wpm)??0;t=M.wpm-s,console.debug("Local PB",a,"diff",t),t<=0?(console.debug("Showing warning crown"),fc("warning"),mr(`This result is not eligible for a new PB (${o.reason})`,!0)):(console.debug("Showing ineligible crown"),fc("ineligible"),mr(`You could've gotten a new PB (+${N.typingSpeed(t,{showDecimalPlaces:!0})}), but your config does not allow it (${o.reason})`,!0))}}function Ff(){f2(),mr("")}function L2(){p2()==="pending"&&(Bw(),qw("error"),mr("Local PB data is out of sync with the server - please refresh (pb mismatch)",!0))}async function Ww(){const e=M.funbox,o=kr(M.funbox).every(l=>l==null?void 0:l.canGetPb),a=e.length===0||o,s=r.stopOnError==="letter"&&M.acc<100,n=!M.bailedOut;return a&&!s&&n?{value:!0}:a?s?{value:!1,reason:"stop on letter"}:n?{value:!1,reason:"unknown"}:{value:!1,reason:"bailed out"}:{value:!1,reason:"funbox"}}function Pw(){if(De())return;const e=getComputedStyle(document.body),t=[e.getPropertyValue("--main-color"),e.getPropertyValue("--text-color"),e.getPropertyValue("--sub-color")],o=Date.now()+125;(function a(){yg({particleCount:5,angle:60,spread:75,origin:{x:0},colors:t}),yg({particleCount:5,angle:120,spread:75,origin:{x:1},colors:t}),Date.now()<o&&requestAnimationFrame(a)})()}async function $2(e){var n,l,c,d;const t=[],o=((l=(n=x())==null?void 0:n.tags)==null?void 0:l.length)??0;try{(d=(c=x())==null?void 0:c.tags)==null||d.forEach(u=>{u.active===!0&&t.push(u)})}catch{}o===0?i("#result .stats .tags").addClass("hidden"):i("#result .stats .tags").removeClass("hidden"),t.length===0?i("#result .stats .tags .bottom").html("<div class='noTags'>no tags</div>"):i("#result .stats .tags .bottom").text(""),i("#result .stats .tags .editTagsButton").attr("data-result-id",""),i("#result .stats .tags .editTagsButton").attr("data-active-tag-ids",t.map(u=>u._id).join(",")),i("#result .stats .tags .editTagsButton").addClass("invisible");let a="start",s=15;for(const u of t){const f=await Cb(u._id,r.mode,M.mode2,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode);i("#result .stats .tags .bottom").append(`
      <div tagid="${u._id}" aria-label="PB: ${f}" data-balloon-pos="up">${u.display}<i class="fas fa-crown hidden"></i></div>
    `);const p=gt(r.typingSpeedUnit);if(r.mode!=="quote"&&!e&&(await Ww()).value)if(f<M.wpm)await Lx(u._id,r.mode,M.mode2,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode,M.wpm,M.acc,M.rawWpm,M.consistency),i(`#result .stats .tags .bottom div[tagid="${u._id}"] .fas`).removeClass("hidden"),i(`#result .stats .tags .bottom div[tagid="${u._id}"]`).attr("aria-label","+"+V(M.wpm-f));else{const h=await hs();qa.push({display:!0,type:"line",id:"tpb",scaleID:"wpm",value:p.fromWpm(f),borderColor:h.sub+"55",borderWidth:1,label:{backgroundColor:h.sub,font:{family:r.fontFamily.replace(/_/g," "),size:11,style:"normal",weight:mo.defaults.font.weight,lineHeight:mo.defaults.font.lineHeight},color:h.bg,padding:3,borderRadius:3,position:a,xAdjust:s,display:!0,content:`${u.display} PB: ${V(p.fromWpm(f)).toFixed(2)}`}}),a==="start"?(a="end",s=-15):(a="start",s=15)}}}function M2(e){let t="";t+=r.mode,r.mode==="time"?t+=" "+r.time:r.mode==="words"?t+=" "+r.words:r.mode==="quote"&&(e==null?void 0:e.group)!==void 0&&(t+=" "+["short","medium","long","thicc"][e.group]);const o=bs("ignoresLanguage");r.mode!=="custom"&&!o&&(t+="<br>"+ea(M.language)),r.punctuation&&(t+="<br>punctuation"),r.numbers&&(t+="<br>numbers"),r.blindMode&&(t+="<br>blind"),r.lazyMode&&(t+="<br>lazy"),r.funbox.length>0&&(t+="<br>"+r.funbox.map(a=>a.replace(/_/g," ")).join(", ")),r.difficulty==="expert"?t+="<br>expert":r.difficulty==="master"&&(t+="<br>master"),r.stopOnError!=="off"&&(t+=`<br>stop on ${r.stopOnError}`),i("#result .stats .testType .bottom").html(t)}function A2(e,t,o,a,s){let n="";if(e&&(n+=`<br>failed (${t})`),o&&(n+="<br>afk detected"),Jp){n+="<br>invalid";const l=[];(M.wpm<0||M.wpm>350&&M.mode!=="words"&&M.mode2!=="10"||M.wpm>420&&M.mode==="words"&&M.mode2==="10")&&l.push("wpm"),(M.rawWpm<0||M.rawWpm>350&&M.mode!=="words"&&M.mode2!=="10"||M.rawWpm>420&&M.mode==="words"&&M.mode2==="10")&&l.push("raw"),(M.acc<75||M.acc>100)&&l.push("accuracy"),l.length>0&&(n+=` (${l.join(",")})`)}a&&(n+="<br>repeated"),M.bailedOut&&(n+="<br>bailed out"),s&&(n+="<br>too short"),n===""?i("#result .stats .info").addClass("hidden"):(i("#result .stats .info").removeClass("hidden"),n=n.substring(4),i("#result .stats .info .bottom").html(n))}function E2(e){var t,o,a;if(r.mode==="quote"){if(e===null){console.error("Failed to update quote rating button: randomQuote is null");return}const s=(a=(o=(t=x())==null?void 0:t.quoteRatings)==null?void 0:o[e.language])==null?void 0:a[e.id];Ce(s)&&i(".pageTest #result #rateQuoteButton .icon").removeClass("far").addClass("fas"),xw(e).then(n=>{var l;i(".pageTest #result #rateQuoteButton .rating").text(((l=n==null?void 0:n.average)==null?void 0:l.toFixed(1))??"")}).catch(n=>{i(".pageTest #result #rateQuoteButton .rating").text("?")}),i(".pageTest #result #rateQuoteButton").css({opacity:0}).removeClass("hidden").css({opacity:1})}}function _2(e){const t=i(".pageTest #result #favoriteQuoteButton .icon");if(r.mode!=="quote"||!B()){t.parent().addClass("hidden");return}if(e===null){console.error("Failed to update quote favorite button: randomQuote is null");return}da=r.mode==="quote"?e.language:void 0,Wi=r.mode==="quote"?e.id.toString():"";const o=mt.isQuoteFavorite(e);t.removeClass(o?"far":"fas").addClass(o?"fas":"far"),t.parent().removeClass("hidden")}function I2(e){r.mode==="quote"?(i("#result .stats .source").removeClass("hidden"),i("#result .stats .source .bottom").html((e==null?void 0:e.source)??"Error: Source unknown")):i("#result .stats .source").addClass("hidden")}async function B2(e,t,o,a,s,n,l,c){qa=[],M=structuredClone(e),Ff(),i("#resultWordsHistory .words").empty(),i("#result #resultWordsHistory").addClass("hidden"),i("#retrySavingResultButton").addClass("hidden"),i(".pageTest #result #rateQuoteButton .icon").removeClass("fas").addClass("far"),i(".pageTest #result #rateQuoteButton .rating").text(""),i(".pageTest #result #rateQuoteButton").addClass("hidden"),i("#words").removeClass("blurred"),i("#wordsInput").trigger("blur"),i("#result .stats .time .bottom .afk").text(""),B()?i("#result .loginTip").addClass("hidden"):i("#result .loginTip").removeClass("hidden"),r.ads==="off"||r.ads==="result"?i("#result #watchVideoAdButton").addClass("hidden"):i("#result #watchVideoAdButton").removeClass("hidden"),Dw(),C2(),k2(),x2(),M2(l),I2(l),_2(l),await T2(c),await km(),await Rw(),await $2(c),zw(),A2(t,o,a,s,n),ue.options.plugins.annotation.annotations=qa,ue.updateColors(),ue.resize(),i("#result .stats .tags").hasClass("hidden")&&i("#result .stats .info").hasClass("hidden")?i("#result .stats .infoAndTags").addClass("hidden"):i("#result .stats .infoAndTags").removeClass("hidden"),uh()?(i("main #result .noStressMessage").remove(),i("main #result").prepend(`

      <div class='noStressMessage' style="
        text-align: center;
        grid-column: 1/3;
        font-size: 2rem;
        padding-bottom: 2rem;
      ">
      <i class="fas fa-check"></i>
      </div>

    `),i("main #result .stats").addClass("hidden"),i("main #result .chart").addClass("hidden"),i("main #result #resultWordsHistory").addClass("hidden"),i("main #result #resultReplay").addClass("hidden"),i("main #result .loginTip").addClass("hidden"),i("main #result #showWordHistoryButton").addClass("hidden"),i("main #result #watchReplayButton").addClass("hidden"),i("main #result #saveScreenshotButton").addClass("hidden"),console.log(`Test Completed: ${M.wpm} wpm ${M.acc}% acc ${M.rawWpm} raw ${M.consistency}% consistency`)):(i("main #result .stats").removeClass("hidden"),i("main #result .chart").removeClass("hidden"),B()||i("main #result .loginTip").removeClass("hidden"),i("main #result #showWordHistoryButton").removeClass("hidden"),i("main #result #watchReplayButton").removeClass("hidden"),i("main #result #saveScreenshotButton").removeClass("hidden")),g2(),nn(i("#typingTest"),i("#result"),250,async()=>{const d=document.querySelector("#result");d==null||d.focus({preventScroll:!0}),Py(d),s2(),$v(!1),i("#words").empty(),ue.resize()},async()=>{Do(!1),i("#resultExtraButtons").removeClass("hidden").css("opacity",0).animate({opacity:1},ge(125));const d=au(r.mode,r.words,r.time,Ia(),ta()??!1);r.alwaysShowWordsHistory&&d&&!uh()&&Yp(!0),td(!0),Ui()})}const Rf=new Bt({key:"resultChartDataVisibility",schema:D.object({raw:D.boolean(),burst:D.boolean(),errors:D.boolean(),pbLine:D.boolean(),tagPbLine:D.boolean()}).strict(),fallback:{raw:!0,burst:!0,errors:!0,pbLine:!0,tagPbLine:!0}});function zw(e=!1){const t=Rf.get();ue.getDataset("raw").hidden=!t.raw,ue.getDataset("burst").hidden=!t.burst,ue.getDataset("error").hidden=!t.errors;for(const s of qa)s.id==="lpb"?s.display=t.pbLine:s.id==="tpb"&&(s.display=t.tagPbLine);e&&ue.update();const o=i(".pageTest #result .chart .chartLegend button"),a=qa.some(s=>s.id==="tpb");for(const s of o){const n=i(s).data("id");if(n!=="raw"&&n!=="burst"&&n!=="errors"&&n!=="pbLine"&&n!=="tagPbLine")return;i(s).toggleClass("active",t[n]),n==="pbLine"?i(s).toggleClass("hidden",!B()):n==="tagPbLine"&&i(s).toggleClass("hidden",!B()||!a)}}function q2(e,t){var a,s;const o=[];if(e.length>0)for(const n of e)(s=(a=x())==null?void 0:a.tags)==null||s.forEach(l=>{n===l._id&&o.push(l.display)});if(e.length===0)i(".pageTest #result .tags .bottom").html("<div class='noTags'>no tags</div>");else{i(".pageTest #result .tags .bottom div.noTags").remove();const n=i(".pageTest #result .tags .bottom div[tagid]"),l=[];n.each((d,u)=>{const f=i(u).attr("tagid");e.includes(f)?l.push(f):i(u).remove()});let c="";e.forEach((d,u)=>{l.includes(d)||(t.includes(d)?c+=`<div tagid="${d}" data-balloon-pos="up">${o[u]}<i class="fas fa-crown"></i></div>`:c+=`<div tagid="${d}">${o[u]}</div>`)}),i(".pageTest #result .tags .bottom").append(c),i(".pageTest #result .tags .top .editTagsButton").attr("active-tag-ids",e.join(","))}}i(".pageTest #result .chart .chartLegend button").on("click",e=>{const o=i(e.target).data("id");if(o!=="raw"&&o!=="burst"&&o!=="errors"&&o!=="pbLine"&&o!=="tagPbLine")return;const a=Rf.get();a[o]=!a[o],Rf.set(a),zw(!0)});i(".pageTest #favoriteQuoteButton").on("click",async()=>{var o,a,s,n,l;if(da===void 0||Wi===""){m("Could not get quote stats!",-1);return}const e=i(".pageTest #favoriteQuoteButton .icon"),t=x();if(t)if(e.hasClass("fas")){J();const c=await E.users.removeQuoteFromFavorites({body:{language:da,quoteId:Wi}});if(K(),m(c.body.message,c.status===200?1:-1),c.status===200){e.removeClass("fas").addClass("far");const d=(a=(o=t.favoriteQuotes)==null?void 0:o[da])==null?void 0:a.indexOf(Wi);(n=(s=t.favoriteQuotes)==null?void 0:s[da])==null||n.splice(d,1)}}else{J();const c=await E.users.addQuoteToFavorites({body:{language:da,quoteId:Wi}});K(),m(c.body.message,c.status===200?1:-1),c.status===200&&(e.removeClass("far").addClass("fas"),t.favoriteQuotes===void 0&&(t.favoriteQuotes={}),t.favoriteQuotes[da]||(t.favoriteQuotes[da]=[]),(l=t.favoriteQuotes[da])==null||l.push(Wi))}});be(async e=>{["typingSpeedUnit","startGraphsAtZero"].includes(e)&&de&&(qa=[],Dw(),await km(),await Rw(),Ji(),ue.options.plugins.annotation.annotations=qa,ue.updateColors(),ue.resize())});const G={particles:[],rendering:!1},F2=1e3,R2=.05,D2=4,W2=.6,Vl=1500,fh=.3,ph=[6,3],Kl=10;function P2(){const e=document.createElement("canvas");return e.style.cssText="position:fixed;top:0;left:0;pointer-events:none;z-index:999999",e.height=window.innerHeight,e.width=window.innerWidth,window.addEventListener("resize",()=>{e.height=window.innerHeight,e.width=window.innerWidth}),document.body.appendChild(e),e}function z2(e,t,o){return{x:e,y:t,color:o,alpha:1,prev:{x:e,y:t},vel:{x:Vl-Math.random()*Vl*2,y:Vl-Math.random()*Vl*2}}}function H2(e){!G.canvas||!Ce(G.deltaTime)||(e.prev.x=e.x,e.prev.y=e.y,e.x+=e.vel.x*G.deltaTime,e.y+=e.vel.y*G.deltaTime,e.x>G.canvas.width?(e.vel.x*=-.3,e.x=G.canvas.width-(e.x-G.canvas.width)*fh):e.x<0&&(e.vel.x*=-.3,e.x*=-.3),e.y>G.canvas.height?(e.vel.y*=-.3,e.y=G.canvas.height-(e.y-G.canvas.height)*fh):e.y<0&&(e.vel.y*=-1,e.y*=-1),e.vel.y+=F2*G.deltaTime,e.vel.x*=1-R2*G.deltaTime,e.alpha*=1-W2*G.deltaTime)}function O2(){G.caret=i("#caret"),G.canvas=P2(),G.context2d=G.canvas.getContext("2d")}function Hw(){if(!Ce(G.lastFrame)||!G.context2d||!G.canvas)return;G.rendering=!0;const e=Date.now();G.deltaTime=(e-G.lastFrame)/1e3,G.lastFrame=e,G.context2d.clearRect(0,0,G.canvas.width,G.canvas.height);const t=[];for(const o of G.particles)o.alpha<.1||(H2(o),G.context2d.globalAlpha=o.alpha,G.context2d.strokeStyle=o.color,G.context2d.lineWidth=D2,G.context2d.beginPath(),G.context2d.moveTo(Math.round(o.prev.x),Math.round(o.prev.y)),G.context2d.lineTo(Math.round(o.x),Math.round(o.y)),G.context2d.stroke(),t.push(o));G.particles=t,G.particles.length&&!De()?requestAnimationFrame(Hw):(G.context2d.clearRect(0,0,G.canvas.width,G.canvas.height),G.rendering=!1)}function Ow(e=!1){if(!Ce(G.resetTimeOut))return;delete G.resetTimeOut,clearTimeout(G.resetTimeOut);const t=i(document.body);t.css("transition","all .25s, transform 0.8s"),t.css("transform","translate(0,0)"),setTimeout(()=>{t.css("transition","all .25s, transform .05s"),i("html").css("overflow","inherit"),i("html").css("overflow-y","scroll")},e?0:1e3)}function N2(){G.rendering||(G.lastFrame=Date.now(),Hw())}function U2(){const e=Math.floor(Math.random()*256).toString(16),t=Math.floor(Math.random()*256).toString(16),o=Math.floor(Math.random()*256).toString(16);return`#${e}${t}${o}`}async function Nw(e=!0,t=!1){var s,n;if(r.monkeyPowerLevel==="off"||De())return;if(r.blindMode&&(e=!0),["3","4"].includes(r.monkeyPowerLevel)){i("html").css("overflow","hidden");const l=[Math.round(Kl-Math.random()*Kl),Math.round(Kl-Math.random()*Kl)];i(document.body).css("transform",`translate(${l[0]}px, ${l[1]}px)`),Ce(G.resetTimeOut)&&clearTimeout(G.resetTimeOut),G.resetTimeOut=setTimeout(Ow,2e3)}const o=(s=G.caret)==null?void 0:s.offset(),a=[(o==null?void 0:o.left)??0,((o==null?void 0:o.top)??0)+(((n=G.caret)==null?void 0:n.height())??0)];for(let l=Math.round((ph[0]+Math.random()*ph[1])*(t?2:1));l>0;l--){const c=["2","4"].includes(r.monkeyPowerLevel)?U2():e?await Kt("caret"):await Kt("error");G.particles.push(z2(...a,c))}N2()}const V2={laborers:"labourers",industrialized:"industrialised",acclimatizing:"acclimatising",acclimatized:"acclimatised",behoove:"behove",reorganization:"reorganisation",galvanize:"galvanise",demagogism:"demagoguism",canceled:"cancelled",baptize:"baptise",revitalize:"revitalise",skeptical:"sceptical",piscine:"piscinae",ionization:"ionisation",chili:"chilli",dexterous:"dextrous",likable:"likeable",neutralize:"neutralise",meter:"metre",meters:"metres",centimeter:"centimetre",hurrah:"hooray",multicolor:"multicolour",actualization:"actualisation",fertilizing:"fertilising",enamor:"enamour",skepticism:"scepticism",authorize:"authorise",minimize:"minimise",bandoleer:"bandolier",rigor:"rigour",fledgling:"fledgeling",mesquite:"mesquit",fogy:"fogey",characterize:"characterise",wagonette:"waggonette",plagiarize:"plagiarise",kilometers:"kilometres",molt:"moult",leveler:"leveller",checkered:"chequered",vendor:"vender",candor:"candour",moralize:"moralise",denationalization:"denationalisation",anemia:"anaemia",caiman:"cayman",chitterlings:"chitlins",acclimated:"acclimatised",acclimate:"acclimatise",skillful:"skilful",enamored:"enamoured",watercolor:"watercolour",extemporization:"extemporisation",lackluster:"lacklustre",equalizer:"equaliser",cipher:"cypher",polarization:"polarisation",polymerization:"polymerisation",ionize:"ionise",anesthetic:"anaesthetic",aerie:"eyrie",lachrymal:"lacrimal",decimeter:"decimetre",rajah:"raja",modernize:"modernise",gasoline:"petrol",alphabetized:"alphabetised",saber:"sabre",burglarize:"burglarise",terrorize:"terrorise",enthrall:"enthral",mustachioed:"moustachioed",anesthesia:"anaesthesia",sepulcher:"sepulchre",caftan:"kaftan",organize:"organise",manikin:"mannikin",dexterously:"dextrously",artifact:"artefact",kilometer:"kilometre",mommy:"mummy",brant:"brent",hyena:"hyaena",fuze:"fuse",victimize:"victimise",jihad:"jehad",airplane:"aeroplane",laborer:"labourer",vaporware:"vapourware",worshiped:"worshipped",taboret:"tabouret",rationalize:"rationalise",whimsy:"whimsey",scandalize:"scandalise",categorization:"categorisation",centered:"centred",kerosene:"kerosine",specialize:"specialise",specialized:"specialised",cicatrix:"cicatrice",jailer:"jailor",unfavorable:"unfavourable",guerrilla:"guerilla",emphasize:"emphasise",wacky:"whacky",ionizing:"ionising",czarina:"tzarina",ratline:"ratlin",abolitionize:"abolitionise",subsidize:"subsidise",plowing:"ploughing",untrammeled:"untrammelled",worshiping:"worshipping",memorization:"memorisation",anglicize:"anglicise",finalize:"finalise",gases:"gasses",fertilization:"fertilisation",libeling:"libelling",kinesthetic:"kinaesthetic",immunization:"immunisation",coloration:"colouration",overdraft:"overdraught",lambaste:"lambast",unpasteurized:"unpasteurised",ascendance:"ascendence",jeweler:"jeweller",fervor:"fervour",jeopardize:"jeopardise",abridgment:"abridgement",monopolize:"monopolise",colorless:"colourless",colorlessness:"colourlessness",tumors:"tumours",jinni:"jinn",aluminum:"aluminium",salable:"saleable",bronco:"broncho",lupine:"lupin",linchpin:"lynchpin",mesmerize:"mesmerise",internationalization:"internationalisation",anapestic:"anapaestic",supersede:"supercede",europeanize:"europeanise",optimized:"optimised",botanize:"botanise",organizational:"organisational",heme:"haem",estivation:"aestivation",edema:"oedema",penalize:"penalise",peddler:"pedlar",biased:"biassed",aggrandize:"aggrandise",rationalizing:"rationalising",deputize:"deputise",centers:"centres",unicolor:"unicolour",hypnotized:"hypnotised",anglicized:"anglicised",initialization:"initialisation",topee:"topi",nightie:"nighty",tricolor:"tricolour",reorganize:"reorganise",barbecue:"barbeque",fertilized:"fertilised",synthesize:"synthesise",economize:"economise",colter:"coulter",paleontologist:"palaeontologist",acclimatize:"acclimatise",idealize:"idealise",fossilization:"fossilisation",lionize:"lionise",acclimating:"acclimatising",luster:"lustre",demeanor:"demeanour",unauthorized:"unauthorised",smolder:"smoulder",abettor:"abetter",jewelry:"jewellery",demoralization:"demoralisation",fullness:"fulness",neighbored:"neighboured",neighbor:"neighbour",neighbors:"neighbours",neighboring:"neighbouring",neighborly:"neighbourly",neighborhood:"neighbourhood",neighborhoods:"neighbourhoods",magnetizer:"magnetiser",appetizer:"appetiser",hebraizing:"hebraising",carbonization:"carbonisation",favorably:"favourably",favorite:"favourite",behavioral:"behavioural",cognizant:"cognisant",skeptic:"sceptic",fiber:"fibre",fibers:"fibres",labeled:"labelled",analyze:"analyse",disorganization:"disorganisation",concenter:"concentre",categorize:"categorise",novelization:"novelisation",proselytize:"proselytise",draftsman:"draughtsman",paralyze:"paralyse",ostracize:"ostracise",italicize:"italicise",micrometer:"micrometre",cognizance:"cognisance",saltpeter:"saltpetre",conceptualization:"conceptualisation",containerization:"containerisation",anapest:"anapaest",leukemia:"leukaemia",omelet:"omelette",industrialize:"industrialise",characterization:"characterisation",amortize:"amortise",mazurka:"mazourka",macadamize:"macadamise",stymie:"stymy",analog:"analogue",prizer:"priser",cauterize:"cauterise",dysmenorrhea:"dysmenorrhoea",hippie:"hippy",mechanization:"mechanisation",commercialize:"commercialise",unsavory:"unsavoury",somber:"sombre",esophageal:"oesophageal",iodized:"iodised",tyrannize:"tyrannise",liberalize:"liberalise",computerization:"computerisation",synthesizer:"synthesiser",fertilizes:"fertilises",airdrome:"aerodrome",uncivilized:"uncivilised",mold:"mould",nitrogenized:"nitrogenised",legalize:"legalise",tantalize:"tantalise",eulogize:"eulogise",depolarization:"depolarisation",fecal:"faecal",bastardize:"bastardise",summarize:"summarise",cony:"coney",authorization:"authorisation",colorful:"colourful",temporized:"temporised",adviser:"advisor",tendinitis:"tendonitis",crystallization:"crystallisation",humor:"humour",humorous:"humourous",chanty:"shanty",dyspnea:"dyspnoea",aging:"ageing",mousy:"mousey",succor:"succour",distill:"distil",decentralization:"decentralisation",cauterization:"cauterisation",specter:"spectre",snowplow:"snowplough",pediatrics:"paediatrics",discoloration:"discolouration",tumor:"tumour",empathize:"empathise",pawpaw:"papaya",aggrandizement:"aggrandisement",fontanel:"fontanelle",brunet:"brunette",rumor:"rumour",epaulet:"epaulette",glycerin:"glycerine",fraternize:"fraternise",latinize:"latinise",sniveling:"snivelling",pasteurize:"pasteurise",modernization:"modernisation",patronize:"patronise",totaled:"totalled",normalization:"normalisation",niter:"nitre",shoveler:"shoveller",flier:"flyer",equalization:"equalisation",meagerly:"meagrely",favoritism:"favouritism",libelous:"libellous",popularized:"popularised",armory:"armoury",humanization:"humanisation",minuscule:"miniscule",collectible:"collectable",tepee:"teepee",stabilization:"stabilisation",moldy:"mouldy",colonize:"colonise",idealized:"idealised",meager:"meagre",armorer:"armourer",vitalize:"vitalise",fossilized:"fossilised",antagonize:"antagonise",criticize:"criticise",liter:"litre",stigmatize:"stigmatise",theorize:"theorise",combated:"combatted",desalination:"desalinisation",evangelize:"evangelise",idolization:"idolisation",smoldering:"smouldering",commercialization:"commercialisation",laureled:"laurelled",hematology:"haematology",fulfill:"fulfil",disorganized:"disorganised",accouterments:"accoutrements",busses:"buses",utilize:"utilise",enroll:"enrol",goiter:"goitre",stylized:"stylised",diarrhea:"diarrhoea",hypothesize:"hypothesise",esthetic:"aesthetic",dishonor:"dishonour",victualer:"victualler",paleolithic:"palaeolithic",sanatorium:"sanitarium",feminization:"feminisation",flotation:"floatation",teetotaler:"teetotaller",feudalization:"feudalisation",visualize:"visualise",fertilize:"fertilise",czar:"tzar",nationalization:"nationalisation",septicemia:"septicaemia",organizer:"organiser",recrystallization:"recrystallisation",dolor:"dolour",agonizing:"agonising",romanization:"romanisation",synchronize:"synchronise",amorist:"amourist",agonized:"agonised",belabor:"belabour",caster:"castor",softy:"softie",apothegm:"apophthegm",demobilization:"demobilisation",agonizes:"agonises",misdemeanor:"misdemeanour",recognizable:"recognisable",asshole:"arsehole",brutalization:"brutalisation",chamois:"shammy",clamor:"clamour",fertilizer:"fertiliser",deodorization:"deodorisation",privatization:"privatisation",tidbit:"titbit",molding:"moulding",alleluia:"halleluiah",canonization:"canonisation",customize:"customise",customization:"customisations",customizer:"customiser",customizers:"customisers",customizes:"customises",customizing:"customising",popularize:"popularise",specialty:"speciality",meagerness:"meagreness",esophagus:"oesophagus",millimeter:"millimetre",harmonization:"harmonisation",atomizer:"atomiser",dieresis:"diaeresis",maneuver:"manoeuvre",capitalize:"capitalise",gynecologist:"gynaecologist",acclimation:"acclimatisation",generalize:"generalise",temporize:"temporise",premunire:"praemunire",estival:"aestival",selvage:"selvedge",brier:"briar",hyperesthesia:"hyperaesthesia",maximize:"maximise",draftsmen:"draughtsmen",colonization:"colonisation",capitalization:"capitalisation",tenia:"taenia",paleontology:"palaeontology",libeler:"libeller",arytenoid:"arytaenoid",wainscoting:"wainscotting",globalization:"globalisation",legalization:"legalisation",magnetization:"magnetisation",stabilize:"stabilise",mesmerized:"mesmerised",savory:"savoury",reconnoiter:"reconnoitre",bastardized:"bastardised",rancor:"rancour",checker:"chequer",industrialization:"industrialisation",epitomize:"epitomise",socialize:"socialise",externalization:"externalisation",chivy:"chivvy",optimize:"optimise",romanize:"romanise",vulcanize:"vulcanise",plow:"plough",memorize:"memorise",sterilization:"sterilisation",routing:"routeing",raveling:"ravelling",savor:"savour",harmonize:"harmonise",cannibalize:"cannibalise",vaporize:"vaporise",utilization:"utilisation",hybridization:"hybridisation",mechanize:"mechanise",arbor:"arbour",arbors:"arbours",licorice:"liquorice",counselor:"counsellor",orthopedic:"orthopaedic",lusterless:"lustreless",numskull:"numbskull",paleozoic:"palaeozoic",malodor:"malodour",amenorrhea:"amenorrhoea",criticized:"criticised",gonorrhea:"gonorrhoea",fossilize:"fossilise",revolutionize:"revolutionise",woolen:"woollen",dishabille:"deshabille",organdy:"organdie",asses:"arses",furor:"furore",paycheck:"paycheque",pulverize:"pulverise",dramatization:"dramatisation",yodeler:"yodeller",apologize:"apologise",apologized:"apologised",blond:"blonde",oxidize:"oxidise",extemporize:"extemporise",whiz:"whizz",edile:"aedile",appall:"appal",legitimize:"legitimise",urbanization:"urbanisation",magnetize:"magnetise",womanize:"womanise",orthopedics:"orthopaedics",cognize:"cognise",christianization:"christianisation",vocalize:"vocalise",individualization:"individualisation",hemoglobin:"haemoglobin",racket:"racquet",agonize:"agonise",aggrandizes:"aggrandises",accouter:"accoutre",mollusk:"mollusc",publicize:"publicise",fraternization:"fraternisation",odorless:"odourless",odor:"odour",odorous:"odourous",rationalization:"rationalisation",pretense:"pretence",louver:"louvre",kopeck:"kopek",lissome:"lissom",idealization:"idealisation",nosy:"nosey",stogie:"stogy",althea:"althaea",immobilization:"immobilisation",majolica:"maiolica",savior:"saviour",civilize:"civilise",granddad:"grandad",centralization:"centralisation",localization:"localisation",evangelization:"evangelisation",ruble:"rouble",pajamas:"pyjamas",sterilize:"sterilise",math:"maths",localize:"localise",hospitalization:"hospitalisation",scrutinize:"scrutinise",acclimatization:"acclimatisation",misbehavior:"misbehaviour",behavior:"behaviour",color:"colour",tire:{britishWord:"tyre",exceptPreviousWords:["will"]},gray:"grey",grays:"greys",theater:"theatre",amphitheater:"amphitheatre",center:"centre",realize:"realise",realizing:"realising",realization:"realisation",license:"licence",mom:"mum","mom'l":"mum'll",favor:"favour",favors:"favours",favorites:"favourites",analyzed:"analysed",characterized:"characterised",colored:"coloured",colors:"colours",counseling:"counselling",customized:"customised",defense:"defence",offense:"offence",enrollment:"enrolment",flavor:"flavour",flavors:"flavours",flavoring:"flavouring",harbor:"harbour",harbored:"harboured",honor:"honour",honors:"honours",labor:"labour",licensed:"licenced",licenses:"licences",licensing:"licencing",modeling:"modelling",optimization:"optimisation",organization:"organisation",organizations:"organisations",organized:"organised",organizing:"organising",pediatric:"paediatric",personalized:"personalised",practice:"practise",realized:"realised",recognize:"recognise",recognized:"recognised",specialties:"specialities",specializing:"specialising",theaters:"theatres",travelers:"travellers",traveler:"traveller",traveling:"travelling",authorized:"authorised",behaviors:"behaviours",traveled:"travelled",utilizing:"utilising",utilized:"utilised",honored:"honoured",specializes:"specialises",practicing:"practising",signaling:"signalling",analyzing:"analysing",recognizes:"recognises",organizers:"organisers",visualization:"visualisation",standardized:"standardised",favorable:"favourable",analyzer:"analyser",recognizing:"recognising",uncategorized:"uncategorised",categorized:"categorised",vapor:"vapour",synchronization:"synchronisation",synchronized:"synchronised",rumors:"rumours",coloring:"colouring",honorable:"honourable",generalized:"generalised",generalization:"generalisation",mobilize:"mobilise",armor:"armour",armored:"armoured",labeling:"labelling",endeavor:"endeavour",civilized:"civilised",civilization:"civilisation",parlor:"parlour",tranquilize:"tranquilise",tranquillized:"tranquillised",tranquillization:"tranquillisation",catalog:"catalogue",cataloger:"cataloguer",cataloging:"cataloguing",catalogs:"catalogues",cataloged:"catalogued",uncataloged:"uncatalogued",catalogers:"cataloguers",discolored:"discoloured",discolor:"discolour",encyclopedias:"encyclopaedias",endeavored:"endeavoured",endeavors:"endeavours",endeavoring:"endeavouring",judgments:"judgements",judgment:"judgement",paneling:"panelling",defenses:"defences",criticizing:"criticising",mustache:"moustache",emphasized:"emphasised",emphasizes:"emphasises",emphasizing:"emphasising",fetus:"foetus",programs:"programmes",yogurt:"yoghurt",valor:"valour",moisturize:"moisturise",moisturized:"moisturised",moisturizes:"moisturises",moisturizing:"moisturising",favoring:"favouring",marvelous:"marvellous"};async function Uw(e,t){if(e.includes("-"))return(await Promise.all(e.split("-").map(async o=>Uw(o,t)))).join("-");{const o=e.replace(/^[\W]+|[\W]+$/g,"").toLowerCase(),a=V2[o];if(a===void 0)return e;const[s,n]=typeof a=="string"?[a,[]]:[a.britishWord,a.exceptPreviousWords];return r.mode==="quote"&&n.includes(t)?e:e.replace(RegExp(`^(?:([\\W]*)(${o})([\\W]*))$`,"gi"),(l,c,d,u)=>c+(d.charAt(0)===d.charAt(0).toUpperCase()?d===d.toUpperCase()?s.toUpperCase():yi(s):s)+u)}}const K2=[["áàâäåãąą́āą̄ă","a"],["éèêëẽęę́ēę̄ėě","e"],["íìîïĩįį́īį̄ı","i"],["óòôöøõóōǫǫ́ǭő","o"],["úùûüŭũúūůű","u"],["ńň","n"],["çĉčć","c"],["řŕṛ","r"],["ďđḍ","d"],["ťțṭ","t"],["ṃ","m"],["æ","ae"],["œ","oe"],["ẅŵ","w"],["ĝğg̃","g"],["ĥ","h"],["ĵ","j"],["ńṇṅ","n"],["ŝśšșşṣ","s"],["ß","ss"],["żźž","z"],["ÿỹýÿŷ","y"],["łľĺ","l"],["أإآ","ا"],["َ",""],["ُ",""],["ِ",""],["ْ",""],["ً",""],["ٌ",""],["ٍ",""],["ّ",""],["ё","е"],["ά","α"],["έ","ε"],["ί","ι"],["ύ","υ"],["ό","ο"],["ή","η"],["ώ","ω"],["þ","th"]],G2=new Map(K2.flatMap(e=>[...e[0]].map(t=>[t,e[1]])));function j2(e,t){const o=e.toLowerCase(),a=t==null?void 0:t.find(l=>o.startsWith(l[0])),s=G2.get(o[0]),n=s!==void 0?[o[0],s]:void 0;return a!==void 0?a:n}function Q2(e,t){if(!e)return e;const o=e.toUpperCase(),a=[...e].map((l,c)=>l===o[c]),s=[];let n=0;for(let l=0;l<e.length;l++){const c=l+n;if(c>=e.length)break;const d=e.slice(c),u=a.slice(c),f=j2(d,t);if(f!==void 0){for(let p=0;p<f[1].length;p++){const h=f[1][p],g=u[p]??!1;s.push(g?h.toUpperCase():h)}n+=f[0].length-1}else{const p=e[c],h=a[c];s.push(h?p.toUpperCase():p)}}return s.join("")}const Vw=[["are",["aren't"]],["can",["can't"]],["could",["couldn't"]],["did",["didn't"]],["does",["doesn't"]],["do",["don't"]],["had",["hadn't"]],["has",["hasn't"]],["have",["haven't"]],["is",["isn't"]],["it",["it's","it'll"]],["i",["i'm","i'll","i've","i'd"]],["you",["you'll","you're","you've","you'd"]],["that",["that's","that'll","that'd"]],["must",["mustn't","must've"]],["there",["there's","there'll","there'd"]],["he",["he's","he'll","he'd"]],["she",["she's","she'll","she'd"]],["we",["we're","we'll","we'd"]],["they",["they're","they'll","they'd"]],["should",["shouldn't","should've"]],["was",["wasn't"]],["were",["weren't"]],["will",["won't"]],["would",["wouldn't","would've"]],["going",["goin'"]]];async function Y2(e){return Vw.find(t=>e.match(RegExp(`^([\\W]*${t[0]}[\\W]*)$`,"gi")))!==void 0}async function X2(e){const t=Vw.find(a=>e.match(RegExp(`^([\\W]*${a[0]}[\\W]*)$`,"gi")));if(t===void 0)return e;const o=_o(t[1]);return e.replace(RegExp(`^(?:([\\W]*)(${t[0]})([\\W]*))$`,"gi"),(a,s,n,l)=>s+(n.charAt(0)===n.charAt(0).toUpperCase()?Z2(n)?o.toUpperCase():yi(o):o)+l)}function Z2(e){return e==="I"?!1:e===e.toUpperCase()}const Rt=Math.random;function J2(e){return/[?!.؟]/.test(e)}let Ai="";async function eE(e,t,o,a){let s=t;const n=r.language.split("_")[0],l=Ab(e),c=Ha("punctuateWord");if(c)return c.functions.punctuateWord(s);if(n!=="code"&&n!=="georgian"&&(o===0||J2(l))){if(s=yi(s),n==="turkish"&&(s=s.replace(/I/g,"İ")),n==="spanish"){const d=Rt();d>.9?(s="¿"+s,Ai="?"):d>.8&&(s="¡"+s,Ai="!")}}else if(Rt()<.1&&l!=="."&&l!==","&&o!==a-2||o===a-1)if(n==="spanish")(Ai==="?"||Ai==="!")&&(s+=Ai,Ai="");else{const d=Rt();d<=.8?n==="kurdish"?s+=".":n==="nepali"||n==="bangla"||n==="hindi"?s+="।":n==="japanese"||n==="chinese"?s+="。":s+=".":d>.8&&d<.9?n==="french"?s="?":n==="arabic"||n==="persian"||n==="urdu"||n==="kurdish"?s+="؟":n==="greek"?s+=";":n==="japanese"||n==="chinese"?s+="？":s+="?":n==="french"?s="!":n==="japanese"||n==="chinese"?s+="！":s+="!"}else if(Rt()<.01&&l!==","&&l!=="."&&n!=="russian")s=`"${s}"`;else if(Rt()<.011&&l!==","&&l!=="."&&n!=="russian"&&n!=="ukrainian"&&n!=="slovak")s=`'${s}'`;else if(Rt()<.012&&l!==","&&l!==".")if(n==="code"){const d=Rt(),u=["()","{}","[]","<>"];r.language.startsWith("code_javascript")&&u.push("``");const f=Math.floor(d*u.length),p=u[f];s=`${p[0]}${s}${p[1]}`}else n==="japanese"||n==="chinese"?s=`（${s}）`:s=`(${s})`;else if(Rt()<.013&&l!==","&&l!=="."&&l!==";"&&l!=="؛"&&l!==":"&&l!=="；"&&l!=="：")n==="french"?s=":":n==="chinese"?s+="：":s+=":";else if(Rt()<.014&&l!==","&&l!=="."&&e!=="-")s="-";else if(Rt()<.015&&l!==","&&l!=="."&&l!==";"&&l!=="؛"&&l!=="；"&&l!=="：")n==="french"?s=";":n==="greek"?s=".":n==="arabic"||n==="kurdish"?s+="؛":n==="chinese"?s+="；":s+=";";else if(Rt()<.2&&l!==",")n==="arabic"||n==="urdu"||n==="persian"||n==="kurdish"?s+="،":n==="japanese"?s+="、":n==="chinese"?s+="，":s+=",";else if(Rt()<.25&&n==="code"){const d=["{","}","[","]","(",")",";","=","+","%","/"],u=["{","}","[","]","(",")",";","=","+","%","/","/*","*/","//","!=","==","<=",">=","||","&&","<<",">>","%=","&=","*=","++","+=","--","-=","/=","^=","|="];r.language.startsWith("code_c")&&!r.language.startsWith("code_css")||r.language.startsWith("code_arduino")?s=_o(u):r.language.startsWith("code_javascript")?s=_o([...d,"`"]):s=_o(d)}else Rt()<.5&&n==="english"&&await Y2(s)&&(s=await tE(s));return s.includes("	")&&(s=s.replace(/\t/g,""),s+="	"),s.includes(`
`)&&(s=s.replace(/\n/g,""),s+=`
`),s}async function tE(e){return X2(e)}function oE(){const e=Ha("getWordsFrequencyMode");if(e)return e.functions.getWordsFrequencyMode()}async function aE(){const e=[],t=Ha("pullSection");if(t){const o=await t.functions.pullSection(r.language);if(o===!1||o===void 0)throw Yi(t.name),new Error("Failed to pull section");for(const a of o.words){if(e.length>=r.words&&r.mode==="words")break;e.push(a)}}return e}function sE(e,t,o){const a=Ha("getWord");return a&&(e=a.functions.getWord(o,t)),e}function iE(e,t,o){for(const a of yt("alterText"))e=a.functions.alterText(e,t,o);return e}async function nE(e,t){return!r.britishEnglish||!r.language.includes("english")||r.mode==="quote"&&(X==null?void 0:X.britishText)!==void 0&&(X==null?void 0:X.britishText)!==""?e:await Uw(e,t)}function qu(e,t){const o=!t.noLazyMode||r.mode==="custom";return r.lazyMode&&o&&(e=Q2(e,t.additionalAccents)),e}function rE(){const e=za().flatMap(t=>t.properties??[]).find(t=>t.startsWith("wordOrder:"));return(e==null?void 0:e.split(":")[1])??"normal"}function lE(){if(r.mode==="zen")return 0;let e=100;const t=X;if(r.mode==="quote"&&t===null)throw new it("Random quote is null");const o=za().flatMap(a=>a.properties??[]).find(a=>a.startsWith("toPush:"))??"";return r.showAllLines&&(r.mode==="custom"&&(e=xe()),r.mode==="words"&&(e=r.words),r.mode==="quote"&&(e=t.textSplit.length)),r.mode==="words"&&r.words===0&&(e=100),r.mode==="custom"&&(xe()===0||Te()==="time"?e=100:e=xe()>100?100:xe()),o&&(e=+o.split(":")[1]),r.mode==="words"&&r.words!==0&&r.words<e&&(e=r.words),r.mode==="quote"&&t.textSplit.length<e&&(e=t.textSplit.length),r.mode==="custom"&&Te()==="word"&&xe()<e&&xe()!==0&&(e=xe()),e}async function cE(e,t){if(To){if(Qe===null)throw new it("Current wordset is null");return cf(Kw),t==="reverse"?Qe.words.reverse():Qe.words}const o=e.name.startsWith("swiss_german")?"german":e.name;J();const a=await mt.getQuotes(o,r.quoteLength);if(K(),a.length===0)throw ut("words"),new it(`No ${r.language.replace(/_\d*k$/g,"").replace(/_/g," ")} quotes found`);let s;if(r.quoteLength.includes(-2)&&r.quoteLength.length===1){const n=mt.getQuoteById(of);if(n===void 0)throw Xi(),new it(`Quote ${of} does not exist`);s=n}else if(r.quoteLength.includes(-3)){const n=mt.getRandomFavoriteQuote(r.language);if(n===null)throw Xi(),new it("No favorite quotes found");s=n}else{const n=mt.getRandomQuote();if(n===null)throw Xi(),new it("No quotes found for selected quote length");s=n}if(s.language=No(r.language),s.text=s.text.replace(/ +/gm," "),s.text=s.text.replace(/( *(\r\n|\r|\n) *)/g,`
 `),s.text=s.text.replace(/…/g,"..."),s.text=s.text.trim(),s.britishText!==void 0&&s.britishText!==""&&r.britishEnglish?s.textSplit=s.britishText.split(" "):s.textSplit=s.text.split(" "),cf(s),X===null)throw new it("Random quote is null");if(X.textSplit===void 0)throw new it("Random quote textSplit is undefined");return X.textSplit}let Qe=null,As=null,pc=!1,Kw=null;async function dE(e){To||(Df=[]),Kw=X,cf(null),Ws=[],Ds=0,gr=[],As=e;const t={words:[],sectionIndexes:[],hasTab:!1,hasNewline:!1};pc=Lv("pullSection");const o=rE();console.debug("Word order",o);let a=e.words;r.mode==="custom"?a=pl():r.mode==="quote"?a=await cE(e,o):r.mode==="zen"&&(a=[]);const s=r.mode==="custom"&&ml(),n=lE();console.debug(`${s?"Section":"Word"} limit ${n}`),o==="reverse"&&(a=a.reverse());const l=Ha("withWords");if(l?Qe=await l.functions.withWords(a):Qe=await c$(a),console.debug("Wordset",Qe),n===0)return t;let c=!1,d=0;for(;!c;){const f=await Gw(d,n,ln(t.words,-1)??"",ln(t.words,-2)??"");if(t.words.push(f.word),t.sectionIndexes.push(f.sectionIndex),s){const p=Ws.length===0&&Ds>=n,h=t.words.length>=100;(p||h)&&(c=!0)}else t.words.length>=n&&(c=!0);d++}const u=X;if(r.mode==="quote"&&u===null)throw new it("Random quote is null");return t.hasTab=t.words.some(f=>f.includes("	"))||Qe.words.some(f=>f.includes("	"))||r.mode==="quote"&&u.textSplit.some(f=>f.includes("	")),t.hasNewline=t.words.some(f=>f.includes(`
`))||Qe.words.some(f=>f.includes(`
`))||r.mode==="quote"&&u.textSplit.some(f=>f.includes(`
`)),gr=[],t}let Ds=0,Ws=[],gr=[],Df=[];async function Gw(e,t,o,a){if(console.debug("Getting next word",{isRepeated:To,currentWordset:Qe,wordIndex:e,language:As,wordsBound:t,previousWord:o,previousWord2:a}),Qe===null)throw new it("Current wordset is null");if(As===null)throw new it("Current language is null");if(To&&r.mode!=="quote"){const f=Df[e];if(f===void 0){let p=!1;if((r.mode==="time"||r.mode==="custom"&&Te()==="time"||r.mode==="custom"&&Te()==="word"&&e<xe()||r.mode==="custom"&&Te()==="section"&&Ds<xe()||r.mode==="words"&&e<r.words)&&(p=!0),p)console.debug("Repeated word is undefined but random generation is allowed - getting random word");else throw new it("Repeated word is undefined")}else return console.debug("Repeated word: ",f),Ds++,f}const s=oE()??"normal";let n=Qe.randomWord(s);const l=o.replace(/[.?!":\-,]/g,"").toLowerCase(),c=a==null?void 0:a.replace(/[.?!":\-,']/g,"").toLowerCase();if(Ws.length===0){const f=await aE();if(r.mode==="quote")n=Qe.nextWord();else if(r.mode==="custom"&&lc()==="repeat")n=Qe.nextWord();else if(r.mode==="custom"&&lc()==="random"&&(Qe.length<4||$e.mode!==null))n=Qe.randomWord(s);else if(r.mode==="custom"&&lc()==="shuffle")n=Qe.shuffledWord();else if(r.mode==="custom"&&Te()==="section"){n=Qe.randomWord(s);const p=ln(gr,-1),h=ln(gr,-2);let g=0;for(;g<100&&(p===n||h===n);)g++,n=Qe.randomWord(s)}else if(pc)n=f.join(" ");else{let p=0,h=n.split(" ")[0].toLowerCase(),g=qu(h,As);for(;p<100&&(l===g||c===g||r.mode!=="custom"&&!r.punctuation&&n==="I"||r.mode!=="custom"&&!r.punctuation&&!r.language.startsWith("code")&&/[-=_+[\]{};'\\:"|,./<>?]/i.test(n)||r.mode!=="custom"&&!r.numbers&&/[0-9]/i.test(n));)p++,n=Qe.randomWord(s),h=n.split(" ")[0],g=qu(h,As)}n=n.replace(/ +/g," "),n=n.replace(/(^ )|( $)/g,""),n=sE(n,e,Qe),Ws=[...n.split(" ")],gr.push(n),n=Ws.shift(),Ds++}else n=Ws.shift();if(n===void 0)throw new it("Random word is undefined");if(n==="")throw new it("Random word is empty");if(/ /g.test(n))throw new it("Random word contains spaces");const d=Lv("getWord");r.mode!=="custom"&&r.mode!=="quote"&&/[A-Z]/.test(n)&&!r.punctuation&&!r.language.startsWith("german")&&!r.language.startsWith("swiss_german")&&!r.language.startsWith("code")&&!r.language.startsWith("klingon")&&!pc&&!d&&(n=n.toLowerCase()),n=n.replace(/ +/gm," "),n=n.replace(/(^ )|( $)/gm,""),n=qu(n,As),n=await nE(n,l),r.language.startsWith("swiss_german")&&(n=n.replace(/ß/g,"ss")),r.punctuation&&!As.originalPunctuation&&!pc&&(n=await eE(o,n,e,t)),r.numbers&&Rt()<.1&&(n=hv(4),r.language.startsWith("kurdish")?n=Dy(n):r.language.startsWith("nepali")?n=Wy(n):r.language.startsWith("bangla")?n=Nk(n):r.language.startsWith("hindi")&&(n=Uk(n))),n=iE(n,e,t),console.debug("Word:",n);const u={word:n,sectionIndex:Ds};return Df.push(u),u}let jw=0,Qw=0;async function uE(){const e=gi(r,X),[t,o]=(await wb(r.mode,e,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode)).map(V);jw=r.alwaysShowDecimalPlaces?t:Math.round(t),Qw=r.alwaysShowDecimalPlaces?o:Math.floor(o)}function fE(){return jw}function pE(){return Qw}be(e=>{["difficulty","blindMode","stopOnError","paceCaret","minWpm","minWpmCustomSpeed","minAcc","minAccCustom","minBurst","confidenceMode","layout","showAverage","typingSpeedUnit","quickRestart","customPolyglot","alwaysShowDecimalPlaces"].includes(e)&&Nt()});async function Nt(){var s,n;i(".pageTest #testModesNotice").empty(),To&&r.mode!=="quote"&&i(".pageTest #testModesNotice").append('<div class="textButton noInteraction" style="color:var(--error-color);"><i class="fas fa-sync-alt"></i>repeated</div>'),nl||i(".pageTest #testModesNotice").append('<div class="textButton" commands="resultSaving" style="color:var(--error-color);"><i class="fas fa-save"></i>saving disabled</div>'),Mr&&(r.quickRestart==="esc"&&(i(".pageTest #testModesNotice").append('<div class="textButton noInteraction"><i class="fas fa-long-arrow-alt-right"></i>shift + tab to open commandline</div>'),i(".pageTest #testModesNotice").append('<div class="textButton noInteraction"><i class="fas fa-level-down-alt fa-rotate-90"></i>shift + esc to restart</div>')),r.quickRestart==="tab"&&i(".pageTest #testModesNotice").append('<div class="textButton noInteraction"><i class="fas fa-level-down-alt fa-rotate-90"></i>shift + tab to restart</div>')),(Ar||r.funbox.includes("58008"))&&r.quickRestart==="enter"&&i(".pageTest #testModesNotice").append('<div class="textButton noInteraction"><i class="fas fa-level-down-alt fa-rotate-90"></i>shift + enter to restart</div>');const e=Zp(),t=ta();r.mode==="custom"&&e!==""&&t&&i(".pageTest #testModesNotice").append(`<div class="textButton noInteraction"><i class="fas fa-book"></i>${ft(e)} (shift + enter to save progress)</div>`),Wt&&i(".pageTest #testModesNotice").append(`<div class="textButton noInteraction"><i class="fas fa-award"></i>${Wt.display}</div>`),r.mode==="zen"&&i(".pageTest #testModesNotice").append('<div class="textButton noInteraction"><i class="fas fa-poll"></i>shift + enter to finish zen </div>');const o=ho().includes("polyglot");if(r.mode!=="zen"&&!o&&i(".pageTest #testModesNotice").append(`<button class="textButton" commands="languages"><i class="fas fa-globe-americas"></i>${ea(r.language,r.mode==="quote")}</button>`),o){const l=r.customPolyglot.map(c=>ea(c,!0)).join(", ");i(".pageTest #testModesNotice").append(`<button class="textButton" commandId="setCustomPolyglotCustom"><i class="fas fa-globe-americas"></i>${l}</button>`)}if(r.difficulty==="expert"?i(".pageTest #testModesNotice").append('<button class="textButton" commands="difficulty"><i class="fas fa-star-half-alt"></i>expert</button>'):r.difficulty==="master"&&i(".pageTest #testModesNotice").append('<button class="textButton" commands="difficulty"><i class="fas fa-star"></i>master</button>'),r.blindMode&&i(".pageTest #testModesNotice").append('<button class="textButton" commands="blindMode"><i class="fas fa-eye-slash"></i>blind</button>'),r.lazyMode&&i(".pageTest #testModesNotice").append('<button class="textButton" commands="lazyMode"><i class="fas fa-couch"></i>lazy</button>'),r.paceCaret!=="off"||r.repeatedPace&&Xs){const l=N.typingSpeed((O==null?void 0:O.wpm)??0,{showDecimalPlaces:!1,suffix:` ${r.typingSpeedUnit}`});i(".pageTest #testModesNotice").append(`<button class="textButton" commands="paceCaretMode"><i class="fas fa-tachometer-alt"></i>${r.paceCaret==="average"?"average":r.paceCaret==="pb"?"pb":r.paceCaret==="tagPb"?"tag pb":r.paceCaret==="last"?"last":r.paceCaret==="daily"?"daily":"custom"} pace ${l}</button>`)}if(r.showAverage!=="off"){const l=fE(),c=pE();if(B()&&l>0){const d=["speed","both"].includes(r.showAverage)?N.typingSpeed(l,{suffix:` ${r.typingSpeedUnit}`}):"",u=["acc","both"].includes(r.showAverage)?N.accuracy(c,{suffix:" acc"}):"",f=`${d} ${u}`.trim();i(".pageTest #testModesNotice").append(`<button class="textButton" commands="showAverage"><i class="fas fa-chart-bar"></i>avg: ${f}</button>`)}}r.minWpm!=="off"&&i(".pageTest #testModesNotice").append(`<button class="textButton" commands="minWpm"><i class="fas fa-bomb"></i>min ${N.typingSpeed(r.minWpmCustomSpeed,{showDecimalPlaces:!1,suffix:` ${r.typingSpeedUnit}`})}</button>`),r.minAcc!=="off"&&i(".pageTest #testModesNotice").append(`<button class="textButton" commands="minAcc"><i class="fas fa-bomb"></i>min ${r.minAccCustom}% acc</button>`),r.minBurst!=="off"&&i(".pageTest #testModesNotice").append(`<button class="textButton" commands="minBurst"><i class="fas fa-bomb"></i>min ${N.typingSpeed(r.minBurstCustomSpeed,{showDecimalPlaces:!1})} ${r.typingSpeedUnit} burst ${r.minBurst==="flex"?"(flex)":""}</button>`),r.funbox.length>0&&i(".pageTest #testModesNotice").append(`<button class="textButton" commands="funbox"><i class="fas fa-gamepad"></i>${r.funbox.map(l=>l.replace(/_/g," ")).join(", ")}</button>`),r.confidenceMode==="on"&&i(".pageTest #testModesNotice").append('<button class="textButton" commands="confidenceMode"><i class="fas fa-backspace"></i>confidence</button>'),r.confidenceMode==="max"&&i(".pageTest #testModesNotice").append('<button class="textButton" commands="confidenceMode"><i class="fas fa-backspace"></i>max confidence</button>'),r.stopOnError!=="off"&&i(".pageTest #testModesNotice").append(`<button class="textButton" commands="stopOnError"><i class="fas fa-hand-paper"></i>stop on ${r.stopOnError}</button>`),r.layout!=="default"&&i(".pageTest #testModesNotice").append(`<button class="textButton" commands="layouts"><i class="fas fa-keyboard"></i>emulating ${r.layout.replace(/_/g," ")}</button>`),r.oppositeShiftMode!=="off"&&i(".pageTest #testModesNotice").append(`<button class="textButton" commands="oppositeShiftMode"><i class="fas fa-exchange-alt"></i>opposite shift${r.oppositeShiftMode==="keymap"?" (keymap)":""}</button>`);let a="";try{(n=(s=x())==null?void 0:s.tags)==null||n.forEach(l=>{l.active===!0&&(a+=l.display+", ")}),a!==""&&i(".pageTest #testModesNotice").append(`<button class="textButton" commands="tags"><i class="fas fa-tag"></i>${a.substring(0,a.length-2)}</button>`)}catch{}}let mc;async function ri(e,t){try{w1(mc,e,t)}catch{console.log("Analytics unavailable")}}function mE(){if(mc!==void 0){console.warn("Analytics already activated");return}console.log("Activating Analytics");try{mc=j1(),C1(mc,!0),i("body").append(`
    <script
    async
    src="https://www.googletagmanager.com/gtag/js?id=UA-165993088-1"
  ><\/script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());

    gtag("config", "UA-165993088-1");
  <\/script>`)}catch(e){console.error(ie(e,"Failed to activate analytics"))}}const Yw=new Bt({key:"prefersArabicLazyMode",schema:D.boolean(),fallback:!0});function gE(){return Yw.get()}function hE(e){Yw.set(e)}const od=document.querySelector(".pageTest #testInitFailed"),ad=document.querySelector(".pageTest #typingTest"),hr=document.querySelector(".pageTest #testInitFailed .error");function yE(){od&&ad&&(od.classList.remove("hidden"),ad.classList.add("hidden"))}function bE(){hr&&hr.classList.add("hidden")}function vE(e){hr&&(hr.classList.remove("hidden"),hr.innerText=e)}function wE(){od&&ad&&(bE(),od.classList.add("hidden"),ad.classList.remove("hidden"))}let jr="";const CE=document.getElementById("koInputVisual");let ko=null;function Xw(){ko=null}function kE(e){ko!==null&&(ko.uid=e,delete ko.hash,ko.hash=Gy(ko))}function SE(e){if(Qs())return!1;B()?ri("testStarted"):ri("testStartedNoLogin"),Sp(!0),$A(),_f(_.list),bL(),zp(),qp(),Rp(),Fp(),hl(),pm(),lA();for(const t of yt("start"))t.functions.start();try{(r.paceCaret!=="off"||r.repeatedPace&&Xs)&&aA()}catch{}return yM(e),LA(),!0}function z(e={}){var n,l,c;e={...{withSameWordset:!1,practiseMissed:!1,noAnim:!1,nosave:!1},...e},oT();const o=e.noAnim?0:ge(125),a=Tv("no_quit");if(Ee&&a){m("No quit funbox is active. Please finish the test.",0,{important:!0}),(n=e.event)==null||n.preventDefault();return}if(Ot||ti){(l=e.event)==null||l.preventDefault();return}if(Z()==="test"&&!mM()&&(r.mode!=="zen"&&((c=e.event)==null||c.preventDefault()),!au(r.mode,r.words,r.time,Ia(),ta()??!1))){let d="Use your mouse to confirm.";r.quickRestart==="tab"?d="Press shift + tab or use your mouse to confirm.":r.quickRestart==="esc"?d="Press shift + escape or use your mouse to confirm.":r.quickRestart==="enter"&&(d="Press shift + enter or use your mouse to confirm."),m(`Quick restart disabled in long tests. ${d}`,0,{duration:4,important:!0});return}if(Ee&&(To&&(e.withSameWordset=!0),nl)){Fd(),Dd(),Rd();const d=yl(performance.now()),u=nm(d);let f=V(d-u);f<0&&(f=0),am(f),om();const p=V(bl());sm(p,f)}r.mode==="quote"&&X!==null&&r.language.startsWith(X.language)&&r.repeatQuotes==="typing"&&(Ee||jr!=="")&&(e.withSameWordset=!0),$e.mode!==null&&!e.withSameWordset&&!e.practiseMissed&&(m("Reverting to previous settings.",0),$e.punctuation!==null&&cs($e.punctuation),$e.numbers!==null&&Sa($e.numbers),$e.customText&&(_a($e.customText.text),$o($e.customText.limit.mode),Ko($e.customText.limit.value),ei($e.customText.pipeDelimiter)),ut($e.mode),rm()),zr(),pm(),hM(),vL(),Ze.reset(),TM(),LM(),fl(),Sp(!1),bm(),Wd(),zd(),Pd(),Nd(),Sl(),xp(!1),oA(),dw(),k.setKoreanStatus(!1),ur(),gn(),DA(),X$(),Hp(!1),de&&(r.randomTheme!=="off"&&nw(),Kx()),tt()||Td();let s=null;de?s=i("#result"):s=i("#typingTest"),hb(!1),ac(!0),s.stop(!0,!0).animate({opacity:0},o,async()=>{i("#result").addClass("hidden"),i("#typingTest").css("opacity",0).removeClass("hidden"),i("#wordsInput").css({left:0}).val(" "),r.language.startsWith("korean")?(CE.innerText=" ",r.mode!=="zen"?i("#koInputVisualContainer").show():i("#koInputVisualContainer").hide()):i("#koInputVisualContainer").hide(),Do(!1),Z()==="test"&&td(!1),m2(),n2(),await MM(),Wf=0,jr="";let d=!1;if(r.repeatedPace&&e.withSameWordset&&(d=!0),pb(e.withSameWordset??!1),ix(d),wE(),gb(!0),!await Pf()){ac(!1);return}await Xc();for(const p of yt("restart"))p.functions.restart();r.showAverage!=="off"?uE().then(()=>{Nt()}):Nt(),i("#wordsInput").is(":focus")&&Ln(),oi(),i("#typingTest").css("opacity",0).removeClass("hidden").stop(!0,!0).animate({opacity:1},o,()=>{WL(),$L(),IL(),AL(),sM(),zr(),ac(!1)})}),Np()}let On=null,gc,Wf=0;async function Pf(){if(console.debug("Initializing test"),Wf++,Wf>3)return On&&(Mp(On),vE(`${On.name}: ${On.message}`)),yE(),ac(!1),gb(!1),Do(!1),!1;Ow(),bm(),_.reset(),nx(0),k.resetHistory(),k.current="",J();const{data:e,error:t}=await Qt($n(r.language));if(K(),t&&m(ie(t,"Failed to load language"),-1),!e||e.name!==r.language)return un("english"),await Pf();Z()==="test"&&await Kv(),r.mode==="quote"&&r.quoteLength.includes(-3)&&!B()&&Xi();const o=!e.noLazyMode||r.mode==="custom";r.lazyMode&&!o?(gc=!0,m("This language does not support lazy mode.",0,{important:!0}),qc(!1,!0)):gc&&!e.noLazyMode&&qc(!0,!0),!r.lazyMode&&!e.noLazyMode&&(gc=!1),r.mode==="custom"&&console.debug("Custom text",Ia()),console.log("Inializing test",{language:{...e,words:`${e.words.length} words`},customText:{...Ia(),text:`${pl().length} words`},mode:r.mode,mode2:gi(r,null),funbox:r.funbox,currentQuote:X});let a,s,n=!1,l=!1;try{const f=await dE(e);a=f.words,s=f.sectionIndexes,n=f.hasTab,l=f.hasNewline}catch(f){return K(),(f instanceof it||f instanceof Error)&&(On=f),console.error(f),f instanceof it?f.message.length>0&&m(f.message,0,{important:!0}):m(ie(f,"Failed to generate words"),-1,{important:!0}),await Pf()}const c=Bp;let d=!1;for(const f of a)/\d/g.test(f)&&!d&&(d=!0);fL(d),dL(n),uL(l),c!==d&&Yc();for(let f=0;f<a.length;f++)_.push(a[f],s[f]);r.keymapMode==="next"&&r.mode!=="zen"&&Za(ln([..._.getCurrent()],0)),jc(_.getCurrent()),iM(e.rightToLeft??!1),nM(e.ligatures??!1);const u=e.rightToLeft??!1;return lx(u),cx(bs("reverseDirection")),J$(),console.debug("Test initialized with words",a),console.debug("Test initialized with section indexes",s),!0}function Sm(){var e;return r.mode==="words"&&_.length>=r.words&&r.words>0||r.mode==="custom"&&Te()==="word"&&_.length>=xe()&&xe()!==0||r.mode==="quote"&&_.length>=(((e=X==null?void 0:X.textSplit)==null?void 0:e.length)??0)||r.mode==="custom"&&Te()==="section"&&Ds>=xe()&&Ws.length===0&&xe()!==0}async function mh(){if(r.mode==="zen"){Iv();return}let e=100;const t=za().flatMap(s=>s.properties??[]).find(s=>s.startsWith("toPush:"))??"",o=t==null?void 0:t.split(":")[1];if(o!==void 0&&(e=+o-1),_.length-k.getHistory().length>e){console.debug("Not adding word, enough words already");return}if(Sm()){console.debug("Not adding word, all words generated");return}const a=Ha("pullSection");if(a&&_.length-ce<20){const s=await a.functions.pullSection(r.language);if(s===!1){m("Error while getting section. Please try again later",-1),Yi(a.name),z();return}if(s===void 0)return;let n=0;for(let l=0;l<s.words.length;l++){const c=s.words[l];if(n>=r.words&&r.mode==="words")break;n++,_.push(c,l),eh(c)}}try{const s=await Gw(_.length,e,_.get(_.length-1),_.get(_.length-2));_.push(s.word,s.sectionIndex),eh(s.word)}catch(s){Vr("fail","word generation error"),m(ie(s,"Error while getting next word. Please try again later"),-1,{important:!0})}}const Ps={completedEvent:null,canRetry:!1};async function xE(){const{completedEvent:e}=Ps;if(e===null){m("Could not retry saving the result as the result no longer exists.",0,{duration:5,important:!0});return}Ps.canRetry&&(Ps.canRetry=!1,i("#retrySavingResultButton").addClass("hidden"),Yo(!0),m("Retrying to save..."),await Zw(e,!0))}function TE(e,t){var H;let o=V(ke.spacing.first-ai);(o<0||r.mode==="zen")&&(o=0);let a=V(Mn-ke.spacing.last);(a<0||r.mode==="zen")&&(a=0);const s=rr(t),n=ec(t);let l=V(gu(s/n)),c=ke.spacing.array.slice();c.length>0&&(c=c.slice(0,c.length-1));let d=V(gu(rr(c)/ec(c)));(!l||isNaN(l))&&(l=0),(!d||isNaN(d))&&(d=0);const u=[];for(const R of dl)u.push(R.count??0);const f={wpm:ds,burst:t,err:u},p=rr(f.wpm??[]),h=ec(f.wpm??[]),g=V(gu(p/h)),y=isNaN(g)?0:g;let b;if(r.mode==="custom"){const R=Ia();b={textLen:R.text.length,mode:R.mode,pipeDelimiter:R.pipeDelimiter,limit:R.limit}}const C=[];for(const R of((H=x())==null?void 0:H.tags)??[])R.active===!0&&C.push(R._id);const L=parseFloat(e.time.toString()),S=nm(L);let q=r.language;r.mode==="quote"&&(q=No(r.language));const P=(X==null?void 0:X.group)??-1,$={wpm:e.wpm,rawWpm:e.wpmRaw,charStats:[e.correctChars+e.correctSpaces,e.incorrectChars,e.extraChars,e.missedChars],charTotal:e.allChars,acc:e.acc,mode:r.mode,mode2:gi(r,X),quoteLength:P,punctuation:r.punctuation,numbers:r.numbers,lazyMode:r.lazyMode,timestamp:Date.now(),language:q,restartCount:em,incompleteTests:tm,incompleteTestSeconds:Gc<0?0:V(Gc),difficulty:r.difficulty,blindMode:r.blindMode,tags:C,keySpacing:ke.spacing.array,keyDuration:ke.duration.array,keyOverlap:V(fa.total),lastKeyToEnd:a,startToFirstKey:o,consistency:l,wpmConsistency:y,keyConsistency:d,funbox:r.funbox,bailedOut:_s,chartData:f,customText:b,testDuration:L,afkDuration:S,stopOnLetter:r.stopOnError==="letter"};return $.mode!=="custom"&&delete $.customText,$.mode!=="quote"&&delete $.quoteLength,$}async function li(e=!1){var L,S,q,P;if(!Ee)return;$v(!0);const t=performance.now();oh(t),To&&r.mode==="quote"&&pb(!1),await Le(1),k.current.length!==0&&(k.pushHistory(),Ze.pushHistory(),_f(k.getHistory())),r.mode==="zen"&&_f(k.getHistory()),hL(t);const o=(t-ke.spacing.last)/1e3;if((r.mode==="zen"||_s)&&o<7&&oh(ke.spacing.last),hb(!0),Sp(!1),bm(),fl(),Wd(),zd(),Pd(),Nd(),Ln(),pm(),dw(),Nt(),qo.length!==((L=k.getHistory())==null?void 0:L.length)){const $=Ov();Qb($)}(r.mode==="zen"||_s)&&vM();const a=kM();if(a.time%1!==0&&r.mode!=="time"&&bM(),eA(a.wpm),si&&!e){const $=im();Gb($.wpm),jb($.raw),Fd(),Dd(),Rd()}const s=Js.map($=>Math.round($/5*60));if(r.mode!=="time"&&si&&a.time%1>=.5){const $=1/(a.time%1);s[s.length-1]=Math.round(s[s.length-1]*$)}const n=TE(a,s);console.debug("Completed event object",n);function l($){return typeof $=="number"?isNaN($)?1:0:typeof $>"u"?1:typeof $=="object"&&$!==null?Object.values($).reduce((H,R)=>H+l(R),0):0}let c=!1;l(n)>0&&(console.log(n),m("Failed to build result object: One of the fields is undefined or NaN",-1),c=!0);const d=structuredClone(n);let f=ul.slice(-5).every($=>$);_s&&(f=!1);const p=parseInt(d.mode2);let h=!1;const g=(Or-Hr)/1e3;if(r.mode==="time"&&!_s&&(n.testDuration<g-.1||n.testDuration>g+.1)&&n.testDuration<=120?(m("Test invalid - inconsistent test duration",0),console.error("Test duration inconsistent",n.testDuration,g),Dl(),c=!0):e?(m(`Test failed - ${jr}`,0,{duration:1}),c=!0):f?(m("Test invalid - AFK detected",0),c=!0):To?(m("Test invalid - repeated",0),c=!0):d.testDuration<1||r.mode==="time"&&p<15&&p>0||r.mode==="time"&&p===0&&d.testDuration<15||r.mode==="words"&&p<10&&p>0||r.mode==="words"&&p===0&&d.testDuration<15||r.mode==="custom"&&(Te()==="word"||Te()==="section")&&xe()<10||r.mode==="custom"&&Te()==="time"&&xe()<15||r.mode==="zen"&&d.testDuration<15?(m("Test invalid - too short",0),h=!0,c=!0):d.wpm<0||d.wpm>350&&d.mode!=="words"&&d.mode2!=="10"||d.wpm>420&&d.mode==="words"&&d.mode2==="10"?(m("Test invalid - wpm",0),Dl(),c=!0):d.rawWpm<0||d.rawWpm>350&&d.mode!=="words"&&d.mode2!=="10"||d.rawWpm>420&&d.mode==="words"&&d.mode2==="10"?(m("Test invalid - raw",0),Dl(),c=!0):(!((S=x())!=null&&S.lbOptOut)&&(d.acc<75||d.acc>100)||((q=x())==null?void 0:q.lbOptOut)===!0&&(d.acc<50||d.acc>100))&&(m("Test invalid - accuracy",0),Dl(),c=!0),To){const $=d.testDuration,H=d.afkDuration;let R=V($-H);R<0&&(R=0);const Pe=d.acc;am(R),om(),sm(Pe,R)}const y=Zp(),b=ta();if(r.mode==="custom"&&y!==""&&b)if(_s||k.getHistory().length<_.length){const $=(P=k.getHistory())==null?void 0:P.length,H=Dp(y)+$;ff(y,H),m("Long custom text progress saved",1,{duration:5,important:!0});let R=Hc(y,!0);R=R.slice(H),_a(R)}else{ff(y,0);const $=Hc(y,!0);_a($),m("Long custom text completed",1,{duration:5,important:!0})}if(EA(d.testDuration-d.afkDuration),S2(),B()?i(".pageTest #result #reportQuoteButton").removeClass("hidden"):(i(".pageTest #result #rateQuoteButton").addClass("hidden"),i(".pageTest #result #reportQuoteButton").addClass("hidden"),ri("testCompletedNoLogin"),c||(ko=d),c=!0),i("#result .stats .dailyLeaderboard").addClass("hidden"),gM(structuredClone(d)),tt()||Td(),await B2(d,e,jr,f,To,h,X,c),d.chartData!=="toolong"&&delete d.chartData.unsmoothedRaw,d.testDuration>122&&(d.chartData="toolong",d.keySpacing="toolong",d.keyDuration="toolong"),d.wpm===0&&!e&&d.testDuration>=5){const $=Math.round(d.testDuration),H=[`Congratulations. You just wasted ${$} seconds of your life by typing nothing. Be proud of yourself.`,`Bravo! You've managed to waste ${$} seconds and accomplish exactly zero. A true productivity icon.`,`That was ${$} seconds of absolutely legendary idleness. History will remember this moment.`,`Wow, ${$} seconds of typing... nothing. Bold. Mysterious. Completely useless.`,`Thank you for those ${$} seconds of utter nothingness. The keyboard needed the break.`,`A breathtaking display of inactivity. ${$} seconds of absolutely nothing. Powerful.`,`You just gave ${$} seconds of your life to the void. And the void says thanks.`,`Stunning. ${$} seconds of intense... whatever that wasn't. Keep it up, champ.`,`Is it performance art? A protest? Or just ${$} seconds of glorious nothing? We may never know.`,`You typed nothing for ${$} seconds. And in that moment, you became legend.`];Pw(),m(_o(H),0,{customTitle:"Nice",duration:15,important:!0})}if(c){ri("testCompletedInvalid");return}const C=go();if(C){if(Hv(),d.uid=C.uid,E2(X),Yo(!0),!d.bailedOut){const $=qA(d);$!==null&&(d.challenge=$)}d.hash=Gy(d),await Zw(d,!1)}}async function Zw(e,t){var n;if(!nl){m("Result not saved: disabled by user",-1,{duration:3,customTitle:"Notice",important:!0}),Yo(!1);return}if(!tt()){m("Result not saved: offline",-1,{duration:2,customTitle:"Notice",important:!0}),Yo(!1),Ps.canRetry=!0,i("#retrySavingResultButton").removeClass("hidden"),t||(Ps.completedEvent=e);return}const o=await E.results.add({body:{result:e}});if(Yo(!1),o.status!==200){[460,461,463,464,465,466].includes(o.status)||(Ps.canRetry=!0,i("#retrySavingResultButton").removeClass("hidden"),t||(Ps.completedEvent=e)),console.log("Error saving result",e),o.body.message==="Old key data format"&&(o.body.message="Old key data format. Please refresh the page to download the new update. If the problem persists, please contact support."),/"result\..+" is (not allowed|required)/gi.test(o.body.message)&&(o.body.message="Looks like your result data is using an incorrect schema. Please refresh the page to download the new update. If the problem persists, please contact support."),m("Failed to save result: "+o.body.message,-1);return}const a=o.body.data;i("#result .stats .tags .editTagsButton").attr("data-result-id",a.insertedId),i("#result .stats .tags .editTagsButton").removeClass("invisible");const s={};if(a.xp!==void 0){const l=((n=x())==null?void 0:n.xp)??0;$b(l,a.xp,de?a.xpBreakdown:void 0),s.xp=a.xp}if(a.streak!==void 0&&(s.streak=a.streak),a.insertedId!==void 0){const l=structuredClone(e);l._id=a.insertedId,a.isPb!==void 0&&a.isPb&&(l.isPb=!0),s.result=l}ri("testCompleted"),a.isPb!==void 0&&a.isPb?(await xr(e.mode,e.mode2,e.punctuation,e.numbers,e.language,e.difficulty,e.lazyMode,kr(e.funbox))!==void 0&&Pw(),fc("normal"),s.isPb=!0):L2(),a.dailyLeaderboardRank===void 0?i("#result .stats .dailyLeaderboard").addClass("hidden"):(i("#result .stats .dailyLeaderboard").css({maxWidth:"13rem",opacity:0}).removeClass("hidden").animate({opacity:1},ge(500)),i("#result .stats .dailyLeaderboard .bottom").html(N.rank(a.dailyLeaderboardRank,{fallback:""}))),i("#retrySavingResultButton").addClass("hidden"),t&&m("Result saved",1,{important:!0}),Sb(s)}function yr(e){if(jr=e,Fd(),Dd(),Rd(),li(!0),!nl)return;const t=yl(performance.now()),o=nm(t);let a=V(t-o);a<0&&(a=0),am(a),om();const s=V(bl());sm(s,a)}i(".pageTest").on("click","#testModesNotice .textButton.restart",()=>{z()});i(".pageTest").on("click","#testInitFailed button.restart",()=>{z()});i(".pageTest").on("click","#restartTestButton",()=>{ee(),!ti&&(Ee&&r.repeatQuotes==="typing"&&r.mode==="quote"?z({withSameWordset:!0}):z())});i(".pageTest").on("click","#retrySavingResultButton",xE);i(".pageTest").on("click","#nextTestButton",()=>{ee(),z()});i(".pageTest").on("click","#restartTestButtonWithSameWordset",()=>{if(r.mode==="zen"){m("Repeat test disabled in zen mode");return}ee(),z({withSameWordset:!0})});i(".pageTest").on("click","#testConfig .mode .textButton",e=>{if(Ot||i(e.currentTarget).hasClass("active"))return;const t=i(e.currentTarget).attr("mode")??"time";t!==void 0&&ut(t)&&(ee(),z())});i(".pageTest").on("click","#testConfig .wordCount .textButton",e=>{if(Ot)return;const t=i(e.currentTarget).attr("wordCount")??"15";t!=="custom"&&Zs(parseInt(t))&&(ee(),z())});i(".pageTest").on("click","#testConfig .time .textButton",e=>{if(Ot)return;const t=i(e.currentTarget).attr("timeConfig")??"10";t!=="custom"&&Ca(parseInt(t))&&(ee(),z())});i(".pageTest").on("click","#testConfig .quoteLength .textButton",e=>{if(Ot)return;const t=i(e.currentTarget).attr("quoteLength");if(t==="all")Xi()&&(ee(),z());else{const o=parseInt(t??"1");if(o!==-2){let a=[];e.shiftKey?a=[...r.quoteLength,o]:a=[o],Id(a,!1)&&(ee(),z())}}});i(".pageTest").on("click","#testConfig .punctuationMode.textButton",()=>{Ot||cs(!r.punctuation)&&(ee(),z())});i(".pageTest").on("click","#testConfig .numbersMode.textButton",()=>{Ot||Sa(!r.numbers)&&(ee(),z())});i("header").on("click","nav #startTestButton, #logo",()=>{Z()==="test"&&z()});be((e,t,o)=>{Z()==="test"&&(e==="language"&&(t!=null&&t.startsWith("arabic")&&gE()&&qc(!0,!0),z()),e==="difficulty"&&!o&&z(),e==="customLayoutfluid"&&r.funbox.includes("layoutfluid")&&z(),e==="keymapMode"&&t==="next"&&r.mode!=="zen"&&setTimeout(()=>{Za(ln([..._.getCurrent()],0))},0)),e==="lazyMode"&&!o&&(r.language.startsWith("arabic")&&hE(t),t===!1&&(gc=!1))});cA((e,t)=>{e==="fail"&&t!==void 0&&yr(t),e==="finish"&&li()});function zf(){return r.mode==="custom"&&ta()===!0||r.mode==="custom"&&(Te()==="word"||Te()==="section")&&(Hg().value>=5e3||Hg().value===0)||r.mode==="custom"&&Te()==="time"&&(xe()>=3600||xe()===0)||r.mode==="words"&&r.words>=5e3||r.words===0||r.mode==="time"&&(r.time>=3600||r.time===0)||r.mode==="zen"}const LE={title:"Are you sure...",list:[{id:"bailOutNo",display:"Nevermind",available:()=>zf()},{id:"bailOutForSure",display:"Yes, I am sure",exec:()=>{xp(!0),li()},available:()=>zf()}]},$E=[{id:"bailOut",display:"Bail out...",icon:"fa-running",subgroup:LE,visible:!1,available:()=>zf()}],ME=[{id:"addQuoteToFavorite",display:"Add current quote to favorite",icon:"fa-heart",available:()=>{const e=X;return B()&&e!==null&&r.mode==="quote"&&!mt.isQuoteFavorite(e)},exec:async()=>{try{J(),await mt.setQuoteFavorite(X,!0),K(),m("Quote added to favorites",1)}catch(e){K();const t=ie(e,"Failed to add quote to favorites");m(t,-1)}}},{id:"removeQuoteFromFavorite",display:"Remove current quote from favorite",icon:"fa-heart-broken",available:()=>{const e=X;return B()&&e!==null&&r.mode==="quote"&&mt.isQuoteFavorite(e)},exec:async()=>{try{J(),await mt.setQuoteFavorite(X,!1),K(),m("Quote removed from favorites",1)}catch(e){K();const t=ie(e,"Failed to remove quote from favorites");m(t,-1)}}}],AE={title:"Result saving...",list:[{id:"setResultSavingOff",display:"off",alias:"disabled incognito",exec:()=>{Lg(!1),Nt()}},{id:"setResultSavingOn",display:"on",alias:"enabled incognito",exec:()=>{Lg(!0),Nt()}}]},Jw=[{id:"setResultSaving",display:"Result saving...",icon:"fa-save",alias:"results",subgroup:AE}];class xm{constructor(t,o){var s;this.inputElement=t,i(this.inputElement).wrap('<div class="inputAndIndicator"></div>'),this.parentElement=i(this.inputElement).parent(".inputAndIndicator"),this.options=o,this.currentStatus=null;let a='<div class="statusIndicator">';for(const[n,l]of Object.entries(o))a+=`
      <div
        class="indicator level${l.level} hidden"
        data-option-id="${n}"
        
        ${(((s=l.message)==null?void 0:s.length)??0)>27?'data-balloon-length="large"':""}
        data-balloon-pos="left"
        ${l.message??""?`aria-label="${l.message}"`:""}
      >
        <i class="fas fa-fw ${l.icon} ${l.spinIcon?"fa-spin":""}"></i>
      </div>
      `;a+="</div>",this.parentElement.append(a)}hide(){this.parentElement.find(".statusIndicator div").addClass("hidden"),this.currentStatus=null,i(this.inputElement).css("padding-right","0.5em")}show(t,o){this.hide(),this.currentStatus=t;const a=this.parentElement.find(`[data-option-id="${t}"]`);a.removeClass("hidden"),o!==void 0&&o!==""&&(o.length>20?a.attr("data-balloon-length","large"):a.removeAttr("data-balloon-length"),a.attr("aria-label",o)),i(this.inputElement).css("padding-right","2.1em"),this.parentElement.attr("data-indicator-status",t)}get(){return this.currentStatus}}function EE(e,t){return e<=0?t:It(e,t)}function e0(e,t,o){let a=t.isValid!==void 0?EE(t.debounceDelay??250,async(s,n,l)=>{var d;const c=await((d=t.isValid)==null?void 0:d.call(t,l));s.value===n&&(c===!0?e({status:"success"}):typeof c=="object"&&"warning"in c?e({status:"warning",errorMessage:c.warning}):e({status:"failed",errorMessage:c}))}):void 0;return async s=>{var d,u;const n=s.target,l=n.value;let c=l;if(o!==void 0&&(c=o(l)),e({status:"checking"}),t.schema!==void 0){const f=t.schema.safeParse(c);if(!f.success){e({status:"failed",errorMessage:f.error.errors.map(p=>p.message).join(", ")});return}}if(a===void 0){e({status:"success"}),(d=n.oninput)==null||d.call(n,s);return}await a(n,l,c),(u=n.oninput)==null||u.call(n,s)}}function ia(e,t){const o=new xm(e,{success:{icon:"fa-check",level:1},failed:{icon:"fa-times",level:-1},warning:{icon:"fa-exclamation-triangle",level:1},checking:{icon:"fa-circle-notch",spinIcon:!0,level:0}});let a;const n=e0(c=>{var d;a=c.status==="success"||c.status==="warning",c.status==="failed"||c.status==="warning"?o.show(c.status,c.errorMessage):o.show(c.status),(d=t.callback)==null||d.call(t,c)},t,"inputValueConvert"in t?t.inputValueConvert:void 0);e.addEventListener("input",n);const l=e;return l.isValid=()=>a,l.setValue=c=>{e.value=c??"",c===null?(a=void 0,o.hide()):e.dispatchEvent(new Event("input"))},l.triggerValidation=()=>{e.dispatchEvent(new Event("input"))},l}function Pi({input:e,configName:t,validation:o}){if(e===null)throw new Error(`Failed to find input element for ${t}`);const a=o!==void 0&&"inputValueConvert"in o?o.inputValueConvert:void 0;let s="checking";if(o!==void 0){const l=il.shape[t];ia(e,{schema:o.schema?l:void 0,isValid:o.isValid,inputValueConvert:a,callback:c=>{s=c.status}})}const n=()=>{if(e.value===""&&((o==null?void 0:o.resetIfEmpty)??!0)&&(e.value=new String(r[t]).toString(),e.dispatchEvent(new Event("input"))),s==="failed"){const d=i(e.parentElement);d.stop(!0,!0).addClass("hasError").animate({undefined:1},500,()=>{d.removeClass("hasError")});return}const l=(a==null?void 0:a(e.value))??e.value;if(r[t]===l)return;A(t,l,!1)&&m("Saved",1,{duration:1})};e.addEventListener("keypress",l=>{l.key==="Enter"&&n()}),e.addEventListener("focusout",l=>n())}class W{constructor(t,o,a,s){this.configName=t,this.mode=a,this.configFunction=o,this.setCallback=s==null?void 0:s.setCallback,this.updateCallback=s==null?void 0:s.updateCallback,this.validation=s==null?void 0:s.validation;const n=l=>{let c=l;return this.validation!==void 0&&"inputValueConvert"in this.validation&&(c=this.validation.inputValueConvert(l)),c==="true"&&(c=!0),c==="false"&&(c=!1),c};if(this.mode==="select"){const l=document.querySelector(`.pageSettings .section[data-config-name=${this.configName}] select`);if(l===null)throw new Error(`Failed to find select element for ${t}`);if(l.hasAttribute("multiple"))throw new Error("multi-select dropdowns not supported. Config: "+this.configName);l.addEventListener("change",c=>{const d=i(c.target);d.hasClass("disabled")||d.hasClass("no-auto-handle")||this.setValue(d.val())}),this.elements=[l]}else if(this.mode==="button"){const l=document.querySelectorAll(`
        .pageSettings .section[data-config-name=${this.configName}] .buttons button, .pageSettings .section[data-config-name=${this.configName}] .inputs button`);if(l.length===0)throw new Error(`Failed to find a button element for ${t}`);for(const c of l)c.addEventListener("click",d=>{if(c.classList.contains("disabled")||c.classList.contains("no-auto-handle"))return;let u=c.getAttribute("data-config-value");if(u===null||u===""){console.error(`Failed to handle settings button click for ${t}: data-${t} is missing or empty.`),m("Button is missing data property. Please report this.",-1);return}let f=n(u);this.setValue(f)});this.elements=Array.from(l)}else if(this.mode==="input"){const l=document.querySelector(`
        .pageSettings .section[data-config-name=${this.configName}] .inputs .inputAndButton input`);if(l===null)throw new Error(`Failed to find input element for ${t}`);let c;this.validation!==void 0&&(c={schema:this.validation.schema??!1,isValid:this.validation.isValid,inputValueConvert:"inputValueConvert"in this.validation?this.validation.inputValueConvert:void 0}),Pi({input:l,configName:this.configName,validation:c}),this.elements=[l]}else if(this.mode==="range"){const l=document.querySelector(`.pageSettings .section[data-config-name=${this.configName}] input[type=range]`);if(l===null)throw new Error(`Failed to find range element for ${t}`);const c=It(250,d=>{this.setValue(d)});l.addEventListener("input",d=>{if(l.classList.contains("disabled")||l.classList.contains("no-auto-handle"))return;const u=parseFloat(l.value);this.updateUI(u),c(u)}),this.elements=[l]}else this.elements=[];if(this.elements.length===0||this.elements===void 0)throw new Error(`Failed to find elements for ${t} with mode ${a}`);this.updateUI()}setValue(t){if(r[this.configName]===t)return!1;const o=this.configFunction(t);return this.updateUI(),this.setCallback&&this.setCallback(),o}updateUI(t){var a,s;const o=t??r[this.configName];if(this.mode==="select"){const n=(a=this.elements)==null?void 0:a[0];if(!n)return;const l=n.slim;if(l!==void 0){const c=l.getSelected()[0]??null;o!==c&&l.setSelected(o)}else n.value!==o&&(n.value=o)}else if(this.mode==="button")for(const n of this.elements){let c=n.getAttribute("data-config-value");c==="true"&&(c=!0),c==="false"&&(c=!1),c!==o?n.classList.remove("active"):n.classList.add("active")}else if(this.mode==="range"){const n=(s=this.elements)==null?void 0:s[0],l=document.querySelector(`.pageSettings .section[data-config-name='${this.configName}'] .value`);if(n==null||l===null)return;n.value=o,l.textContent=`${o.toFixed(1)}`}this.updateCallback&&this.updateCallback()}}const t0=new Bt({key:"activeTags",schema:D.array(Uy),fallback:[]});function _n(){var t,o;const e=[];(o=(t=x())==null?void 0:t.tags)==null||o.forEach(a=>{a.active===!0&&e.push(a._id)}),t0.set(e)}function _E(e=!1){var o;const t=x();t&&(t.tags=(o=t.tags)==null?void 0:o.map(a=>(a.active=!1,a)),kt(t),Nt(),e||_n())}function IE(e,t,o=!1){var s;const a=x();a&&(a.tags=(s=a.tags)==null?void 0:s.map(n=>(n._id===e&&(n.active=t),n)),kt(a),Nt(),o||_n())}function Tm(e,t=!1){var o,a;(a=(o=x())==null?void 0:o.tags)==null||a.forEach(s=>{s._id===e&&(s.active===void 0?s.active=!0:s.active=!s.active)}),Nt(),t||_n()}function BE(){const e=t0.get();for(const t of e)Tm(t,!0);_n()}sa(e=>{e.type==="snapshotUpdated"&&e.data.isInitial&&BE()});async function o0(e){var a,s;const t=x();if(!t)return;const o=(a=t.presets)==null?void 0:a.find(n=>n._id===e);if(o!==void 0){if(gh(o)?await fn({...structuredClone(r),...o.config}):await fn(o.config),(!gh(o)||(s=o.settingGroups)!=null&&s.includes("behavior"))&&(_E(!0),o.config.tags)){for(const n of o.config.tags)IE(n,!0,!1);_n()}z(),m("Preset applied",1,{duration:2}),xn()}}function gh(e){return e.settingGroups!==void 0&&e.settingGroups!==null}async function qE(e){var a;const t=x();if(!t)return;const o=(a=t.presets)==null?void 0:a.find(s=>s._id===e);if(o===void 0){m("Preset not found",0);return}return o}function a0(){var t;let e=r.theme;r.randomTheme!=="off"&&r.randomTheme!=="custom"&&Ve!==null&&(e=Ve),document.querySelectorAll(".pageSettings .section.themes .theme").forEach(o=>{o.classList.remove("active")}),(t=document.querySelector(`.pageSettings .section.themes .theme[theme='${e}']`))==null||t.classList.add("active")}function bn(e,t,o=!1,a=!1){if(o){const d=e.find("input.color").attr("id");d===void 0&&console.error("Could not find color ID!"),!a&&d!==void 0&&document.documentElement.style.setProperty(d,t);const u=e.find("label");u.val(t),u.attr("value",t),u.attr("for")!=="--bg-color"&&u.css("background-color",t),e.find("input.input").val(t),e.find("input.color").attr("value",t),e.find("input.color").val(t);return}const s=[{rule:/\b[0-9]{1,3},\s?[0-9]{1,3},\s?[0-9]{1,3}\s*\b/,start:"rgb(",end:")"},{rule:/\b[A-Z, a-z, 0-9]{6}\b/,start:"#",end:""},{rule:/\b[0-9]{1,3},\s?[0-9]{1,3}%,\s?[0-9]{1,3}%?\s*\b/,start:"hsl(",end:")"}];t=t.replace("°","");for(const d of s)if(t.match(d.rule)){t=d.start+t+d.end;break}i(".colorConverter").css("color",t);const n=JL(i(".colorConverter").css("color"));if(n===void 0)return;t=n;const l=e.find("input.color").attr("id");l===void 0&&console.error("Could not find color ID!"),!a&&l!==void 0&&document.documentElement.style.setProperty(l,t);const c=e.find("label");c.val(t),c.attr("value",t),c.attr("for")!=="--bg-color"&&c.css("background-color",t),e.find("input.input").val(t),e.find("input.color").attr("value",t),e.find("input.color").val(t)}async function s0(){const e=document.querySelector(".pageSettings .section.themes .favThemes.buttons"),t=document.querySelector(".pageSettings .section.themes .allThemes.buttons");if(e===null||t===null){const l="Failed to fill preset theme buttons: favThemes or allThemes element not found";m(l,-1),Mp(new Error(l)),console.error(l,{favThemesEl:e,themesEl:t});return}e.innerHTML="",t.innerHTML="";let o="",a="",s=r.theme;r.randomTheme!=="off"&&r.randomTheme!=="custom"&&Ve!==null&&(s=Ve);const n=QM;if(r.favThemes.length>0){e.style.marginBottom="1rem";for(const l of n)if(r.favThemes.includes(l.name)){const c=s===l.name?"active":"";o+=`<div class="theme button ${c}" theme='${l.name}' style="background: ${l.bgColor}; color: ${l.mainColor};outline: 0 solid ${l.mainColor};">
          <div class="favButton active"><i class="fas fa-star"></i></div>
          <div class="text">${l.name.replace(/_/g," ")}</div>
          <div class="themeBubbles" style="background: ${l.bgColor};outline: 0.25rem solid ${l.bgColor};">
            <div class="themeBubble" style="background: ${l.mainColor}"></div>
            <div class="themeBubble" style="background: ${l.subColor}"></div>
            <div class="themeBubble" style="background: ${l.textColor}"></div>
          </div>
          </div>
          `}e.innerHTML=o}else e.style.marginBottom="0";for(const l of n){if(r.favThemes.includes(l.name))continue;const c=s===l.name?"active":"";a+=`<div class="theme button ${c}" theme='${l.name}' style="background: ${l.bgColor}; color: ${l.mainColor};outline: 0 solid ${l.mainColor};">
      <div class="favButton"><i class="far fa-star"></i></div>
      <div class="text">${l.name.replace(/_/g," ")}</div>
      <div class="themeBubbles" style="background: ${l.bgColor};outline: 0.25rem solid ${l.bgColor};">
        <div class="themeBubble" style="background: ${l.mainColor}"></div>
        <div class="themeBubble" style="background: ${l.subColor}"></div>
        <div class="themeBubble" style="background: ${l.textColor}"></div>
      </div>
      </div>
      `}t.innerHTML=a}async function su(){var s;const e=i(".pageSettings .section.themes .allCustomThemes.buttons").empty(),t=i(".pageSettings .section.themes .addCustomThemeButton"),o=i(".pageSettings .section.themes .customThemeEdit #saveCustomThemeButton");if(!B()){o.text("save"),t.addClass("hidden"),e.css("margin-bottom","0");return}o.text("save as new"),t.removeClass("hidden");const a=((s=x())==null?void 0:s.customThemes)??[];a.length===0?e.css("margin-bottom","0"):e.css("margin-bottom","1rem");for(const n of a){const l=n.colors[0],c=n.colors[1];e.append(`<div class="customTheme button" customThemeId='${n._id}' 
      style="color:${c};background:${l}">
      <div class="editButton"><i class="fas fa-pen"></i></div>
      <div class="text">${n.name.replace(/_/g," ")}</div>
      <div class="delButton"><i class="fas fa-trash fa-fw"></i></div>
      </div>`)}}function FE(e=!1){i(".pageSettings .section.themes .tabContainer .customTheme .colorPicker").each((t,o)=>{const a=r.customThemeColors[Ba.indexOf(i(o).find("input.color").attr("id"))];bn(i(o),a,!1,e)})}function RE(e){if(r.favThemes.includes(e))Bc(r.favThemes.filter(t=>t!==e));else{const t=r.favThemes;t.push(e),Bc(t)}xn()}function DE(){const e=[];for(const t of Ba)e.push(i(`.pageSettings .customTheme .customThemeEdit #${t}[type='color']`).attr("value"));dn(e),m("Custom theme saved",1)}function WE(){i(".pageSettings .section.themes .tabs button").removeClass("active"),i(`.pageSettings .section.themes .tabs button[data-tab="${r.customTheme?"custom":"preset"}"]`).addClass("active"),r.customTheme?nn(i('.pageSettings [tabContent="preset"]'),i('.pageSettings [tabContent="custom"]'),250):nn(i('.pageSettings [tabContent="custom"]'),i('.pageSettings [tabContent="preset"]'),250)}async function PE(){await s0(),a0()}i(".pageSettings .section.themes .tabs button").on("click",e=>{i(".pageSettings .section.themes .tabs button").removeClass("active");const t=i(e.currentTarget);t.addClass("active"),t.attr("data-tab")==="preset"?xa(!1):xa(!0)});i(".pageSettings").on("click"," .section.themes .customTheme.button",e=>{var a,s;if(i(e.target).hasClass("delButton")||i(e.target).hasClass("editButton"))return;const t=i(e.currentTarget).attr("customThemeId")??"",o=(s=(a=x())==null?void 0:a.customThemes)==null?void 0:s.find(n=>n._id===t);if(o===void 0){console.error("Could not find custom theme in snapshot for id ",t);return}dn(o.colors)});i(".pageSettings").on("click",".section.themes .theme .favButton",e=>{const t=i(e.currentTarget).parents(".theme.button").attr("theme");t!==void 0?RE(t):console.error("Could not find the theme attribute attached to the button clicked!")});i(".pageSettings").on("click",".section.themes .theme.button",e=>{const t=i(e.currentTarget).attr("theme");!i(e.target).hasClass("favButton")&&t!==void 0&&_p(t)});i(".pageSettings .section.themes .tabContainer .customTheme input[type=color]").on("input",e=>{const t=i(e.currentTarget).attr("id"),o=i(e.currentTarget).val();bn(i(".colorPicker #"+t).parent(),o,!0)});i(".pageSettings .section.themes .tabContainer .customTheme input[type=color]").on("change",e=>{const t=i(e.currentTarget).attr("id"),o=i(e.currentTarget).val();bn(i(".colorPicker #"+t).parent(),o)});i(".pageSettings .section.themes .tabContainer .customTheme input.input").on("blur",e=>{if(e.target.id==="name")return;const t=i(e.currentTarget).attr("id"),o=i(e.currentTarget).val();bn(i(".colorPicker #"+t).parent(),o)}).on("keypress",function(e){if(e.target.id!=="name"&&e.code==="Enter"){i(this).attr("disabled","disabled");const t=i(e.currentTarget).attr("id"),o=i(e.currentTarget).val();bn(i(".colorPicker #"+t).parent(),o),i(this).removeAttr("disabled")}});i(".pageSettings #loadCustomColorsFromPreset").on("click",async()=>{await aw(r.theme),Ba.forEach(t=>{document.documentElement.style.setProperty(t,"")}),tw();const e=await hs();Ba.forEach(t=>{let o;t==="--bg-color"?o=e.bg:t==="--main-color"?o=e.main:t==="--sub-color"?o=e.sub:t==="--sub-alt-color"?o=e.subAlt:t==="--caret-color"?o=e.caret:t==="--text-color"?o=e.text:t==="--error-color"?o=e.error:t==="--error-extra-color"?o=e.errorExtra:t==="--colorful-error-color"?o=e.colorfulError:t==="--colorful-error-extra-color"&&(o=e.colorfulErrorExtra),bn(i(".colorPicker #"+t).parent(),o)})});i(".pageSettings #saveCustomThemeButton").on("click",async()=>{if(DE(),B()){const e={name:"custom",colors:r.customThemeColors};J(),await wx(e),K()}su()});be(e=>{e==="theme"&&Z()==="settings"&&a0(),e==="favThemes"&&Z()==="settings"&&s0()});const ba={mode:"import",value:""};function i0(e,t){ba.mode=e,ba.value="",Hf.show({focusFirstInput:"focusAndSelect",beforeAnimation:async o=>{var a,s,n,l;o.querySelector("input").value=ba.value,ba.mode==="export"?((a=o.querySelector("button"))==null||a.classList.add("hidden"),(s=o.querySelector("input"))==null||s.setAttribute("readonly","true")):ba.mode==="import"&&((n=o.querySelector("button"))==null||n.classList.remove("hidden"),(l=o.querySelector("input"))==null||l.removeAttribute("readonly"))}})}const Hf=new re({dialogId:"importExportSettingsModal",setup:async e=>{var t;(t=e.querySelector("input"))==null||t.addEventListener("input",o=>{ba.value=o.target.value}),e==null||e.addEventListener("submit",async o=>{if(o.preventDefault(),ba.mode==="import"){if(ba.value===""){Hf.hide();return}await Wb(ba.value),Hf.hide()}})}});async function jn(){}class Oa{constructor(t){this.id=t.id,this.display=t.display,this.element=t.element,this.pathname=t.path,this.loadingOptions=t.loadingOptions,this.beforeHide=t.beforeHide??jn,this.afterHide=t.afterHide??jn,this._beforeShow=t.beforeShow??jn,this.afterShow=t.afterShow??jn}async beforeShow(t){var o;await((o=this._beforeShow)==null?void 0:o.call(this,t))}}class Lm extends Oa{constructor(t){super(t),this.urlSchema=t.urlParamsSchema,this._beforeShow=t.beforeShow??jn}readUrlParams(){const t=new URLSearchParams(window.location.search),o=QS({schema:this.urlSchema,input:t});if(o.success)return o.data}setUrlParams(t){const o=YS({schema:this.urlSchema,data:t}),a=`${window.location.pathname}?${o.toString()}`;window.history.replaceState({},"",a)}async beforeShow(t){var a;const o=this.readUrlParams();await((a=this._beforeShow)==null?void 0:a.call(this,{...t,urlParams:o}))}}const sd=sS._def.values,va={Roboto_Mono:{fileName:"RobotoMono-Regular.woff2"},Noto_Naskh_Arabic:{fileName:"NotoNaskhArabic-Regular.woff2"},Source_Code_Pro:{fileName:"SourceCodePro-Regular.woff2"},IBM_Plex_Sans:{fileName:"IBMPlexSans-SemiBold.woff2",weight:600},Inconsolata:{fileName:"Inconsolata-Regular.woff2"},Fira_Code:{fileName:"FiraCode-Regular.woff2"},JetBrains_Mono:{fileName:"JetBrainsMono-Regular.woff2"},Roboto:{fileName:"Roboto-Regular.woff2"},Montserrat:{fileName:"Montserrat-Regular.woff2"},Titillium_Web:{fileName:"TitilliumWeb-Regular.woff2"},Lexend_Deca:{fileName:"LexendDeca-Regular.woff2"},Comic_Sans_MS:{display:"Helvetica",systemFont:!0},Oxygen:{fileName:"Oxygen-Regular.woff2"},Nunito:{fileName:"Nunito-Bold.woff2",weight:700},Itim:{fileName:"Itim-Regular.woff2"},Courier:{systemFont:!0},Comfortaa:{fileName:"Comfortaa-Regular.woff2"},Coming_Soon:{fileName:"ComingSoon-Regular.woff2"},Atkinson_Hyperlegible:{fileName:"AtkinsonHyperlegible-Regular.woff2"},Lato:{fileName:"Lato-Regular.woff2"},Lalezar:{fileName:"Lalezar-Regular.woff2"},Boon:{display:"Boon (ไทย)",fileName:"Boon-Regular.woff2"},Open_Dyslexic:{fileName:"OpenDyslexic-Regular.woff2"},Ubuntu:{fileName:"Ubuntu-Regular.woff2"},Ubuntu_Mono:{fileName:"UbuntuMono-Regular.woff2"},Georgia:{systemFont:!0},Cascadia_Mono:{fileName:"CascadiaMono-Regular.woff2"},IBM_Plex_Mono:{fileName:"IBMPlexMono-Regular.woff2"},Overpass_Mono:{fileName:"OverpassMono-Regular.woff2"},Hack:{fileName:"Hack-Regular.woff2"},CommitMono:{fileName:"CommitMono-Regular.woff2"},Mononoki:{fileName:"Mononoki-Regular.woff2"},Parkinsans:{fileName:"Parkinsans-Regular.woff2"},Geist:{fileName:"Geist-Medium.woff2"},Sarabun:{fileName:"Sarabun-Bold.woff2"},Kanit:{fileName:"Kanit-Regular.woff2"},Geist_Mono:{fileName:"GeistMono-Medium.woff2"},Iosevka:{fileName:"Iosevka-Regular.woff2"},Proto:{display:"0xProto",fileName:"0xProto-Regular.woff2"}},co=document.querySelector(".pageSettings .section[data-config-name='customBackgroundSize']"),pa=co==null?void 0:co.querySelector(".usingLocalImage"),Ei=co==null?void 0:co.querySelector(".separator"),ma=co==null?void 0:co.querySelector(".uploadContainer"),_i=co==null?void 0:co.querySelector(".inputAndButton");async function zE(e){return new Promise((t,o)=>{const a=new FileReader;a.onload=()=>t(a.result),a.onerror=o,a.readAsDataURL(e)})}async function Qr(){await et.hasFile("LocalBackgroundFile")?(pa==null||pa.classList.remove("hidden"),Ei==null||Ei.classList.add("hidden"),ma==null||ma.classList.add("hidden"),_i==null||_i.classList.add("hidden")):(pa==null||pa.classList.add("hidden"),Ei==null||Ei.classList.remove("hidden"),ma==null||ma.classList.remove("hidden"),_i==null||_i.classList.remove("hidden"))}var py;(py=pa==null?void 0:pa.querySelector("button"))==null||py.addEventListener("click",async()=>{await et.deleteFile("LocalBackgroundFile"),await Qr(),await yn()});var my;(my=ma==null?void 0:ma.querySelector("input[type='file']"))==null||my.addEventListener("change",async e=>{var s;const t=e.target,o=(s=t.files)==null?void 0:s[0];if(!o)return;if(!o.type.match(/image\/(jpeg|jpg|png|gif|webp)/)){m("Unsupported image format",0),t.value="";return}const a=await zE(o);await et.storeFile("LocalBackgroundFile",a),await Qr(),await yn(),t.value=""});const uo=document.querySelector(".pageSettings .section[data-config-name='fontFamily']"),ga=uo==null?void 0:uo.querySelector(".usingLocalFont"),Ii=uo==null?void 0:uo.querySelector(".separator"),ha=uo==null?void 0:uo.querySelector(".uploadContainer"),Bi=uo==null?void 0:uo.querySelector(".buttons");async function HE(e){return new Promise((t,o)=>{const a=new FileReader;a.onload=()=>t(a.result),a.onerror=o,a.readAsDataURL(e)})}async function Yr(){await et.hasFile("LocalFontFamilyFile")?(ga==null||ga.classList.remove("hidden"),Ii==null||Ii.classList.add("hidden"),ha==null||ha.classList.add("hidden"),Bi==null||Bi.classList.add("hidden")):(ga==null||ga.classList.add("hidden"),Ii==null||Ii.classList.remove("hidden"),ha==null||ha.classList.remove("hidden"),Bi==null||Bi.classList.remove("hidden"))}var gy;(gy=ga==null?void 0:ga.querySelector("button"))==null||gy.addEventListener("click",async()=>{await et.deleteFile("LocalFontFamilyFile"),await Yr(),await Ur()});var hy;(hy=ha==null?void 0:ha.querySelector("input[type='file']"))==null||hy.addEventListener("change",async e=>{var s;const t=e.target,o=(s=t.files)==null?void 0:s[0];if(!o)return;if(!o.type.match(/font\/(woff|woff2|ttf|otf)/)&&!o.name.match(/\.(woff|woff2|ttf|otf)$/i)){m("Unsupported font format, must be woff, woff2, ttf or otf.",0),t.value="";return}const a=await HE(o);await et.storeFile("LocalFontFamilyFile",a),await Yr(),await Ur(),t.value=""});let hh=!1,hc,yc;const I={},OE=iS.or(D.enum(["resetSettings","updateCookiePreferences","importexportSettings","theme","presets","tags"])),NE=D.object({highlight:OE}).partial();async function UE(){I.smoothCaret=new W("smoothCaret",zT,"button"),I.codeUnindentOnBackspace=new W("codeUnindentOnBackspace",HT,"button"),I.difficulty=new W("difficulty",ua,"button"),I.quickRestart=new W("quickRestart",UT,"button"),I.showAverage=new W("showAverage",AT,"button"),I.keymapMode=new W("keymapMode",wo,"button",{updateCallback:()=>{r.keymapMode==="off"?(i(".pageSettings .section[data-config-name='keymapStyle']").addClass("hidden"),i(".pageSettings .section[data-config-name='keymapLayout']").addClass("hidden"),i(".pageSettings .section[data-config-name='keymapLegendStyle']").addClass("hidden"),i(".pageSettings .section[data-config-name='keymapShowTopRow']").addClass("hidden"),i(".pageSettings .section[data-config-name='keymapSize']").addClass("hidden")):(i(".pageSettings .section[data-config-name='keymapStyle']").removeClass("hidden"),i(".pageSettings .section[data-config-name='keymapLayout']").removeClass("hidden"),i(".pageSettings .section[data-config-name='keymapLegendStyle']").removeClass("hidden"),i(".pageSettings .section[data-config-name='keymapShowTopRow']").removeClass("hidden"),i(".pageSettings .section[data-config-name='keymapSize']").removeClass("hidden"))}}),I.keymapStyle=new W("keymapStyle",JT,"button"),I.keymapLayout=new W("keymapLayout",Fs,"select"),I.keymapLegendStyle=new W("keymapLegendStyle",ZT,"button"),I.keymapShowTopRow=new W("keymapShowTopRow",eL,"button"),I.keymapSize=new W("keymapSize",Bd,"range"),I.showKeyTips=new W("showKeyTips",PT,"button"),I.freedomMode=new W("freedomMode",VT,"button",{setCallback:()=>{var e;(e=I.confidenceMode)==null||e.updateUI()}}),I.strictSpace=new W("strictSpace",TT,"button"),I.oppositeShiftMode=new W("oppositeShiftMode",LT,"button"),I.confidenceMode=new W("confidenceMode",KT,"button",{setCallback:()=>{var e,t;(e=I.freedomMode)==null||e.updateUI(),(t=I.stopOnError)==null||t.updateUI()}}),I.indicateTypos=new W("indicateTypos",GT,"button"),I.hideExtraLetters=new W("hideExtraLetters",IT,"button"),I.blindMode=new W("blindMode",cT,"button"),I.quickEnd=new W("quickEnd",wT,"button"),I.repeatQuotes=new W("repeatQuotes",kT,"button"),I.ads=new W("ads",CT,"button"),I.alwaysShowWordsHistory=new W("alwaysShowWordsHistory",yT,"button"),I.britishEnglish=new W("britishEnglish",XT,"button"),I.singleListCommandLine=new W("singleListCommandLine",bT,"button"),I.capsLockWarning=new W("capsLockWarning",vT,"button"),I.flipTestColors=new W("flipTestColors",ST,"button"),I.showOutOfFocusWarning=new W("showOutOfFocusWarning",fT,"button"),I.colorfulMode=new W("colorfulMode",xT,"button"),I.startGraphsAtZero=new W("startGraphsAtZero",OT,"button"),I.autoSwitchTheme=new W("autoSwitchTheme",Rb,"button"),I.randomTheme=new W("randomTheme",YT,"button"),I.stopOnError=new W("stopOnError",qb,"button",{setCallback:()=>{var e;(e=I.confidenceMode)==null||e.updateUI()}}),I.soundVolume=new W("soundVolume",rT,"range"),I.playTimeWarning=new W("playTimeWarning",lT,"button",{setCallback:()=>{r.playTimeWarning!=="off"&&Jc()}}),I.playSoundOnError=new W("playSoundOnError",iT,"button",{setCallback:()=>{r.playSoundOnError!=="off"&&Cl()}}),I.playSoundOnClick=new W("playSoundOnClick",nT,"button",{setCallback:()=>{r.playSoundOnClick!=="off"&&Wo("KeyQ")}}),I.showAllLines=new W("showAllLines",lf,"button"),I.paceCaret=new W("paceCaret",pT,"button"),I.repeatedPace=new W("repeatedPace",mT,"button"),I.minWpm=new W("minWpm",gT,"button"),I.minAcc=new W("minAcc",hT,"button"),I.minBurst=new W("minBurst",rc,"button"),I.smoothLineScroll=new W("smoothLineScroll",NT,"button"),I.lazyMode=new W("lazyMode",qc,"button"),I.layout=new W("layout",Ya,"select"),I.language=new W("language",un,"select"),I.fontSize=new W("fontSize",tL,"input",{validation:{schema:!0,inputValueConvert:Number}}),I.maxLineWidth=new W("maxLineWidth",oL,"input",{validation:{schema:!0,inputValueConvert:Number}}),I.caretStyle=new W("caretStyle",$T,"button"),I.paceCaretStyle=new W("paceCaretStyle",MT,"button"),I.timerStyle=new W("timerStyle",BT,"button"),I.liveSpeedStyle=new W("liveSpeedStyle",qT,"button"),I.liveAccStyle=new W("liveAccStyle",FT,"button"),I.liveBurstStyle=new W("liveBurstStyle",RT,"button"),I.highlightMode=new W("highlightMode",Is,"button"),I.tapeMode=new W("tapeMode",ET,"button"),I.tapeMargin=new W("tapeMargin",_T,"input",{validation:{schema:!0,inputValueConvert:Number}}),I.timerOpacity=new W("timerOpacity",WT,"button"),I.timerColor=new W("timerColor",DT,"button"),I.fontFamily=new W("fontFamily",Fb,"button",{updateCallback:()=>{const e=i(".pageSettings .section[data-config-name='fontFamily'] .buttons button[data-config-value='custom']");i(".pageSettings .section[data-config-name='fontFamily'] .buttons .active").length===0?(e.addClass("active"),e.text(`Custom (${r.fontFamily.replace(/_/g," ")})`)):e.text("Custom")}}),I.alwaysShowDecimalPlaces=new W("alwaysShowDecimalPlaces",dT,"button"),I.typingSpeedUnit=new W("typingSpeedUnit",uT,"button"),I.customBackgroundSize=new W("customBackgroundSize",Db,"button")}async function VE(){if(hh)return;new st({select:".pageSettings .section[data-config-name='language'] select",data:yh(s=>s===r.language),settings:{searchPlaceholder:"search"}});const e=s=>({value:s,text:s.replace(/_/g," ")});new st({select:".pageSettings .section[data-config-name='layout'] select",data:[{text:"off",value:"default"},...sd.filter(s=>s!=="korean").map(e)]}),new st({select:".pageSettings .section[data-config-name='keymapLayout'] select",data:[{text:"emulator sync",value:"overrideSync"},...sd.map(e)]}),new st({select:".pageSettings .section[data-config-name='autoSwitchThemeInputs'] select.light",data:bh(s=>s.name===r.themeLight),events:{afterChange:s=>{var n;jT((n=s[0])==null?void 0:n.value)}}}),new st({select:".pageSettings .section[data-config-name='autoSwitchThemeInputs'] select.dark",data:bh(s=>s.name===r.themeDark),events:{afterChange:s=>{var n;QT((n=s[0])==null?void 0:n.value)}}});const t=document.querySelector(".pageSettings .section[data-config-name='funbox'] .buttons");let o="";for(const s of bp())s.name==="mirror"?o+=`<button class="funbox" data-funbox-name="mirror" data-config-value='${s.name}' aria-label="${s.description}" data-balloon-pos="up" data-balloon-length="fit" style="transform:scaleX(-1);">${s.name.replace(/_/g," ")}</button>`:s.name==="upside_down"?o+=`<button class="funbox" data-funbox-name="upside_down" data-config-value='${s.name}' aria-label="${s.description}" data-balloon-pos="up" data-balloon-length="fit" style="transform:scaleX(-1) scaleY(-1); z-index:1;">${s.name.replace(/_/g," ")}</button>`:s.name==="underscore_spaces"?o+=`<button class="funbox" data-funbox-name="underscore_spaces" data-config-value='${s.name}' aria-label="${s.description}" data-balloon-pos="up" data-balloon-length="fit">${s.name}</button>`:o+=`<button class="funbox" data-funbox-name="${s.name}" data-config-value='${s.name}' aria-label="${s.description}" data-balloon-pos="up" data-balloon-length="fit">${s.name.replace(/_/g," ")}</button>`;t.innerHTML=o;const a=document.querySelector(".pageSettings .section[data-config-name='fontFamily'] .buttons");if(a.innerHTML===""){let s="";for(const n of lt(va).sort((l,c)=>(va[l].display??l.replace(/_/g," ")).localeCompare(va[c].display??c.replace(/_/g," ")))){const l=va[n];let c=n.replace(/_/g," ");l.systemFont||(c+=" Preview");const d=r.fontFamily===n?" active":"",u=l.display??n.replace(/_/g," ");s+=`<button class="${d}" style="font-family:'${c}'" data-config-value="${n}">${u}</button>`}s+='<button class="no-auto-handle" data-config-value="custom"">Custom</button>',a.innerHTML=s}hc=new st({select:".pageSettings .section[data-config-name='customLayoutfluid'] select",settings:{keepOrder:!0,minSelected:2},events:{afterChange:s=>{const n=s.map(l=>l.value);Cr(n,r.customLayoutfluid)||sL(n)}}}),yc=new st({select:".pageSettings .section[data-config-name='customPolyglot'] select",settings:{minSelected:2},data:yh(s=>r.customPolyglot.includes(s)),events:{afterChange:s=>{const n=s.map(l=>l.value);gs(n,r.customPolyglot)||iL(n)}}}),Pi({input:document.querySelector(".pageSettings .section[data-config-name='minWpm'] input"),configName:"minWpmCustomSpeed",validation:{schema:!0,inputValueConvert:s=>gt(r.typingSpeedUnit).toWpm(new Number(s).valueOf())}}),Pi({input:document.querySelector(".pageSettings .section[data-config-name='minAcc'] input"),configName:"minAccCustom",validation:{schema:!0,inputValueConvert:Number}}),Pi({input:document.querySelector(".pageSettings .section[data-config-name='minBurst'] input"),configName:"minBurstCustomSpeed",validation:{schema:!0,inputValueConvert:s=>gt(r.typingSpeedUnit).toWpm(new Number(s).valueOf())}}),Pi({input:document.querySelector(".pageSettings .section[data-config-name='paceCaret'] input"),configName:"paceCaretCustomSpeed",validation:{schema:!0,inputValueConvert:Number}}),Pi({input:document.querySelector(".pageSettings .section[data-config-name='customBackgroundSize'] input[type='text']"),configName:"customBackground",validation:{schema:!0,resetIfEmpty:!1}}),vn(!0),await UE(),await su(),vn(!1),hh=!0}function n0(){i(".pageSettings .section.needsAccount").addClass("hidden")}function r0(){i(".pageSettings .section.needsAccount").removeClass("hidden"),c0(),d0()}function l0(){const e=document.querySelectorAll(".pageSettings .section[data-config-name='funbox'] button");for(const t of e){t.classList.remove("active"),t.classList.remove("disabled");const o=t.getAttribute("data-config-value"),a=t.getAttribute("data-funbox-name");o===null||a===null||(r.funbox.includes(a)?t.classList.add("active"):sl(ho(),a)||t.classList.add("disabled"))}}function c0(){var e,t;if(B()&&x()){const o=i(".pageSettings .section.tags .tagsList").empty();(t=(e=x())==null?void 0:e.tags)==null||t.forEach(a=>{o.append(`

      <div class="buttons tag" data-id="${a._id}" data-name="${a.name}" data-display="${a.display}">
        <button class="tagButton ${a.active?"active":""}" active="${a.active}">
          ${a.display}
        </button>
        <button class="clearPbButton" aria-label="clear tags personal bests" data-balloon-pos="left" >
          <i class="fas fa-crown fa-fw"></i>
        </button>
        <button class="editButton" aria-label="rename tag" data-balloon-pos="left" >
          <i class="fas fa-pen fa-fw"></i>
        </button>
        <button class="removeButton" aria-label="remove tag"  data-balloon-pos="left" >
          <i class="fas fa-trash fa-fw"></i>
        </button>
      </div>

      `)}),i(".pageSettings .section.tags").removeClass("hidden")}else i(".pageSettings .section.tags").addClass("hidden")}function d0(){var e,t;if(B()&&x()){const o=i(".pageSettings .section.presets .presetsList").empty();(t=(e=x())==null?void 0:e.presets)==null||t.forEach(a=>{o.append(`
      <div class="buttons preset" data-id="${a._id}" data-name="${a.name}" data-display="${a.display}">
        <button class="presetButton">${a.display}</button>
        <button class="editButton">
          <i class="fas fa-pen fa-fw"></i>
        </button>
        <button class="removeButton">
          <i class="fas fa-trash fa-fw"></i>
        </button>
      </div>
      
      `)}),i(".pageSettings .section.presets").removeClass("hidden")}else i(".pageSettings .section.presets").addClass("hidden")}async function u0(){const e=r.customBackground!==""||await et.hasFile("LocalBackgroundFile"),t=i(".customBackground img").is(":visible");e&&t?i(".pageSettings .section[data-config-name='customBackgroundFilter']").removeClass("hidden"):i(".pageSettings .section[data-config-name='customBackgroundFilter']").addClass("hidden")}async function ka(e={}){if(Z()!=="settings")return;r.showKeyTips?i(".pageSettings .tip").removeClass("hidden"):i(".pageSettings .tip").addClass("hidden");for(const n of Object.values(I))"updateUI"in n&&n.updateUI();c0(),d0(),l0(),await Le(0),WE(),FE(!0),await Qr(),await u0(),await Yr();const t=(n,l,c)=>{if(e.eventKey===void 0||e.eventKey===n){const d=document.querySelector(l);if(d===null)throw new Error("Unknown input element "+l);d.value=new String(c).toString(),d.dispatchEvent(new Event("input"))}};t("paceCaret",".pageSettings .section[data-config-name='paceCaret'] input.customPaceCaretSpeed",gt(r.typingSpeedUnit).fromWpm(r.paceCaretCustomSpeed)),t("minWpmCustomSpeed",".pageSettings .section[data-config-name='minWpm'] input.customMinWpmSpeed",gt(r.typingSpeedUnit).fromWpm(r.minWpmCustomSpeed)),t("minAccCustom",".pageSettings .section[data-config-name='minAcc'] input.customMinAcc",r.minAccCustom),t("minBurstCustomSpeed",".pageSettings .section[data-config-name='minBurst'] input.customMinBurst",gt(r.typingSpeedUnit).fromWpm(r.minBurstCustomSpeed)),r.autoSwitchTheme?i(".pageSettings .section[data-config-name='autoSwitchThemeInputs']").removeClass("hidden"):i(".pageSettings .section[data-config-name='autoSwitchThemeInputs']").addClass("hidden"),t("fontSize",".pageSettings .section[data-config-name='fontSize'] input",r.fontSize),t("maxLineWidth",".pageSettings .section[data-config-name='maxLineWidth'] input",r.maxLineWidth),t("keymapSize",".pageSettings .section[data-config-name='keymapSize'] input",r.keymapSize),t("tapeMargin",".pageSettings .section[data-config-name='tapeMargin'] input",r.tapeMargin),t("customBackground",".pageSettings .section[data-config-name='customBackgroundSize'] input[type='text']",r.customBackground),B()?r0():n0(),ow();const o=window.navigator.userAgent.toLowerCase(),a=o.includes("mac")&&!o.includes("firefox")?"cmd":"ctrl",s=r.quickRestart==="esc"?"tab":"esc";i(".pageSettings .tip").html(`
    tip: You can also change all these settings quickly using the
    command line (<key>${s}</key> or <key>${a}</key> + <key>shift</key> + <key>p</key>)`),hc!==void 0&&!Cr(hc.getSelected(),r.customLayoutfluid)&&hc.setData(KE()),yc!==void 0&&!gs(yc.getSelected(),r.customPolyglot)&&yc.setSelected(r.customPolyglot)}function f0(e){m0(void 0);const t=i(`.pageSettings .settingsGroup.${e}`);t.stop(!0,!0).slideToggle(250).toggleClass("slideup"),t.hasClass("slideup")?i(`.pageSettings .sectionGroupTitle[group=${e}]`).addClass("rotateIcon"):i(`.pageSettings .sectionGroupTitle[group=${e}]`).removeClass("rotateIcon")}i(".pageSettings .section[data-config-name='funbox'] .buttons").on("click","button",e=>{const t=i(e.currentTarget).attr("data-config-value");Vv(t),l0()});i(".pageSettings .section.tags").on("click",".tagsList .tag .tagButton",e=>{const t=e.currentTarget,o=i(t).parent(".tag").attr("data-id");Tm(o),i(t).toggleClass("active")});i(".pageSettings .section.presets").on("click",".presetsList .preset .presetButton",async e=>{const t=e.currentTarget,o=i(t).parent(".preset").attr("data-id");await o0(o),ka()});i("#importSettingsButton").on("click",()=>{i0("import")});i("#exportSettingsButton").on("click",()=>{const e=JSON.stringify(r);navigator.clipboard.writeText(e).then(function(){m("JSON Copied to clipboard",0)},function(){i0("export")})});i(".pageSettings .sectionGroupTitle").on("click",e=>{f0(i(e.currentTarget).attr("group"))});i(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton button.save").on("click",()=>{Bd(parseFloat(i(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton input").val()))&&m("Saved",1,{duration:1})});i(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton input").on("focusout",()=>{Bd(parseFloat(i(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton input").val()))&&m("Saved",1,{duration:1})});i(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton input").on("keypress",e=>{e.key==="Enter"&&Bd(parseFloat(i(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton input").val()))&&m("Saved",1,{duration:1})});i(".pageSettings .quickNav .links a").on("click",e=>{const t=e.target.innerText;i(`.pageSettings .settingsGroup.${t}`).hasClass("slideup")&&f0(t)});let p0=!1;function vn(e){p0=e}function yh(e){return Kp.map(t=>{var o;return{label:t,options:(o=kv[t])==null?void 0:o.map(a=>({text:ea(a),value:a,selected:e(a)}))}})}function KE(){const e=r.customLayoutfluid;return[...e,...sd.filter(t=>!e.includes(t))].map(t=>({text:t.replace(/_/g," "),value:t,selected:e.includes(t)}))}function bh(e){return wl.map(t=>({value:t.name,text:t.name.replace(/_/g," "),selected:e(t)}))}function m0(e){if(e===void 0){const o=document.querySelector(".section.highlight");o!==null&&o.classList.remove("highlight");return}const t=document.querySelector(`[data-config-name="${e}"] .groupTitle,[data-section-id="${e}"] .groupTitle`);t!==null&&setTimeout(()=>{var o,a;t.scrollIntoView({block:"center",behavior:"auto"}),(o=t.parentElement)==null||o.classList.remove("highlight"),(a=t.parentElement)==null||a.classList.add("highlight")},250)}i(".pageSettings .section .groupTitle button").on("click",e=>{var a,s,n;const t=(a=e.target.parentElement)==null?void 0:a.parentElement,o=((s=t==null?void 0:t.dataset)==null?void 0:s.configName)??((n=t==null?void 0:t.dataset)==null?void 0:n.sectionId);o!==void 0&&(g0.setUrlParams({highlight:o}),navigator.clipboard.writeText(window.location.toString()).then(()=>{m("Link copied to clipboard",1)}).catch(l=>{const c=ie(l,"Failed to copy to clipboard");m(c,-1)}))});be((e,t)=>{e==="fullConfigChange"&&vn(!0),e==="fullConfigChangeFinished"&&vn(!1),e==="themeLight"?i(`.pageSettings .section[data-config-name='autoSwitchThemeInputs'] select.light option[value="${t}"]`).attr("selected","true"):e==="themeDark"&&i(`.pageSettings .section[data-config-name='autoSwitchThemeInputs'] select.dark option[value="${t}"]`).attr("selected","true"),!(p0||e==="saveToLocalStorage")&&Z()==="settings"&&e!=="theme"&&(e==="customBackground"?u0():ka({eventKey:e}))});sa(e=>{e.type==="authStateChanged"&&(e.data.isUserSignedIn?r0():n0())});const g0=new Lm({id:"settings",element:i(".page.pageSettings"),path:"/settings",urlParamsSchema:NE,afterHide:async()=>{Et("pageSettings")},beforeShow:async e=>{var t;Yt("pageSettings","main"),await Pb,await VE(),await ka(),await PE(),m0((t=e.urlParams)==null?void 0:t.highlight)}});i(async()=>{Xt("pageSettings")});const GE={_id:"default",name:"defaults",pb:{no:!0,yes:!0},difficulty:{normal:!0,expert:!0,master:!0},mode:{words:!0,time:!0,quote:!0,zen:!0,custom:!0},words:{10:!0,25:!0,50:!0,100:!0,custom:!0},time:{15:!0,30:!0,60:!0,120:!0,custom:!0},quoteLength:{short:!0,medium:!0,long:!0,thicc:!0},punctuation:{on:!0,off:!0},numbers:{on:!0,off:!0},date:{last_day:!1,last_week:!1,last_month:!1,last_3months:!1,all:!0},tags:{none:!0},language:Object.fromEntries(Vp.map(e=>[e,!0])),funbox:{none:!0,...Object.fromEntries(nS().map(e=>[e,!0]))}},Mt=structuredClone(GE);function $m(e){try{const t={};for(const o of lt(Mt))if(o==="_id"){let a=e[o]??Mt[o];(a==="default-result-filters-id"||a==="")&&(a="default"),t[o]=a}else o==="name"?t[o]=e[o]??Mt[o]:t[o]={...Mt[o],...e[o]};return t}catch{return Mt}}const h0=new Bt({key:"resultFilters",schema:Ju,fallback:Mt,migrate:(e,t)=>Ry(e)?$m(Lp(Ju.partial().strip(),e)):Mt}),jE=new Set(["language","funbox","tags"]),br={};let Y=Mt;function Fa(){h0.set(Y)}async function QE(){try{Y=$m(h0.get());const e={none:!1};Object.keys(Mt.tags).forEach(t=>{Y.tags[t]!==void 0?e[t]=Y.tags[t]:e[t]=!0}),Y.tags=e,Fa()}catch{console.log("error in loading result filters"),Y=Mt,Fa()}}async function Mm(){var a;const e=document.querySelector(".pageAccount .presetFilterButtons"),t=document.querySelector(".pageAccount .presetFilterButtons .filterBtns");if(!e||!t)return;t.innerHTML="";const o=((a=x())==null?void 0:a.filterPresets)??[];if(o.length>0){let s="";for(const n of o)s+=`<div class="filterPresets">
      <div class="select-filter-preset button" data-id="${n._id}">${n.name.replace(/_/g," ")}</div>
      <div class="button delete-filter-preset" data-id="${n._id}">
        <i class="fas fa-fw fa-trash"></i>
      </div>
    </div>`;t.innerHTML=s,e.classList.remove("hidden")}else e.classList.add("hidden")}async function YE(e){var o;const t=(o=x())==null?void 0:o.filterPresets.find(a=>a._id===e);t&&(Y=n_(t),Fa(),Na()),i(".pageAccount .group.presetFilterButtons .filterBtns .filterPresets .select-filter-preset").removeClass("active"),i(`.pageAccount .group.presetFilterButtons .filterBtns .filterPresets .select-filter-preset[data-id=${e}]`).addClass("active")}function XE(e){const t=x();t&&kt({...t,filterPresets:[...t.filterPresets,structuredClone(e)]})}async function ZE(e){e=e.replace(/ /g,"_"),J();const t=await E.users.addResultFilterPreset({body:{...Y,name:e}});K(),t.status===200?(XE({...Y,name:e,_id:t.body.data}),Mm(),m("Filter preset created",1)):(m("Error creating filter preset: "+t.body.message,-1),console.log("error creating filter preset: "+t.body.message))}function JE(e){const t=x();if(!t)return;const o=[...t.filterPresets],a=o.findIndex(s=>s._id===e);a>-1&&o.splice(a,1),kt({...t,filterPresets:o})}async function e_(e){J();const t=await E.users.removeResultFilterPreset({params:{presetId:e}});K(),t.status===200?(JE(e),Mm(),Em(),m("Filter preset deleted",1)):(m("Error deleting filter preset: "+t.body.message,-1),console.log("error deleting filter preset",t.body.message))}function Am(){i(".pageAccount .group.presetFilterButtons .filterBtns .filterPresets .select-filter-preset").removeClass("active")}function wn(){return Y}function Of(e){return Y[e]}function Ne(e,t){return Y[e][t]}function t_(e,t,o){Y[e][t]=o}function jo(e,t){Object.keys(Of(e)).forEach(o=>{Y[e][o]=t})}function o_(){const e=x();e!==void 0&&e.tags.forEach(t=>{Mt.tags[t._id]=!0})}function Em(){Y=Mt,Fa()}function Na(){var a,s,n,l,c;const e={};for(const d of lt(wn()))if(!(d==="_id"||d==="name")){e[d]={all:!0,array:[]};for(const u of lt(Of(d))){const f=e[d];if(f===void 0)continue;const p=Ne(d,u);if(p===!0?(a=f.array)==null||a.push(u):f.all!==void 0&&(f.all=!1),jE.has(d)){const h=i(`.pageAccount .group.filterButtons .filterGroup[group="${d}"] option[value="${u}"]`);p===!0?h.prop("selected",!0):h.prop("selected",!1)}else{let h;d==="date"?h=i(`.pageAccount .group.topFilters .filterGroup[group="${d}"] button[filter="${u}"]`):h=i(`.pageAccount .group.filterButtons .filterGroup[group="${d}"] button[filter="${u}"]`),p===!0?h.addClass("active"):h.removeClass("active")}}}for(const[d,u]of Object.entries(br)){const f=u,p=Of(d),h=Object.values(p).every(b=>b===!0),g=f.store.getData(),y=i(`.pageAccount .group.filterButtons .filterGroup[group="${d}"] option[value="all"]`);if(h){y.prop("selected",!0);for(const b of g)"value"in b&&(b.value==="all"?b.selected=!0:b.selected=!1);f.store.setData(g),f.render.renderValues()}else y.prop("selected",!1);for(const b of g)"value"in b&&(p[b.value]===!0?b.selected=!0:(!h||b.value!=="all")&&(b.selected=!1));setTimeout(()=>{f.store.setData(g),h||f.render.renderValues(),f.render.renderOptions(g)},0)}function t(d){var f,p,h,g,y;let u="";return u+="<div class='group'>",d==="difficulty"?u+='<span aria-label="Difficulty" data-balloon-pos="up"><i class="fas fa-fw fa-star"></i>':d==="mode"?u+='<span aria-label="Mode" data-balloon-pos="up"><i class="fas fa-fw fa-bars"></i>':d==="punctuation"?u+='<span aria-label="Punctuation" data-balloon-pos="up"><i class="fas fa-fw fa-at"></i>':d==="numbers"?u+='<span aria-label="Numbers" data-balloon-pos="up"><i class="fas fa-fw fa-hashtag"></i>':d==="words"?u+='<span aria-label="Words" data-balloon-pos="up"><i class="fas fa-fw fa-font"></i>':d==="time"?u+='<span aria-label="Time" data-balloon-pos="up"><i class="fas fa-fw fa-clock"></i>':d==="date"?u+='<span aria-label="Date" data-balloon-pos="up"><i class="fas fa-fw fa-calendar"></i>':d==="tags"?u+='<span aria-label="Tags" data-balloon-pos="up"><i class="fas fa-fw fa-tags"></i>':d==="language"?u+='<span aria-label="Language" data-balloon-pos="up"><i class="fas fa-fw fa-globe-americas"></i>':d==="funbox"&&(u+='<span aria-label="Funbox" data-balloon-pos="up"><i class="fas fa-fw fa-gamepad"></i>'),(f=e[d])!=null&&f.all?u+="all":d==="tags"?u+=(h=(p=e.tags)==null?void 0:p.array)==null?void 0:h.map(b=>{var S,q,P;if(b==="none")return b;const C=x();if(C===void 0)return b;const L=(S=C.tags)==null?void 0:S.find($=>$._id===b);return L!==void 0?(P=(q=C.tags)==null?void 0:q.find($=>$._id===b))==null?void 0:P.display:L}).join(", "):u+=(y=(g=e[d])==null?void 0:g.array)==null?void 0:y.join(", ").replace(/_/g," "),u+="</span></div>",u}let o="";o+=t("date"),o+='<div class="spacer"></div>',o+=t("mode"),o+='<div class="spacer"></div>',(n=(s=e.mode)==null?void 0:s.array)!=null&&n.includes("time")&&(o+=t("time"),o+='<div class="spacer"></div>'),(c=(l=e.mode)==null?void 0:l.array)!=null&&c.includes("words")&&(o+=t("words"),o+='<div class="spacer"></div>'),o+=t("difficulty"),o+='<div class="spacer"></div>',o+=t("punctuation"),o+='<div class="spacer"></div>',o+=t("numbers"),o+='<div class="spacer"></div>',o+=t("language"),o+='<div class="spacer"></div>',o+=t("funbox"),o+='<div class="spacer"></div>',o+=t("tags"),setTimeout(()=>{i(".pageAccount .group.chart .above").html(o)},0)}function a_(e,t){Am();try{e==="date"&&jo("date",!1);const a=!Y[e][t];Y[e][t]=a,Fa()}catch(o){m("Something went wrong toggling filter. Reverting to defaults.",0),console.log("toggling filter error"),console.error(o),Em(),Na()}}i(".pageAccount .filterButtons .buttonsAndTitle .buttons, .pageAccount .group.topFilters .buttonsAndTitle.testDate .buttons").on("click","button",e=>{const t=i(e.target).parents(".buttons").attr("group"),o=i(e.target).attr("filter");i(e.target).hasClass("allFilters")?(lt(wn()).forEach(a=>{a==="_id"||a==="name"||jo(a,!0)}),jo("date",!1),Y.date.all=!0):i(e.target).hasClass("noFilters")?lt(wn()).forEach(a=>{a==="_id"||a==="name"||a!=="date"&&jo(a,!1)}):i(e.target).is("button")&&(e.shiftKey?(jo(t,!1),Y[t][o]=!0):a_(t,o)),Na(),Fa()});i(".pageAccount .topFilters button.allFilters").on("click",()=>{Am(),console.log(wn()),lt(wn()).forEach(e=>{e==="_id"||e==="name"||jo(e,!0)}),jo("date",!1),Y.date.all=!0,Na(),Fa()});i(".pageAccount .topFilters button.currentConfigFilter").on("click",()=>{var e,t;if(Am(),lt(wn()).forEach(o=>{o==="_id"||o==="name"||jo(o,!1)}),Y.pb.no=!0,Y.pb.yes=!0,Y.difficulty[r.difficulty]=!0,Y.mode[r.mode]=!0,r.mode==="time")if([15,30,60,120].includes(r.time)){const o=`${r.time}`;Y.time[o]=!0}else Y.time.custom=!0;else if(r.mode==="words")if([10,25,50,100,200].includes(r.words)){const o=`${r.words}`;Y.words[o]=!0}else Y.words.custom=!0;else r.mode==="quote"&&["short","medium","long","thicc"].forEach((a,s)=>{r.quoteLength.includes(s)?Y.quoteLength[a]=!0:Y.quoteLength[a]=!1});if(r.punctuation?Y.punctuation.on=!0:Y.punctuation.off=!0,r.numbers?Y.numbers.on=!0:Y.numbers.off=!0,r.mode==="quote"&&/english.*/.test(r.language)?Y.language.english=!0:Y.language[r.language]=!0,r.funbox.length===0)Y.funbox.none=!0;else for(const o of r.funbox)Y.funbox[o]=!0;Y.tags.none=!0,(t=(e=x())==null?void 0:e.tags)==null||t.forEach(o=>{o.active===!0&&(Y.tags.none=!1,Y.tags[o._id]=!0)}),Y.date.all=!0,Na(),Fa()});i(".pageAccount .topFilters button.toggleAdvancedFilters").on("click",()=>{i(".pageAccount .filterButtons").slideToggle(250),i(".pageAccount .topFilters button.toggleAdvancedFilters").toggleClass("active")});function Fu(e,t=0){const o=br[e];if(o===void 0)return;const a=o.render.content.list,s=a.children.item(t);a.scrollTop=s.offsetTop-a.offsetTop}function Ru(e,t,o){const a=t.some(n=>n.value==="all"),s=o.some(n=>n.value==="all");a?s?t.length<o.length&&(t=t.filter(n=>n.value!=="all")):t=t.filter(n=>n.value==="all"):s&&(t=[]),jo(e,!1);for(const n of t){if(n.value==="all"){jo(e,!0);break}t_(e,n.value,!0)}return Na(),Fa(),y0(),!1}let y0=()=>{};function b0(){const e=x();if(e===void 0)return;const t=e.tags.filter(s=>Mt.tags[s._id]===void 0);if(t.length>0){const s=Object.values(Y.tags).every(n=>n);Mt.tags={...Mt.tags,...Object.fromEntries(t.map(n=>[n._id,!0]))},Y.tags={...Y.tags,...Object.fromEntries(t.map(n=>[n._id,s]))}}const o=document.querySelector(".pageAccount .content .filterButtons .buttonsAndTitle.tags .select select");if(!(o instanceof HTMLElement))return;let a="";a+="<option value='all'>all</option>",a+="<option value='none'>no tag</option>";for(const s of e.tags)a+=`<option value="${s._id}" filter="${s.name}">${s.display}</option>`;o.innerHTML=a}let vh=!1;async function s_(e){if(vh)return;y0=e,br.language=new st({select:".pageAccount .content .filterButtons .buttonsAndTitle.languages .select .languageSelect",data:[{value:"all",text:"all"},...Vp.map(a=>({value:a,text:ea(a),filter:a}))],settings:{showSearch:!0,placeholderText:"select a language",allowDeselect:!0,closeOnSelect:!1},events:{beforeChange:(a,s)=>Ru("language",a,s),beforeOpen:()=>{Fu("language")}}}),br.funbox=new st({select:".pageAccount .content .filterButtons .buttonsAndTitle.funbox .select .funboxSelect",data:[{value:"all",text:"all"},{value:"none",text:"no funbox"},...bp().map(a=>({value:a.name,text:a.name.replace(/_/g," "),filter:a.name}))],settings:{showSearch:!0,placeholderText:"select a funbox",allowDeselect:!0,closeOnSelect:!1},events:{beforeChange:(a,s)=>Ru("funbox",a,s),beforeOpen:()=>{Fu("funbox")}}});const t=x(),o=i(".pageAccount .content .filterButtons .buttonsAndTitle.tags");if(t.tags.length===0)o.addClass("hidden");else{o.removeClass("hidden"),b0();const a=document.querySelector(".pageAccount .content .filterButtons .buttonsAndTitle.tags .select .tagsSelect");a&&(br.tags=new st({select:a,settings:{showSearch:!0,placeholderText:"select a tag",allowDeselect:!0,closeOnSelect:!1},events:{beforeChange:(s,n)=>Ru("tags",s,n),beforeOpen:()=>{Fu("tags")}}}))}Mm(),vh=!0}function i_(){i(".pageAccount .content .filterButtons .buttonsAndTitle.languages .buttons").empty(),i(".pageAccount .content .filterButtons .buttonsAndTitle.funbox .buttons").empty(),i(".pageAccount .content .filterButtons .buttonsAndTitle.tags .buttons").empty()}i(".group.presetFilterButtons .filterBtns").on("click",".filterPresets .delete-filter-preset",e=>{e_(i(e.currentTarget).data("id"))});function n_(e){return $m(Lp(Ju.partial().strip(),structuredClone(e)))}sa(e=>{e.type==="snapshotUpdated"&&e.data.isInitial&&(o_(),QE())});function r_(e){let t=[];for(let s=1;s<=e.wpm.length;s++)t.push(s.toString());e.wpm=e.wpm.slice(0,e.burst.length),e.err=e.err.slice(0,e.burst.length),t=t.slice(0,e.burst.length),Ut.data.labels=t,Ut.getDataset("wpm").data=e.wpm,Ut.getDataset("burst").data=e.burst,Ut.getDataset("error").data=e.err;const o=Math.max(Math.max(...e.wpm),Math.max(...e.burst)),a=Math.min(Math.min(...e.wpm),Math.min(...e.burst));Ut.getScale("wpm").max=Math.round(o),Ut.getScale("burst").max=Math.round(o),r.startGraphsAtZero?(Ut.getScale("wpm").min=0,Ut.getScale("burst").min=0):(Ut.getScale("wpm").min=Math.round(a),Ut.getScale("burst").min=Math.round(a)),Ut.updateColors()}function l_(e){r_(e),c_.show()}const c_=new re({dialogId:"miniResultChartModal"});function d_(e){const t=e?"Profile":"Account",a=e?"":`<div class="buttonGroup"><button
  class="showAllButton"
  data-balloon-pos="left"
  aria-label="Show all personal bests"
>
  <i class="fas fa-ellipsis-v"></i>
</button></div>`;i(`.page${t} .profile .pbsWords`).html(`
      <div class="group">
      <div class="quick">
        <div class="test">10 words</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">25 words</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">50 words</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">100 words</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    ${a}
  `),i(`.page${t} .profile .pbsTime`).html(`
      <div class="group">
      <div class="quick">
        <div class="test">15 seconds</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">30 seconds</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">60 seconds</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">120 seconds</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    ${a}
  `)}function Nf(e,t=!1){if(d_(t),e===void 0)return;let o="";const a=t?"Profile":"Account";i(`.page${a} .profile .pbsTime`).html(""),i(`.page${a} .profile .pbsWords`).html("");const s=["15","30","60","120"],n=["10","25","50","100"];s.forEach(c=>{o+=wh(e,"time",c)});const l=t?"":`<div class="buttonGroup"><button
      class="showAllButton"
      data-balloon-pos="left"
      aria-label="Show all personal bests"
    >
      <i class="fas fa-ellipsis-v"></i>
    </button></div>`;i(`.page${a} .profile .pbsTime`).append(o+l),o="",n.forEach(c=>{o+=wh(e,"words",c)}),i(`.page${a} .profile .pbsWords`).append(o+l)}function wh(e,t,o){let a="",s="";const n=`${o} ${t==="time"?"seconds":"words"}`,l=r.typingSpeedUnit;try{const c=(e[t][o]??[]).sort((u,f)=>f.wpm-u.wpm)[0];if(c===void 0)throw new Error("No PB data found");const d=new Date(c.timestamp);c.timestamp!==void 0&&c.timestamp>0&&(s=te(d,"dd MMM yyyy")),a=`<div class="quick">
      <div class="test">${n}</div>
      <div class="wpm">${N.typingSpeed(c.wpm,{showDecimalPlaces:!1})}</div>
      <div class="acc">${N.accuracy(c.acc,{showDecimalPlaces:!1})}</div>
    </div>
    <div class="fullTest">
      <div>${n}</div>
      <div>${N.typingSpeed(c.wpm,{suffix:` ${l}`})}</div>
      <div>${N.typingSpeed(c.raw,{suffix:" raw"})}</div>
      <div>${N.accuracy(c.acc,{suffix:" acc"})}</div>
      <div>${N.percentage(c.consistency,{suffix:" con"})}</div>
      <div>${s}</div>
    </div>`}catch{a=`<div class="quick">
    <div class="test">${n}</div>
    <div class="wpm">-</div>
    <div class="acc">-</div>
  </div>`}return`
  <div class="group">
  ${a}
  </div>
  `}const v0={1:{id:1,name:"Developer",description:"I made this",icon:"fa-laptop",color:"white",customStyle:"animation: rgb-bg 10s linear infinite; background: linear-gradient(45deg in hsl longer hue, hsl(330, 90%, 30%) 0%, hsl(250, 90%, 30%) 100%);"},2:{id:2,name:"Collaborator",description:"I helped make this",icon:"fa-code",color:"white",customStyle:"animation: rgb-bg 10s linear infinite; background: linear-gradient(45deg in hsl longer hue, hsl(330, 90%, 30%) 0%, hsl(250, 90%, 30%) 100%);"},3:{id:3,name:"Server Mod",description:"Discord server moderator",icon:"fa-hammer",color:"white",customStyle:"animation: rgb-bg 10s linear infinite; background: linear-gradient(45deg in hsl longer hue, hsl(330, 90%, 30%) 0%, hsl(250, 90%, 30%) 100%);"},4:{id:4,name:"OG Account",description:"First 1000 users on the site",icon:"fa-baby",color:"var(--bg-color)",background:"var(--main-color)"},5:{id:5,name:"OG Discordian",description:"First 1000 Discord server members",icon:"fa-baby",color:"var(--bg-color)",background:"var(--main-color)"},6:{id:6,name:"Supporter",description:"Donated money",icon:"fa-heart",color:"var(--text-color)",background:"var(--sub-color)"},7:{id:7,name:"Sugar Daddy",description:"Donated a lot of money",icon:"fa-gem",color:"var(--bg-color)",background:"var(--main-color)"},8:{id:8,name:"Monkey Supporter",description:"Donated more money",icon:"fa-heart",color:"var(--bg-color)",background:"var(--main-color)"},9:{id:9,name:"White Hat",description:"Reported critical vulnerabilities on the site",icon:"fa-user-secret",color:"var(--bg-color)",background:"var(--main-color)"},10:{id:10,name:"Bug Hunter",description:"Reported or helped track down bugs on the site",icon:"fa-bug",color:"var(--text-color)",background:"var(--sub-color)"},11:{id:11,name:"Content Creator",description:"Verified content creator",icon:"fa-video",color:"var(--text-color)",background:"var(--sub-color)"},12:{id:12,name:"Contributor",description:"Contributed to the site",icon:"fa-hands-helping",color:"var(--text-color)",background:"var(--sub-color)"},13:{id:13,name:"Mythical",description:"Yes, I'm actually this fast",icon:"fa-rocket",color:"white",customStyle:"animation: rgb-bg 10s linear infinite; background: linear-gradient(45deg in hsl longer hue, hsl(330, 90%, 30%) 0%, hsl(250, 90%, 30%) 100%);"},14:{id:14,name:"All Year Long",description:"Reached a streak of 365 days",icon:"fa-fire",color:"var(--bg-color)",background:"var(--main-color)"},15:{id:15,name:"Insane",description:"I typed for 69 hours straight",icon:"fa-bomb",color:"white",background:"#093d79",customStyle:"animation: gold-shimmer 10s cubic-bezier(0.5, 0, 0.5, 1) infinite; background: linear-gradient(90deg, rgb(8 31 84) 0%, rgb(18 134 158) 100%); background-size: 200% 200%;"},16:{id:16,name:"Perfection",description:"Longest test with zero mistakes - 4 hours and 1 minute",icon:"fa-bullseye",color:"white",customStyle:"animation: gold-shimmer 10s cubic-bezier(0.5, -0.15, 0.5, 1.15) infinite; background: linear-gradient(45deg, #b8860b 0%, #daa520 25%, #ffd700 50%, #daa520 75%, #b8860b 100%); background-size: 200% 200%;"},17:{id:17,name:"Phineas",description:"Ferb, I know what we're gonna do today...",icon:"fa-sun",color:"white",customStyle:"animation: rgb-bg 10s linear infinite; background: linear-gradient(45deg in hsl longer hue, hsl(330, 90%, 30%) 0%, hsl(250, 90%, 30%) 100%);"}};function Xr(e,t=!1,o=!1,a=!1){const s=v0[e];if(!s&&!a)return"";let n="";(s==null?void 0:s.background)!==void 0&&(n+=`background: ${s.background};`),(s==null?void 0:s.color)!==void 0&&(n+=`color: ${s.color};`),(s==null?void 0:s.customStyle)!==void 0&&(n+=s.customStyle);const l=(s==null?void 0:s.name)??"Badge Name Missing",c=(s==null?void 0:s.description)??"Badge Description Missing",d=(t?l+": ":"")+c;let u="";o||(u=`aria-label="${d}" data-balloon-pos="right"`);let f="";(s==null?void 0:s.icon)!==void 0?f=`<i class="fas ${t?"fa-fw":""} ${s.icon}"></i>`:f='<i class="fas fa-question"></i>';const p=`<div class="text">${l}</div>`;return`<div class="badge" ${u} style="${n}">${f}${t?"":p}</div>`}function u_(e){return v0[e]}async function id(e,t){var q,P,$,H,R,Pe,j,ne,fe,me,St,ki,ra,Cs,ks,Zt,Jt,bo,Ss,la,El,Si,Fn,Rn,Dn,w,ze,ve,xt,xs,ca,ye;const o=e.charAt(0).toUpperCase()+e.slice(1),a=i(`.page${o} .profile`),s=i(`.page${o} .profile .details`);a.attr("uid",t.uid??""),a.attr("name",t.name??"");const n=t.banned===!0;if(s===void 0||t===void 0||t.name===void 0||t.addedAt===void 0)return;if(s.find(".avatarAndName .avatar").replaceWith(Ad(t,{size:256})),(q=t.inventory)!=null&&q.badges&&!n){let we="",_e="";for(const He of t.inventory.badges)He.selected===!0?we=Xr(He.id):_e+=Xr(He.id,!0);s.find(".badges").empty().append(we),s.find(".allBadges").empty().append(_e)}s.find(".name").text(t.name),s.find(".userFlags").html(rl(t)),t.lbOptOut===!0&&(e==="profile"?a.find(".lbOptOutReminder").removeClass("hidden").text("Note: This account has opted out of the leaderboards, meaning their results aren't verified by the anticheat system and may not be legitimate."):a.find(".lbOptOutReminder").addClass("hidden")),setTimeout(()=>{_m(e)},10);const c="Joined "+te(t.addedAt??0,"dd MMM yyyy"),d=new Date(t.addedAt),u=Hi(new Date,d),f=`${u} day${u!==1?"s":""} ago`;s.find(".joined").text(c).attr("aria-label",f);let p="";if(t.streak&&(t==null?void 0:t.streak)>1?(s.find(".streak").text(`Current streak: ${t.streak} ${t.streak===1?"day":"days"}`),p=`Longest streak: ${t.maxStreak} ${t.maxStreak===1?"day":"days"}`):(s.find(".streak").text(""),p=""),e==="account"){const we=(P=x())==null?void 0:P.results,_e=we==null?void 0:we[0],He=t.streakHourOffset,bt=1e3*60*60*24;let Ye=_l(He)+bt;Ye<Date.now()&&(Ye+=bt);const qt=Qy(Ye);if(console.debug("Streak hour offset"),console.debug("date.now()",Date.now(),new Date(Date.now())),console.debug("dayInMilis",bt),console.debug("difTarget",new Date(_l(He)+bt)),console.debug("timeDif",qt),console.debug("DateTime.getCurrentDayTimestamp()",_l(),new Date(_l())),console.debug("profile.streakHourOffset",He),_e!==void 0){const Ts=rS(_e.timestamp,He),Ls=lS(_e.timestamp,He);console.debug("lastResult.timestamp",_e.timestamp,new Date(_e.timestamp)),console.debug("isToday",Ts),console.debug("isYesterday",Ls);const ot=Ce(He)?`(${He>0?"+":""}${He} offset)`:"";Ts?(p+=`
Claimed today: yes`,p+=`
Come back in: ${qt} ${ot}`):Ls?(p+=`
Claimed today: no`,p+=`
Streak lost in: ${qt} ${ot}`):(p+=`
Streak lost ${qt} ${ot} ago`,p+=`
It will be removed from your profile on the next result save`),console.debug(p),He===void 0&&(p+=`

If the streak reset time doesn't line up with your timezone, you can change it in Account Settings > Account > Set streak hour offset.`)}}s.find(".streak").attr("aria-label",p).attr("data-balloon-break","");let h="",g="";t.typingStats.completedTests!==void 0&&t.typingStats.startedTests!==void 0&&(h=Math.floor(t.typingStats.completedTests/t.typingStats.startedTests*100).toString(),g=((t.typingStats.startedTests-t.typingStats.completedTests)/t.typingStats.completedTests).toFixed(1));const y=s.find(".typingStats");y.find(".started .value").text((($=t.typingStats)==null?void 0:$.startedTests)??0),y.find(".completed .value").text(((H=t.typingStats)==null?void 0:H.completedTests)??0).attr("data-balloon-pos","up").attr("aria-label",`${h}% (${g} restarts per completed test)`),y.find(".timeTyping .value").text(rt(Math.round(((R=t.typingStats)==null?void 0:R.timeTyping)??0),!0,!0));let b=!1,C=!1,L=!1;if(!n&&(b=!!(((Pe=t.details)==null?void 0:Pe.bio)??""),s.find(".bio .value").text(((j=t.details)==null?void 0:j.bio)??""),C=!!(((ne=t.details)==null?void 0:ne.keyboard)??""),s.find(".keyboard .value").text(((fe=t.details)==null?void 0:fe.keyboard)??""),((St=(me=t.details)==null?void 0:me.socialProfiles)==null?void 0:St.github)!==void 0&&((ra=(ki=t.details)==null?void 0:ki.socialProfiles)==null?void 0:ra.github)!==""||((ks=(Cs=t.details)==null?void 0:Cs.socialProfiles)==null?void 0:ks.twitter)!==void 0&&((Jt=(Zt=t.details)==null?void 0:Zt.socialProfiles)==null?void 0:Jt.twitter)!==""||((Ss=(bo=t.details)==null?void 0:bo.socialProfiles)==null?void 0:Ss.website)!==void 0&&((El=(la=t.details)==null?void 0:la.socialProfiles)==null?void 0:El.website)!=="")){L=!0;const we=s.find(".socials .value");we.empty();const _e=((Si=t.details)==null?void 0:Si.socialProfiles.github)??"";_e&&we.append(`<a href='https://github.com/${ft(_e)}/' target="_blank" rel="nofollow me" aria-label="${ft(_e)}" data-balloon-pos="up" class="textButton"><i class="fab fa-fw fa-github"></i></a>`);const He=((Fn=t.details)==null?void 0:Fn.socialProfiles.twitter)??"";He&&we.append(`<a href='https://x.com/${ft(He)}' target="_blank" rel="nofollow me" aria-label="${ft(He)}" data-balloon-pos="up" class="textButton"><i class="fab fa-fw fa-twitter"></i></a>`);const bt=((Rn=t.details)==null?void 0:Rn.socialProfiles.website)??"",Ye=/^https?:\/\/(?:www\.)?([^/]+)/,qt=((Dn=bt==null?void 0:bt.match(Ye))==null?void 0:Dn[1])??bt;bt&&we.append(`<a href='${ft(bt)}' target="_blank" rel="nofollow me" aria-label="${ft(qt??"")}" data-balloon-pos="up" class="textButton"><i class="fas fa-fw fa-globe"></i></a>`)}if(w0(e,t.xp??0),n)a.find(".leaderboardsPositions").addClass("hidden");else{a.find(".leaderboardsPositions").removeClass("hidden");const we=((ve=(ze=(w=t.allTimeLbs)==null?void 0:w.time)==null?void 0:ze["15"])==null?void 0:ve.english)??null,_e=((ca=(xs=(xt=t.allTimeLbs)==null?void 0:xt.time)==null?void 0:xs["60"])==null?void 0:ca.english)??null;we===null&&_e===null?a.find(".leaderboardsPositions").addClass("hidden"):(we!==null&&(a.find(".leaderboardsPositions .group.t15 .pos").text(N.rank(we==null?void 0:we.rank)),a.find(".leaderboardsPositions .group.t15 .topPercentage").text(Ch(we))),_e!==null&&(a.find(".leaderboardsPositions .group.t60 .pos").text(N.rank(_e==null?void 0:_e.rank)),a.find(".leaderboardsPositions .group.t60 .topPercentage").text(Ch(_e))))}t.uid===((ye=go())==null?void 0:ye.uid)?a.find(".userReportButton").addClass("hidden"):a.find(".userReportButton").removeClass("hidden");const S=b||C;b?s.find(".bio").removeClass("hidden"):s.find(".bio").addClass("hidden"),C?s.find(".keyboard").removeClass("hidden"):s.find(".keyboard").addClass("hidden"),S?(s.find(".bioAndKeyboard").removeClass("hidden"),s.find(".sep2").removeClass("hidden")):(s.find(".bioAndKeyboard").addClass("hidden"),s.find(".sep2").addClass("hidden")),L?(s.find(".socials").removeClass("hidden"),s.find(".sep3").removeClass("hidden")):(s.find(".socials").addClass("hidden"),s.find(".sep3").addClass("hidden")),s.removeClass("none"),s.removeClass("bioAndKey"),s.removeClass("soc"),s.removeClass("both"),!L&&!S?s.addClass("none"):L&&!S?s.addClass("soc"):!L&&S?s.addClass("bioAndKey"):L&&S&&s.addClass("both")}function w0(e,t,o=!1){var u;const a=e.charAt(0).toUpperCase()+e.slice(1),s=i(`.page${a} .profile`),n=i(`.page${a} .profile .details .levelAndBar`);if(n==null||o&&e==="profile"&&((u=go())==null?void 0:u.uid)!==s.attr("uid"))return;const l=Lr(t),c=l.levelMaxXp,d=l.levelCurrentXp;n.find(".level").text(l.level).attr("aria-label",`${Gl(t)} total xp`),n.find(".xp").text(`${Gl(d)}/${Gl(c)}`).attr("aria-label",`${Gl(c-d)} xp until next level`),n.find(".xpBar .bar").css("width",`${d/c*100}%`),n.find(".xpBar").attr("aria-label",`${(d/c*100).toFixed(2)}%`)}function _m(e){if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent))return;let o;if(e==="account"?o=i(".pageAccount .profile .details"):e==="profile"&&(o=i(".pageProfile .profile .details")),!o)return;const a=o.find(".user"),s=a.parent()[0],n=a[0],l=Ys(2);if(!n||!s)return;n.style.fontSize="10px";const c=s.clientWidth,d=n.clientWidth,f=c/d*10,p=Math.min(Math.max(f,10),l);n.style.fontSize=`${p}px`}const f_=jy(1e3,()=>{const e=Z();e&&["account","profile"].includes(e)&&_m(e)});i(window).on("resize",()=>{f_()});function Ch(e){return e.rank===void 0?"-":e.rank===1?"GOAT":"Top "+V(e.rank/e.count*100)+"%"}function Gl(e){return e<1e3?Math.round(e).toString():Mc(e)}let C0;const{promise:p_,resolve:m_}=Wa();function In(){return C0}async function g_(){const e=await E.configuration.get();if(e.status!==200){console.error("Could not fetch configuration",e.body.message);return}else C0=e.body.data??void 0,m_(!0)}function Uf(){i(".pageAccount .resultBatches").addClass("hidden")}function h_(){i(".pageAccount .resultBatches").removeClass("hidden")}async function y_(){var f,p,h,g,y;const e=(f=x())==null?void 0:f.results;if(e===void 0){console.error("(Result batches) Results are missing but they should be available at the time of drawing the account page?"),Uf();return}b_();const t=((h=(p=x())==null?void 0:p.typingStats)==null?void 0:h.completedTests)??0,o=Math.round(e.length/t*100),a=((g=In())==null?void 0:g.results.limits)??{regularUser:0,premiumUser:0},s=(y=x())!=null&&y.isPremium?a.premiumUser:a.regularUser,n=Math.round((e==null?void 0:e.length)/s*100),l=i(".pageAccount .resultBatches .bars"),c={downloaded:{fill:l.find(".downloaded .fill"),rightText:l.find(".downloaded.rightText")},limit:{fill:l.find(".limit .fill"),rightText:l.find(".limit.rightText")}};c.downloaded.fill.css("width",Math.min(o,100)+"%"),c.downloaded.rightText.text(`${e==null?void 0:e.length} / ${t} (${o}%)`);const d=await hs();c.limit.fill.css({width:Math.min(n,100)+"%",background:so(d.sub,d.error,Tc(n,50,100,0,1))}),c.limit.rightText.text(`${e==null?void 0:e.length} / ${s} (${n}%)`),i(".pageAccount .resultBatches > .text").text(""),e.length>=t&&(Vf(),kh("all results loaded")),e.length>=s&&(Vf(),kh("limit reached"))}function Vf(){i(".pageAccount .resultBatches button").prop("disabled",!0)}function b_(){i(".pageAccount .resultBatches button").prop("disabled",!1)}function kh(e){i(".pageAccount .resultBatches button").text(e)}function v_(){var a,s,n,l;if(!(((a=x())==null?void 0:a.isPremium)??!1)){Uf();return}const t=((n=(s=x())==null?void 0:s.typingStats)==null?void 0:n.completedTests)??0,o=((l=In())==null?void 0:l.results.maxBatchSize)??0;if(t<=o){Uf();return}h_()}let Dt;function k0(e,t,o){if(t===void 0){Im(e);return}e.classList.remove("hidden"),e.querySelector(".yearSelect")!==null&&(Dt=T0(e),x0(e,"current",nr(o==null?void 0:o.getFullYear())??2022)),C_(e,t.firstDayOfWeek),S0(e,t)}function Im(e){var t;e.classList.add("hidden"),(t=e.querySelector(".activity"))==null||t.replaceChildren()}function S0(e,t){var s,n;const o=e.querySelector(".activity");if(o===null)return;if(o.innerHTML="",t===void 0){Sh([]),(s=e.querySelector(".nodata"))==null||s.classList.remove("hidden");return}Sh(t.getMonths()),(n=e.querySelector(".nodata"))==null||n.classList.add("hidden");const a=e.querySelector(".title");a!==null&&(a.innerHTML=t.getTotalTests()+" tests");for(const l of t.getDays()){const c=document.createElement("div");c.setAttribute("data-level",l.level),l.label!==void 0&&(c.setAttribute("aria-label",l.label),c.setAttribute("data-balloon-pos","up")),o.appendChild(c)}}function x0(e,t,o){var l,c;const a=new Date().getFullYear(),s=[{text:"last 12 months",value:"current",selected:t==="current"}];for(let d=a;d>=o;d--)(s.length<2||(l=In())!=null&&l.users.premium.enabled&&((c=x())!=null&&c.isPremium))&&s.push({text:d.toString(),value:d.toString(),selected:d===t});const n=T0(e);n.setData(s),s.length>1?n.enable():n.disable()}function Sh(e){const t=document.querySelector(".testActivity .months");t!==null&&(t.innerHTML=e.map(o=>`<div style="grid-column: span ${o.weeks}">${o.text}</div>`).join(""))}function T0(e){return Dt!==void 0||(Dt=new st({select:e.querySelector(".yearSelect"),settings:{showSearch:!1},events:{afterChange:async t=>{var s;Dt==null||Dt.disable();const o=(s=t[0])==null?void 0:s.value,a=await Ix(o);S0(e,a),((Dt==null?void 0:Dt.getData())??[]).length>1&&(Dt==null||Dt.enable())}}})),Dt}const w_=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];function C_(e,t){const o=[];for(let s=0;s<7;s++)o.push(s%2!==t%2?w_[(t+s)%7]:void 0);const a=s=>{const n=s!==void 0?l=>l.substring(0,s):l=>l;return o.map(l=>l!==void 0?`<div><div class="text">${n(l)}</div></div>`:"<div></div>").join("")};e.querySelector(".daysFull").innerHTML=a(),e.querySelector(".days").innerHTML=a(3)}let vt=!1;function k_(){vt=!vt,vt&&console.log("filterDebug is on")}let Fe=[],Bs=0,Kf;function iu(e){var o;if(Fe===void 0||Fe.length===0)return;let t;Ce(e)&&e>Bs?t=Math.ceil(e/10)*10:t=Bs+10;for(let a=Bs;a<t;a++){const s=Fe[a];if(!s)continue;let n=s.difficulty;n===void 0&&(n="normal");let l=`<span aria-label="${(o=s.language)==null?void 0:o.replace("_"," ")}" data-balloon-pos="up"><i class="fas fa-fw fa-globe-americas"></i></span>`;n==="normal"?l+=`<span aria-label="${s.difficulty}" data-balloon-pos="up"><i class="far fa-fw fa-star"></i></span>`:n==="expert"?l+=`<span aria-label="${s.difficulty}" data-balloon-pos="up"><i class="fas fa-fw fa-star-half-alt"></i></span>`:n==="master"&&(l+=`<span aria-label="${s.difficulty}" data-balloon-pos="up"><i class="fas fa-fw fa-star"></i></span>`),s.punctuation&&(l+='<span aria-label="punctuation" data-balloon-pos="up"><i class="fas fa-fw fa-at"></i></span>'),s.numbers&&(l+='<span aria-label="numbers" data-balloon-pos="up"><i class="fas fa-fw fa-hashtag"></i></span>'),s.blindMode&&(l+='<span aria-label="blind mode" data-balloon-pos="up"><i class="fas fa-fw fa-eye-slash"></i></span>'),s.lazyMode&&(l+='<span aria-label="lazy mode" data-balloon-pos="up"><i class="fas fa-fw fa-couch"></i></span>'),s.funbox!==void 0&&s.funbox.length>0&&(l+=`<span aria-label="${s.funbox.map(C=>C.replace(/_/g," ")).join(", ")}" data-balloon-pos="up"><i class="fas fa-gamepad"></i></span>`),s.chartData==="toolong"||s.testDuration>122?l+='<span class="miniResultChartButton disabled" aria-label="Graph history is not available for long tests" data-balloon-pos="up"><i class="fas fa-fw fa-chart-line"></i></span>':l+=`<span class="miniResultChartButton" aria-label="View graph" data-balloon-pos="up" filteredResultsId="${a}"><i class="fas fa-fw fa-chart-line"></i></span>`;let c="no tags";s.tags!==void 0&&s.tags.length>0&&(c="",s.tags.forEach(C=>{var L,S;(S=(L=x())==null?void 0:L.tags)==null||S.forEach(q=>{C===q._id&&(c+=q.display+", ")})}),c=c.substring(0,c.length-2));let d;s.tags===void 0?d="[]":d=JSON.stringify(s.tags);const u=s.tags!==void 0&&s.tags.length>0,f=s.tags!==void 0&&s.tags.length>1?"fa-tags":"fa-tag",p=`<button class="textButton resultEditTagsButton ${u?"active":""}" data-result-id="${s._id}" data-tags='${d}' aria-label="${c}" data-balloon-pos="up"><i class="fas fa-fw ${f}"></i></button>`;let h="";s.isPb?h='<i class="fas fa-fw fa-crown"></i>':h="";const g=s.charStats.join("/"),y=s.mode==="custom"?"":s.mode2,b=new Date(s.timestamp);i(".pageAccount .history table tbody").append(`
    <tr class="resultRow" id="result-${a}">
    <td>${h}</td>
    <td>${N.typingSpeed(s.wpm,{showDecimalPlaces:!0})}</td>
    <td>${N.typingSpeed(s.rawWpm,{showDecimalPlaces:!0})}</td>
    <td>${N.percentage(s.acc,{showDecimalPlaces:!0})}</td>
    <td>${N.percentage(s.consistency,{showDecimalPlaces:!0})}</td>
    <td>${g}</td>
    <td>${s.mode} ${y}</td>
    <td class="infoIcons">${l}</td>
    <td>${p}</td>
    <td>${te(b,"dd MMM yyyy")}<br>
    ${te(b,"HH:mm")}
    </td>
    </tr>`)}Bs=t,Bs>=Fe.length?i(".pageAccount .loadMoreButton").addClass("hidden"):i(".pageAccount .loadMoreButton").removeClass("hidden")}async function S_(){await U.updateColors(),await Le(0),await Ja.updateColors(),await Le(0),await tn.updateColors(),await Le(0)}function x_(){i(".pageAccount .history table tbody").empty(),tn.getDataset("count").data=[],Ja.getDataset("count").data=[],Ja.getDataset("avgWpm").data=[],U.getDataset("wpm").data=[],U.getDataset("pb").data=[],U.getDataset("acc").data=[],U.getDataset("wpmAvgTen").data=[],U.getDataset("accAvgTen").data=[],U.getDataset("wpmAvgHundred").data=[],U.getDataset("accAvgHundred").data=[]}let jl=0,Ft=[],qi=[];async function L0(){var Fn,Rn,Dn;console.log("updating account page"),ll();const e=x();if(!e)return;Nf(e.personalBests),id("account",e),k0(Kf,e.testActivity,new Date(e.addedAt)),y_(),Ft=[],qi=[];const t=[];Bs=0;let o=0,a="",s=0,n=0,l=0,c=0,d=0,u=0,f=0,p=0;const h={total:0,count:0,last10Total:0,last10Count:0,max:0};let g=0;jl=0;let y=0,b=0,C=0,L=0;const S={},q=[],P=gt(r.typingSpeedUnit);Fe=[],i(".pageAccount .history table tbody").empty(),(Rn=(Fn=x())==null?void 0:Fn.results)==null||Rn.forEach(w=>{var we,_e,He,bt;try{if(!Ne("pb",w.isPb?"yes":"no")){vt&&console.log("skipping result due to pb filter",w);return}let Ye=w.difficulty;if(Ye===void 0&&(Ye="normal"),!Ne("difficulty",Ye)){vt&&console.log("skipping result due to difficulty filter",w);return}if(!Ne("mode",w.mode)){vt&&console.log("skipping result due to mode filter",w);return}if(w.mode==="time"){let Ge="custom";if(["15","30","60","120"].includes(`${w.mode2}`)&&(Ge=`${w.mode2}`),!Ne("time",Ge)){vt&&console.log("skipping result due to time filter",w);return}}else if(w.mode==="words"){let Ge="custom";if(["10","25","50","100","200"].includes(`${w.mode2}`)&&(Ge=`${w.mode2}`),!Ne("words",Ge)){vt&&console.log("skipping result due to word filter",w);return}}if(w.quoteLength!==null){let Ge;if(w.quoteLength===0?Ge="short":w.quoteLength===1?Ge="medium":w.quoteLength===2?Ge="long":w.quoteLength===3&&(Ge="thicc"),Ge!==void 0&&!Ne("quoteLength",Ge)){vt&&console.log("skipping result due to quoteLength filter",w);return}}let qt=Ne("language",w.language);if(w.language==="english_expanded"&&Ne("language","english_1k")&&(qt=!0),!qt){vt&&console.log("skipping result due to language filter",w);return}let Ts="off";if(w.punctuation&&(Ts="on"),!Ne("punctuation",Ts)){vt&&console.log("skipping result due to punctuation filter",w);return}let Ls="off";if(w.numbers&&(Ls="on"),!Ne("numbers",Ls)){vt&&console.log("skipping result due to numbers filter",w);return}if(w.funbox===void 0||w.funbox.length===0){if(!Ne("funbox","none")){vt&&console.log("skipping result due to funbox filter",w);return}}else{let Ge=0;for(const xi of w.funbox)if(Ne("funbox",xi)){Ge++;break}if(Ge===0){vt&&console.log("skipping result due to funbox filter",w);return}}let ot=!0;if(w.tags===void 0||w.tags.length===0)(((_e=(we=x())==null?void 0:we.tags)==null?void 0:_e.length)??0)>0?Ne("tags","none")&&(ot=!1):ot=!1;else{const Ge=(bt=(He=x())==null?void 0:He.tags)==null?void 0:bt.map(xi=>xi._id);if(Ge===void 0)return;w.tags.forEach(xi=>{ot&&(Ge!=null&&Ge.includes(xi)?Ne("tags",xi)&&(ot=!1):Ne("tags","none")&&(ot=!1))})}if(ot){vt&&console.log("skipping result due to tag filter",w);return}const eo=Math.abs(w.timestamp-Date.now())/1e3;let fg=!0;if((Ne("date","all")||Ne("date","last_day")&&eo<=86400||Ne("date","last_week")&&eo<=604800||Ne("date","last_month")&&eo<=2592e3||Ne("date","last_3months")&&eo<=7776e3)&&(fg=!1),fg){vt&&console.log("skipping result due to date filter",w);return}Fe.push(w)}catch(Ye){m("Something went wrong when filtering. Resetting filters.",0),console.log(w),console.error(Ye),Em(),Na(),Cn();return}g+=Math.round(w.wpm/60*w.testDuration);const ze=new Date(w.timestamp);ze.setSeconds(0),ze.setMinutes(0),ze.setHours(0),ze.setMilliseconds(0);const ve=ze.getTime(),xt=S[ve];xt!==void 0?(xt.amount++,xt.restarts+=w.restartCount??0,xt.time+=w.testDuration+(w.incompleteTestSeconds??0)-(w.afkDuration??0),w.wpm>xt.maxWpm&&(xt.maxWpm=w.wpm),xt.totalWpm+=w.wpm,xt.totalAcc+=w.acc,xt.totalCon+=w.consistency??0):S[ve]={amount:1,restarts:w.restartCount??0,time:w.testDuration+(w.incompleteTestSeconds??0)-(w.afkDuration??0),maxWpm:w.wpm,totalWpm:w.wpm,totalAcc:w.acc,totalCon:w.consistency??0};const xs=P.histogramDataBucketSize,ca=Math.floor(Math.round(P.fromWpm(w.wpm))/xs);if(q.length<=ca)for(let Ye=q.length;Ye<=ca;Ye++)q.push(0);q[ca]++;let ye=0;if(w.testDuration===void 0&&w.mode2!=="custom"&&w.mode2!=="zen"?w.mode==="time"?ye=parseInt(w.mode2):w.mode==="words"&&(ye=parseInt(w.mode2)/w.wpm*60):ye=parseFloat(w.testDuration),w.incompleteTestSeconds!==void 0?ye+=w.incompleteTestSeconds:w.restartCount!==void 0&&w.restartCount>0&&(ye+=ye/4*w.restartCount),jl+=ye,c<10&&(c++,d+=w.wpm,p+=w.acc,w.consistency!==void 0&&(C+=w.consistency)),l++,w.consistency!==void 0&&(L++,b+=w.consistency,w.consistency>y&&(y=w.consistency)),w.rawWpm!==null&&(h.last10Count<10&&(h.last10Count++,h.last10Total+=w.rawWpm),h.total+=w.rawWpm,h.count++,w.rawWpm>h.max&&(h.max=w.rawWpm)),w.acc>u&&(u=w.acc),f+=w.acc,w.restartCount!==void 0&&(s+=w.restartCount),Ft.push({x:Fe.length,y:V(P.fromWpm(w.wpm)),wpm:V(P.fromWpm(w.wpm)),acc:w.acc,mode:w.mode,mode2:w.mode2,punctuation:w.punctuation,language:w.language,timestamp:w.timestamp,difficulty:w.difficulty,raw:V(P.fromWpm(w.rawWpm)),isPb:w.isPb??!1}),t.push(w.wpm),qi.push({x:Fe.length,y:w.acc,errorRate:100-w.acc}),w.wpm>o)if(o=w.wpm,w.mode==="custom")a=w.mode;else{const Ye=w.punctuation?",<br>with punctuation":"",qt=w.numbers?",<br>with numbers":"";a=w.mode+" "+w.mode2+Ye+qt}n+=w.wpm}),i(".pageAccount .group.history table thead tr td:nth-child(2)").text(r.typingSpeedUnit),await Le(0),iu();const $=[],H=[],R=P.historyStepSize;for(const w of Object.keys(S)){const ze=parseInt(w),ve=S[ze];ve!==void 0&&($.push({x:ze,y:ve.time/60,amount:ve.amount,restarts:ve.restarts,maxWpm:V(P.fromWpm(ve.maxWpm)),avgWpm:V(ve.totalWpm/ve.amount),avgAcc:V(ve.totalAcc/ve.amount),avgCon:V(ve.totalCon/ve.amount)}),H.push({x:ze,y:V(P.fromWpm(ve.totalWpm)/ve.amount)}))}const j=Ja.options.scales.avgWpm;j.title.text="Average "+r.typingSpeedUnit,j.ticks.stepSize=R,Ja.getDataset("count").data=$,Ja.getDataset("avgWpm").data=H;const ne=[],fe=[],me=P.histogramDataBucketSize,St=me-(me<=1?.01:1);q.forEach((w,ze)=>{const ve=ze*me;fe.push(`${ve} - ${ve+St}`),ne.push({x:ve,y:w})}),tn.data.labels=fe,tn.getDataset("count").data=ne;const ra=U.options.scales.wpm;if(ra.title.text=P.fullUnitString,Ft.length>0){let w=0;const ze=[];for(let ye=Ft.length-1;ye>=0;ye--){const we=Ft[ye];we.y>w&&(w=we.y,ze.push(we))}ze.push({x:1,y:(Dn=js(ze))==null?void 0:Dn.y});const ve=[],xt=[],xs=[],ca=[];for(let ye=0;ye<Ft.length;ye++){const we=Ft.slice(ye,ye+10),_e=qi.slice(ye,ye+10),He=we.reduce((ot,{y:eo})=>ot+eo,0)/we.length,bt=_e.reduce((ot,{y:eo})=>ot+eo,0)/_e.length;ve.push({x:ye+1,y:He}),xt.push({x:ye+1,y:bt});const Ye=Ft.slice(ye,ye+100),qt=qi.slice(ye,ye+100),Ts=Ye.reduce((ot,{y:eo})=>ot+eo,0)/Ye.length,Ls=qt.reduce((ot,{y:eo})=>ot+eo,0)/qt.length;xs.push({x:ye+1,y:Ts}),ca.push({x:ye+1,y:Ls})}U.getDataset("wpm").data=Ft,U.getDataset("pb").data=ze,U.getDataset("acc").data=qi,U.getDataset("wpmAvgTen").data=ve,U.getDataset("accAvgTen").data=xt,U.getDataset("wpmAvgHundred").data=xs,U.getDataset("accAvgHundred").data=ca,U.getScale("x").max=Ft.length+1}const Cs=Ft.map(w=>w.y),ks=Math.min(...Cs),Zt=Math.max(...Cs),Jt=isFinite(ks)?ks:0,bo=isFinite(Zt)?Zt:0,Ss=Math.floor(bo)+(R-Math.floor(bo)%R);if(ra.max=Ss,ra.ticks.stepSize=R,U.getScale("pb").max=Ss,U.getScale("wpmAvgTen").max=Ss,U.getScale("wpmAvgHundred").max=Ss,r.startGraphsAtZero)U.getScale("wpm").min=0,U.getScale("pb").min=0,U.getScale("wpmAvgTen").min=0,U.getScale("wpmAvgHundred").min=0;else{const w=Math.floor(Jt/R)*R;U.getScale("wpm").min=w,U.getScale("pb").min=w,U.getScale("wpmAvgTen").min=w,U.getScale("wpmAvgHundred").min=w}Ft===void 0||Ft.length===0?(i(".pageAccount .group.noDataError").removeClass("hidden"),i(".pageAccount .group.chart").addClass("hidden"),i(".pageAccount .group.dailyActivityChart").addClass("hidden"),i(".pageAccount .group.histogramChart").addClass("hidden"),i(".pageAccount .group.aboveHistory").addClass("hidden"),i(".pageAccount .group.history").addClass("hidden"),i(".pageAccount .triplegroup.stats").addClass("hidden"),i(".pageAccount .group.estimatedWordsTyped").addClass("hidden")):(i(".pageAccount .group.noDataError").addClass("hidden"),i(".pageAccount .group.chart").removeClass("hidden"),i(".pageAccount .group.dailyActivityChart").removeClass("hidden"),i(".pageAccount .group.histogramChart").removeClass("hidden"),i(".pageAccount .group.aboveHistory").removeClass("hidden"),i(".pageAccount .group.history").removeClass("hidden"),i(".pageAccount .triplegroup.stats").removeClass("hidden"),i(".pageAccount .group.estimatedWordsTyped").removeClass("hidden")),i(".pageAccount .timeTotalFiltered .val").text(rt(Math.round(jl),!0,!0));const la=r.typingSpeedUnit;i(".pageAccount .highestWpm .title").text(`highest ${la}`),i(".pageAccount .highestWpm .val").text(N.typingSpeed(o)),i(".pageAccount .averageWpm .title").text(`average ${la}`),i(".pageAccount .averageWpm .val").text(N.typingSpeed(n/l)),i(".pageAccount .averageWpm10 .title").text(`average ${la} (last 10 tests)`),i(".pageAccount .averageWpm10 .val").text(N.typingSpeed(d/c)),i(".pageAccount .highestRaw .title").text(`highest raw ${la}`),i(".pageAccount .highestRaw .val").text(N.typingSpeed(h.max)),i(".pageAccount .averageRaw .title").text(`average raw ${la}`),i(".pageAccount .averageRaw .val").text(N.typingSpeed(h.total/h.count)),i(".pageAccount .averageRaw10 .title").text(`average raw ${la} (last 10 tests)`),i(".pageAccount .averageRaw10 .val").text(N.typingSpeed(h.last10Total/h.last10Count)),i(".pageAccount .highestWpm .mode").html(a),i(".pageAccount .testsTaken .val").text(l),i(".pageAccount .highestAcc .val").text(N.accuracy(u)),i(".pageAccount .avgAcc .val").text(N.accuracy(f/l)),i(".pageAccount .avgAcc10 .val").text(N.accuracy(p/c)),b===0||b===void 0?(i(".pageAccount .avgCons .val").text("-"),i(".pageAccount .avgCons10 .val").text("-")):(i(".pageAccount .highestCons .val").text(N.percentage(y)),i(".pageAccount .avgCons .val").text(N.percentage(b/L)),i(".pageAccount .avgCons10 .val").text(N.percentage(C/Math.min(c,L)))),i(".pageAccount .testsStarted .val").text(`${l+s}`),i(".pageAccount .testsCompleted .val").text(`${l}(${Math.floor(l/(l+s)*100)}%)`),i(".pageAccount .testsCompleted .avgres").text(`
    ${(s/l).toFixed(1)} restarts per completed test
  `);const El=Fe.map(w=>w.wpm).reverse(),Si=W1(El);if(Si){const ze=(Si[1][1]-Si[0][1])*(3600/jl),ve=ze>0?"+":"";i(".pageAccount .group.chart .below .text").text(`Speed change per hour spent typing: ${ve+N.typingSpeed(ze,{showDecimalPlaces:!0})} ${r.typingSpeedUnit}`)}i(".pageAccount .estimatedWordsTyped .val").text(g),(Ft.length||qi.length)&&(OM(),U.options.animation=!1,U.update(),delete U.options.animation),await Le(0),Ja.update(),tn.update(),Do(!1),i(".page.pageAccount").css("height","unset"),setTimeout(()=>{_m("account")},0)}async function Bm(e){const t=await $p(e);if(!t&&!tt()){m("Could not get results - you are offline",-1,{duration:5});return}IA(),t&&Na()}async function Cn(){await Bm();try{await Le(0),await L0()}catch(e){console.error(e),m(`Something went wrong: ${e}`,-1)}}function T_(e,t){var s,n;const o=[];if(t.length>0)for(const l of t)(n=(s=x())==null?void 0:s.tags)==null||n.forEach(c=>{l===c._id&&o.push(c.display)});const a=i(`.pageAccount .resultEditTagsButton[data-result-id='${e}']`);a.attr("data-tags",JSON.stringify(t)),t.length>0?(a.attr("aria-label",o.join(", ")),a.addClass("active"),t.length>1?a.html('<i class="fas fa-fw fa-tags"></i>'):a.html('<i class="fas fa-fw fa-tag"></i>')):(a.attr("aria-label","no tags"),a.removeClass("active"),a.html('<i class="fas fa-fw fa-tag"></i>'))}function vs(e,t,o=null){var c,d;if(i("td").removeClass("headerSorted"),i("td").children("i").remove(),i(t).addClass("headerSorted"),Fe.length<2)return;const a=e;let s=!0;o!==null?o?i(t).append('<i class="fas fa-sort-down" aria-hidden="true"></i>'):(s=!1,i(t).append('<i class="fas fa-sort-up" aria-hidden="true"></i>')):parseInt((c=Fe==null?void 0:Fe[0])==null?void 0:c[a])<=parseInt((d=Fe==null?void 0:Fe[Fe.length-1])==null?void 0:d[a])?(s=!0,i(t).append('<i class="fas fa-sort-down" aria-hidden="true"></i>')):(s=!1,i(t).append('<i class="fas fa-sort-up", aria-hidden="true"></i>'));const n=[],l=[];for(;n.length<Fe.length;){let u=Number.MAX_VALUE,f=-1,p=-1;for(const[h,g]of Fe.entries())s?g[a]>=f&&!l.includes(h)&&(f=g[a],p=h):g[a]<=u&&!l.includes(h)&&(u=g[a],p=h);n.push(Fe[p]),l.push(p)}Fe=n,i(".pageAccount .history table tbody").empty(),Bs=0,iu()}i(".pageAccount button.toggleResultsOnChart").on("click",()=>{const e=[...r.accountChart];e[0]=e[0]==="on"?"off":"on",_d(e)});i(".pageAccount button.toggleAccuracyOnChart").on("click",()=>{const e=[...r.accountChart];e[1]=e[1]==="on"?"off":"on",_d(e)});i(".pageAccount button.toggleAverage10OnChart").on("click",()=>{const e=[...r.accountChart];e[2]=e[2]==="on"?"off":"on",_d(e)});i(".pageAccount button.toggleAverage100OnChart").on("click",()=>{const e=[...r.accountChart];e[3]=e[3]==="on"?"off":"on",_d(e)});i(".pageAccount .loadMoreButton").on("click",()=>{iu()});i(".pageAccount #accountHistoryChart").on("click",()=>{var s;const e=Yv;if(iu(e),window===void 0)return;const t=i(window).height()??0,a=(((s=i(`#result-${e}`).offset())==null?void 0:s.top)??0)-t/2;i([document.documentElement,document.body]).stop(!0).animate({scrollTop:a},{duration:ge(500),done:()=>{const n=i(`#result-${e}`);i(".resultRow").removeClass("active"),requestAnimationFrame(()=>n.addClass("active"))}})});i(".pageAccount").on("click",".miniResultChartButton",async e=>{var n,l;const t=i(e.currentTarget);if(t.hasClass("loading")||t.hasClass("disabled"))return;const o=t.attr("filteredResultsId");if(o===void 0)return;const a=Fe[parseInt(o)];if(a===void 0)return;let s=a.chartData;if(s===void 0){t.addClass("loading"),t.attr("aria-label",null),t.html('<i class="fas fa-fw fa-spin fa-circle-notch"></i>'),J();const c=await E.results.getById({params:{resultId:a._id}});if(K(),t.html('<i class="fas fa-fw fa-chart-line"></i>'),t.removeClass("loading"),c.status!==200){m("Error fetching result: "+c.body.message,-1);return}s=c.body.data.chartData,a.chartData=s;const d=(l=(n=x())==null?void 0:n.results)==null?void 0:l.find(u=>u._id===a._id);if(d!==void 0&&(d.chartData=a.chartData),c.body.data.chartData==="toolong"){t.attr("aria-label","Graph history is not available for long tests"),t.attr("data-baloon-pos","up"),t.addClass("disabled"),m("Graph history is not available for long tests",0);return}}t.attr("aria-label","View graph"),l_(s)});i(".pageAccount .group.history").on("click",".history-wpm-header",()=>{vs("wpm",".history-wpm-header")});i(".pageAccount .group.history").on("click",".history-raw-header",()=>{vs("rawWpm",".history-raw-header")});i(".pageAccount .group.history").on("click",".history-acc-header",()=>{vs("acc",".history-acc-header")});i(".pageAccount .group.history").on("click",".history-correct-chars-header",()=>{vs("correctChars",".history-correct-chars-header")});i(".pageAccount .group.history").on("click",".history-incorrect-chars-header",()=>{vs("incorrectChars",".history-incorrect-chars-header")});i(".pageAccount .group.history").on("click",".history-consistency-header",()=>{vs("consistency",".history-consistency-header")});i(".pageAccount .group.history").on("click",".history-date-header",()=>{vs("timestamp",".history-date-header")});i(".pageAccount .group.history").on("click",".buttonsAndTitle .buttons button",()=>{vs("timestamp",".history-date-header",!0)});i(".pageAccount .group.topFilters, .pageAccount .filterButtons").on("click","button",()=>{setTimeout(()=>{Cn()},0)});i(".pageAccount .group.presetFilterButtons").on("click",".filterBtns .filterPresets .select-filter-preset",async e=>{await YE(i(e.target).data("id")),Cn()});i(".pageAccount .content .group.aboveHistory .exportCSV").on("click",()=>{Vk(Fe)});i(".pageAccount .profile").on("click",".details .copyLink",()=>{const e=x();if(!e)return;const{name:t}=e,o=`${location.origin}/profile/${t}`;navigator.clipboard.writeText(o).then(function(){m("URL Copied to clipboard",0)},function(){alert("Failed to copy using the Clipboard API. Here's the link: "+o)})});i(".pageAccount button.loadMoreResults").on("click",async()=>{var t,o;const e=((o=(t=x())==null?void 0:t.results)==null?void 0:o.length)??0;J(),Vf(),await Bm(e),await L0(),K()});be(e=>{Z()==="account"&&e==="typingSpeedUnit"&&Cn()});const L_=new Oa({id:"account",element:i(".page.pageAccount"),path:"/account",loadingOptions:{loadingMode:()=>{var e;return((e=x())==null?void 0:e.results)===void 0?"sync":"none"},loadingPromise:async()=>{if(x()===null)throw new Error("Looks like your account data didn't download correctly. Please refresh the page.<br>If this error persists, please contact support.");return Bm()},style:"bar",keyframes:[{percentage:90,durationMs:2e3,text:"Downloading results..."}]},afterHide:async()=>{x_(),i_(),Et("pageAccount")},beforeShow:async()=>{Yt("pageAccount","main");const e=x();b0(),await s_(Cn),Na(),await Le(0),Kf=document.querySelector(".page.pageAccount .testActivity"),x0(Kf,"current",e!==void 0?new Date(e.addedAt).getFullYear():2020),await Cn().then(()=>{var t;S_(),i(".pageAccount .content .accountVerificatinNotice").remove(),((t=go())==null?void 0:t.emailVerified)===!1&&i(".pageAccount .content").prepend('<div class="accountVerificatinNotice"><i class="fas icon fa-exclamation-triangle"></i><p>Your email address is still not verified</p><button class="sendVerificationEmail">resend verification email</button></div>'),v_()})}});i(()=>{Xt("pageAccount")});let nd=!1;function $0(){i(".scrollToTopButton").addClass("invisible"),nd=!1}function $_(){i(".scrollToTopButton").removeClass("invisible"),nd=!0}i(document).on("click",".scrollToTopButton",()=>{i(".scrollToTopButton").addClass("invisible"),window.scrollTo({top:0,behavior:Kk()?"instant":"smooth"})});i(window).on("scroll",()=>{if(Z()==="test")return;const t=window.scrollY;!nd&&t>100?$_():nd&&t<100&&$0()});const M_=new Oa({id:"test",element:i(".page.pageTest"),path:"/",beforeHide:async()=>{i("#wordsInput").trigger("focusout")},afterHide:async()=>{ee(),z({noAnim:!0}),Ui(),Nt(),td(!0)},beforeShow:async()=>{td(!1),Hv(),ee(),z({noAnim:!0}),Fw(),Yc(),$0()}});function A_(){i(".pageAbout .contributors").empty(),i(".pageAbout .supporters").empty(),on.getDataset("count").data=[],on.updateColors()}let rd,Qa;function E_(){var e;if(rd){on.updateColors();const t=B_(rd);on.data.labels=t.labels,on.getDataset("count").data=t.data}if(Qa){const t=Math.round(Qa.timeTyping),o=Yy({start:0,end:t*1e3});i(".pageAbout #totalTimeTypingStat .val").text(((e=o.years)==null?void 0:e.toString())??""),i(".pageAbout #totalTimeTypingStat .valSmall").text("years"),i(".pageAbout #totalTimeTypingStat").attr("aria-label",yu(Math.round(t/3600))+" hours");const a=kg(Qa.testsStarted);i(".pageAbout #totalStartedTestsStat .val").text(a.rounded<10?a.roundedTo2:a.rounded),i(".pageAbout #totalStartedTestsStat .valSmall").text(a.orderOfMagnitude),i(".pageAbout #totalStartedTestsStat").attr("aria-label",yu(Qa.testsStarted)+" tests");const s=kg(Qa.testsCompleted);i(".pageAbout #totalCompletedTestsStat .val").text(s.rounded<10?s.roundedTo2:s.rounded),i(".pageAbout #totalCompletedTestsStat .valSmall").text(s.orderOfMagnitude),i(".pageAbout #totalCompletedTestsStat").attr("aria-label",yu(Qa.testsCompleted)+" tests")}}async function __(){if(rd&&Qa)return;if(!tt()){m("Cannot update all time stats - offline",0);return}const e=await E.public.getSpeedHistogram({query:{language:"english",mode:"time",mode2:"60"}});e.status===200?rd=e.body.data:m(`Failed to get global speed stats for histogram: ${e.body.message}`,-1);const t=await E.public.getTypingStats();t.status===200?Qa=t.body.data:m(`Failed to get global typing stats: ${e.body.message}`,-1)}async function I_(){const{data:e,error:t}=await Qt(jL());t&&m(ie(t,"Failed to get supporters"),-1);const{data:o,error:a}=await Qt(QL());a&&m(ie(a,"Failed to get contributors"),-1),__().then(()=>{E_()});const s=document.querySelector(".pageAbout .supporters");let n="";for(const d of e??[])n+=`<div>${ft(d)}</div>`;s&&(s.innerHTML=n);const l=document.querySelector(".pageAbout .contributors");let c="";for(const d of o??[])c+=`<div>${ft(d)}</div>`;l&&(l.innerHTML=c)}function B_(e){const t=[],o=[],a=Object.keys(e).sort((s,n)=>parseInt(s,10)-parseInt(n,10));for(const[s,n]of a.entries()){const l=a[s+1],c=parseInt(n,10);if(t.push({x:c,y:e[c]}),o.push(`${c} - ${c+9}`),l!==void 0&&c+10!==parseInt(l,10))for(let d=c+10;d<parseInt(l,10);d+=10)t.push({x:d,y:0}),o.push(`${d} - ${d+9}`)}return{data:t,labels:o}}const q_=new Oa({id:"about",element:i(".page.pageAbout"),path:"/about",afterHide:async()=>{A_(),Et("pageAbout")},beforeShow:async()=>{Yt("pageAbout","main"),I_()}});i(()=>{Xt("pageAbout")});const F_=["gmaill.com","gamil.com","gmali.com","gnail.com","gmil.com","gamail.com","hotmai.com","gmial.com","hotmal.com","yaho.com","outlokk.com","gmil.com","hotmial.com","yahooo.com","otulook.com","gamil.com","hotnail.com","yaoo.com","outlok.com","gmail.cmo","hotmail.cmo","yahho.com","outloook.com","gmaail.com","hottmail.com","yaho.com","outllok.com","gmai.com","hotmil.com","yhaoo.com","outlookk.com","gmil.com","htmial.com","yaahoo.com","otlook.com","gamail.com","hotnail.com","yaoho.com","outlok.com","gemail.com","hotmiall.com","yahhoo.com","outloookk.com","gmal.com","hottmail.com","yahio.com","outlokkk.com",".comm",".con",".cmo",".coom",".cim",".vom","-online.de","-tonline.de","acor.de","aecor.de","ahoo.de","al.com","ao.com","aol.cm","aol.con","aol.ocm","aol.om","aoll.com","apl.com","arco.de","arocr.de","aror.de","feenet.de","freeenet.de","freeent.de","freeet.de","freemet.de","freeneet.de","freent.de","frenet.de","gm.de","gm.net","gm.xde","gmc.de","gmx.ded","gmx.dw","gmxx.de","gmy.de","gx.de","hmx.de","homail.de","hotmai.de","hotmal.de","mx.de","mx.net","@otmail.com","r-online.de","rcor.de","reenet.de","t--online.de","t-0nline.de","t-nline.de","t-oline.de","t-omline.de","t-onine.de","t-onlien.de","t-onliine.de","t-onlin.de","t-onlinde.de","t-onlinr.de","t-onlione.de","t-onlline.de","t-onlne.de","t-onlone.de","t.-online.de","t.online.de","tonline.de","wb.de","we.de","web.ded","web.dw","wed.de","weeb.de","wen.de","wweb.de","yaho.de","yahooo.de","yaoo.de","yhoo.de","yahhoo.de","icoud.com","icloud.cim","icloud.con","icloud.ocm","icloud.om","icloud.cm"];let is={};function qm(){i(".page.pageLogin .register.side button").prop("disabled",!1)}function Tl(){i(".page.pageLogin .register.side button").prop("disabled",!0)}function oa(){i(".pageLogin input").prop("disabled",!1),i(".pageLogin button").prop("disabled",!1)}function Fm(){i(".pageLogin input").prop("disabled",!0),i(".pageLogin button").prop("disabled",!0)}function Rm(){i(".pageLogin .preloader").removeClass("hidden")}function Zo(){i(".pageLogin .preloader").addClass("hidden")}function M0(){return is.name!==void 0&&is.email!==void 0&&is.password!==void 0}const ci=()=>{M0()?qm():Tl()};function R_(){return M0()?is:!1}const xh=document.querySelector(".page.pageLogin .register.side input.usernameInput");ia(xh,{schema:Cd,isValid:async e=>(await E.users.getNameAvailability({params:{name:e}})).status===200?!0:"Name not available",debounceDelay:1e3,callback:e=>{is.name=e.status==="success"?xh.value:void 0,ci()}});let bc=null,Th=!1;const vc=ia(document.querySelector(".page.pageLogin .register.side input.emailInput"),{schema:Lc,isValid:async e=>{if(/@.*(student|education|school|\.edu$|\.edu\.|\.ac\.|\.sch\.)/i.test(e))return{warning:"Some education emails will fail to receive our messages, or disable the account as soon as you graduate. Consider using a personal email address."};if(F_.some(a=>e.endsWith(a)))return{warning:"Please check your email address, it may contain a typo."};if(bc&&bc.isDisposableEmail!==void 0)try{if(bc.isDisposableEmail(e))return{warning:"Using a temporary email may cause issues with logging in, password resets and support. Consider using a permanent email address. Don't worry, we don't send spam."}}catch{}return!0},debounceDelay:0,callback:e=>{e.status==="success"&&A0.dispatchEvent(new Event("input"))}});vc.addEventListener("focus",async()=>{if(!Th){Th=!0;try{bc=await Sd(()=>import("./vendor.DwUKJXLy.js").then(e=>e.i),__vite__mapDeps([0,1,2]))}catch{}}});const A0=document.querySelector(".page.pageLogin .register.side input.verifyEmailInput");ia(A0,{isValid:async e=>vc.value===e?!0:"verify email not matching email",debounceDelay:0,callback:e=>{is.email=vc.isValid()&&e.status==="success"?vc.value:void 0,ci()}});const Du=ia(document.querySelector(".page.pageLogin .register.side .passwordInput"),{schema:Vy,callback:e=>{e.status==="success"&&E0.dispatchEvent(new Event("input"))}}),E0=document.querySelector(".page.pageLogin .register.side .verifyPasswordInput");ia(E0,{isValid:async e=>Du.value===e?!0:"verify password not matching password",debounceDelay:0,callback:e=>{is.password=Du.isValid()&&e.status==="success"?Du.value:void 0,ci()}});const D_=new Oa({id:"login",element:i(".page.pageLogin"),path:"/login",afterHide:async()=>{Zo(),Et("pageLogin")},beforeShow:async()=>{Yt("pageLogin","main"),is={},i(".pageLogin input").val(""),i(".pageLogin .register .indicator").addClass("hidden"),oa(),Tl()}});i(()=>{Xt("pageLogin")});const Ll=i(".page.pageLoading"),nu=Ll.find(".bar"),Dm=Ll.find(".error"),Wm=Ll.find(".spinner"),ru=Ll.find(".text");async function Gf(e,t){return new Promise(o=>{nu.find(".fill").stop(!0,!1).animate({width:e+"%"},t,()=>{o()})})}function ld(e){ru.removeClass("hidden").html(e)}function W_(){nu.addClass("hidden"),Dm.addClass("hidden"),Wm.removeClass("hidden"),ru.addClass("hidden")}function P_(){nu.addClass("hidden"),Wm.addClass("hidden"),Dm.removeClass("hidden"),ru.addClass("hidden")}async function z_(){nu.removeClass("hidden"),Dm.addClass("hidden"),Wm.addClass("hidden"),ru.addClass("hidden")}const Es=new Oa({id:"loading",element:Ll,path:"/",afterHide:async()=>{Et("pageLoading")},beforeShow:async()=>{Yt("pageLoading","main")}}),H_=Sn.recaptchaSiteKey,$a={};function Pm(){if(!("grecaptcha"in window))throw new Error("grecaptcha is not defined");return window.grecaptcha}function di(){return"grecaptcha"in window}function Bn(e,t,o){if($a[t]!==void 0&&$a[t]!==null)return;const a=Pm().render(e,{sitekey:H_,callback:o});$a[t]=a}function Ra(e){$a[e]===void 0||$a[e]===null||Pm().reset($a[e])}function $l(e){return $a[e]===void 0||$a[e]===null?"":Pm().getResponse($a[e])}class Zr{constructor(t,o){this.textareaElement=t,this.maxLength=o,this.textareaElement.attr("maxlength",this.maxLength.toString()),this.textareaElement.parent().hasClass("textareaWithCounter")||i(this.textareaElement).wrap('<div class="textareaWithCounter"></div>'),this.parentElement=i(this.textareaElement).parent(".textareaWithCounter"),this.parentElement.find(".char-counter").length===0?(this.counterElement=i('<span class="char-counter"></span>'),this.parentElement.append(this.counterElement)):this.counterElement=this.parentElement.find(".char-counter"),this.updateCounter(),this.textareaElement.on("input",()=>this.updateCounter())}updateCounter(){const t=this.maxLength,o=this.textareaElement.val().length,a=t-o;this.counterElement.text(`${o}/${t}`);const s=a/this.maxLength*100;this.counterElement.removeClass("warning"),this.counterElement.removeClass("error"),s===0?this.counterElement.addClass("error"):s<10&&this.counterElement.addClass("warning")}setMaxLength(t){this.maxLength=t,this.updateCounter()}}const cd={userUid:void 0,lbOptOut:void 0};let Qn;async function O_(e){if(!B()){m("You must be logged in to submit a report",0);return}if(!di()){m("Could not show user report popup: Captcha is not available. This could happen due to a blocked or failed network request. Please refresh the page or contact support if this issue persists.",-1);return}_0.show({mode:"dialog",focusFirstInput:!0,beforeAnimation:async t=>{Bn(t.querySelector(".g-recaptcha"),"userReportModal");const{name:o}=e;cd.userUid=e.uid,cd.lbOptOut=e.lbOptOut,t.querySelector(".user").textContent=o,t.querySelector(".reason").value="Inappropriate name",t.querySelector(".comment").value="",Qn=new st({select:t.querySelector(".reason"),settings:{showSearch:!1,contentLocation:t}})}}),new Zr(i("#userReportModal .comment"),250)}async function N_(){_0.hide()}async function U_(){const e=$l("userReportModal");if(!e){m("Please complete the captcha");return}const t=i("#userReportModal .reason").val(),o=i("#userReportModal .comment").val(),a=e;if(!t){m("Please select a valid report reason");return}if(!o){m("Please provide a comment");return}if(t==="Suspected cheating"&&cd.lbOptOut){m("You cannot report this user for suspected cheating as they have opted out of the leaderboards.",0,{duration:10});return}const s=o.length-250;if(s>0){m(`Report comment is ${s} character(s) too long`);return}J();const n=await E.users.report({body:{uid:cd.userUid,reason:t,comment:o,captcha:a}});if(K(),n.status!==200){m("Failed to report user: "+n.body.message,-1);return}m("Report submitted. Thank you!",1),N_()}const _0=new re({dialogId:"userReportModal",setup:async e=>{var t;(t=e.querySelector("button"))==null||t.addEventListener("click",()=>{U_()})},cleanup:async()=>{Qn==null||Qn.destroy(),Qn=void 0,Ra("userReportModal")}}),V_=yb();function Lh(){i(".page.pageProfile .error").addClass("hidden"),i(".page.pageProfile .preloader").removeClass("hidden"),i(".page.pageProfile .profile").html(`
      <div class="details none">
        <div class="avatarAndName">
          <div class="avatar"></div>
          <div>
             <div class="user">
              <div class="name">-</div>
              <div class="userFlags"></div>
            </div>
            <div class="badges"></div>
            <div class="allBadges"></div>
            <div class="joined" data-balloon-pos="up">-</div>
	          <div class="streak" data-balloon-pos="up">-</div>
          </div>
          <div class="levelAndBar">
            <div class="level" data-balloon-pos="up">-</div>
            <div class="xpBar" data-balloon-pos="up">
              <div class="bar" style="width: 0%;"></div>
            </div>
            <div class="xp" data-balloon-pos="up">-/-</div>
          </div>
        </div>
        <div class="separator sep1"></div>
        <div class="typingStats vertical">
          <div class="started">
            <div class="title">tests started</div>
            <div class="value">-</div>
          </div>
          <div class="completed">
            <div class="title">tests completed</div>
            <div class="value">-</div>
          </div>
          <div class="timeTyping">
            <div class="title">time typing</div>
            <div class="value">-</div>
          </div>
        </div>
        <div class="separator sep2 hidden"></div>

        <div class="bioAndKeyboard vertical hidden">
          <div class="bio">
            <div class="title">bio</div>
            <div class="value">-</div>
          </div>
          <div class="keyboard hidden">
            <div class="title">keyboard</div>
            <div class="value">-</div>
          </div>
        </div>
        <div class="separator sep3 hidden"></div>

        <div class="socials big hidden">
          <div class="title">socials</div>
          <div class="value">-</div>
        </div>
        <div class="buttonGroup">
          <button
            class="userReportButton"
            data-balloon-pos="left"
            aria-label="Report user"
          >
            <i class="fas fa-flag"></i>
          </button>
        </div>
      </div>
      <div class="leaderboardsPositions">
        <div class="title">All-Time English Leaderboards</div>
        <div class="group t15">
          <div class="testType">15 seconds</div>
          <div class="pos">-</div>
          <div class="topPercentage">-</div>
        </div>
        <div class="group t60">
          <div class="testType">60 seconds</div>
          <div class="pos">-</div>
          <div class="topPercentage">-</div>
        </div>
      </div>
      <div class="pbsWords">
        <div class="group">
          <div class="quick">
            <div class="test">10 words</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">25 words</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">50 words</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">100 words</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
      </div>
      <div class="pbsTime">
        <div class="group">
          <div class="quick">
            <div class="test">15 seconds</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">30 seconds</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">60 seconds</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">120 seconds</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
      </div><div class="lbOptOutReminder hidden"></div>
      `);const e=document.querySelector(".page.pageProfile .testActivity");e!==null&&Im(e)}async function K_(e){const t=Gk("isUid");if(e.data)i(".page.pageProfile .preloader").addClass("hidden"),await id("profile",e.data),Nf(e.data.personalBests,!0);else if(e.uidOrName!==void 0&&e.uidOrName!==""){const o=await E.users.getProfile({params:{uidOrName:e.uidOrName},query:{isUid:t}});if(i(".page.pageProfile .preloader").addClass("hidden"),o.status===404){const a=t?"User not found":`User ${e.uidOrName} not found`;i(".page.pageProfile .preloader").addClass("hidden"),i(".page.pageProfile .error").removeClass("hidden"),i(".page.pageProfile .error .message").text(a)}else if(o.status===200){const a=o.body.data;window.history.replaceState(null,"",`/profile/${a.name}`),await id("profile",a),Nf(a.personalBests,!0);const s=document.querySelector(".page.pageProfile .testActivity");if(a.testActivity!==void 0){const n=new cr(a.testActivity.testsByDays,new Date(a.testActivity.lastDay),V_);k0(s,n);const l=s.querySelector(".top .title");l.innerHTML=(l==null?void 0:l.innerHTML)+" in last 12 months"}else Im(s)}else{m("Failed to load profile: "+o.body.message,-1);return}}else m("Missing update parameter!",-1)}i(".page.pageProfile").on("click",".profile .userReportButton",()=>{const e=i(".page.pageProfile .profile").attr("uid")??"",t=i(".page.pageProfile .profile").attr("name")??"",o=(i(".page.pageProfile .profile").attr("lbOptOut")??"false")==="true";O_({uid:e,name:t,lbOptOut:o})});const G_=new Oa({id:"profile",element:i(".page.pageProfile"),path:"/profile",afterHide:async()=>{Et("pageProfile"),Lh()},beforeShow:async e=>{var o;Yt("pageProfile","main");const t=((o=e==null?void 0:e.params)==null?void 0:o.uidOrName)??"";t?(i(".page.pageProfile .preloader").removeClass("hidden"),i(".page.pageProfile .search").addClass("hidden"),i(".page.pageProfile .content").removeClass("hidden"),Lh(),K_({uidOrName:t,data:e==null?void 0:e.data})):(i(".page.pageProfile .preloader").addClass("hidden"),i(".page.pageProfile .search").removeClass("hidden"),i(".page.pageProfile .content").addClass("hidden"))}});Xt("pageProfile");const j_=new Oa({id:"profileSearch",element:i(".page.pageProfileSearch"),path:"/profile",afterHide:async()=>{Et("pageProfileSearch")},beforeShow:async()=>{Yt("pageProfileSearch","main"),i(".page.pageProfileSearch input").val("")},afterShow:async()=>{i(".page.pageProfileSearch input").trigger("focus")}}),Q_=new Oa({id:"404",element:i(".page.page404"),path:"/404",afterHide:async()=>{Et("page404")},beforeShow:async()=>{Yt("page404","main")}});Xt("page404");const Y_=D.enum(["allTime","weekly","daily"]),Wu="EEEE, do MMMM yyyy",$h="EEEE, do MMMM yyyy HH:mm",v={loading:!0,updating:!1,type:"allTime",mode:"time",mode2:"15",data:null,userData:null,page:0,pageSize:50,title:"All-time English Time 15 Leaderboard",scrollToUserAfterFill:!1,goToUserPage:!1},I0=D.object({type:Y_,mode:Ky.optional(),mode2:D.string().optional(),language:Ny.optional(),yesterday:D.boolean().optional(),lastWeek:D.boolean().optional()}),X_=I0.extend({page:D.number(),goToUserPage:D.boolean()}).partial(),B0=new Bt({key:"leaderboardSelector",schema:I0,fallback:{type:"allTime",mode2:"15"}}),ns={allTime:{time:{15:["english"],60:["english"]}},daily:{}};function Ml(){const e=v.type==="allTime"?"All-time":v.type==="weekly"?"Weekly XP":"Daily",t=v.type!=="weekly"?_t(v.language):"",o=v.type!=="weekly"?` ${_t(v.mode)} ${v.mode2}`:"";if(v.title=`${e} ${t} ${o} Leaderboard`,i(".page.pageLeaderboards .bigtitle >.text").text(v.title),i(".page.pageLeaderboards .bigtitle .subtext").addClass("hidden"),i(".page.pageLeaderboards .bigtitle button").addClass("hidden"),i(".page.pageLeaderboards .bigtitle .subtext .divider").addClass("hidden"),v.type==="daily"){i(".page.pageLeaderboards .bigtitle .subtext").removeClass("hidden"),i(".page.pageLeaderboards .bigtitle button[data-action='toggleYesterday']").removeClass("hidden"),i(".page.pageLeaderboards .bigtitle .subtext .divider").removeClass("hidden"),v.yesterday?i(".page.pageLeaderboards .bigtitle button[data-action='toggleYesterday']").html(`
        <i class="fas fa-forward"></i>
            show today
        `):i(".page.pageLeaderboards .bigtitle button[data-action='toggleYesterday']").html(`
        <i class="fas fa-backward"></i>
            show yesterday
        `);let a=XS(new Vo);v.yesterday&&(a=ZS(a)),Bh(te(a,Wu)+" UTC",Ql(a),Ql(Xy(a)))}else if(v.type==="weekly"){i(".page.pageLeaderboards .bigtitle .subtext").removeClass("hidden"),i(".page.pageLeaderboards .bigtitle button[data-action='toggleLastWeek']").removeClass("hidden"),i(".page.pageLeaderboards .bigtitle .subtext .divider").removeClass("hidden"),v.lastWeek?i(".page.pageLeaderboards .bigtitle button[data-action='toggleLastWeek']").html(`
        <i class="fas fa-forward"></i>
            show this week
        `):i(".page.pageLeaderboards .bigtitle button[data-action='toggleLastWeek']").html(`
        <i class="fas fa-backward"></i>
            show last week
        `);let a=JS(new Vo,{weekStartsOn:1});v.lastWeek&&(a=e1(a,7));const s=Zy(a,{weekStartsOn:1}),n=`${te(a,Wu)} - ${te(s,Wu)} UTC`;Bh(n,Ql(a),Ql(s))}}async function qn(e=!1){var n;e?(v.updating=!0,v.error=void 0):(v.loading=!0,v.error=void 0,v.data=null,v.userData=null),Da();const t=(l,c,d)=>({rank:async()=>c({query:d}),data:async()=>l({query:{...d,page:v.page,pageSize:v.pageSize}})});let o;if(v.type==="allTime")o=t(E.leaderboards.get,E.leaderboards.getRank,{language:"english",mode:"time",mode2:v.mode2});else if(v.type==="daily")o=t(E.leaderboards.getDaily,E.leaderboards.getDailyRank,{language:v.language,mode:v.mode,mode2:v.mode2,daysBefore:v.yesterday?1:void 0});else if(v.type==="weekly")o=t(E.leaderboards.getWeeklyXp,E.leaderboards.getWeeklyXpRank,{weeksBefore:v.lastWeek?1:void 0});else throw new Error("unknown state type");if((!B()||v.userData!==null)&&(o.rank=void 0),v.goToUserPage&&o.rank!==void 0){v.goToUserPage=!1;const l=await o.rank();l!==void 0&&l.status===200&&l.body.data!==null&&(v.userData=l.body.data,v.page=Math.floor((v.userData.rank-1)/v.pageSize),vi()),o.rank=void 0}const[a,s]=await Promise.all([o.data(),(n=o.rank)==null?void 0:n.call(o)]);a.status===200?(v.data=a.body.data.entries,v.count=a.body.data.count,v.pageSize=a.body.data.pageSize,v.type==="daily"&&(v.minWpm=a.body.data.minWpm)):(v.data=null,a.status===404?v.error="No leaderboard found":(v.error="Something went wrong",m("Failed to get leaderboard: "+a.body.message,-1))),v.userData===null&&s!==void 0&&(s.status===200?s.body.data!==null&&(v.userData=s.body.data):(v.userData=null,v.error="Something went wrong",m("Failed to get rank: "+s.body.message,-1))),v.loading=!1,v.updating=!1,Da(),!e&&B()&&q0()}function Z_(){const e=i(".page.pageLeaderboards .titleAndButtons .jumpButtons");e.find("button").removeClass("active");const t=Math.ceil(v.count/v.pageSize);if(t<=1?e.find("button").addClass("disabled"):e.find("button").removeClass("disabled"),v.page===0?(e.find("button[data-action='previousPage']").addClass("disabled"),e.find("button[data-action='firstPage']").addClass("disabled")):(e.find("button[data-action='previousPage']").removeClass("disabled"),e.find("button[data-action='firstPage']").removeClass("disabled")),B()){const o=e.find("button[data-action='userPage']");if(!v.userData)o.addClass("disabled");else{const a=Math.floor((v.userData.rank-1)/v.pageSize);v.page===a?o.addClass("disabled"):o.removeClass("disabled")}}v.page>=t-1?e.find("button[data-action='nextPage']").addClass("disabled"):e.find("button[data-action='nextPage']").removeClass("disabled")}function J_(e,t=!1){var s;const o={wpm:N.typingSpeed(e.wpm,{showDecimalPlaces:!0}),acc:N.percentage(e.acc,{showDecimalPlaces:!0}),raw:N.typingSpeed(e.raw,{showDecimalPlaces:!0}),con:N.percentage(e.consistency,{showDecimalPlaces:!0})},a=document.createElement("tr");return t&&a.classList.add("me"),a.dataset.uid=e.uid,a.innerHTML=`
    
      <td>${e.rank===1?'<i class="fas fa-fw fa-crown"></i>':e.rank}</td>
      <td>
        <div class="avatarNameBadge">
          <div class="avatarPlaceholder"></div>
          <a href="${location.origin}/profile/${e.uid}?isUid" class="entryName" uid=${e.uid} router-link>${e.name}</a>
          <div class="flagsAndBadge">
            ${rl(e)}
            ${Ce(e.badgeId)?Xr(e.badgeId):""}
          </div>
        </div>
      </td>
      <td class="stat narrow">
      ${o.wpm}
        <div class="sub">${o.acc}</div>
      </td>
      </td>
      <td class="stat narrow rawAndConsistency">
      ${o.raw}
        <div class="sub">${o.con}</div>
      </td>
      <td class="stat wide">${o.wpm}</td>
      <td class="stat wide">${o.acc}</td>
      <td class="stat wide">${o.raw}</td>
      <td class="stat wide">${o.con}</td>
      <td class="date">${te(e.timestamp,"dd MMM yyyy")}<div class="sub">${te(e.timestamp,"HH:mm")}</div></td>
    
  `,(s=a.querySelector(".avatarPlaceholder"))==null||s.replaceWith(Ad(e)),a}function eI(e,t=!1){var s;const o=o1(e.lastActivityTimestamp,{addSuffix:!0}),a=document.createElement("tr");return t&&a.classList.add("me"),a.dataset.uid=e.uid,a.innerHTML=`
      <td>${e.rank===1?'<i class="fas fa-fw fa-crown"></i>':e.rank}</td>
      <td>
        <div class="avatarNameBadge">
          <div class="avatarPlaceholder"></div>
          <a href="${location.origin}/profile/${e.uid}?isUid" class="entryName" uid=${e.uid} router-link>${e.name}</a>
          <div class="flagsAndBadge">
            ${rl(e)}
            ${Ce(e.badgeId)?Xr(e.badgeId):""}
          </div>
        </div>
      </td>
      <td class="stat wide">${e.totalXp<1e3?e.totalXp:Mc(e.totalXp)}</td>
      <td class="stat wide">${rt(Math.round(e.timeTypedSeconds),!0,!0,":")}</td>
      <td class="stat narrow">
      ${e.totalXp<1e3?e.totalXp:Mc(e.totalXp)}
      <div class="sub">${rt(Math.round(e.timeTypedSeconds),!0,!0,":")}</td>
      </td>
      <td class="date" data-balloon-pos="left"  aria-label="${o}">
        ${te(e.lastActivityTimestamp,"dd MMM yyyy")}
        <div class="sub">
          ${te(e.lastActivityTimestamp,"HH:mm")}
        </div>
      </td>
    </tr>
  `,(s=a.querySelector(".avatarPlaceholder"))==null||s.replaceWith(Ad(e)),a}function tI(){var t,o;const e=i(".page.pageLeaderboards table tbody");if(e.empty(),i(".page.pageLeaderboards table thead").addClass("hidden"),v.type==="allTime"||v.type==="daily"?i(".page.pageLeaderboards table thead.allTimeAndDaily").removeClass("hidden"):v.type==="weekly"&&i(".page.pageLeaderboards table thead.weekly").removeClass("hidden"),v.data===null||v.data.length===0){e.append('<tr><td colspan="7" class="empty">No data</td></tr>'),i(".page.pageLeaderboards table").removeClass("hidden");return}if(v.type==="allTime"||v.type==="daily")for(const a of v.data){const s=((t=go())==null?void 0:t.uid)===a.uid;e.append(J_(a,s))}else if(v.type==="weekly")for(const a of v.data){const s=((o=go())==null?void 0:o.uid)===a.uid;e.append(eI(a,s))}i(".page.pageLeaderboards table").removeClass("hidden")}function Mh(){var a,s,n,l;if(v.type!=="allTime"||v.userData===null)return null;const e=((l=(n=(s=(a=x())==null?void 0:a.lbMemory)==null?void 0:s.time)==null?void 0:n[v.mode2])==null?void 0:l.english)??0,t=v.userData.rank,o=e-t;return o!==0&&$x("time",v.mode2,"english",t,!0),o}function q0(){var t,o,a,s,n;if(B()&&((t=x())==null?void 0:t.lbOptOut)===!0){i(".page.pageLeaderboards .bigUser").html('<div class="warning">You have opted out of the leaderboards.</div>');return}if(B()&&((o=x())==null?void 0:o.banned)===!0){i(".page.pageLeaderboards .bigUser").html('<div class="warning">Your account is banned</div>');return}const e=((a=In())==null?void 0:a.leaderboards.minTimeTyping)??7200;if(B()&&(((n=(s=x())==null?void 0:s.typingStats)==null?void 0:n.timeTyping)??0)<e){i(".page.pageLeaderboards .bigUser").html(`<div class="warning">Your account must have ${a1(Yy({start:0,end:e*1e3}))} typed to be placed on the leaderboard.</div>`);return}if(B()&&v.type==="daily"&&v.userData===null){let l="Not qualified";v.yesterday||(l+=` (min speed required: ${N.typingSpeed(v.minWpm,{showDecimalPlaces:!0,suffix:` ${r.typingSpeedUnit}`})})`),i(".page.pageLeaderboards .bigUser").html(`<div class="warning">${l}</div>`);return}if(B()&&v.userData===null){i(".page.pageLeaderboards .bigUser").html('<div class="warning">Not qualified</div>');return}if(v.data!==null){if(v.type==="allTime"||v.type==="daily"){if(!v.userData||!v.count){i(".page.pageLeaderboards .bigUser").addClass("hidden"),i(".page.pageLeaderboards .tableAndUser > .divider").removeClass("hidden");return}const l=v.userData;let d=`Top ${(l.rank/v.count*100).toFixed(2)}%`;l.rank===1&&(d="GOAT");const u=Mh();let f;u===null?f="":u===0?f=" ( = since you last checked)":u>0?f=` (<i class="fas fa-fw fa-angle-up"></i>${Math.abs(u)} since you last checked
      )`:f=` (<i class="fas fa-fw fa-angle-down"></i>${Math.abs(u)} since you last checked
        )`;const p={wpm:N.typingSpeed(l.wpm,{showDecimalPlaces:!0}),acc:N.percentage(l.acc,{showDecimalPlaces:!0}),raw:N.typingSpeed(l.raw,{showDecimalPlaces:!0}),con:N.percentage(l.consistency,{showDecimalPlaces:!0})},h=`
          <div class="rank">${l.rank===1?'<i class="fas fa-fw fa-crown"></i>':l.rank}</div>
        <div class="userInfo">
          <div class="top">You (${d})</div>
          <div class="bottom">${f}</div>
        </div>
        <div class="stat wide">
          <div class="title">${r.typingSpeedUnit}</div>
          <div class="value">${p.wpm}</div>
        </div>
        <div class="stat wide">
          <div class="title">accuracy</div>
          <div class="value">${p.acc}</div>
        </div>
        <div class="stat wide">
          <div class="title">raw</div>
          <div class="value">${p.raw}</div>
        </div>
        <div class="stat wide">
          <div class="title">consistency</div>
          <div class="value">${p.con}</div>
        </div>
        <div class="stat wide">
          <div class="title">date</div>
          <div class="value">${te(l.timestamp,"dd MMM yyyy HH:mm")}</div>
        </div>


        <div class="stat narrow">
          <div>${p.wpm}</div>
          <div class="sub">${p.acc}</div>
        </div>
        <div class="stat narrow rawAndConsistency">
          <div>${p.raw}</div>
          <div class="sub">${p.con}</div>
        </div>
        <div class="stat narrow">
          <div>${te(l.timestamp,"dd MMM yyyy")}</div>
          <div class="sub">${te(l.timestamp,"HH:mm")}</div>
        </div>
        `;i(".page.pageLeaderboards .bigUser").html(h)}else if(v.type==="weekly"){if(!v.userData||!v.count){i(".page.pageLeaderboards .bigUser").addClass("hidden");return}const l=v.userData;let d=`Top ${(l.rank/v.count*100).toFixed(2)}%`;l.rank===1&&(d="GOAT");const u=Mh();let f;u===null?f="":u===0?f=" ( = since you last checked)":u>0?f=` (<i class="fas fa-fw fa-angle-up"></i>${Math.abs(u)} since you last checked
      )`:f=` (<i class="fas fa-fw fa-angle-down"></i>${Math.abs(u)} since you last checked
        )`;const p={xp:l.totalXp<1e3?l.totalXp:Mc(l.totalXp),time:rt(Math.round(l.timeTypedSeconds),!0,!0,":")},h=`
          <div class="rank">${l.rank===1?'<i class="fas fa-fw fa-crown"></i>':l.rank}</div>
        <div class="userInfo">
          <div class="top">You (${d})</div>
          <div class="bottom">${f}</div>
        </div>
        <div class="stat wide">
          <div class="title">xp gained</div>
          <div class="value">${p.xp}</div>
        </div>
        <div class="stat wide">
          <div class="title">time typed</div>
          <div class="value">${p.time}</div>
        </div>
        <div class="stat narrow">
          <div>${p.xp}</div>
          <div class="sub">${p.time}</div>
        </div>
        <div class="stat wide">
          <div class="title">last activity</div>
          <div class="value">${te(l.lastActivityTimestamp,"dd MMM yyyy HH:mm")}</div>
        </div>
        <div class="stat narrow">
          <div>${te(l.lastActivityTimestamp,"dd MMM yyyy")}</div>
          <div class="sub">${te(l.lastActivityTimestamp,"HH:mm")}</div>
        </div>
        `;i(".page.pageLeaderboards .bigUser").html(h)}i(".page.pageLeaderboards .bigUser").removeClass("hidden"),i(".page.pageLeaderboards .tableAndUser > .divider").addClass("hidden")}}function Da(){var e;if(i(".page.pageLeaderboards .loading").addClass("hidden"),i(".page.pageLeaderboards .updating").addClass("invisible"),i(".page.pageLeaderboards .error").addClass("hidden"),v.error!==void 0){i(".page.pageLeaderboards .error").removeClass("hidden"),i(".page.pageLeaderboards .error p").text(v.error),Ih();return}if(v.updating){_h(),i(".page.pageLeaderboards .updating").removeClass("invisible");return}else if(v.loading){_h(),i(".page.pageLeaderboards .bigUser").addClass("hidden"),i(".page.pageLeaderboards .titleAndButtons").addClass("hidden"),i(".page.pageLeaderboards .loading").removeClass("hidden"),i(".page.pageLeaderboards table").addClass("hidden");return}else Ih();if(B()?i(".page.pageLeaderboards .needAuth").removeClass("hidden"):i(".page.pageLeaderboards .needAuth").addClass("hidden"),v.data===null){m("Data is null");return}i(".page.pageLeaderboards .titleAndButtons").removeClass("hidden"),Z_(),iI(),tI();for(const t of document.querySelectorAll(".page.pageLeaderboards .wide.speedUnit, .page.pageLeaderboards .narrow.speedUnit span"))t.innerHTML=r.typingSpeedUnit;if(v.scrollToUserAfterFill){const t=i(window).height()??0,a=(((e=i(".tableAndUser .me").offset())==null?void 0:e.top)??0)-t/2;i([document.documentElement,document.body]).animate({scrollTop:a},ge(500)),v.scrollToUserAfterFill=!1}}function lu(){oI(),aI(),sI()}function oI(){const e=i(".page.pageLeaderboards .buttonGroup.typeButtons");e.find("button").removeClass("active"),e.find(`button[data-type=${v.type}]`).addClass("active")}function aI(){if(v.type!=="allTime"&&v.type!=="daily"){i(".page.pageLeaderboards .buttonGroup.modeButtons").addClass("hidden"),i(".page.pageLeaderboards .sideButtons .divider").addClass("hidden");return}i(".page.pageLeaderboards .buttonGroup.modeButtons").removeClass("hidden"),i(".page.pageLeaderboards .sideButtons .divider").removeClass("hidden");const e=i(".page.pageLeaderboards .buttonGroup.modeButtons");e.find("button").removeClass("active"),e.find(`button[data-mode=${v.mode}][data-mode2=${v.mode2}]`).addClass("active"),i(".page.pageLeaderboards .buttonGroup.modeButtons button").addClass("hidden");for(const t of Object.keys(ns[v.type]))for(const o of Object.keys(ns[v.type][t]))i(`.page.pageLeaderboards .buttonGroup.modeButtons button[data-mode="${t}"][data-mode2="${o}"]`).removeClass("hidden")}function sI(){var t;if(v.type!=="daily"){i(".page.pageLeaderboards .buttonGroup.languageButtons").addClass("hidden"),i(".page.pageLeaderboards .sideButtons .divider2").addClass("hidden");return}i(".page.pageLeaderboards .buttonGroup.languageButtons").removeClass("hidden"),i(".page.pageLeaderboards .sideButtons .divider2").removeClass("hidden");const e=i(".page.pageLeaderboards .buttonGroup.languageButtons");e.find("button").removeClass("active"),e.find(`button[data-language=${v.language}]`).addClass("active"),i(".page.pageLeaderboards .buttonGroup.languageButtons button").addClass("hidden");for(const o of((t=ns[v.type][v.mode])==null?void 0:t[v.mode2])??[])i(`.page.pageLeaderboards .buttonGroup.languageButtons button[data-language="${o}"]`).removeClass("hidden")}let jf;function Ah(){if(v.type==="daily"){const e=bg(new Date,Xy(new Vo));i(".page.pageLeaderboards .titleAndButtons .timer").text("Next reset in: "+rt(e,!0))}else if(v.type==="allTime"){const e=new Date,t=14-e.getMinutes()%15,o=60-e.getSeconds(),a=t*60+o;i(".page.pageLeaderboards .titleAndButtons .timer").text("Next update in: "+rt(a,!0))}else if(v.type==="weekly"){const e=Zy(new Vo,{weekStartsOn:1}),t=bg(new Date,e);i(".page.pageLeaderboards .titleAndButtons .timer").text("Next reset in: "+rt(t,!0,!0,":",!0,!0))}}function iI(){let e=!0;(v.type==="daily"&&v.yesterday||v.type==="weekly"&&v.lastWeek)&&(e=!1),e?i(".page.pageLeaderboards .titleAndButtons .timer").removeClass("invisible"):i(".page.pageLeaderboards .titleAndButtons .timer").addClass("invisible")}function nI(){Ah(),jf=setInterval(()=>{Ah()},1e3)}function rI(){clearInterval(jf),jf=void 0,i(".page.pageLeaderboards .titleAndButtons .timer").text("-")}function Eh(e){return e.startsWith("(")?e.slice(1,-1).split("|"):[e]}async function lI(){var o;const e=(o=In())==null?void 0:o.dailyLeaderboards.validModeRules;if(e===void 0)throw new Error("cannot load server configuration for dailyLeaderboards.validModeRules");const t=e.flatMap(a=>{const s=Eh(a.language);return Eh(a.mode2).map(l=>({mode:a.mode,mode2:l,languages:s}))});ns.daily=t.reduce((a,{mode:s,mode2:n,languages:l})=>{let c=a[s];c===void 0&&(c={},a[s]=c);let d=c[n];return d===void 0&&(d=[],c[n]=d),d.push(...l),a},{})}function cu(){if(v.type==="weekly")return;const e=ns[v.type];let t=e[v.mode];if(t===void 0){const a=Object.keys(e).sort()[0];if(a===void 0)throw new Error(`no valid leaderboard config for type ${v.type}`);v.mode=a,t=e[v.mode]}let o=t[v.mode2];if(o===void 0){const a=Object.keys(t).sort((s,n)=>parseInt(s)-parseInt(n))[0];if(a===void 0)throw new Error(`no valid leaderboard config for type ${v.type} and mode ${v.mode}`);v.mode2=a,o=t[v.mode2]}if(o===void 0||o.length<1)throw new Error(`Daily leaderboard config not valid for mode:${v.mode} mode2:${v.mode2}`);o.includes(v.language)||(v.language=o.sort()[0])}async function cI(){const t=Array.from(new Set(Object.values(ns).flatMap(s=>Object.keys(s)))).sort().flatMap(s=>{const n=Array.from(new Set(Object.values(ns).flatMap(c=>Object.keys(c[s]??{})))).sort((c,d)=>parseInt(c)-parseInt(d)),l=s==="time"?"fas fa-clock":"fas fa-align-left";return n.map(c=>`<button data-mode="${s}" data-mode2="${c}">
      <i class="${l}"></i>
       ${s} ${c}
    </button>`)});i(".modeButtons").html(t.join(`
`));const a=Array.from(new Set(Object.values(ns).flatMap(s=>Object.values(s)).flatMap(s=>Object.values(s)).flatMap(s=>s))).sort().map(s=>`<button data-language="${s}">
          <i class="fas fa-globe"></i>
          ${s}
        </button>`);i(".languageButtons").html(a.join(`
`))}function _h(){i(".page.pageLeaderboards button").prop("disabled",!0)}function Ih(){i(".page.pageLeaderboards button").prop("disabled",!1)}function dI(e){e<0||e===v.page||F0("goToPage",e)}function F0(e,t){var o;if(e==="firstPage")v.page=0;else if(e==="previousPage"&&v.page>0){const a=Math.ceil(v.count/v.pageSize);v.page>a?v.page=a-1:v.page-=1}else if(e==="nextPage")v.page+=1;else if(e==="goToPage"&&t!==void 0)v.page=t;else if(e==="userPage"){if(B()){const a=(o=v.userData)==null?void 0:o.rank;if(Ce(a)){const s=Math.floor((a-1)/v.pageSize);if(v.page===s)return;v.page=s,v.scrollToUserAfterFill=!0}}}else return;vi(),qn(!0),Da()}function uI(e){v.type==="daily"&&e==="toggleYesterday"?v.yesterday=!v.yesterday:v.type==="weekly"&&e==="toggleLastWeek"&&(v.lastWeek=!v.lastWeek),vi(),qn(),Da(),Ml()}function vi(){if(v.goToUserPage)return;const e={};e.type=v.type,v.type==="allTime"?e.mode2=v.mode2:v.type==="daily"?(e.mode=v.mode,e.language=v.language,e.mode2=v.mode2,v.yesterday&&(e.yesterday=!0)):v.type==="weekly"&&v.lastWeek&&(e.lastWeek=!0),e.page=v.page+1,R0.setUrlParams(e),B0.set(v)}function fI(e){if(e===void 0){Object.assign(v,B0.get());return}e.type!==void 0&&(v.type=e.type),v.type==="allTime"?e.mode2!==void 0&&(v.mode2=e.mode2):v.type==="daily"?(e.language!==void 0&&(v.language=e.language),e.mode2!==void 0&&(v.mode2=e.mode2),e.mode!==void 0&&(v.mode=e.mode),e.yesterday!==void 0&&(v.yesterday=e.yesterday)):v.type==="weekly"&&e.lastWeek!==void 0&&(v.lastWeek=e.lastWeek),e.page!==void 0&&(v.page=e.page-1,v.page<0&&(v.page=0)),e.goToUserPage===!0&&(v.goToUserPage=!0)}function Ql(e){return t1(e,new Date().getTimezoneOffset())}function Bh(e,t,o){const a=`local time 
`+te(t,$h)+` - 
`+te(o,$h),s=i(".page.pageLeaderboards .bigtitle .subtext > .text");s.text(`${e}`),s.attr("aria-label",a)}i(".page.pageLeaderboards .jumpButtons button").on("click",function(){const e=i(this).data("action");e!=="goToPage"&&F0(e)});i(".page.pageLeaderboards .bigtitle button").on("click",function(){const e=i(this).data("action");uI(e)});i(".page.pageLeaderboards .buttonGroup.typeButtons").on("click","button",function(){const e=i(this).data("type");v.type!==e&&(v.type=e,v.type==="daily"&&(v.language="english",v.yesterday=!1),v.type==="weekly"&&(v.lastWeek=!1),cu(),v.data=null,v.page=0,qn(),Ml(),lu(),Da(),vi())});i(".page.pageLeaderboards .buttonGroup.modeButtons").on("click","button",function(){const e=i(this).attr("data-mode"),t=i(this).attr("data-mode2");if(e!==void 0&&t!==void 0&&(v.type==="allTime"||v.type==="daily")){if(v.mode===e&&v.mode2===t)return;v.mode=e,v.mode2=t,v.page=0}else return;cu(),v.data=null,qn(),lu(),Ml(),Da(),vi()});i(".page.pageLeaderboards .buttonGroup.languageButtons").on("click","button",function(){const e=i(this).attr("data-language");if(e!==void 0&&v.type==="daily"){if(v.language===e)return;v.language=e,v.page=0}else return;cu(),v.data=null,qn(),lu(),Ml(),Da(),vi()});const R0=new Lm({id:"leaderboards",element:i(".page.pageLeaderboards"),path:"/leaderboards",urlParamsSchema:X_,afterHide:async()=>{Et("pageLeaderboards"),rI()},beforeShow:async e=>{await p_,Yt("pageLeaderboards","main"),await lI(),await cI(),fI(e.urlParams),cu(),nI(),Ml(),Da(),lu(),vi(),qn(!1)},afterShow:async()=>{}});i(async()=>{Xt("pageLeaderboards")});be(e=>{Z()==="leaderboards"&&e==="typingSpeedUnit"&&(Da(),q0())});function pI(){if(!tt()){m("You are offline",0,{duration:2});return}Jr.show({focusFirstInput:!0,beforeAnimation:async e=>{var t,o,a,s;((t=x())==null?void 0:t.streakHourOffset)!==void 0?((o=e.querySelector("input"))==null||o.remove(),(a=e.querySelector(".preview"))==null||a.remove(),(s=e.querySelector("button"))==null||s.remove(),e.querySelector(".text").textContent="You have already set your streak hour offset."):(e.querySelector("input").value="0",D0())}})}function D0(){var s;const e=parseInt((s=Jr.getModal().querySelector("input"))==null?void 0:s.value,10),t=Jr.getModal().querySelector(".preview"),o=new Date;o.setUTCHours(0),o.setUTCMinutes(0),o.setUTCSeconds(0),o.setUTCMilliseconds(0);const a=new Date;a.setUTCHours(0),a.setUTCMinutes(0),a.setUTCSeconds(0),a.setUTCMilliseconds(0),a.setHours(a.getHours()- -1*e),t.innerHTML=`
    <div class="row"><div>Current local reset time:</div><div>${o.toLocaleTimeString()}</div></div>
    <div class="row"><div>New local reset time:</div><div>${a.toLocaleTimeString()}</div></div>
  `}function mI(){Jr.hide()}async function gI(){var o;const e=parseInt((o=Jr.getModal().querySelector("input"))==null?void 0:o.value,10);if(isNaN(e)){m("Streak hour offset must be a number",0);return}if(e<-11||e>12){m("Streak hour offset must be between -11 and 12",0);return}J();const t=await E.users.setStreakHourOffset({body:{hourOffset:e}});if(K(),t.status!==200)m("Failed to set streak hour offset: "+t.body.message,-1);else{m("Streak hour offset set",1);const a=x();a.streakHourOffset=e,kt(a),mI()}}const Jr=new re({dialogId:"streakHourOffsetModal",setup:async e=>{var t,o;(t=e.querySelector("input"))==null||t.addEventListener("input",()=>{D0()}),(o=e.querySelector("button"))==null||o.addEventListener("click",()=>{gI()})}});function Yl({tagname:e,classes:t,attributes:o,innerHTML:a}){let s=`<${e}`;return t!==void 0&&(s+=` class="${t.join(" ")}"`),o!==void 0&&(s+=" "+Object.entries(o).filter(n=>n[1]!==void 0).sort((n,l)=>n[0].localeCompare(l[0])).map(n=>n[1]===!0?`${n[0]}`:`${n[0]}="${n[1]}"`).join(" ")),a!==void 0?s+=`>${a}</${e}>`:s+=" />",s}class he{constructor(t){this.parameters=[],this.id=t.id,this.execFn=t.execFn,this.title=t.title,this.inputs=t.inputs??[],this.text=t.text,this.textAllowHtml=t.textAllowHtml??!1,this.wrapper=Nn.getWrapper(),this.element=Nn.getModal(),this.modal=Nn,this.buttonText=t.buttonText,this.beforeInitFn=t.beforeInitFn,this.beforeShowFn=t.beforeShowFn,this.canClose=t.canClose??!0,this.onlineOnly=t.onlineOnly??!1,this.hideCallsExec=t.hideCallsExec??!1,this.showLabels=t.showLabels??!1}reset(){this.element.innerHTML=`
    <div class="title"></div>
    <div class="inputs"></div>
    <div class="text"></div>
    <button type="submit" class="submitButton"></button>`}init(){const t=i(this.element);t.find("input").val(""),this.reset(),t.attr("data-popup-id",this.id),t.find(".title").text(this.title),this.textAllowHtml?t.find(".text").html(this.text??""):t.find(".text").text(this.text??""),this.initInputs(),this.buttonText===""?t.find(".submitButton").remove():(t.find(".submitButton").text(this.buttonText),this.updateSubmitButtonState()),(this.text??"")===""?t.find(".text").addClass("hidden"):t.find(".text").removeClass("hidden")}initInputs(){const t=i(this.element);if(this.inputs.every(s=>s.hidden)||this.inputs.length===0){t.find(".inputs").addClass("hidden");return}const a=t.find(".inputs");this.showLabels&&a.addClass("withLabel"),this.inputs.forEach((s,n)=>{var h,g,y,b;const l=`${this.id}_${n}`;this.showLabels&&!s.hidden&&a.append(`<label for="${l}">${s.label??""}</label>`);const c=s.type==="textarea"?"textarea":"input",d=s.hidden?["hidden"]:void 0,u={id:l,placeholder:s.placeholder??"",autocomplete:"off"};if(s.type!=="textarea"&&(u.value=((h=s.initVal)==null?void 0:h.toString())??"",u.type=s.type),!s.hidden&&!s.optional&&(u.required=!0),s.disabled&&(u.disabled=!0),s.type==="textarea")a.append(Yl({tagname:c,classes:d,attributes:u,innerHTML:s.initVal}));else if(s.type==="checkbox"){let C=Yl({tagname:c,classes:d,attributes:u});s.description!==void 0&&(C+=`<span>${s.description}</span>`),this.showLabels?C=`<div>${C}</div>`:C=`
          <label class="checkbox">
            ${C}
            <div>${s.label}</div>
          </label>
        `,a.append(C)}else if(s.type==="range")a.append(`
          <div>
            ${Yl({tagname:c,classes:d,attributes:{...u,min:s.min.toString(),max:s.max.toString(),step:(g=s.step)==null?void 0:g.toString(),oninput:"this.nextElementSibling.innerHTML = this.value"}})}
            <span>${s.initVal??""}</span>
          </div>
          `);else{switch(s.type){case"text":case"password":case"email":break;case"datetime-local":{s.min!==void 0&&(u.min=te(s.min,"yyyy-MM-dd'T'HH:mm:ss")),s.max!==void 0&&(u.max=te(s.max,"yyyy-MM-dd'T'HH:mm:ss")),s.initVal!==void 0&&(u.value=te(s.initVal,"yyyy-MM-dd'T'HH:mm:ss"));break}case"date":{s.min!==void 0&&(u.min=te(s.min,"yyyy-MM-dd")),s.max!==void 0&&(u.max=te(s.max,"yyyy-MM-dd")),s.initVal!==void 0&&(u.value=te(s.initVal,"yyyy-MM-dd"));break}case"number":{u.min=(y=s.min)==null?void 0:y.toString(),u.max=(b=s.max)==null?void 0:b.toString();break}}a.append(Yl({tagname:c,classes:d,attributes:u}))}const f=document.querySelector("#"+u.id),p=f.oninput;if(f.oninput=C=>{var L;p&&p.call(f,C),(L=s.oninput)==null||L.call(s,C),this.updateSubmitButtonState()},s.currentValue=()=>f.type==="checkbox"?f.checked?"true":"false":f.value,s.validation!==void 0){const C={schema:s.validation.schema??void 0,isValid:s.validation.isValid!==void 0?async L=>s.validation.isValid(L,this):void 0,callback:L=>{s.hasError=L.status!=="success",this.updateSubmitButtonState()},debounceDelay:s.validation.debounceDelay};ia(f,C)}}),t.find(".inputs").removeClass("hidden")}exec(){if(!this.canClose)return;if(this.hasMissingRequired()){m("Please fill in all fields",0);return}if(this.hasValidationErrors()){m("Please solve all validation errors",0);return}this.disableInputs(),J();const t=this.inputs.map(o=>o.currentValue());this.execFn(this,...t).then(o=>{K(),(o.showNotification??!0)&&m(o.message,o.status,o.notificationOptions),o.status===1?this.hide(!0,o.hideOptions).then(()=>{o.afterHide&&o.afterHide()}):(this.enableInputs(),i(i("#simpleModal").find("input")[0]).trigger("focus"))})}disableInputs(){i("#simpleModal input").prop("disabled",!0),i("#simpleModal button").prop("disabled",!0),i("#simpleModal textarea").prop("disabled",!0),i("#simpleModal .checkbox").addClass("disabled")}enableInputs(){i("#simpleModal input").prop("disabled",!1),i("#simpleModal button").prop("disabled",!1),i("#simpleModal textarea").prop("disabled",!1),i("#simpleModal .checkbox").removeClass("disabled")}show(t=[],o){if(this.onlineOnly&&!tt()){m("You are offline",0,{duration:2});return}Ks=this,this.parameters=t,Nn.show({focusFirstInput:!0,...o,beforeAnimation:async()=>{var a,s;(a=this.beforeInitFn)==null||a.call(this,this),this.init(),(s=this.beforeShowFn)==null||s.call(this,this)}})}async hide(t,o){this.canClose&&(this.hideCallsExec&&!t?this.exec():(Ks=null,await Nn.hide(o)))}hasMissingRequired(){return this.inputs.filter(t=>t.hidden!==!0&&t.optional!==!0).some(t=>t.currentValue()===void 0||t.currentValue()==="")}hasValidationErrors(){return this.inputs.some(t=>t.hasError===!0)}updateSubmitButtonState(){const t=this.element.querySelector(".submitButton");t!==null&&(this.hasMissingRequired()||this.hasValidationErrors()?t.disabled=!0:t.disabled=!1)}}function qh(){if(Ks){Ks.hide();return}}let Ks=null;const Nn=new re({dialogId:"simpleModal",setup:async e=>{e.addEventListener("submit",t=>{t.preventDefault(),Ks==null||Ks.exec()})},customEscapeHandler:e=>{qh()},customWrapperClickHandler:e=>{qh()}}),hI=new he({id:"editApeKey",title:"Edit Ape key",inputs:[{type:"text",placeholder:"name",initVal:""}],buttonText:"edit",onlineOnly:!0,execFn:async(e,t)=>{const o=await E.apeKeys.save({params:{apeKeyId:e.parameters[0]??""},body:{name:t}});return o.status!==200?{status:-1,message:"Failed to update key: "+o.body.message}:{status:1,message:"Key updated",hideOptions:{clearModalChain:!0}}}}),yI=new he({id:"deleteApeKey",title:"Delete Ape key",text:"Are you sure?",buttonText:"delete",onlineOnly:!0,execFn:async e=>{const t=await E.apeKeys.delete({params:{apeKeyId:e.parameters[0]??""}});return t.status!==200?{status:-1,message:"Failed to delete key: "+t.body.message}:(Gs==null||Gs(),{status:1,message:"Key deleted",hideOptions:{clearModalChain:!0}})}}),bI=new he({id:"viewApeKey",title:"Ape key",inputs:[{type:"textarea",disabled:!0,placeholder:"key",initVal:""}],textAllowHtml:!0,text:`
    This is your new Ape Key. Please keep it safe. You will only see it once!<br><br>
    <strong>Note:</strong> Ape Keys are disabled by default, you need to enable them before they can be used.`,buttonText:"close",hideCallsExec:!0,execFn:async e=>({status:1,message:"Key generated",showNotification:!1,hideOptions:{clearModalChain:!0}}),beforeInitFn:e=>{e.inputs[0].initVal=e.parameters[0]},beforeShowFn:e=>{e.canClose=!1,i("#simpleModal textarea").css("height","110px"),i("#simpleModal .submitButton").addClass("hidden"),setTimeout(()=>{e.canClose=!0,i("#simpleModal .submitButton").removeClass("hidden")},5e3)}}),vI=new he({id:"generateApeKey",title:"Generate new Ape key",inputs:[{type:"text",placeholder:"Name",initVal:""}],buttonText:"generate",onlineOnly:!0,execFn:async(e,t)=>{const o=await E.apeKeys.add({body:{name:t,enabled:!1}});if(o.status!==200)return{status:-1,message:"Failed to generate key: "+o.body.message};const a=o.body.data,s=e.modal.getPreviousModalInChain();return Gs==null||Gs(),{status:1,message:"Key generated",hideOptions:{clearModalChain:!0,animationMode:"modalOnly"},afterHide:()=>{bI.show([a.apeKey],{modalChain:s,animationMode:"modalOnly"})}}}});let Vi={};const W0=i("#pageAccountSettings .tab[data-tab='apeKeys']");async function wI(){if(!B())return!1;CI();const e=await E.apeKeys.get();return e.status!==200?e.body.message==="You have lost access to ape keys, please contact support"?(z0=!0,H0(),!1):(m("Error getting ape keys: "+e.body.message,-1),!1):(Vi=e.body.data,!0)}function CI(){const e=W0.find("table tbody");e.empty(),e.append("<tr><td colspan='6' style='text-align: center;font-size:1rem;'><i class='fas fa-spin fa-circle-notch'></i></td></tr>")}function P0(){var a,s,n;const e=Vi;if(e==null)return;const t=W0.find("table tbody");t.empty();const o=Object.keys(e);if(o.length===0){t.append("<tr><td colspan='6' style='text-align: center;'>No keys found</td></tr>");return}o.forEach(l=>{const c=e[l];t.append(`
      <tr keyId="${l}">
        <td>
          <button class="textButton toggleActive" style="font-size: 1.25rem">
            ${c.enabled?'<i class="fas fa-fw fa-check-square"></i>':'<i class="far fa-fw fa-square"></i>'}
          </button>
        </td>
        <td>${c.name}</td>
        <td>${te(new Date(c.createdOn),"dd MMM yyyy HH:mm")}</td>
        <td>${te(new Date(c.modifiedOn),"dd MMM yyyy HH:mm")}</td>
        <td>${c.lastUsedOn===-1?"-":te(new Date(c.lastUsedOn),"dd MMM yyyy HH:mm")}</td>
        <td>
          <div class="keyButtons">
            <button class="editButton">
              <i class="fas fa-fw fa-pen"></i>
            </button>
            <button class="deleteButton">
              <i class="fas fa-fw fa-trash-alt"></i>
            </button>
          </div>
        </td>
      </tr>
    `)});for(const l of t.find("tr")){const c=l.getAttribute("keyid");(a=l.querySelector("button.toggleActive"))==null||a.addEventListener("click",d=>{kI(c)}),(s=l.querySelector("button.deleteButton"))==null||s.addEventListener("click",d=>{yI.show([c],{})}),(n=l.querySelector("button.editButton"))==null||n.addEventListener("click",d=>{hI.show([c],{})})}}async function kI(e){const t=Vi==null?void 0:Vi[e];if(!t||Vi===void 0)return;J();const o=await E.apeKeys.save({params:{apeKeyId:e},body:{enabled:!t.enabled}});if(K(),o.status!==200){m("Failed to update key: "+o.body.message,-1);return}t.enabled=!t.enabled,P0(),t.enabled?m("Key active",1):m("Key inactive",1)}let Gs,z0=!1;async function H0(e){if(z0){i(".pageAccountSettings .tab[data-tab='apeKeys'] table").remove(),i(".pageAccountSettings .section.apeKeys .buttons").remove(),i(".pageAccountSettings .section.apeKeys .lostAccess").removeClass("hidden");return}Gs=e,await wI(),P0()}i(".pageAccountSettings").on("click","#generateNewApeKey",()=>{vI.show([],{})});const ae=i(".page.pageAccountSettings"),SI=D.object({tab:D.enum(["authentication","account","apeKeys","dangerZone"])}),xI=SI.partial(),rs={tab:"account"};function TI(){ae.find(".section.passwordAuthSettings button").addClass("hidden"),ae.find(".section.googleAuthSettings button").addClass("hidden"),ae.find(".section.githubAuthSettings button").addClass("hidden");const e=go();if(e===null)return;const t=e.providerData.some(s=>s.providerId==="password"),o=e.providerData.some(s=>s.providerId==="google.com"),a=e.providerData.some(s=>s.providerId==="github.com");t?(ae.find(".section.passwordAuthSettings #emailPasswordAuth").removeClass("hidden"),ae.find(".section.passwordAuthSettings #passPasswordAuth").removeClass("hidden"),(o||a)&&ae.find(".section.passwordAuthSettings #removePasswordAuth").removeClass("hidden")):ae.find(".section.passwordAuthSettings #addPasswordAuth").removeClass("hidden"),o?(ae.find(".section.googleAuthSettings #removeGoogleAuth").removeClass("hidden"),t||a?ae.find(".section.googleAuthSettings #removeGoogleAuth").removeClass("disabled"):ae.find(".section.googleAuthSettings #removeGoogleAuth").addClass("disabled")):ae.find(".section.googleAuthSettings #addGoogleAuth").removeClass("hidden"),a?(ae.find(".section.githubAuthSettings #removeGithubAuth").removeClass("hidden"),t||o?ae.find(".section.githubAuthSettings #removeGithubAuth").removeClass("disabled"):ae.find(".section.githubAuthSettings #removeGithubAuth").addClass("disabled")):ae.find(".section.githubAuthSettings #addGithubAuth").removeClass("hidden")}function LI(){var e;if(!B())ae.find(".section.discordIntegration").addClass("hidden");else{if(!x())return;ae.find(".section.discordIntegration").removeClass("hidden"),((e=x())==null?void 0:e.discordId)===void 0?(ae.find(".section.discordIntegration .buttons").removeClass("hidden"),ae.find(".section.discordIntegration .info").addClass("hidden")):(ae.find(".section.discordIntegration .buttons").addClass("hidden"),ae.find(".section.discordIntegration .info").removeClass("hidden"))}}function O0(){nn(ae.find(".tab.active"),ae.find(`.tab[data-tab="${rs.tab}"]`),250,async()=>{},async()=>{ae.find(".tab").removeClass("active"),ae.find(`.tab[data-tab="${rs.tab}"]`).addClass("active")}),ae.find("button").removeClass("active"),ae.find(`button[data-tab="${rs.tab}"]`).addClass("active")}function $I(){ae.find(".section.optOutOfLeaderboards .optedOut").addClass("hidden"),ae.find(".section.optOutOfLeaderboards .buttons").removeClass("hidden"),ae.find(".section.setStreakHourOffset .info").addClass("hidden"),ae.find(".section.setStreakHourOffset .buttons").removeClass("hidden");const e=x();if((e==null?void 0:e.lbOptOut)===!0&&(ae.find(".section.optOutOfLeaderboards .optedOut").removeClass("hidden"),ae.find(".section.optOutOfLeaderboards .buttons").addClass("hidden")),(e==null?void 0:e.streakHourOffset)!==void 0){ae.find(".section.setStreakHourOffset .info").removeClass("hidden");const t=(e==null?void 0:e.streakHourOffset)>0?"+":"";ae.find(".section.setStreakHourOffset .info span").text(t+(e==null?void 0:e.streakHourOffset)),ae.find(".section.setStreakHourOffset .buttons").addClass("hidden")}}function ws(){Z()==="accountSettings"&&(TI(),LI(),$I(),H0(ws),O0(),zm.setUrlParams(rs))}i(".page.pageAccountSettings").on("click",".tabs button",e=>{rs.tab=i(e.target).data("tab"),O0(),zm.setUrlParams(rs)});i(".page.pageAccountSettings .section.discordIntegration .getLinkAndGoToOauth").on("click",()=>{J(),E.users.getDiscordOAuth().then(e=>{e.status===200?window.open(e.body.data.url,"_self"):m("Failed to get OAuth from discord: "+e.body.message,-1)})});i(".page.pageAccountSettings #setStreakHourOffset").on("click",()=>{pI()});sa(e=>{e.type==="authConfigUpdated"&&ws()});const zm=new Lm({id:"accountSettings",display:"Account Settings",element:ae,path:"/account-settings",urlParamsSchema:xI,afterHide:async()=>{Et("pageAccountSettings")},beforeShow:async e=>{var t;((t=e.urlParams)==null?void 0:t.tab)!==void 0&&(rs.tab=e.urlParams.tab),Yt("pageAccountSettings","main"),ae.find(`.tab[data-tab="${rs.tab}"]`).addClass("active"),ws()}});i(()=>{Xt("pageAccountSettings")});function MI(){const e=document.querySelector('meta[property="og:url"]'),t=window.location.href;if(e)e.setAttribute("content",t);else{const o=document.createElement("meta");o.setAttribute("property","og:url"),o.content=t,document.head.appendChild(o)}}function AI(e){if(e.id==="test")pg();else{const t=e.display??yi(e.id);pg(`${t} | Monkeytype`)}}async function EI({loadingOptions:e,totalDuration:t,easingMethod:o}){Es.element.removeClass("hidden").css("opacity",0),await Es.beforeShow({});const a=e.length,s=100/a;xo(Es.element,{opacity:"1"},t/2,o);for(let n=0;n<e.length;n++){const l=s*n,c=e[n];c.style==="bar"?(await z_(),n===0&&(await Gf(0,0),ld(""))):W_(),c.style==="bar"?(await _I(c,a,l),Gf(100,125),ld("Done")):await c.loadingPromise()}await xo(Es.element,{opacity:"0"},t/2,o),await Es.afterHide(),Es.element.addClass("hidden")}async function _I(e,t,o){let a=!1,s=e.loadingPromise();const n=(async()=>{for(const l of e.keyframes){if(a)break;l.text!==void 0&&ld(l.text),await Gf(o+l.percentage/t,l.durationMs)}})();await Promise.race([n,(async()=>{await s,a=!0})()]),await s}async function vo(e,t={}){var u,f,p,h,g;if(t={...{force:!1},...t},Qs()&&!t.force)return console.debug(`change page to ${e} stopped, page transition is true`),!1;if(!t.force&&Z()===e)return console.debug(`change page ${e} stoped, page already active`),!1;console.log(`changing page ${e}`);const a={loading:Es,test:M_,settings:g0,about:q_,account:L_,login:D_,profile:G_,profileSearch:j_,404:Q_,accountSettings:zm,leaderboards:R0},s=a[Z()],n=a[e],l=ge(250),c="swing";hu(!0),i(".page").removeClass("active"),await((u=s==null?void 0:s.beforeHide)==null?void 0:u.call(s)),s.element.removeClass("hidden").css("opacity",1),await xo(s.element,{opacity:"0"},l/2,c),s.element.addClass("hidden"),await(s==null?void 0:s.afterHide());const d=(f=n.loadingOptions)==null?void 0:f.loadingMode();try{let y=[];((p=t.loadingOptions)==null?void 0:p.loadingMode())==="sync"&&y.push(t.loadingOptions),((h=n.loadingOptions)==null?void 0:h.loadingMode())==="sync"&&y.push(n.loadingOptions),y.length>0&&await EI({loadingOptions:y,totalDuration:l,easingMethod:c})}catch(y){return a.loading.element.addClass("active"),jg(a.loading.id),Do(!1),P_(),ld(`Failed to load the ${n.id} page: ${y instanceof Error?y.message:String(y)}`),hu(!1),!1}return AI(n),jg(n.id),MI(),Do(!1),await(n==null?void 0:n.beforeShow({params:t.params,data:t.data})),typeof d=="object"&&d.mode==="async"&&(d.beforeLoading(),(g=n==null?void 0:n.loadingOptions)==null||g.loadingPromise().then(()=>{d.afterLoading()})),n.element.removeClass("hidden").css("opacity",0),await xo(n.element,{opacity:"1"},l/2,c),n.element.addClass("active"),await(n==null?void 0:n.afterShow()),hu(!1),a2(),!0}function II(e){return new RegExp("^"+e.replace(/\//g,"\\/").replace(/:\w+/g,"(.+)")+"$")}function BI(e){const t=e.result.slice(1),a=Array.from(e.route.path.matchAll(/:(\w+)/g)).map(s=>s[1]).map((s,n)=>[s,t[n]]);return Object.fromEntries(a)}const qI={path:"404",load:async()=>{await vo("404")}},FI=[{path:"/",load:async(e,t)=>{await vo("test",t)}},{path:"/verify",load:async(e,t)=>{await vo("test",t)}},{path:"/leaderboards",load:async(e,t)=>{await vo("leaderboards",t)}},{path:"/about",load:async(e,t)=>{await vo("about",t)}},{path:"/settings",load:async(e,t)=>{await vo("settings",t)}},{path:"/login",load:async(e,t)=>{if(!Bo()){await Ke("/",t);return}if(B()){await Ke("/account",t);return}await vo("login",t)}},{path:"/account",load:async(e,t)=>{if(!Bo()){await Ke("/",t);return}if(!B()){await Ke("/login",t);return}await vo("account",t)}},{path:"/account-settings",load:async(e,t)=>{if(!Bo()){await Ke("/",t);return}if(!B()){await Ke("/login",t);return}await vo("accountSettings",t)}},{path:"/profile",load:async(e,t)=>{await vo("profileSearch",t)}},{path:"/profile/:uidOrName",load:async(e,t)=>{await vo("profile",{...t,force:!0,params:{uidOrName:e.uidOrName},data:t.data})}}];async function Ke(e=window.location.pathname+window.location.search+window.location.hash,t={}){if(!t.force&&(Ot||ti||Qs())){console.debug(`navigate: ${e} ignored, page is busy (testRestarting: ${Ot}, resultCalculating: ${ti}, pageTransition: ${Qs()})`);return}const o=Tv("no_quit");if(Ee&&o){m("No quit funbox is active. Please finish the test.",0,{important:!0});return}e=e.replace(/\/$/,""),e===""&&(e="/");const a=new URL(window.location.href),s=new URL(e,window.location.origin);a.pathname+a.search+a.hash!==s.pathname+s.search+s.hash&&history.pushState(null,"",e),await N0(t)}async function N0(e={}){const o=FI.map(a=>({route:a,result:location.pathname.match(II(a.path))})).find(a=>a.result!==null);if(o===void 0){await qI.load({},{});return}await o.route.load(BI(o),e)}window.addEventListener("popstate",()=>{N0()});document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",e=>{const t=e==null?void 0:e.target;t.matches("[router-link]")&&(t!=null&&t.href)&&(e.preventDefault(),Ke(t.href))})});const RI=[{id:"viewTypingPage",display:"View Typing Page",alias:"navigate go to start begin type test",icon:"fa-keyboard",exec:()=>{Ke("/")}},{id:"viewLeaderboards",display:"View Leaderboards",alias:"navigate go to",icon:"fa-crown",exec:()=>{Ke("/leaderboards")}},{id:"viewAbout",display:"View About Page",alias:"navigate go to",icon:"fa-info",exec:()=>{Ke("/about")}},{id:"viewSettings",display:"View Settings Page",alias:"navigate go to",icon:"fa-cog",exec:()=>{Ke("/settings")}},{id:"viewAccount",display:"View Account Page",alias:"navigate go to stats",icon:"fa-user",exec:()=>{B()?Ke("/account"):Ke("/login")}},{id:"toggleFullscreen",display:"Toggle Fullscreen",icon:"fa-expand",exec:()=>{jk()}}],es={missed:"words",slow:!1},Fi="#practiseWordsModal .modal";function Pu(){i(`${Fi} .group[data-id="missed"] button`).removeClass("active"),i(`${Fi} .group[data-id="missed"] button[value="${es.missed}"]`).addClass("active"),i(`${Fi} .group[data-id="slow"] button`).removeClass("active"),i(`${Fi} .group[data-id="slow"] button[value="${es.slow}"]`).addClass("active"),es.missed==="off"&&!es.slow?i(`${Fi} .start`).prop("disabled",!0):i(`${Fi} .start`).prop("disabled",!1)}async function DI(e){var t;for(const o of e.querySelectorAll(".group[data-id='missed'] button"))o.addEventListener("click",a=>{es.missed=a.target.value,Pu()});for(const o of e.querySelectorAll(".group[data-id='slow'] button"))o.addEventListener("click",a=>{es.slow=a.target.value==="true",Pu()});(t=e.querySelector(".start"))==null||t.addEventListener("click",()=>{Fh()}),e.addEventListener("submit",o=>{o.preventDefault(),Fh()}),Pu()}function U0(e){V0.show(e)}function WI(e=!1){V0.hide({clearModalChain:e})}function Fh(){xf(es.missed,es.slow),WI(!0),z({practiseMissed:!0})}const V0=new re({dialogId:"practiseWordsModal",setup:DI});let K0=!1,Qf=!1;function Rh(){K(),i("#ad-result-wrapper").removeClass("hidden"),i("#ad-result-small-wrapper").removeClass("hidden"),i("#testConfig").removeClass("hidden"),i(".pageTest .screenshotSpacer").remove(),i("#notificationCenter").removeClass("hidden"),i("#commandLineMobileButton").removeClass("hidden"),i(".pageTest .ssWatermark").addClass("hidden"),i(".pageTest .ssWatermark").text("monkeytype.com"),i(".pageTest .buttons").removeClass("hidden"),i("noscript").removeClass("hidden"),i("#nocss").removeClass("hidden"),i("header, footer").removeClass("invisible"),i("#result").removeClass("noBalloons"),i(".wordInputHighlight").removeClass("hidden"),i(".highlightContainer").removeClass("hidden"),Qf&&i("#cookiesModal").removeClass("hidden"),K0&&i("#resultReplay").removeClass("hidden"),B()||i(".pageTest .loginTip").removeClass("hidden"),document.querySelector("html").style.scrollBehavior="smooth";for(const e of yt("applyGlobalCSS"))e.functions.applyGlobalCSS()}let Dh=!1;async function G0(){var p,h;const{domToCanvas:e}=await Sd(async()=>{const{domToCanvas:g}=await import("./vendor.DwUKJXLy.js").then(y=>y.ad);return{domToCanvas:g}},__vite__mapDeps([0,1,2]));J(!0),i("#resultReplay").hasClass("hidden")||(K0=!0,Sl()),(Qk("#cookiesModal")||document.contains(document.querySelector("#cookiesModal")))&&(Qf=!0);const t=new Date(Date.now());i("#resultReplay").addClass("hidden"),i(".pageTest .ssWatermark").removeClass("hidden");const o=x(),a=[te(t,"dd MMM yyyy HH:mm"),"monkeytype.com"];if((o==null?void 0:o.name)!==void 0){const g=`${o==null?void 0:o.name}${rl(o,{iconsOnly:!0})}`;a.unshift(g)}i(".pageTest .ssWatermark").html(a.map(g=>`<span>${g}</span>`).join("<span class='pipe'>|</span>")),i(".pageTest .buttons").addClass("hidden"),i("#notificationCenter").addClass("hidden"),i("#commandLineMobileButton").addClass("hidden"),i(".pageTest .loginTip").addClass("hidden"),i("noscript").addClass("hidden"),i("#nocss").addClass("hidden"),i("#ad-result-wrapper").addClass("hidden"),i("#ad-result-small-wrapper").addClass("hidden"),i("#testConfig").addClass("hidden"),i(".pageTest .screenshotSpacer").remove(),i(".page.pageTest").prepend("<div class='screenshotSpacer'></div>"),i("header, footer").addClass("invisible"),i("#result").addClass("noBalloons"),i(".wordInputHighlight").addClass("hidden"),i(".highlightContainer").addClass("hidden"),Qf&&i("#cookiesModal").addClass("hidden");for(const g of yt("clearGlobal"))g.functions.clearGlobal();document.querySelector("html").style.scrollBehavior="auto",window.scrollTo({top:0,behavior:"auto"});const s=i("#result .wrapper");if(!s.length)return console.error("Result wrapper not found for screenshot"),m("Screenshot target element not found",-1),Rh(),null;await Le(50);const n=((p=s.offset())==null?void 0:p.left)??0,l=((h=s.offset())==null?void 0:h.top)??0,c=s.outerWidth(!0),d=s.outerHeight(!0),u=Ys(2),f=Ys(2);try{const g=document.documentElement,{scrollWidth:y,clientWidth:b,scrollHeight:C,clientHeight:L}=g,S=Math.max(y,b),q=Math.max(C,L),P=await e(g,{backgroundColor:await Kt("bg"),scale:window.devicePixelRatio??1,style:{width:`${S}px`,height:`${q}px`,overflow:"hidden"},fetch:{requestInit:{mode:"cors",credentials:"omit"},bypassingCache:!0},filter:Zt=>{if(!(Zt instanceof HTMLElement))return!0;const Jt=getComputedStyle(Zt);return!(Zt.classList.contains("hidden")||Jt.display==="none")},onCloneEachNode:Zt=>{if(Zt instanceof HTMLElement){const Jt=Zt;if(Jt.classList.contains("customBackground")){Jt.style.zIndex="0",Jt.style.width=`${S}px`,Jt.style.height=`${q}px`;const bo=Jt.querySelector("img");bo&&(window.innerWidth<=720?(bo.style.transform="translateY(20vh)",bo.style.height="100%"):(bo.style.width="100%",bo.style.height="100%"))}}}}),$=P.width/S,H=c+u*2,R=d+f*2,Pe=Math.round(H*$),j=Math.round(R*$),ne=Math.ceil(H*$),fe=Math.ceil(R*$),me=document.createElement("canvas");me.width=Pe,me.height=j;const St=me.getContext("2d");if(!St)return m("Failed to get canvas context for screenshot",-1),null;St.imageSmoothingEnabled=!0,St.imageSmoothingQuality="high";const ki=Math.max(0,Math.floor((n-u)*$)),ra=Math.max(0,Math.floor((l-f)*$)),Cs=Math.min(ne,P.width-ki),ks=Math.min(fe,P.height-ra);return St.drawImage(P,ki,ra,Cs,ks,0,0,me.width,me.height),me}catch(g){return m(ie(g,"Error creating screenshot canvas"),-1),null}finally{Rh()}}async function j0(){const e=await G0();e&&e.toBlob(async t=>{if(!t){m("Failed to generate image data (blob is null)",-1);return}try{const o=new ClipboardItem(Object.defineProperty({},t.type,{value:t,enumerable:!0}));await navigator.clipboard.write([o]),m("Copied screenshot to clipboard",1,{duration:2})}catch(o){console.error("Error saving image to clipboard",o),navigator.userAgent.toLowerCase().includes("firefox")&&!Dh&&(Dh=!0,m("On Firefox you can enable the asyncClipboard.clipboardItem permission in about:config to enable copying straight to the clipboard",0,{duration:10})),m("Could not copy screenshot to clipboard. Opening in new tab instead (make sure popups are allowed)",0,{duration:5});try{const a=URL.createObjectURL(t);window.open(a)}catch(a){m("Failed to open screenshot in new tab",-1),console.error("Error opening blob URL:",a)}}})}async function PI(){const e=await G0();return e?new Promise(t=>{e.toBlob(o=>{o?t(o):(m("Failed to convert canvas to Blob for download",-1),t(null))},"image/png")}):null}async function Q0(){try{const e=await PI();if(!e){m("Failed to generate screenshot data",-1);return}const t=URL.createObjectURL(e),o=document.createElement("a");o.href=t;const a=new Date().toISOString().replace(/[:.]/g,"-");o.download=`monkeytype-result-${a}.png`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(t),m("Screenshot download started",1)}catch(e){console.error("Error downloading screenshot:",e),m("Failed to download screenshot",-1)}}i(".pageTest").on("click","#saveScreenshotButton",e=>{e.shiftKey?Q0():j0(),i("#saveScreenshotButton i").removeClass("fas fa-download").addClass("far fa-image")});i(document).on("keydown",e=>{de&&Z()==="test"&&e.key==="Shift"&&i("#result #saveScreenshotButton i").removeClass("far fa-image").addClass("fas fa-download")});i(document).on("keyup",e=>{de&&Z()==="test"&&e.key==="Shift"&&i("#result #saveScreenshotButton i").removeClass("fas fa-download").addClass("far fa-image")});const zI={title:"Practice words...",list:[{id:"practiseWordsMissed",display:"missed",exec:()=>{xf("words",!1),z({practiseMissed:!0})}},{id:"practiseWordsSlow",display:"slow",exec:()=>{xf("off",!0),z({practiseMissed:!0})}},{id:"practiseWordsCustom",display:"custom...",opensModal:!0,exec:e=>{U0({animationMode:"modalOnly",modalChain:e.commandlineModal})}}]},HI=[{id:"nextTest",display:"Next test",alias:"restart start begin type test typing",icon:"fa-chevron-right",available:()=>de,exec:()=>{z()}},{id:"repeatTest",display:"Repeat test",icon:"fa-sync-alt",exec:()=>{z({withSameWordset:!0})},available:()=>de},{id:"practiseWords",display:"Practice words...",icon:"fa-exclamation-triangle",subgroup:zI,available:()=>de},{id:"toggleWordHistory",display:"Toggle word history",icon:"fa-align-left",exec:()=>{Yp()},available:()=>de},{id:"copyScreenshot",display:"Copy screenshot to clipboard",icon:"fa-copy",alias:"copy image clipboard",exec:()=>{setTimeout(()=>{j0()},500)},available:()=>de},{id:"downloadScreenshot",display:"Download screenshot",icon:"fa-download",alias:"save image download file",exec:()=>{setTimeout(async()=>{Q0()},500)},available:()=>de},{id:"copyWordsToClipboard",display:"Copy words to clipboard",icon:"fa-copy",exec:()=>{const e=(r.mode==="zen"?k.getHistory():_.list.slice(0,k.getHistory().length)).join(" ");navigator.clipboard.writeText(e).then(()=>{m("Copied to clipboard",1)},()=>{m("Failed to copy!",-1)})},available:()=>de}];let Yf=!1;function Y0(e){document.documentElement.style.setProperty("--font",'"'+e.replaceAll(/_/g," ")+'", "Roboto Mono", "Vazirmatn"'),Kd(),Yf=!0}function Xf(){Yf&&(Y0(r.fontFamily),Yf=!1)}function OI(){const e=window.navigator.userAgent.toLowerCase(),t=e.includes("mac")&&!e.includes("firefox")?"cmd":"ctrl",o=r.quickRestart==="esc"?"tab":"esc";i("footer .keyTips").html(`
    ${r.quickRestart==="off"?"<key>tab</key> + <key>enter</key>":`<key>${r.quickRestart}</key>`} - restart test<br>
    <key>${o}</key> or <key>${t}</key>+<key>shift</key>+<key>p</key> - command line`)}window.addEventListener("keydown",function(e){var t;e.code==="Space"&&(e.target===document.body||((t=e.target)==null?void 0:t.id)==="result")&&e.preventDefault()});window.addEventListener("beforeunload",e=>{au(r.mode,r.words,r.time,Ia(),ta()??!1)||Ee&&(e.preventDefault(),e.returnValue="")});const NI=It(250,()=>{Z()==="test"&&!de&&(r.tapeMode!=="off"?jd():(qv(),Kd()),setTimeout(()=>{Gp(),oi()},250))}),UI=jy(250,()=>{fl()});i(window).on("resize",()=>{UI(),NI()});be(async e=>{e==="quickRestart"&&OI(),e==="showKeyTips"&&(r.showKeyTips?i("footer .keyTips").removeClass("hidden"):i("footer .keyTips").addClass("hidden")),e==="fontFamily"&&await Ur()});const VI={punctuation:{subgroup:{options:"fromSchema",afterExec:()=>{z()}}},numbers:{subgroup:{options:"fromSchema",afterExec:()=>{z()}}},words:{alias:"words",subgroup:{options:[10,25,50,100],afterExec:()=>{ee(),z()}},input:{inputValueConvert:Number,afterExec:()=>{ee(),z()}}},time:{subgroup:{options:[15,30,60,120],afterExec:()=>{ee(),z()}},input:{inputValueConvert:Number,afterExec:()=>{ee(),z()}}},mode:{subgroup:{options:"fromSchema",afterExec:()=>{ee(),z()}}},quoteLength:{alias:"quotes",subgroup:{options:[[0,1,2,3],[0],[1],[2],[3],[-3]],configValueMode:()=>"include",isAvailable:e=>{if(e[0]===-3)return B},display:e=>gs(e,[0,1,2,3])?"all":{0:"short",1:"medium",2:"long",3:"thicc","-3":"favorite"}[e[0]],afterExec:()=>{z()}}},language:{subgroup:{options:"fromSchema",display:e=>ea(e)}},difficulty:{subgroup:{options:"fromSchema"}},quickRestart:{subgroup:{options:"fromSchema"}},repeatQuotes:{subgroup:{options:"fromSchema"}},blindMode:{subgroup:{options:"fromSchema"}},alwaysShowWordsHistory:{subgroup:{options:"fromSchema"}},singleListCommandLine:{subgroup:{options:"fromSchema"}},minWpm:{display:"Minimum speed...",alias:"wpm",subgroup:{options:["off"]},input:{configValue:"custom",display:"custom...",secondKey:"minWpmCustomSpeed",inputValueConvert:e=>{let t=Number(e);return t=gt(r.typingSpeedUnit).toWpm(t),t}}},minAcc:{display:"Minimum accuracy...",subgroup:{options:["off"]},input:{configValue:"custom",display:"custom...",secondKey:"minAccCustom",inputValueConvert:e=>Number(e)}},britishEnglish:{subgroup:{options:"fromSchema",afterExec:()=>{z()}}},customLayoutfluid:{input:{defaultValue:()=>r.customLayoutfluid.join(" "),inputValueConvert:e=>e.trim().split(" ")}},customPolyglot:{input:{defaultValue:()=>r.customPolyglot.join(" "),inputValueConvert:e=>e.trim().split(" "),afterExec:()=>{Z()==="test"&&z()}}},freedomMode:{subgroup:{options:"fromSchema"}},strictSpace:{subgroup:{options:"fromSchema"}},oppositeShiftMode:{subgroup:{options:"fromSchema",afterExec:()=>{Nt()}}},stopOnError:{subgroup:{options:"fromSchema"}},confidenceMode:{subgroup:{options:"fromSchema"}},quickEnd:{subgroup:{options:"fromSchema"}},indicateTypos:{subgroup:{options:"fromSchema"}},hideExtraLetters:{subgroup:{options:"fromSchema"}},lazyMode:{subgroup:{options:"fromSchema",afterExec:()=>z()}},layout:{subgroup:{options:"fromSchema",display:e=>e==="default"?"off":e.replace(/_/g," "),afterExec:()=>z()}},codeUnindentOnBackspace:{subgroup:{options:"fromSchema"}},soundVolume:{subgroup:{options:[.1,.5,1],display:e=>new Map([[.1,"quiet"],[.5,"medium"],[1,"loud"]]).get(e)??"custom...",afterExec:()=>Wo},input:{inputValueConvert:Number}},playSoundOnClick:{alias:"play",display:"Sound on click...",subgroup:{options:"fromSchema",display:e=>({off:"off",1:"click",2:"beep",3:"pop",4:"nk creams",5:"typewriter",6:"osu",7:"hitmarker",8:"sine",9:"sawtooth",10:"square",11:"triangle",12:"pentatonic",13:"wholetone",14:"fist fight",15:"rubber keys"})[e],hover:e=>{e!=="off"&&uA(e)},afterExec:()=>{Wo()}}},playSoundOnError:{alias:"play",display:"Sound on error...",subgroup:{options:"fromSchema",display:e=>({off:"off",1:"damage",2:"triangle",3:"square",4:"punch miss"})[e],hover:e=>{e!=="off"&&fA(e)},afterExec:()=>{Cl()}}},playTimeWarning:{alias:"sound",subgroup:{options:"fromSchema",display:e=>e==="off"?"off":`${e} second${e!=="1"?"s":""}`,afterExec:e=>{e!=="off"&&Jc()},hover:e=>{e!=="off"&&Jc()}}},smoothCaret:{subgroup:{options:"fromSchema"}},caretStyle:{subgroup:{options:"fromSchema",isVisible:e=>!["banana","carrot"].includes(e)}},paceCaret:{display:"Pace caret mode...",subgroup:{options:["off","pb","tagPb","last","average","daily"],afterExec:()=>{z()}},input:{secondKey:"paceCaretCustomSpeed",configValue:"custom",inputValueConvert:e=>{let t=Number(e);return t=gt(r.typingSpeedUnit).toWpm(t),t},afterExec:()=>{z()}}},repeatedPace:{subgroup:{options:"fromSchema"}},paceCaretStyle:{subgroup:{options:"fromSchema",isVisible:e=>!["banana","carrot"].includes(e)}},liveSpeedStyle:{subgroup:{options:"fromSchema"},alias:"wpm"},liveAccStyle:{subgroup:{options:"fromSchema"},alias:"wpm"},liveBurstStyle:{subgroup:{options:"fromSchema"},alias:"wpm"},timerStyle:{display:"Live progress style...",subgroup:{options:"fromSchema"},alias:"timer"},timerColor:{display:"Live progress color...",alias:"timer speed wpm burst acc",subgroup:{options:"fromSchema",alias:()=>"timer"}},timerOpacity:{display:"Live progress opacity...",alias:"timer speed wpm burst acc",subgroup:{options:"fromSchema",alias:()=>"timer"}},highlightMode:{subgroup:{options:"fromSchema"}},tapeMode:{subgroup:{options:"fromSchema"}},tapeMargin:{input:{inputValueConvert:Number}},smoothLineScroll:{subgroup:{options:"fromSchema"}},showAllLines:{subgroup:{options:"fromSchema"}},typingSpeedUnit:{subgroup:{options:"fromSchema",isVisible:e=>e!=="wph"}},alwaysShowDecimalPlaces:{subgroup:{options:"fromSchema"}},startGraphsAtZero:{subgroup:{options:"fromSchema"}},maxLineWidth:{input:{alias:"page",inputValueConvert:Number}},fontSize:{input:{inputValueConvert:Number}},fontFamily:{subgroup:{options:lt(va).sort((e,t)=>{var o,a;return(((o=va[e])==null?void 0:o.display)??e.replace(/_/g," ")).localeCompare(((a=va[t])==null?void 0:a.display)??t.replace(/_/g," "))}),display:e=>{var t;return((t=va[e])==null?void 0:t.display)??e.replaceAll(/_/g," ")},customData:e=>{const t=va[e];return t===void 0?{}:{name:e.replaceAll(/_/g," "),isSystem:t.systemFont===!0,display:t.display}},hover:e=>Y0(e)}},keymapMode:{alias:"keyboard",subgroup:{options:"fromSchema",alias:e=>e==="react"?"flash":""}},keymapStyle:{subgroup:{options:"fromSchema"},alias:"keyboard"},keymapLegendStyle:{subgroup:{options:"fromSchema"},alias:"keyboard"},keymapSize:{input:{alias:"keyboard",inputValueConvert:Number}},keymapLayout:{alias:"keyboard",subgroup:{options:"fromSchema",alias:e=>e==="overrideSync"?"default":"",display:e=>e==="overrideSync"?"emulator sync":e.replace(/_/g," "),afterExec:()=>z()}},keymapShowTopRow:{subgroup:{options:"fromSchema"},alias:"keyboard"},customTheme:{subgroup:{options:"fromSchema"}},flipTestColors:{subgroup:{options:"fromSchema"}},colorfulMode:{subgroup:{options:"fromSchema"}},customBackground:{input:{}},customBackgroundSize:{subgroup:{options:"fromSchema"}},randomTheme:{subgroup:{options:"fromSchema",isAvailable:e=>e==="custom"?B:void 0}},showKeyTips:{subgroup:{options:"fromSchema"},display:"Key tips..."},showOutOfFocusWarning:{subgroup:{options:"fromSchema"},display:"Out of focus warning..."},capsLockWarning:{subgroup:{options:"fromSchema"}},showAverage:{subgroup:{options:"fromSchema"}},monkeyPowerLevel:{alias:"powermode",isVisible:!1,subgroup:{options:"fromSchema",display:e=>({off:"off",1:"mellow",2:"high",3:"ultra",4:"over 9000"})[e]}},monkey:{subgroup:{options:"fromSchema"}},ads:{subgroup:{options:"fromSchema"}}};function Zf(e){if(e instanceof D.ZodLiteral)return[e.value];if(e instanceof D.ZodEnum)return e.options;if(e instanceof D.ZodBoolean)return[!0,!1];if(e instanceof D.ZodUnion)return e.options.flatMap(Zf).filter(t=>t!==void 0)}function qe(e){const t=Bb[e],o=VI[e],a=il.shape[e];return KI(e,t,o,a)}function KI(e,t,o,a){var n;if(o==null)throw new Error(`No commandline metadata found for config key "${e}".`);let s;if("subgroup"in o&&o.subgroup!==void 0&&(s=GI(e,o.display,o.alias,o.subgroup,t,a)),"input"in o&&o.input!==void 0){const l=o.input,c=QI({key:"secondKey"in l?l.secondKey:e,isPartOfSubgruop:"subgroup"in o,inputProps:l,configMeta:t,schema:"secondKey"in l?il.shape[l.secondKey]:a});if(s===void 0)return c;(n=s.subgroup)==null||n.list.push(c)}if(s===void 0)throw new Error(`Nothing returned for config key "${e}". This is a bug in the commandline metadata.`);return s}function GI(e,t,o,a,s,n){if(a===null)throw new Error(`No commandline metadata found for config key "${e}".`);const l=t??`${_t((s==null?void 0:s.displayString)??e)}...`;let c=a.options??Zf(n);if(c==="fromSchema"&&(c=Zf(n)),c===void 0)throw new Error(`Unsupported schema type for key "${e}": ${n._def.typeName}`);const d=c.map(u=>jI(e,u,a));return d.sort((u,f)=>u.configValue==="off"||u.configValue===!1?-1:f.configValue==="off"||f.configValue===!1?1:0),{id:`change${_t(e)}`,display:l,icon:(s==null?void 0:s.icon)??"fa-cog",subgroup:{title:l,configKey:e,list:d},alias:o}}function jI(e,t,{afterExec:o,hover:a,display:s,alias:n,configValueMode:l,isVisible:c,isAvailable:d,customData:u}){const f=t;let p=s==null?void 0:s(t);return p===void 0&&(t===!0?p="on":t===!1?p="off":p=t.toString()),{id:`set${_t(e)}${_t(f.toString())}`,display:p,configValueMode:l==null?void 0:l(t),alias:(n==null?void 0:n(t))??void 0,configValue:f,visible:(c==null?void 0:c(t))??void 0,available:(d==null?void 0:d(t))??void 0,exec:()=>{A(e,f),o==null||o(f)},hover:a!==void 0?()=>{a==null||a(f)}:void 0,customData:(u==null?void 0:u(f))??void 0}}function QI({key:e,isPartOfSubgruop:t,inputProps:o,configMeta:a,schema:s}){const n=(o==null?void 0:o.validation)??{schema:!0},l=(o==null?void 0:o.display)??(t?"custom...":`${_t(a.displayString??e)}...`),c={id:`set${_t(e)}Custom`,defaultValue:(o==null?void 0:o.defaultValue)??(()=>{var d;return((d=r[e])==null?void 0:d.toString())??""}),configValue:o!==void 0&&"configValue"in o?o.configValue??void 0:void 0,display:l,alias:(o==null?void 0:o.alias)??void 0,input:!0,icon:a.icon??"fa-cog",exec:({input:d})=>{var u;d!==void 0&&(A(e,d),(u=o==null?void 0:o.afterExec)==null||u.call(o,d))},hover:o==null?void 0:o.hover};return(o==null?void 0:o.inputValueConvert)!==void 0&&(c.inputValueConvert=o.inputValueConvert),c.validation={schema:n.schema===!0?s:void 0,isValid:n.isValid},c}const YI=qe("customBackground"),XI={id:"customBackground",display:"Custom background...",icon:"fa-image",subgroup:{title:"Custom background...",list:[YI,{id:"customLocalBackground",display:"Local background...",icon:"fa-file-import fa-fw",alias:"upload background",available:async()=>!await et.hasFile("LocalBackgroundFile"),exec:async()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.style.display="none",document.body.appendChild(e);const t=()=>{document.body.removeChild(e)};e.onchange=async o=>{var n;const a=(n=o.target.files)==null?void 0:n[0];if(!a){t();return}if(!a.type.match(/image\/(jpeg|jpg|png|gif|webp)/)){m("Unsupported image format",0),t();return}const s=new FileReader;s.onload=async l=>{var d;const c=(d=l.target)==null?void 0:d.result;try{await et.storeFile("LocalBackgroundFile",c),await yn(),await Qr()}catch(u){m("Error uploading background: "+u.message,0)}t()},s.onerror=t,s.readAsDataURL(a)},e.click()}},{id:"removeLocalBackground",display:"Remove local background",icon:"fa-trash",alias:"remove background",available:async()=>await et.hasFile("LocalBackgroundFile"),exec:async()=>{try{await et.deleteFile("LocalBackgroundFile"),await yn(),await Qr()}catch(e){m("Error removing background: "+e.message,0)}}}]}},ZI=[XI],Jf=qe("fontFamily");Jf.subgroup&&Jf.subgroup.list.push({id:"customFont",display:"Custom font...",icon:"fa-font",alias:"custom font options",subgroup:{title:"Custom font...",list:[{id:"customFontName",display:"Custom name...",icon:"fa-font",alias:"custom font name",input:!0,defaultValue:()=>r.fontFamily.replace(/_/g," "),exec:({input:e})=>{if(e===void 0||e==="")return;const t=e.replaceAll(/ /g,"_");Fb(t)}},{id:"customLocalFont",display:"Local font...",icon:"fa-file-import fa-fw",alias:"upload font",available:async()=>!await et.hasFile("LocalFontFamilyFile"),exec:async()=>{const e=document.createElement("input");e.type="file",e.accept="font/woff,font/woff2,font/ttf,font/otf",e.style.display="none",document.body.appendChild(e);const t=()=>{document.body.removeChild(e)};e.onchange=async o=>{var n;const a=(n=o.target.files)==null?void 0:n[0];if(!a){t();return}if(!a.type.match(/font\/(woff|woff2|ttf|otf)/)&&!a.name.match(/\.(woff|woff2|ttf|otf)$/i)){m("Unsupported font format, must be woff, woff2, ttf or otf.",0),t();return}const s=new FileReader;s.onload=async l=>{var d;const c=(d=l.target)==null?void 0:d.result;try{await et.storeFile("LocalFontFamilyFile",c),await Ur(),await Yr()}catch(u){m("Error uploading font: "+u.message,0)}t()},s.onerror=t,s.readAsDataURL(a)},e.click()}},{id:"removeLocalFont",display:"Remove local font",icon:"fa-trash",alias:"remove font",available:async()=>await et.hasFile("LocalFontFamilyFile"),exec:async()=>{try{await et.deleteFile("LocalFontFamilyFile"),await Yr(),await Ur()}catch(e){m("Error removing font: "+e.message,0)}}}]}});const JI=[Jf],eB={title:"Custom background filter...",configKey:"customBackgroundFilter",list:[{id:"setCustomBackgroundBlur",display:"blur...",icon:"fa-image",input:!0,defaultValue:()=>r.customBackgroundFilter[0].toString(),exec:({input:e})=>{if(e===void 0||e==="")return;const t=r.customBackgroundFilter;t[0]=parseFloat(e),Oi(t)}},{id:"setCustomBackgroundBrightness",display:"brightness...",icon:"fa-image",input:!0,defaultValue:()=>r.customBackgroundFilter[1].toString(),exec:({input:e})=>{if(e===void 0||e==="")return;const t=r.customBackgroundFilter;t[1]=parseFloat(e),Oi(t)}},{id:"setCustomBackgroundSaturation",display:"saturation...",icon:"fa-image",input:!0,defaultValue:()=>r.customBackgroundFilter[2].toString(),exec:({input:e})=>{if(e===void 0||e==="")return;const t=r.customBackgroundFilter;t[2]=parseFloat(e),Oi(t)}},{id:"setCustomBackgroundOpacity",display:"opacity...",icon:"fa-image",input:!0,defaultValue:()=>r.customBackgroundFilter[3].toString(),exec:({input:e})=>{if(e===void 0||e==="")return;const t=r.customBackgroundFilter;t[3]=parseFloat(e),Oi(t)}}]},tB=[{id:"setCustomBackgroundFilter",display:"Custom background filter...",icon:"fa-image",subgroup:eB}],oB=[{id:"addThemeToFavorite",display:"Add current theme to favorite",icon:"fa-star",available:()=>!r.customTheme&&!r.favThemes.includes(Ve??r.theme),exec:()=>{const{theme:e,favThemes:t,customTheme:o}=r,a=Ve??e;!o&&!t.includes(a)&&Bc([...t,a])}},{id:"removeThemeFromFavorite",display:"Remove current theme from favorite",icon:"fa-star",iconType:"regular",available:()=>!r.customTheme&&r.favThemes.includes(Ve??r.theme),exec:()=>{const{theme:e,favThemes:t,customTheme:o}=r,a=Ve??e;!o&&t.includes(a)&&Bc([...t.filter(s=>s!==a)])}}],ep=e=>e.replaceAll(" ","_"),Wh=async e=>{const t=cS.safeParse(ep(e));return t.success?!0:t.error.errors.map(o=>o.message).join(", ")},aB={add:new he({id:"addTag",title:"Add new tag",inputs:[{placeholder:"tag name",type:"text",validation:{isValid:Wh,debounceDelay:0}}],onlineOnly:!0,buttonText:"add",execFn:async(e,t)=>{var s,n;const o=ep(t),a=await E.users.createTag({body:{tagName:o}});return a.status!==200?{status:-1,message:"Failed to add tag: "+a.body.message.replace(o,t)}:((n=(s=x())==null?void 0:s.tags)==null||n.push({display:t,name:a.body.data.name,_id:a.body.data._id,personalBests:{time:{},words:{},quote:{},zen:{},custom:{}}}),ka(),{status:1,message:"Tag added"})}}),edit:new he({id:"editTag",title:"Edit tag",inputs:[{placeholder:"tag name",type:"text",validation:{isValid:Wh,debounceDelay:0}}],onlineOnly:!0,buttonText:"save",beforeInitFn:e=>{e.inputs[0].initVal=e.parameters[0]},execFn:async(e,t)=>{var n,l;const o=ep(t),a=e.parameters[1],s=await E.users.editTag({body:{tagId:a,newName:o}});return s.status!==200?{status:-1,message:"Failed to edit tag: "+s.body.message}:((l=(n=x())==null?void 0:n.tags)==null||l.forEach(c=>{c._id===a&&(c.name=o,c.display=t)}),ka(),{status:1,message:"Tag updated"})}}),remove:new he({id:"removeTag",title:"Delete tag",onlineOnly:!0,buttonText:"delete",beforeInitFn:e=>{e.text=`Are you sure you want to delete tag ${e.parameters[0]} ?`},execFn:async e=>{var a,s;const t=e.parameters[1],o=await E.users.deleteTag({params:{tagId:t}});return o.status!==200?{status:-1,message:"Failed to remove tag: "+o.body.message}:((s=(a=x())==null?void 0:a.tags)==null||s.forEach((n,l)=>{var c,d;n._id===t&&((d=(c=x())==null?void 0:c.tags)==null||d.splice(l,1))}),ka(),{status:1,message:"Tag removed"})}}),clearPb:new he({id:"clearTagPb",title:"Clear personal bests",onlineOnly:!0,buttonText:"clear",beforeInitFn:e=>{e.text=`Are you sure you want to clear personal bests for tag ${e.parameters[0]} ?`},execFn:async e=>{const t=e.parameters[1],o=await E.users.deleteTagPersonalBest({params:{tagId:t}});return o.status!==200?{status:-1,message:"Failed to clear tag pb: "+o.body.message}:(ka(),{status:1,message:"Tag PB cleared"})}})};function Yn(e,t,o,a){const s={modalChain:a,focusFirstInput:"focusAndSelect"};e!=="add"&&(o===void 0||t===void 0)||aB[e].show([o??"",t??""],s)}const Xn={title:"Tags...",list:[],beforeList:()=>{sB()}},X0=[{id:"changeTags",display:"Tags...",icon:"fa-tag",subgroup:Xn,available:()=>B()}];function sB(){const e=x();if(Xn.list=[],e!==void 0&&e.tags!==void 0&&e.tags.length>0){Xn.list.push({id:"clearTags",display:"Clear tags",icon:"fa-times",sticky:!0,exec:async()=>{var o;const t=x();t&&(t.tags=(o=t.tags)==null?void 0:o.map(a=>(a.active=!1,a)),kt(t),(r.paceCaret==="average"||r.paceCaret==="tagPb"||r.paceCaret==="daily")&&await Xc(),Nt(),_n())}});for(const t of e.tags)Xn.list.push({id:"toggleTag"+t._id,display:t.display,sticky:!0,active:()=>{var o,a,s;return((s=(a=(o=x())==null?void 0:o.tags)==null?void 0:a.find(n=>n._id===t._id))==null?void 0:s.active)??!1},exec:async()=>{Tm(t._id),(r.paceCaret==="average"||r.paceCaret==="tagPb"||r.paceCaret==="daily")&&await Xc(),Nt()}})}Xn.list.push({id:"createTag",display:"Create tag",icon:"fa-plus",shouldFocusTestUI:!1,opensModal:!0,exec:({commandlineModal:t})=>{Yn("add",void 0,void 0,t)}})}const tp={title:"Custom themes list...",beforeList:()=>nB(),list:[]},iB=[{id:"setCustomThemeId",display:"Custom themes...",icon:"fa-palette",subgroup:tp,available:()=>B()}];function nB(){var t;if(!B())return;tp.list=[];const e=x();if(e&&e.customThemes!==void 0&&((t=e.customThemes)==null?void 0:t.length)!==0)for(const o of e.customThemes)tp.list.push({id:"setCustomThemeId"+o._id,display:o.name.replace(/_/gi," "),configValue:o._id,hover:()=>{dm("custom",o.colors)},exec:()=>{xa(!0),dn(o.colors)}})}const pe={presetType:"full",checkboxes:new Map(kd.options.map(e=>[e,!0])),setPresetToCurrent:!1};let je=null;function wc(e,t,o){if(!tt()){m("You are offline",0,{duration:2});return}J0.show({focusFirstInput:!0,beforeAnimation:async()=>{var a,s,n;i("#editPresetModal .modal .text").addClass("hidden"),cB(),je||(je=ia(document.querySelector("#editPresetModal .modal input"),{schema:fS})),e==="add"?(i("#editPresetModal .modal").attr("data-action","add"),i("#editPresetModal .modal .popupTitle").html("Add new preset"),i("#editPresetModal .modal .submit").html("add"),je==null||je.setValue(null),(a=je==null?void 0:je.parentElement)==null||a.classList.remove("hidden"),i("#editPresetModal .modal input").removeClass("hidden"),i("#editPresetModal .modal label.changePresetToCurrentCheckbox").addClass("hidden"),i("#editPresetModal .modal .inputs").removeClass("hidden"),i("#editPresetModal .modal .presetType").removeClass("hidden"),i("#editPresetModal .modal .presetNameTitle").removeClass("hidden"),pe.presetType="full"):e==="edit"&&t!==void 0&&o!==void 0?(i("#editPresetModal .modal").attr("data-action","edit"),i("#editPresetModal .modal").attr("data-preset-id",t),i("#editPresetModal .modal .popupTitle").html("Edit preset"),i("#editPresetModal .modal .submit").html("save"),je==null||je.setValue(o),(s=je==null?void 0:je.parentElement)==null||s.classList.remove("hidden"),i("#editPresetModal .modal input").removeClass("hidden"),i("#editPresetModal .modal label.changePresetToCurrentCheckbox").removeClass("hidden"),i("#editPresetModal .modal .presetNameTitle").removeClass("hidden"),pe.setPresetToCurrent=!1,await Z0()):e==="remove"&&t!==void 0&&o!==void 0&&(i("#editPresetModal .modal").attr("data-action","remove"),i("#editPresetModal .modal").attr("data-preset-id",t),i("#editPresetModal .modal .popupTitle").html("Delete preset"),i("#editPresetModal .modal .submit").html("delete"),i("#editPresetModal .modal input").addClass("hidden"),i("#editPresetModal .modal label.changePresetToCurrentCheckbox").addClass("hidden"),i("#editPresetModal .modal .text").removeClass("hidden"),i("#editPresetModal .modal .deletePrompt").text(`Are you sure you want to delete the preset ${o}?`),i("#editPresetModal .modal .inputs").addClass("hidden"),i("#editPresetModal .modal .presetType").addClass("hidden"),i("#editPresetModal .modal .presetNameTitle").addClass("hidden"),(n=je==null?void 0:je.parentElement)==null||n.classList.add("hidden")),Hm()}})}async function rB(e){for(const o of pe.checkboxes.keys())pe.checkboxes.set(o,!1);const t=await qE(e);if(t===void 0){m("Preset not found",-1);return}if(t.settingGroups===void 0||t.settingGroups===null){pe.presetType="full";for(const o of pe.checkboxes.keys())pe.checkboxes.set(o,!0)}else pe.presetType="partial",t.settingGroups.forEach(o=>pe.checkboxes.set(o,!0));pe.setPresetToCurrent=!1,Hm()}function lB(){kd.options.forEach(t=>{const o=i(`#editPresetModal .modal .checkboxList .checkboxTitlePair[data-id="${t}"] input`);o.on("change",a=>{pe.checkboxes.set(t,o.prop("checked"))})});const e=i("#editPresetModal .modal .changePresetToCurrentCheckbox input");e.on("change",async()=>{pe.setPresetToCurrent=e.prop("checked"),await Z0()})}function cB(){function e(o){return o.replace(/([a-z])([A-Z])/g,"$1 $2")}const t=i("#editPresetModal .modal .inputs .checkboxList").empty();kd.options.forEach(o=>{const a=e(o),s=`<label class="checkboxTitlePair" data-id="${o}">
              <input type="checkbox" />
              <div class="title">${a}</div>
              </label>`;t.append(s)});for(const o of pe.checkboxes.keys())pe.checkboxes.set(o,!0);lB()}function Hm(){kd.options.forEach(e=>{i(`#editPresetModal .modal .checkboxList .checkboxTitlePair[data-id="${e}"] input`).prop("checked",pe.checkboxes.get(e))}),i("#editPresetModal .modal .presetType button").removeClass("active"),i(`#editPresetModal .modal .presetType button[value="${pe.presetType}"]`).addClass("active"),i("#editPresetModal .modal .partialPresetGroups").removeClass("hidden"),pe.presetType==="full"&&i("#editPresetModal .modal .partialPresetGroups").addClass("hidden")}async function Z0(){if(i("#editPresetModal .modal label.changePresetToCurrentCheckbox input").prop("checked",pe.setPresetToCurrent),pe.setPresetToCurrent){const e=i("#editPresetModal .modal").attr("data-preset-id");await rB(e),i("#editPresetModal .modal .inputs").removeClass("hidden"),i("#editPresetModal .modal .presetType").removeClass("hidden")}else i("#editPresetModal .modal .inputs").addClass("hidden"),i("#editPresetModal .modal .presetType").addClass("hidden")}function dB(){J0.hide()}async function uB(){var d;const e=i("#editPresetModal .modal").attr("data-action"),t=i("#editPresetModal .modal input").val(),o=t.replaceAll(" ","_"),a=i("#editPresetModal .modal").attr("data-preset-id"),s=i("#editPresetModal .modal label input").prop("checked"),n=((d=x())==null?void 0:d.presets)??[];if(e===void 0)return;if(["add","edit"].includes(e)&&pe.presetType==="partial"&&Array.from(pe.checkboxes.values()).every(u=>!u)){m("At least one setting group must be active while saving partial presets",0);return}if(["add","edit"].includes(e)&&o.replace(/^_+|_+$/g,"").length===0){m("Preset name cannot be empty",0);return}if((je==null?void 0:je.isValid())===!1){m("Preset name is not valid",0);return}if(dB(),J(),e==="add"){const u=Ph(),f=zu(),p=await E.presets.add({body:{name:o,config:u,...pe.presetType==="partial"&&{settingGroups:f}}});p.status!==200||p.body.data===null?m("Failed to add preset: "+p.body.message.replace(o,t),-1):(m("Preset added",1,{duration:2}),n.push({name:o,config:u,...pe.presetType==="partial"&&{settingGroups:f},display:t,_id:p.body.data.presetId}))}else if(e==="edit"){const u=n.find(g=>g._id===a);if(u===void 0){m("Preset not found",-1);return}const f=Ph(),p=pe.presetType==="partial"?zu():null,h=await E.presets.save({body:{_id:a,name:o,...s&&{config:f,settingGroups:p}}});h.status!==200?m("Failed to edit preset: "+h.body.message,-1):(m("Preset updated",1),u.name=o,u.display=o.replace(/_/g," "),s&&(u.config=f,pe.presetType==="partial"?u.settingGroups=zu():u.settingGroups=null))}else if(e==="remove"){const u=await E.presets.delete({params:{presetId:a}});u.status!==200?m("Failed to remove preset: "+u.body.message,-1):(m("Preset removed",1),n.forEach((f,p)=>{f._id===a&&n.splice(p,1)}))}ka(),K()}function fB(e){return uS[e]}function pB(e){const t={},o=Jo();return Object.keys(o).filter(a=>{const s=fB(a);return s===null?!1:pe.checkboxes.get(s)===!0}).forEach(a=>{const s=a,n=e[s]!==void 0?e[s]:o[s];t[s]=n}),t}function zu(){return Array.from(pe.checkboxes.entries()).filter(([,e])=>e).map(([e])=>e)}function Ph(){var s;const e=pe.presetType==="partial"?pB(Pg()):Pg(),o=(((s=x())==null?void 0:s.tags)??[]).filter(n=>n.active).map(n=>n._id),a=pe.presetType==="full"||pe.checkboxes.get("behavior")===!0;return{...e,...a&&{tags:o}}}async function mB(e){e.addEventListener("submit",t=>{t.preventDefault(),uB()}),dS.options.forEach(t=>{const o=e.querySelector(`.presetType button[value="${t}"]`);o!==null&&o.addEventListener("click",()=>{pe.presetType=t,Hm()})})}const J0=new re({dialogId:"editPresetModal",setup:mB}),Cc={title:"Presets...",list:[],beforeList:()=>{hB()}},gB=[{visible:!1,id:"applyPreset",display:"Presets...",icon:"fa-sliders-h",subgroup:Cc,available:()=>B()}];function hB(){const e=x();Cc.list=[],!(!(e!=null&&e.presets)||e.presets.length===0)&&(e.presets.forEach(t=>{const o=t.display;Cc.list.push({id:"applyPreset"+t._id,display:o,exec:async()=>{vn(!0),await o0(t._id),vn(!1),ka(),Nt()}})}),Cc.list.push({id:"createPreset",display:"Create preset",icon:"fa-plus",exec:()=>{wc("add")}}))}const eC=[{id:"changeFunboxNone",display:"none",configValue:"none",alias:"off",sticky:!0,exec:()=>{ee(),$M([])&&z()}}];for(const e of bp())eC.push({id:"changeFunbox"+e.name,display:e.name.replace(/_/g," "),available:()=>{const t=ho();return t.includes(e.name)?!0:sl(t,e.name)},sticky:!0,alias:e.alias,configValue:e.name,configValueMode:"include",exec:()=>{Vv(e.name),ee(),z()}});const yB={title:"Funbox...",configKey:"funbox",list:eC},tC=[{id:"changeFunbox",display:"Funbox...",alias:"fun box",icon:"fa-gamepad",subgroup:yB}],op=e=>r.favThemes.includes(e.name),oC=e=>({id:"changeTheme"+yi(e.name),display:e.name.replace(/_/g," "),configValue:e.name,customData:{mainColor:e.mainColor,bgColor:e.bgColor,subColor:e.subColor,textColor:e.textColor,isFavorite:op(e)},hover:()=>{dm(e.name)},exec:()=>{_p(e.name)}}),aC=e=>[...e.filter(op),...e.filter(pS(op))],ap={title:"Theme...",configKey:"theme",list:aC(wl).map(e=>oC(e))},sC=[{id:"changeTheme",display:"Theme...",icon:"fa-palette",subgroup:ap}];function bB(e){ap.list=[],ap.list=aC(e).map(t=>oC(t))}be((e,t)=>{if(e==="favThemes")try{bB(wl)}catch(o){console.error(ie(o,"Failed to update themes commands"))}});const iC={title:"Load challenge...",list:[]},nC=[{id:"loadChallenge",display:"Load challenge...",icon:"fa-award",subgroup:iC}];function vB(e){e.forEach(t=>{iC.list.push({id:"loadChallenge"+yi(t.name),display:t.display,exec:async()=>{await Ke("/"),await kw(t.name),z({nosave:!0})}})})}const rC={homeKeys:{display:"home keys",getIncludeString:e=>{const t=e.keys.row3.slice(0,4),o=e.keys.row3.slice(6,10);return[...t,...o]},getExcludeString:e=>{const t=e.keys.row2,o=e.keys.row4,a=e.keys.row3.slice(10),s=e.keys.row3.slice(4,6);return[...t,...s,...a,...o]}},leftHand:{display:"left hand",getIncludeString:e=>{const t=e.keys.row2.slice(0,5),o=e.keys.row3.slice(0,5),a=e.keys.row4.slice(0,5);return[...t,...o,...a]},getExcludeString:e=>{const t=e.keys.row2.slice(5),o=e.keys.row3.slice(5),a=e.keys.row4.slice(5);return[...t,...o,...a]}},rightHand:{display:"right hand",getIncludeString:e=>{const t=e.keys.row2.slice(5),o=e.keys.row3.slice(5),a=e.keys.row4.slice(4);return[...t,...o,...a]},getExcludeString:e=>{const t=e.keys.row2.slice(0,5),o=e.keys.row3.slice(0,5),a=e.keys.row4.slice(0,4);return[...t,...o,...a]}},homeRow:{display:"home row",getIncludeString:e=>e.keys.row3,getExcludeString:e=>{const t=e.keys.row2,o=e.keys.row4;return[...t,...o]}},topRow:{display:"top row",getIncludeString:e=>e.keys.row2,getExcludeString:e=>{const t=e.keys.row3,o=e.keys.row4;return[...t,...o]}},bottomRow:{display:"bottom row",getIncludeString:e=>e.keys.row4,getExcludeString:e=>{const t=e.keys.row2,o=e.keys.row3;return[...t,...o]}}};async function wB(){i("#wordFilterModal .languageInput").empty(),i("#wordFilterModal .layoutInput").empty(),i("wordFilterModal .presetInput").empty(),Vp.forEach(e=>{const t=e.replace(/_/gi," ");i("#wordFilterModal .languageInput").append(`
        <option value=${e}>${t}</option>
      `)});for(const e of sd){const t=e.replace(/_/gi," ");i("#wordFilterModal .layoutInput").append(`
      <option value=${e}>${t}</option>
    `)}for(const[e,t]of Object.entries(rC))i("#wordFilterModal .presetInput").append(`<option value=${e}>${t.display}</option>`)}let Zn,Jn,er;async function CB(e){an.show({...e,beforeAnimation:async t=>{Zn=new st({select:"#wordFilterModal .languageInput",settings:{contentLocation:t}}),Jn=new st({select:"#wordFilterModal .layoutInput",settings:{contentLocation:an.getModal()}}),er=new st({select:"#wordFilterModal .presetInput",settings:{contentLocation:an.getModal()}}),i("#wordFilterModal .loadingIndicator").removeClass("hidden"),lC()}})}function kB(e){an.hide({...e})}async function SB(e){let t=i("#wordFilterModal .wordIncludeInput").val();t=mg(t==null?void 0:t.trim()),t=t.replace(/\s+/gi,"|");const o=new RegExp(t,"i");let a=i("#wordFilterModal .wordExcludeInput").val();a=mg(a.trim()),a=a.replace(/\s+/gi,"|");const s=new RegExp(a,"i"),n=[],{data:l,error:c}=await Qt($n(e));if(c)return m(ie(c,"Failed to filter language words"),-1),[];const d=i("#wordFilterModal .wordMaxInput").val(),u=i("#wordFilterModal .wordMinInput").val();let f,p;d===""?f=999:f=parseInt(d),u===""?p=1:p=parseInt(u);for(const h of l.words){const g=o.test(h),y=s.test(h);(g&&!y||g&&a==="")&&h.length<=f&&h.length>=p&&n.push(h)}return n}async function zh(e){const t=i("#wordFilterModal .languageInput").val(),o=await SB(t);if(o.length===0){m("No words found",0),lC();return}const a=o.join(ml()?"|":" ");kB({modalChainData:{text:a,set:e}})}function Hh(){for(const e of an.getModal().querySelectorAll("button"))e.setAttribute("disabled","true")}function lC(){for(const e of an.getModal().querySelectorAll("button"))e.removeAttribute("disabled")}async function xB(){await wB(),i("#wordFilterModal button.generateButton").on("click",async()=>{const e=i("#wordFilterModal .presetInput").val(),t=i("#wordFilterModal .layoutInput").val(),o=rC[e];if(o===void 0){m(`Preset ${e} not found`,-1);return}const a=await Ns(t);i("#wordIncludeInput").val(o.getIncludeString(a).map(s=>s[0]).join(" ")),i("#wordExcludeInput").val(o.getExcludeString(a).map(s=>s[0]).join(" "))}),i("#wordFilterModal button.addButton").on("click",()=>{i("#wordFilterModal .loadingIndicator").removeClass("hidden"),Hh(),setTimeout(()=>{zh(!1)},0)}),i("#wordFilterModal button.setButton").on("click",()=>{i("#wordFilterModal .loadingIndicator").removeClass("hidden"),Hh(),setTimeout(()=>{zh(!0)},0)})}async function TB(){Zn==null||Zn.destroy(),Jn==null||Jn.destroy(),er==null||er.destroy(),Zn=void 0,Jn=void 0,er=void 0}const an=new re({dialogId:"wordFilterModal",setup:xB,cleanup:TB});let{promise:cC,resolve:kc}=Wa();async function LB(){if(!di()){m("Could not show register popup: Captcha is not available. This could happen due to a blocked or failed network request. Please refresh the page or contact support if this issue persists.",-1),kc(void 0);return}await dC.show({mode:"dialog",beforeAnimation:async e=>{({promise:cC,resolve:kc}=Wa()),Ra("register"),Bn(e.querySelector(".g-recaptcha"),"register",t=>{kc(t),sp()})}})}function sp(e=!1){e&&kc(void 0),dC.hide()}const dC=new re({dialogId:"registerCaptchaModal",customEscapeHandler:async()=>{sp(!0)},customWrapperClickHandler:async()=>{sp(!0)}}),Om=new k1,Nm=new S1;async function uC(){if(!Bo()){m("Authentication uninitialized",-1,{duration:3});return}J(),i(".sendVerificationEmail").prop("disabled",!0);const e=await E.users.verificationEmail();i(".sendVerificationEmail").prop("disabled",!1),e.status!==200?(K(),m("Failed to request verification email: "+e.body.message,-1)):(K(),m("Verification email sent",1))}async function $B(){try{console.log("getting account data");const e=await vx();if(e===!1)throw new Error("Snapshot didn't initialize due to lacking authentication even though user is authenticated");qx(e.uid,e.name),e.needsToChangeName&&Hs("You need to update your account name. <a class='openNameChange'>Click here</a> to change it and learn more about why.",-1,void 0,!0,void 0,!0);const t=JSON.stringify(r)===JSON.stringify(e.config);if(r===void 0||!t){console.log("no local config or local and db configs are different - applying db"),await fn(e.config),xn(!0);for(const o of yt("applyGlobalCSS"))o.functions.applyGlobalCSS()}return!0}catch(e){if(console.error(e),oa(),i("header nav .view-account").css("opacity",1),e instanceof Vn)e.responseCode===429&&(m("Doing so will save you bandwidth, make the next test be ready faster and will not sign you out (which could mean your new personal best would not save to your account).",0,{duration:0}),m("You will run into this error if you refresh the website to restart the test. It is NOT recommended to do that. Instead, use tab + enter or just tab (with quick tab mode enabled) to restart the test.",0,{duration:0})),m("Failed to get user data: "+e.message,-1);else{const t=ie(e,"Failed to get user data");m(t,-1)}return!1}}async function fC(e){if(!await $B()){wi();return}$d({type:"snapshotUpdated",data:{isInitial:!0}})}async function pC(e,t){console.debug("account controller ready");let o=Promise.resolve();e&&(console.debug(`auth state changed, user ${t?"true":"false"}`),console.debug(t),t?o=fC():kt(void 0)),(!e||!t)&&Fx(),await Ke(void 0,{force:!0,loadingOptions:{loadingMode:()=>t!==null?"sync":"none",loadingPromise:async()=>{await o},style:"bar",keyframes:[{percentage:90,durationMs:1e3,text:"Downloading user data..."}]}}),$d({type:"authStateChanged",data:{isUserSignedIn:t!==null}})}async function MB(e,t){if(!Bo()){m("Authentication uninitialized",-1);return}if(!tt()){m("You are offline",0,{duration:2});return}if(Rm(),Fm(),Tl(),e===""||t===""){m("Please fill in all fields",0),Zo(),oa(),qm();return}const o=i(".pageLogin .login #rememberMe input").prop("checked"),{error:a}=await Qt(Y1(e,t,o));if(a!==null){m(a.message,-1),Zo(),oa(),ci();return}}async function mC(e){if(!Bo()){m("Authentication uninitialized",-1,{duration:3});return}if(!tt()){m("You are offline",0,{duration:2});return}Rm(),Fm(),Tl();const t=i(".pageLogin .login #rememberMe input").prop("checked"),{error:o}=await Qt(X1(e,t));if(o!==null){o.message!==""&&m(o.message,-1),Zo(),oa(),ci();return}}async function AB(){return mC(Om)}async function EB(){return mC(Nm)}async function _B(){return gC("Google",Om)}async function IB(){return gC("GitHub",Nm)}async function gC(e,t){if(!tt()){m("You are offline",0,{duration:2});return}if(!Bo()){m("Authentication uninitialized",-1,{duration:3});return}J();const o=go();if(o)try{await x1(o,t),K(),m(`${e} authentication added`,1),$d({type:"authConfigUpdated"})}catch(a){K();const s=ie(a,`Failed to add ${e} authentication`);m(s,-1)}}function wi(){if(!Bo()){m("Authentication uninitialized",-1,{duration:3});return}B()&&Q1()}async function BB(){if(!Bo()){m("Authentication uninitialized",-1,{duration:3});return}if(!tt()){m("You are offline",0,{duration:2});return}await LB();const e=await cC;if(e===void 0||e===""){m("Please complete the captcha",-1);return}Fm(),Tl(),Rm();const t=R_();if(t===!1){Zo(),oa(),ci(),m("Please fill in all fields",0);return}const{name:o,email:a,password:s}=t;try{const n=await Z1(a,s),l=await E.users.create({body:{name:o,captcha:e,email:a,uid:n.user.uid}});if(l.status!==200)throw new Error(`Failed to sign in: ${l.body.message}`);await eb(n.user,{displayName:o}),await uC(),Zo(),await pC(!0,n.user),rb(),m("Account created",1)}catch(n){let l=ie(n,"Failed to create account");n instanceof Error&&"code"in n&&n.code==="auth/email-already-in-use"&&(l=ie({message:"Email already in use"},"Failed to create account")),m(l,-1),Zo(),oa(),ci(),wi();return}}i(".pageLogin .login form").on("submit",e=>{e.preventDefault();const t=i(".pageLogin .login input")[0].value??"",o=i(".pageLogin .login input")[1].value??"";MB(t,o)});i(".pageLogin .login button.signInWithGoogle").on("click",()=>{AB()});i(".pageLogin .login button.signInWithGitHub").on("click",()=>{EB()});i("nav .accountButtonAndMenu .menu button.signOut").on("click",()=>{if(!Bo()){m("Authentication uninitialized",-1,{duration:3});return}wi()});i(".pageLogin .register form").on("submit",e=>{e.preventDefault(),BB()});i(".pageAccountSettings").on("click","#addGoogleAuth",()=>{_B()});i(".pageAccountSettings").on("click","#addGithubAuth",()=>{IB()});i(".pageAccount").on("click",".sendVerificationEmail",()=>{if(!tt()){m("You are offline",0,{duration:2});return}uC()});const We={updateEmail:void 0,updateName:void 0,updatePassword:void 0,removeGoogleAuth:void 0,removeGithubAuth:void 0,removePasswordAuth:void 0,addPasswordAuth:void 0,deleteAccount:void 0,resetAccount:void 0,optOutOfLeaderboards:void 0,applyCustomFont:void 0,resetPersonalBests:void 0,resetSettings:void 0,revokeAllTokens:void 0,unlinkDiscord:void 0,editApeKey:void 0,deleteCustomText:void 0,deleteCustomTextLong:void 0,resetProgressCustomTextLong:void 0,updateCustomTheme:void 0,deleteCustomTheme:void 0,devGenerateData:void 0,lbGoToPage:void 0};function qB(e){const o=["password","github.com","google.com"].filter(a=>a!==e);for(const a of o)if(du(a))return a}function na(){return du("password")}function FB(){return du("github.com")}function RB(){return du("google.com")}function du(e){var t;return((t=go())==null?void 0:t.providerData.some(o=>o.providerId===e))||!1}async function yo(e){if(!Bo())return{status:-1,message:"Authentication is not initialized"};const t=go();if(t===null)return{status:-1,message:"User is not signed in"};const o=qB(e.excludeMethod);try{if(o===void 0)return{status:-1,message:"Failed to reauthenticate: there is no valid authentication present on the account."};if(o==="password"){if(e.password===void 0)return{status:-1,message:"Failed to reauthenticate using password: password missing."};const a=tb.credential(t.email,e.password);await L1(t,a)}else await $1(t,o==="github.com"?Nm:Om);return{status:1,message:"Reauthenticated",user:t}}catch(a){const s=a;return s.code==="auth/wrong-password"?{status:0,message:"Incorrect password"}:s.code==="auth/invalid-credential"?{status:0,message:"Password is incorrect or your account does not have password authentication enabled."}:{status:-1,message:"Failed to reauthenticate: "+((s==null?void 0:s.message)??JSON.stringify(a))}}}We.updateEmail=new he({id:"updateEmail",title:"Update email",inputs:[{placeholder:"Password",type:"password",initVal:""},{type:"text",placeholder:"New email",initVal:"",validation:{schema:Lc}},{type:"text",placeholder:"Confirm new email",initVal:"",validation:{schema:Lc,isValid:async(e,t)=>{var o,a;return e===((a=(o=t.inputs)==null?void 0:o[1])==null?void 0:a.currentValue())||"Emails don't match"},debounceDelay:0}}],buttonText:"update",onlineOnly:!0,execFn:async(e,t,o,a)=>{if(o!==a)return{status:0,message:"Emails don't match"};const s=await yo({password:t});if(s.status!==1)return{status:s.status,message:s.message};const n=await E.users.updateEmail({body:{newEmail:o,previousEmail:s.user.email}});return n.status!==200?{status:-1,message:"Failed to update email: "+n.body.message}:(wi(),{status:1,message:"Email updated"})},beforeInitFn:e=>{B()&&(na()||(e.inputs=[],e.buttonText="",e.text="Password authentication is not enabled"))}});We.removeGoogleAuth=new he({id:"removeGoogleAuth",title:"Remove Google authentication",inputs:[{placeholder:"Password",type:"password",initVal:""}],onlineOnly:!0,buttonText:"remove",execFn:async(e,t)=>{const o=await yo({password:t,excludeMethod:"google.com"});if(o.status!==1)return{status:o.status,message:o.message};try{await wp(o.user,"google.com")}catch(a){return{status:-1,message:ie(a,"Failed to unlink Google account")}}return ws(),Pa(3),{status:1,message:"Google authentication removed"}},beforeInitFn:e=>{B()&&(na()||(e.inputs=[],FB()||(e.buttonText="",e.text="Password or GitHub authentication is not enabled")))}});We.removeGithubAuth=new he({id:"removeGithubAuth",title:"Remove GitHub authentication",inputs:[{placeholder:"Password",type:"password",initVal:""}],onlineOnly:!0,buttonText:"remove",execFn:async(e,t)=>{const o=await yo({password:t,excludeMethod:"github.com"});if(o.status!==1)return{status:o.status,message:o.message};try{await wp(o.user,"github.com")}catch(a){return{status:-1,message:ie(a,"Failed to unlink GitHub account")}}return ws(),Pa(3),{status:1,message:"GitHub authentication removed"}},beforeInitFn:e=>{B()&&(na()||(e.inputs=[],RB()||(e.buttonText="",e.text="Password or Google authentication is not enabled")))}});We.removePasswordAuth=new he({id:"removePaswordAuth",title:"Remove Password authentication",inputs:[{type:"checkbox",label:"I understand I will lose access to my Monkeytype account if my Google/GitHub account is lost or disabled."}],onlineOnly:!0,buttonText:"reauthenticate to remove",execFn:async e=>{const t=await yo({excludeMethod:"password"});if(t.status!==1)return{status:t.status,message:t.message};try{await wp(t.user,"password")}catch(o){return{status:-1,message:ie(o,"Failed to remove password authentication")}}return ws(),Pa(3),{status:1,message:"Password authentication removed"}},beforeInitFn:()=>{B()}});We.updateName=new he({id:"updateName",title:"Update name",inputs:[{placeholder:"password",type:"password",initVal:""},{placeholder:"new name",type:"text",initVal:"",validation:{schema:Cd,isValid:async e=>(await E.users.getNameAvailability({params:{name:e}})).status===200?!0:"Name not available",debounceDelay:1e3}}],buttonText:"update",onlineOnly:!0,execFn:async(e,t,o)=>{const a=await yo({password:t});if(a.status!==1)return{status:a.status,message:a.message};const s=await E.users.updateName({body:{name:o}});if(s.status!==200)return{status:-1,message:"Failed to update name: "+s.body.message};const n=x();return n&&(n.name=o,kt(n),n.needsToChangeName&&Pa(2)),{status:1,message:"Name updated"}},beforeInitFn:e=>{if(!B())return;const t=x();t&&(na()||(e.inputs[0].hidden=!0,e.buttonText="reauthenticate to update"),t.needsToChangeName===!0&&(e.text="You need to change your account name. This might be because you have a duplicate name, no account name or your name is not allowed (contains whitespace or invalid characters). Sorry for the inconvenience."))}});We.updatePassword=new he({id:"updatePassword",title:"Update password",inputs:[{placeholder:"current password",type:"password",initVal:""},{placeholder:"new password",type:"password",initVal:"",validation:{schema:Vy}},{placeholder:"confirm new password",type:"password",initVal:""}],buttonText:"update",onlineOnly:!0,execFn:async(e,t,o,a)=>{if(o!==a)return{status:0,message:"New passwords don't match"};if(o===t)return{status:0,message:"New password must be different from previous password"};const s=await yo({password:t});if(s.status!==1)return{status:s.status,message:s.message};const n=await E.users.updatePassword({body:{newPassword:o}});return n.status!==200?{status:-1,message:"Failed to update password: "+n.body.message}:(wi(),{status:1,message:"Password updated"})},beforeInitFn:e=>{B()&&(na()||(e.inputs=[],e.buttonText="",e.text="Password authentication is not enabled"))}});We.addPasswordAuth=new he({id:"addPasswordAuth",title:"Add password authentication",inputs:[{placeholder:"email",type:"email",initVal:""},{placeholder:"confirm email",type:"email",initVal:""},{placeholder:"new password",type:"password",initVal:""},{placeholder:"confirm new password",type:"password",initVal:""}],buttonText:"reauthenticate to add",onlineOnly:!0,execFn:async(e,t,o,a,s)=>{if(t!==o)return{status:0,message:"Emails don't match"};if(a!==s)return{status:0,message:"Passwords don't match"};const n=await yo({password:a});if(n.status!==1)return{status:n.status,message:n.message};try{const c=tb.credential(t,a);await T1(n.user,c)}catch(c){return{status:-1,message:ie(c,"Failed to add password authentication")}}const l=await E.users.updateEmail({body:{newEmail:t,previousEmail:n.user.email}});return l.status!==200?{status:-1,message:"Password authentication added but updating the database email failed. This shouldn't happen, please contact support. Error: "+l.body.message}:(ws(),{status:1,message:"Password authentication added"})}});We.deleteAccount=new he({id:"deleteAccount",title:"Delete account",inputs:[{placeholder:"password",type:"password",initVal:""}],text:"This is the last time you can change your mind. After pressing the button everything is gone.",buttonText:"delete",onlineOnly:!0,execFn:async(e,t)=>{const o=await yo({password:t});if(o.status!==1)return{status:o.status,message:o.message};m("Deleting all data...",0);const a=await E.users.delete();return a.status!==200?{status:-1,message:"Failed to delete user data: "+a.body.message}:(Pa(3),{status:1,message:"Account deleted, goodbye"})},beforeInitFn:e=>{B()&&(na()||(e.inputs=[],e.buttonText="reauthenticate to delete"))}});We.resetAccount=new he({id:"resetAccount",title:"Reset account",inputs:[{placeholder:"password",type:"password",initVal:""}],text:"This is the last time you can change your mind. After pressing the button everything is gone.",buttonText:"reset",onlineOnly:!0,execFn:async(e,t)=>{const o=await yo({password:t});if(o.status!==1)return{status:o.status,message:o.message};m("Resetting settings...",0),await Ip(),await et.deleteFile("LocalBackgroundFile"),m("Resetting account...",0);const a=await E.users.reset();return a.status!==200?{status:-1,message:"Failed to reset account: "+a.body.message}:(Pa(3),{status:1,message:"Account reset"})},beforeInitFn:e=>{B()&&(na()||(e.inputs=[],e.buttonText="reauthenticate to reset"))}});We.optOutOfLeaderboards=new he({id:"optOutOfLeaderboards",title:"Opt out of leaderboards",inputs:[{placeholder:"password",type:"password",initVal:""}],text:"Are you sure you want to opt out of leaderboards?",buttonText:"opt out",onlineOnly:!0,execFn:async(e,t)=>{const o=await yo({password:t});if(o.status!==1)return{status:o.status,message:o.message};const a=await E.users.optOutOfLeaderboards();return a.status!==200?{status:-1,message:"Failed to opt out: "+a.body.message}:(Pa(3),{status:1,message:"Leaderboards opt out successful"})},beforeInitFn:e=>{B()&&(na()||(e.inputs=[],e.buttonText="reauthenticate to opt out"))}});We.applyCustomFont=new he({id:"applyCustomFont",title:"Custom font",inputs:[{type:"text",placeholder:"Font name",initVal:""}],text:"Make sure you have the font installed on your computer before applying",buttonText:"apply",execFn:async(e,t)=>{var o;return(o=I.fontFamily)==null||o.setValue(t.replace(/\s/g,"_")),{status:1,message:"Font applied"}}});We.resetPersonalBests=new he({id:"resetPersonalBests",title:"Reset personal bests",inputs:[{placeholder:"password",type:"password",initVal:""}],buttonText:"reset",onlineOnly:!0,execFn:async(e,t)=>{const o=await yo({password:t});if(o.status!==1)return{status:o.status,message:o.message};const a=await E.users.deletePersonalBests();if(a.status!==200)return{status:-1,message:"Failed to reset personal bests: "+a.body.message};const s=x();return s?(s.personalBests={time:{},words:{},quote:{},zen:{},custom:{}},{status:1,message:"Personal bests reset"}):{status:-1,message:"Failed to reset personal bests: no snapshot"}},beforeInitFn:e=>{B()&&(na()||(e.inputs=[],e.buttonText="reauthenticate to reset"))}});We.resetSettings=new he({id:"resetSettings",title:"Reset settings",text:"Are you sure you want to reset all your settings?",buttonText:"reset",onlineOnly:!0,execFn:async()=>(await Ip(),await et.deleteFile("LocalBackgroundFile"),{status:1,message:"Settings reset"})});We.revokeAllTokens=new he({id:"revokeAllTokens",title:"Revoke all tokens",inputs:[{placeholder:"password",type:"password",initVal:""}],text:"Are you sure you want to do this? This will log you out of all devices.",buttonText:"revoke all",onlineOnly:!0,execFn:async(e,t)=>{const o=await yo({password:t});if(o.status!==1)return{status:o.status,message:o.message};const a=await E.users.revokeAllTokens();return a.status!==200?{status:-1,message:"Failed to revoke tokens: "+a.body.message}:(Pa(3),{status:1,message:"Tokens revoked"})},beforeInitFn:e=>{!B()||!x()||na()||(e.inputs[0].hidden=!0,e.buttonText="reauthenticate to revoke all tokens")}});We.unlinkDiscord=new he({id:"unlinkDiscord",title:"Unlink Discord",text:"Are you sure you want to unlink your Discord account?",buttonText:"unlink",onlineOnly:!0,execFn:async()=>{const e=x();if(!e)return{status:-1,message:"Failed to unlink Discord: no snapshot"};const t=await E.users.unlinkDiscord();return t.status!==200?{status:-1,message:"Failed to unlink Discord: "+t.body.message}:(e.discordAvatar=void 0,e.discordId=void 0,kt(e),ws(),{status:1,message:"Discord unlinked"})}});We.deleteCustomText=new he({id:"deleteCustomText",title:"Delete custom text",text:"Are you sure?",buttonText:"delete",execFn:async e=>(tv(e.parameters[0],!1),us("",void 0),{status:1,message:"Custom text deleted"}),beforeInitFn:e=>{e.text=`Are you sure you want to delete custom text ${e.parameters[0]}?`}});We.deleteCustomTextLong=new he({id:"deleteCustomTextLong",title:"Delete custom text",text:"Are you sure?",buttonText:"delete",execFn:async e=>(tv(e.parameters[0],!0),us("",void 0),{status:1,message:"Custom text deleted"}),beforeInitFn:e=>{e.text=`Are you sure you want to delete custom text ${e.parameters[0]}?`}});We.resetProgressCustomTextLong=new he({id:"resetProgressCustomTextLong",title:"Reset progress for custom text",text:"Are you sure?",buttonText:"reset",execFn:async e=>{ff(e.parameters[0],0);const t=Hc(e.parameters[0],!0);return _a(t),{status:1,message:"Custom text progress reset"}},beforeInitFn:e=>{e.text=`Are you sure you want to reset your progress for custom text ${e.parameters[0]}?`}});We.updateCustomTheme=new he({id:"updateCustomTheme",title:"Update custom theme",inputs:[{type:"text",placeholder:"name",initVal:""},{type:"checkbox",initVal:!1,label:"Update custom theme to current colors",optional:!0}],buttonText:"update",onlineOnly:!0,execFn:async(e,t,o)=>{var d;const a=x();if(!a)return{status:-1,message:"Failed to update custom theme: no snapshot"};const s=(d=a.customThemes)==null?void 0:d.find(u=>u._id===e.parameters[0]);if(s===void 0)return{status:-1,message:"Failed to update custom theme: theme not found"};let n=[];if(o==="true")for(const u of Ba)n.push(i(`.pageSettings .customTheme .customThemeEdit #${u}[type='color']`).attr("value"));else n=s.colors;const l={name:t.replaceAll(" ","_"),colors:n};return await Cx(s._id,l)?(dn(n),su(),{status:1,message:"Custom theme updated"}):{status:-1,message:"Failed to update custom theme"}},beforeInitFn:e=>{var a;const t=x();if(!t)return;const o=(a=t.customThemes)==null?void 0:a.find(s=>s._id===e.parameters[0]);o&&(e.inputs[0].initVal=o.name)}});We.deleteCustomTheme=new he({id:"deleteCustomTheme",title:"Delete custom theme",text:"Are you sure?",buttonText:"delete",onlineOnly:!0,execFn:async e=>(await kx(e.parameters[0]),su(),{status:1,message:"Custom theme deleted"})});We.devGenerateData=new he({id:"devGenerateData",title:"Generate data",showLabels:!0,inputs:[{type:"text",label:"username",placeholder:"username",oninput:e=>{const t=e.target,o=document.querySelector("#devGenerateData_1 + span");o.innerHTML=`if checked, user will be created with ${t.value}@example.com and password: password`},validation:{schema:Cd}},{type:"checkbox",label:"create user",description:"if checked, user will be created with {username}@example.com and password: password",optional:!0},{type:"date",label:"first test",optional:!0},{type:"date",label:"last test",max:new Date,optional:!0},{type:"range",label:"min tests per day",initVal:0,min:0,max:200,step:10},{type:"range",label:"max tests per day",initVal:50,min:0,max:200,step:10}],buttonText:"generate (might take a while)",execFn:async(e,t,o,a,s,n,l)=>{const c={username:t,createUser:o==="true"};a!==void 0&&a.length>0&&(c.firstTestTimestamp=Date.parse(a)),s!==void 0&&s.length>0&&(c.lastTestTimestamp=Date.parse(s)),n!==void 0&&n.length>0&&(c.minTestsPerDay=Number.parseInt(n)),l!==void 0&&l.length>0&&(c.maxTestsPerDay=Number.parseInt(l));const d=await E.dev.generateData({body:c});return{status:d.status===200?1:-1,message:d.body.message,hideOptions:{clearModalChain:!0}}}});We.lbGoToPage=new he({id:"lbGoToPage",title:"Go to page",inputs:[{type:"number",placeholder:"Page number"}],buttonText:"Go",execFn:async(e,t)=>{const o=parseInt(t,10);return isNaN(o)||o<1?{status:0,message:"Invalid page number"}:(dI(o-1),{status:1,message:"Navigating to page "+o,showNotification:!1})}});function Oe(e,t=[],o={}){const a=We[e];if(a===void 0){m("Failed to show popup - popup is not defined",-1);return}a.show(t,o)}i(".pageAccountSettings").on("click","#unlinkDiscordButton",()=>{Oe("unlinkDiscord")});i(".pageAccountSettings").on("click","#removeGoogleAuth",()=>{Oe("removeGoogleAuth")});i(".pageAccountSettings").on("click","#removeGithubAuth",()=>{Oe("removeGithubAuth")});i(".pageAccountSettings").on("click","#removePasswordAuth",()=>{Oe("removePasswordAuth")});i("#resetSettingsButton").on("click",()=>{Oe("resetSettings")});i(".pageAccountSettings").on("click","#revokeAllTokens",()=>{Oe("revokeAllTokens")});i(".pageAccountSettings").on("click","#resetPersonalBestsButton",()=>{Oe("resetPersonalBests")});i(".pageAccountSettings").on("click","#updateAccountName",()=>{Oe("updateName")});i("#bannerCenter").on("click",".banner .text .openNameChange",()=>{Oe("updateName")});i(".pageAccountSettings").on("click","#addPasswordAuth",()=>{Oe("addPasswordAuth")});i(".pageAccountSettings").on("click","#emailPasswordAuth",()=>{Oe("updateEmail")});i(".pageAccountSettings").on("click","#passPasswordAuth",()=>{Oe("updatePassword")});i(".pageAccountSettings").on("click","#deleteAccount",()=>{Oe("deleteAccount")});i(".pageAccountSettings").on("click","#resetAccount",()=>{Oe("resetAccount")});i(".pageAccountSettings").on("click","#optOutOfLeaderboardsButton",()=>{Oe("optOutOfLeaderboards")});i(".pageSettings").on("click",".section.themes .customTheme .delButton",e=>{const o=i(e.currentTarget).parent(".customTheme.button").attr("customThemeId");Oe("deleteCustomTheme",[o])});i(".pageSettings").on("click",".section.themes .customTheme .editButton",e=>{const o=i(e.currentTarget).parent(".customTheme.button").attr("customThemeId");Oe("updateCustomTheme",[o],{focusFirstInput:"focusAndSelect"})});i(".pageSettings").on("click",".section[data-config-name='fontFamily'] button[data-config-value='custom']",()=>{Oe("applyCustomFont")});async function hC(){const e=pf(),t=i("#savedTextsModal .list").empty();let o="";if(e.length===0)o+="<div>No saved custom texts found</div>";else for(const l of e)o+=`<div class="savedText" data-name="${ft(l)}">
      <div class="button name">${ft(l)}</div>
      <div class="button delete">
      <i class="fas fa-fw fa-trash"></i>
      </div>
      </div>`;t.html(o);const a=pf(!0),s=i("#savedTextsModal .listLong").empty();let n="";if(a.length===0)n+="<div>No saved long custom texts found</div>";else for(const l of a)n+=`<div class="savedLongText" data-name="${ft(l)}">
      <div class="button name">${ft(l)}</div>
      <div class="button ${Dp(l)<=0?"disabled":""} resetProgress">reset</div>
      <div class="button delete">
      <i class="fas fa-fw fa-trash"></i>
      </div>
      </div>`;s.html(n),i("#savedTextsModal .list .savedText .button.delete").on("click",l=>{const c=i(l.target).closest(".savedText").data("name");if(c===void 0){m("Failed to show delete modal: no name found",-1);return}Oe("deleteCustomText",[c],{modalChain:vr})}),i("#savedTextsModal .listLong .savedLongText .button.delete").on("click",l=>{const c=i(l.target).closest(".savedLongText").data("name");if(c===void 0){m("Failed to show delete modal: no name found",-1);return}Oe("deleteCustomTextLong",[c],{modalChain:vr})}),i("#savedTextsModal .listLong .savedLongText .button.resetProgress").on("click",l=>{const c=i(l.target).closest(".savedLongText").data("name");if(c===void 0){m("Failed to show delete modal: no name found",-1);return}Oe("resetProgressCustomTextLong",[c],{modalChain:vr})}),i("#savedTextsModal .list .savedText .button.name").on("click",l=>{const c=i(l.target).text();us(c,!1);const d=Nh(c,!1);Oh({modalChainData:{text:d,long:!1}})}),i("#savedTextsModal .listLong .savedLongText .button.name").on("click",l=>{const c=i(l.target).text();us(c,!0);const d=Nh(c,!0);Oh({modalChainData:{text:d,long:!0}})})}async function DB(e){vr.show({...e,beforeAnimation:async()=>{hC()}})}function Oh(e){vr.hide({...e})}function Nh(e,t){let o=Hc(e,t);return t&&(o=o.slice(Dp(e))),o.join(" ")}async function WB(){}const vr=new re({dialogId:"savedTextsModal",setup:WB,showOptionsWhenInChain:{beforeAnimation:async()=>{hC()}}}),dd={textToSave:[]},Uh=ia(i("#saveCustomTextModal .textName")[0],{debounceDelay:500,schema:D.string().min(1).max(32).regex(/^[\w\s-]+$/,{message:"Name can only contain letters, numbers, spaces, underscores and hyphens"}),isValid:async e=>{const t=i("#saveCustomTextModal .isLongText").prop("checked");return pf(t).includes(e)?"Duplicate name":!0},callback:e=>{e.status==="success"?i("#saveCustomTextModal button.save").prop("disabled",!1):i("#saveCustomTextModal button.save").prop("disabled",!0)}});async function PB(e){dd.textToSave=[],yC.show({...e,beforeAnimation:async(t,o)=>{dd.textToSave=(o==null?void 0:o.text)??[],i("#saveCustomTextModal .textName").val(""),i("#saveCustomTextModal .isLongText").prop("checked",!1),i("#saveCustomTextModal button.save").prop("disabled",!0)}})}function zB(){const e=i("#saveCustomTextModal .textName").val(),t=i("#saveCustomTextModal .isLongText").prop("checked");return e?dd.textToSave.length===0?(m("Custom text can't be empty",0),!1):FL(e,dd.textToSave,t)?(us(e,t),m("Custom text saved",1),!0):(m("Error saving custom text",-1),!1):(m("Custom text needs a name",0),!1)}async function HB(e){var t;e.addEventListener("submit",o=>{o.preventDefault(),Uh.isValid()===!0&&zB()&&yC.hide()}),(t=e.querySelector(".isLongText"))==null||t.addEventListener("input",o=>{Uh.triggerValidation()})}const yC=new re({dialogId:"saveCustomTextModal",setup:HB}),Q="#customTextModal .modal",T={textarea:pl().join(ml()?"|":" "),longCustomTextWarning:!1,challengeWarning:!1,customTextMode:"simple",customTextLimits:{word:"",time:"",section:""},removeFancyTypographyEnabled:!0,replaceControlCharactersEnabled:!0,customTextPipeDelimiter:!1,replaceNewlines:"off",removeZeroWidthCharactersEnabled:!0};function Vt(){i(`${Q} .inputs .group[data-id="mode"] button`).removeClass("active"),i(`${Q} .inputs .group[data-id="mode"] button[value="${T.customTextMode}"]`).addClass("active"),i(`${Q} .inputs .group[data-id="limit"] input.words`).addClass("hidden"),i(`${Q} .inputs .group[data-id="limit"] input.sections`).addClass("hidden"),i(`${Q} .inputs .group[data-id="limit"] input.words`).val(T.customTextLimits.word),i(`${Q} .inputs .group[data-id="limit"] input.time`).val(T.customTextLimits.time),i(`${Q} .inputs .group[data-id="limit"] input.sections`).val(T.customTextLimits.section),T.customTextLimits.word!==""&&i(`${Q} .inputs .group[data-id="limit"] input.words`).removeClass("hidden"),T.customTextLimits.section!==""&&i(`${Q} .inputs .group[data-id="limit"] input.sections`).removeClass("hidden"),T.customTextPipeDelimiter?(i(`${Q} .inputs .group[data-id="limit"] input.sections`).removeClass("hidden"),i(`${Q} .inputs .group[data-id="limit"] input.words`).addClass("hidden")):(i(`${Q} .inputs .group[data-id="limit"] input.words`).removeClass("hidden"),i(`${Q} .inputs .group[data-id="limit"] input.sections`).addClass("hidden")),T.customTextMode==="simple"?(i(`${Q} .inputs .group[data-id="limit"]`).addClass("disabled"),i(`${Q} .inputs .group[data-id="limit"] input`).val(""),i(`${Q} .inputs .group[data-id="limit"] input`).prop("disabled",!0)):(i(`${Q} .inputs .group[data-id="limit"]`).removeClass("disabled"),i(`${Q} .inputs .group[data-id="limit"] input`).prop("disabled",!1)),i(`${Q} .inputs .group[data-id="fancy"] button`).removeClass("active"),i(`${Q} .inputs .group[data-id="fancy"] button[value="${T.removeFancyTypographyEnabled}"]`).addClass("active"),i(`${Q} .inputs .group[data-id="control"] button`).removeClass("active"),i(`${Q} .inputs .group[data-id="control"] button[value="${T.replaceControlCharactersEnabled}"]`).addClass("active"),i(`${Q} .inputs .group[data-id="zeroWidth"] button`).removeClass("active"),i(`${Q} .inputs .group[data-id="zeroWidth"] button[value="${T.removeZeroWidthCharactersEnabled}"]`).addClass("active"),i(`${Q} .inputs .group[data-id="delimiter"] button`).removeClass("active"),i(`${Q} .inputs .group[data-id="delimiter"] button[value="${T.customTextPipeDelimiter}"]`).addClass("active"),i(`${Q} .inputs .group[data-id="newlines"] button`).removeClass("active"),i(`${Q} .inputs .group[data-id="newlines"] button[value="${T.replaceNewlines}"]`).addClass("active"),i(`${Q} textarea`).val(T.textarea),T.longCustomTextWarning?(i(`${Q} .longCustomTextWarning`).removeClass("hidden"),i(`${Q} .randomWordsCheckbox input`).prop("checked",!1),i(`${Q} .delimiterCheck input`).prop("checked",!1),i(`${Q} .typographyCheck`).prop("checked",!0),i(`${Q} .replaceNewlineWithSpace input`).prop("checked",!1),i(`${Q} .inputs`).addClass("disabled")):(i(`${Q} .longCustomTextWarning`).addClass("hidden"),i(`${Q} .inputs`).removeClass("disabled")),T.challengeWarning?(i(`${Q} .challengeWarning`).removeClass("hidden"),i(`${Q} .randomWordsCheckbox input`).prop("checked",!1),i(`${Q} .delimiterCheck input`).prop("checked",!1),i(`${Q} .typographyCheck`).prop("checked",!0),i(`${Q} .replaceNewlineWithSpace input`).prop("checked",!1),i(`${Q} .inputs`).addClass("disabled")):(i(`${Q} .challengeWarning`).addClass("hidden"),i(`${Q} .inputs`).removeClass("disabled"))}async function bC(e,t){if(T.customTextMode=lc(),T.customTextMode==="repeat"&&Te()==="word"&&xe()===pl().length&&(T.customTextMode="simple"),T.customTextLimits.word="",T.customTextLimits.time="",T.customTextLimits.section="",Te()==="word"?T.customTextLimits.word=`${xe()}`:Te()==="time"?T.customTextLimits.time=`${xe()}`:Te()==="section"&&(T.customTextLimits.section=`${xe()}`),T.customTextPipeDelimiter=ml(),T.longCustomTextWarning=ta()??!1,(t==null?void 0:t.text)!==void 0){t.long!==!0&&ta()&&(us("",void 0),m("Disabled long custom text progress tracking",0,{duration:5}),T.longCustomTextWarning=!1);const o=t.set??!0?t.text:T.textarea+" "+t.text;T.textarea=o,T.customTextMode="simple",T.customTextLimits.word=`${ud().length}`,T.customTextLimits.time="",T.customTextLimits.section=""}Vt()}async function vC(){!T.challengeWarning&&!T.longCustomTextWarning&&i(`${Q} textarea`).trigger("focus")}function Um(e){T.textarea=pl().join(ml()?"|":" ").replace(/^ +/gm,""),wr.show({...e,beforeAnimation:bC,afterAnimation:vC})}function ip(){wr.hide()}function OB(){var t;const e=(t=i("#fileInput")[0].files)==null?void 0:t[0];if(e){if(e.type!=="text/plain"){m("File is not a text file",-1,{duration:5});return}const o=new FileReader;o.readAsText(e,"UTF-8"),o.onload=a=>{var n;const s=(n=a.target)==null?void 0:n.result;T.textarea=s,Vt(),i("#fileInput").val("")},o.onerror=()=>{m("Failed to read file",-1,{duration:5})}}}function ud(){let e=T.textarea;return e===""?[]:(e=e.normalize().trim(),e=e.replace(/[\u2000-\u200A\u202F\u205F\u00A0]/g," "),T.removeZeroWidthCharactersEnabled&&(e=e.replace(/[\u200B-\u200D\u2060\uFEFF]/g,"")),T.replaceControlCharactersEnabled&&(e=eT(e)),e=e.replace(/ +/gm," "),e=e.replace(/( *(\r\n|\r|\n) *)/g,`
 `),T.removeFancyTypographyEnabled&&(e=Eb(e)),T.replaceNewlines!=="off"&&(T.replaceNewlines==="periodSpace"?(e=e.replace(/\n/gm,". "),e=e.replace(/\.\. /gm,". "),e=e.replace(/ +/gm," ")):(e=e.replace(/\n/gm," "),e=e.replace(/ +/gm," "))),e.split(T.customTextPipeDelimiter?"|":" ").filter(o=>o!==""))}function NB(){if(T.textarea===""){m("Text cannot be empty",0);return}if([T.customTextLimits.word,T.customTextLimits.time,T.customTextLimits.section].filter(t=>t!=="").length>1){m("You can only specify one limit",0,{duration:5});return}if(T.customTextMode!=="simple"&&T.customTextLimits.word===""&&T.customTextLimits.time===""&&T.customTextLimits.section===""){m("You need to specify a limit",0,{duration:5});return}(T.customTextLimits.section==="0"||T.customTextLimits.word==="0"||T.customTextLimits.time==="0")&&m("Infinite test! Make sure to use Bail Out from the command line to save your result.",0,{duration:7});const e=ud();if(e.length===0){m("Text cannot be empty",0);return}T.customTextMode==="simple"?(pn("repeat"),T.customTextLimits.word=`${e.length}`,T.customTextLimits.time="",T.customTextLimits.section=""):pn(T.customTextMode),ei(T.customTextPipeDelimiter),_a(e),T.customTextMode==="simple"&&T.customTextPipeDelimiter?($o("section"),Ko(e.length)):T.customTextLimits.word!==""?($o("word"),Ko(parseInt(T.customTextLimits.word))):T.customTextLimits.time!==""?($o("time"),Ko(parseInt(T.customTextLimits.time))):T.customTextLimits.section!==""&&($o("section"),Ko(parseInt(T.customTextLimits.section))),Cw(),ee(),r.mode!=="custom"&&ut("custom"),rm(),z(),ip()}function UB(){let e=T.textarea.split(T.customTextPipeDelimiter?" ":"|").join(T.customTextPipeDelimiter?"|":" ");e=e.replace(/\n /g,`
`),T.textarea=e}async function VB(e){var a,s,n,l,c,d,u,f,p,h;(a=e.querySelector("#fileInput"))==null||a.addEventListener("change",OB);const t=e.querySelectorAll(".group[data-id='mode'] button");for(const g of t)g.addEventListener("click",y=>{if(T.customTextMode=y.target.value,T.customTextMode==="simple"){const b=ud();T.customTextLimits.word=`${b.length}`,T.customTextLimits.time="",T.customTextLimits.section=""}Vt()});for(const g of e.querySelectorAll(".group[data-id='fancy'] button"))g.addEventListener("click",y=>{T.removeFancyTypographyEnabled=y.target.value==="true",Vt()});for(const g of e.querySelectorAll(".group[data-id='control'] button"))g.addEventListener("click",y=>{T.replaceControlCharactersEnabled=y.target.value==="true",Vt()});for(const g of e.querySelectorAll(".group[data-id='zeroWidth'] button"))g.addEventListener("click",y=>{T.removeZeroWidthCharactersEnabled=y.target.value==="true",Vt()});for(const g of e.querySelectorAll(".group[data-id='delimiter'] button"))g.addEventListener("click",y=>{T.customTextPipeDelimiter=y.target.value==="true",T.customTextPipeDelimiter&&T.customTextLimits.word!==""&&(T.customTextLimits.word=""),!T.customTextPipeDelimiter&&T.customTextLimits.section!==""&&(T.customTextLimits.section=""),UB(),Vt()});for(const g of e.querySelectorAll(".group[data-id='newlines'] button"))g.addEventListener("click",y=>{T.replaceNewlines=y.target.value,Vt()});(s=e.querySelector(".group[data-id='limit'] input.words"))==null||s.addEventListener("input",g=>{T.customTextLimits.word=g.target.value,T.customTextLimits.time="",T.customTextLimits.section="",Vt()}),(n=e.querySelector(".group[data-id='limit'] input.time"))==null||n.addEventListener("input",g=>{T.customTextLimits.time=g.target.value,T.customTextLimits.word="",T.customTextLimits.section="",Vt()}),(l=e.querySelector(".group[data-id='limit'] input.sections"))==null||l.addEventListener("input",g=>{T.customTextLimits.section=g.target.value,T.customTextLimits.word="",T.customTextLimits.time="",Vt()});const o=e.querySelector("textarea");o==null||o.addEventListener("input",g=>{T.textarea=g.target.value}),o==null||o.addEventListener("keydown",g=>{if(g.key!=="Tab")return;g.preventDefault();const y=g.target,b=y.selectionStart,C=y.selectionEnd;y.value=y.value.substring(0,b)+"	"+y.value.substring(C),y.selectionStart=y.selectionEnd=b+1,T.textarea=y.value}),o==null||o.addEventListener("keypress",g=>{if(T.longCustomTextWarning||T.challengeWarning){g.preventDefault();return}g.code==="Enter"&&g.ctrlKey&&i(`${Q} .button.apply`).trigger("click"),ta()&&Zp()!==""&&(us("",void 0),T.longCustomTextWarning=!1,m("Disabled long custom text progress tracking",0,{duration:5}))}),(c=e.querySelector(".button.apply"))==null||c.addEventListener("click",()=>{NB()}),(d=e.querySelector(".button.wordfilter"))==null||d.addEventListener("click",()=>{CB({modalChain:wr})}),(u=e.querySelector(".button.showSavedTexts"))==null||u.addEventListener("click",()=>{DB({modalChain:wr})}),(f=e.querySelector(".button.saveCustomText"))==null||f.addEventListener("click",()=>{PB({modalChain:wr,modalChainData:{text:ud()}})}),(p=e.querySelector(".longCustomTextWarning"))==null||p.addEventListener("click",()=>{T.longCustomTextWarning=!1,Vt()}),(h=e.querySelector(".challengeWarning"))==null||h.addEventListener("click",()=>{T.challengeWarning=!1,Vt()})}const wr=new re({dialogId:"customTextModal",setup:VB,customEscapeHandler:async()=>{ip()},customWrapperClickHandler:async()=>{ip()},showOptionsWhenInChain:{beforeAnimation:bC,afterAnimation:vC}}),el="videoAdPopupWrapper";async function wC(){if(Yt(el,"popups"),await wm(),ou){m("Looks like you're using an adblocker. Video ads will not work until you disable it.",0,{duration:6});return}if(await Cm(),Gr){m("Looks like you're using a cookie popup blocker. Video ads will not work without giving your consent through the popup.",0,{duration:7});return}Io(el)||i("#videoAdPopupWrapper").stop(!0,!0).css("opacity",0).removeClass("hidden").animate({opacity:1},125,()=>{window.dataLayer.push({event:"EG_Video"})})}function Vh(){Io(el)&&i("#videoAdPopupWrapper").stop(!0,!0).css("opacity",1).animate({opacity:0},125,()=>{i("#videoAdPopupWrapper").addClass("hidden"),Et(el)})}function KB(e){const t=e.event;t==="started"||(t==="finished"?Vh():t==="empty"&&(m("Failed to load video ad. Please try again later",-1,{duration:3}),Vh()))}i(".pageTest #watchVideoAdButton").on("click",()=>{wC()});Xt(el);function CC(e){return i(`#shareTestSettingsModal label.${e} input`).prop("checked")}function kC(){const e=location.origin+"?testSettings=",t=new Array(8).fill(null),o=[{key:"mode",getValue:()=>r.mode},{key:"mode2",getValue:()=>gi(r,X)},{key:"customText",getValue:()=>Ia()},{key:"punctuation",getValue:()=>r.punctuation},{key:"numbers",getValue:()=>r.numbers},{key:"language",getValue:()=>r.language},{key:"difficulty",getValue:()=>r.difficulty},{key:"funbox",getValue:()=>r.funbox}];for(const[n,{key:l,getValue:c}]of o.entries())CC(l)&&(t[n]=c());const a=Jy.compressToURI(JSON.stringify(t)),s=e+a;GB(s)}function GB(e){const t=i("#shareTestSettingsModal");t.find("textarea.url").val(e),t.find(".tooLongWarning").toggleClass("hidden",e.length<=2e3)}function SC(){CC("mode")?i("#shareTestSettingsModal .subgroup").removeClass("hidden"):i("#shareTestSettingsModal .subgroup").addClass("hidden")}function Vm(e){QB.show({...e,beforeAnimation:async()=>{kC(),SC()}})}async function jB(e){var o;(o=e.querySelector("textarea.url"))==null||o.addEventListener("click",async a=>{a.target.select()});const t=e.querySelectorAll("label input");for(const a of t)a.addEventListener("change",async()=>{kC(),SC()})}const QB=new re({dialogId:"shareTestSettingsModal",setup:jB});let Kh=!1;async function YB(){if(!Kh){for(const e of Kp)e!=="swiss_german"&&i("#quoteSubmitModal .newQuoteLanguage").append(`<option value="${e}">${e.replace(/_/g," ")}</option>`);Kh=!0}}let tr;async function XB(){const e=i("#quoteSubmitModal .newQuoteText").val(),t=i("#quoteSubmitModal .newQuoteSource").val(),o=i("#quoteSubmitModal .newQuoteLanguage").val(),a=$l("submitQuote");if(!e||!t||!o){m("Please fill in all fields",0);return}J();const s=await E.quotes.add({body:{text:e,source:t,language:o,captcha:a}});if(K(),s.status!==200){m("Failed to submit quote: "+s.body.message,-1);return}m("Quote submitted.",1),i("#quoteSubmitModal .newQuoteText").val(""),i("#quoteSubmitModal .newQuoteSource").val(""),Ra("submitQuote")}async function ZB(e){if(!di()){m("Could not show quote submit popup: Captcha is not available. This could happen due to a blocked or failed network request. Please refresh the page or contact support if this issue persists.",-1);return}xC.show({...e,mode:"dialog",focusFirstInput:!0,afterAnimation:async()=>{Bn(document.querySelector("#quoteSubmitModal .g-recaptcha"),"submitQuote"),await YB(),tr=new st({select:"#quoteSubmitModal .newQuoteLanguage"}),i("#quoteSubmitModal .newQuoteLanguage").val(No(r.language)),i("#quoteSubmitModal .newQuoteLanguage").trigger("change"),i("#quoteSubmitModal input").val(""),new Zr(i("#quoteSubmitModal .newQuoteText"),250)}})}function JB(e){xC.hide({clearModalChain:e})}async function eq(e){var t;(t=e.querySelector("button"))==null||t.addEventListener("click",()=>{XB(),JB(!0)})}async function tq(){Ra("submitQuote"),tr==null||tr.destroy(),tr=void 0}const xC=new re({dialogId:"quoteSubmitModal",setup:eq,cleanup:tq});let ms=[];function uu(){i("#quoteApproveModal .quotes").empty(),ms.forEach((e,t)=>{const o=i(`
      <div class="quote" data-id="${t}" data-db-id="${e._id}">
        <textarea class="text">${e.text}</textarea>
        <input type="text" class="source" placeholder="Source" value="${e.source}">
        <div class="buttons">
          <button disabled class="textButton undo" aria-label="Undo changes" data-balloon-pos="left"><i class="fas fa-fw fa-undo-alt"></i></button>
          <button class="textButton refuse" aria-label="Refuse quote" data-balloon-pos="left"><i class="fas fa-fw fa-times"></i></button>
          <button class="textButton approve" aria-label="Approve quote" data-balloon-pos="left"><i class="fas fa-fw fa-check"></i></button>
          <button class="textButton edit hidden" aria-label="Edit and approve quote" data-balloon-pos="left"><i class="fas fa-fw fa-pen"></i></button>
        </div>
        <div class="bottom">
          <div class="length ${e.text.length<60?"red":""}"><i class="fas fa-fw fa-ruler"></i>${e.text.length}</div>
          <div class="language"><i class="fas fa-fw fa-globe-americas"></i>${e.language}</div>
          <div class="timestamp"><i class="fas fa-fw fa-calendar"></i>${te(new Date(e.timestamp),"dd MMM yyyy HH:mm")}</div>
        </div>
      </div>
    `);i("#quoteApproveModal .quotes").append(o),o.find(".source").on("input",()=>{i(`#quoteApproveModal .quote[data-id=${t}] .undo`).prop("disabled",!1),i(`#quoteApproveModal .quote[data-id=${t}] .approve`).addClass("hidden"),i(`#quoteApproveModal .quote[data-id=${t}] .edit`).removeClass("hidden")}),o.find(".text").on("input",()=>{i(`#quoteApproveModal .quote[data-id=${t}] .undo`).prop("disabled",!1),i(`#quoteApproveModal .quote[data-id=${t}] .approve`).addClass("hidden"),i(`#quoteApproveModal .quote[data-id=${t}] .edit`).removeClass("hidden"),TC(t)}),o.find(".undo").on("click",()=>{aq(t)}),o.find(".approve").on("click",()=>{sq(t,e._id)}),o.find(".refuse").on("click",()=>{iq(t,e._id)}),o.find(".edit").on("click",()=>{nq(t,e._id)})})}function TC(e){var o;const t=(o=i(`#quoteApproveModal .quote[data-id=${e}] .text`).val())==null?void 0:o.length;i(`#quoteApproveModal .quote[data-id=${e}] .length`).html(`<i class="fas fa-fw fa-ruler"></i>${t}`),t<60?i(`#quoteApproveModal .quote[data-id=${e}] .length`).addClass("red"):i(`#quoteApproveModal .quote[data-id=${e}] .length`).removeClass("red")}async function LC(){J();const e=await E.quotes.get();if(K(),e.status!==200){m("Failed to get new quotes: "+e.body.message,-1);return}ms=e.body.data??[],uu()}async function oq(e){lq.show({...e,beforeAnimation:async()=>{ms=[],LC()}})}function Km(e){const t=i(`#quoteApproveModal .quotes .quote[data-id=${e}]`);t.find("button").prop("disabled",!1),t.find(".edit").hasClass("hidden")&&t.find(".undo").prop("disabled",!0)}function aq(e){var t,o;i(`#quoteApproveModal .quote[data-id=${e}] .text`).val(((t=ms[e])==null?void 0:t.text)??""),i(`#quoteApproveModal .quote[data-id=${e}] .source`).val(((o=ms[e])==null?void 0:o.source)??""),i(`#quoteApproveModal .quote[data-id=${e}] .undo`).prop("disabled",!0),i(`#quoteApproveModal .quote[data-id=${e}] .approve`).removeClass("hidden"),i(`#quoteApproveModal .quote[data-id=${e}] .edit`).addClass("hidden"),TC(e)}async function sq(e,t){if(!confirm("Are you sure?"))return;const o=i(`#quoteApproveModal .quotes .quote[data-id=${e}]`);o.find("button").prop("disabled",!0),o.find("textarea, input").prop("disabled",!0),J();const a=await E.quotes.approveSubmission({body:{quoteId:t}});if(K(),a.status!==200){Km(e),o.find("textarea, input").prop("disabled",!1),m("Failed to approve quote: "+a.body.message,-1);return}m(`Quote approved. ${a.body.message??""}`,1),ms.splice(e,1),uu()}async function iq(e,t){if(!confirm("Are you sure?"))return;const o=i(`#quoteApproveModal .quotes .quote[data-id=${e}]`);o.find("button").prop("disabled",!0),o.find("textarea, input").prop("disabled",!0),J();const a=await E.quotes.rejectSubmission({body:{quoteId:t}});if(K(),a.status!==200){Km(e),o.find("textarea, input").prop("disabled",!1),m("Failed to refuse quote: "+a.body.message,-1);return}m("Quote refused.",1),ms.splice(e,1),uu()}async function nq(e,t){if(!confirm("Are you sure?"))return;const o=i(`#quoteApproveModal .quote[data-id=${e}] .text`).val(),a=i(`#quoteApproveModal .quote[data-id=${e}] .source`).val(),s=i(`#quoteApproveModal .quotes .quote[data-id=${e}]`);s.find("button").prop("disabled",!0),s.find("textarea, input").prop("disabled",!0),J();const n=await E.quotes.approveSubmission({body:{quoteId:t,editText:o,editSource:a}});if(K(),n.status!==200){Km(e),s.find("textarea, input").prop("disabled",!1),m("Failed to approve quote: "+n.body.message,-1);return}m(`Quote edited and approved. ${n.body.message??""}`,1),ms.splice(e,1),uu()}async function rq(e){var t;(t=e.querySelector("button.refreshList"))==null||t.addEventListener("click",()=>{i("#quoteApproveModal .quotes").empty(),LC()})}const lq=new re({dialogId:"quoteApproveModal",setup:rq}),sn={quoteToReport:void 0,reasonSelect:void 0};async function $C(e,t){if(!di()){m("Could not show quote report popup: Captcha is not available. This could happen due to a blocked or failed network request. Please refresh the page or contact support if this issue persists.",-1);return}MC.show({mode:"dialog",...t,beforeAnimation:async()=>{var s;Bn(document.querySelector("#quoteReportModal .g-recaptcha"),"quoteReportModal");const o=r.language==="swiss_german"?"german":r.language,{quotes:a}=await mt.getQuotes(o);sn.quoteToReport=a.find(n=>n.id===e),i("#quoteReportModal .quote").text((s=sn.quoteToReport)==null?void 0:s.text),i("#quoteReportModal .reason").val("Grammatical error"),i("#quoteReportModal .comment").val(""),sn.reasonSelect=new st({select:"#quoteReportModal .reason",settings:{showSearch:!1}}),new Zr(i("#quoteReportModal .comment"),250)}})}async function cq(e=!1){MC.hide({clearModalChain:e})}async function dq(){var d;const e=$l("quoteReportModal");if(!e){m("Please complete the captcha");return}const t=(d=sn.quoteToReport)==null?void 0:d.id.toString(),o=No(r.language),a=i("#quoteReportModal .reason").val(),s=i("#quoteReportModal .comment").val(),n=e;if(t===void 0||t===""){m("Please select a quote");return}if(!a){m("Please select a valid report reason");return}if(!s){m("Please provide a comment");return}const l=s.length-250;if(l>0){m(`Report comment is ${l} character(s) too long`);return}J();const c=await E.quotes.report({body:{quoteId:t,quoteLanguage:o,reason:a,comment:s,captcha:n}});if(K(),c.status!==200){m("Failed to report quote: "+c.body.message,-1);return}m("Report submitted. Thank you!",1),cq(!0)}async function uq(e){var t;(t=e.querySelector("button"))==null||t.addEventListener("click",async()=>{await dq()})}async function fq(){var e;Ra("quoteReportModal"),(e=sn.reasonSelect)==null||e.destroy(),sn.reasonSelect=void 0}const MC=new re({dialogId:"quoteReportModal",setup:uq,cleanup:fq}),pq={fuzzyMatchSensitivity:.2,scoreForSimilarMatch:.5,scoreForExactMatch:1};function mq(e,t){return t===0?0:Math.log10(e/t)}const Gh=.4;function gq(e,t){return Gh+(1-Gh)*(t.termFrequencies[e]/t.maxTermFrequency)}function jh(e){return e.match(/[^\\\][.,"/#!?$%^&*;:{}=\-_`~()\s]+/g)??[]}const hq=(e,t,o=pq)=>{const a={},s={};e.forEach((c,d)=>{const u=jh(t(c)),f={id:d,termFrequencies:{},maxTermFrequency:0};let p=0;u.forEach(h=>{var y,b;const g=vg(h);Object.hasOwn(s,g)||(s[g]=new Set),(y=s[g])==null||y.add(h),Object.hasOwn(a,g)||(a[g]=new Set),(b=a[g])==null||b.add(f),g in f.termFrequencies||(f.termFrequencies[g]=0),f.termFrequencies[g]++,p=Math.max(p,f.termFrequencies[g])}),f.maxTermFrequency=p});const n=Object.keys(a);return{query:c=>{const d={results:[],matchedQueryTerms:[]},u=new Set(jh(c).map(g=>vg(g)));if(u.size===0)return d;const f=new Map,p=new Set;u.forEach(g=>{n.forEach(y=>{var S;const{similarity:b}=s1(g,y),C=y===g,L=b>=1-o.fuzzyMatchSensitivity;if(C||L){const q=a[y],P=mq(e.length,q.size);q.forEach($=>{const H=f.get($.id)??0,R=gq(y,$),Pe=C?o.scoreForExactMatch:0,j=L?o.scoreForSimilarMatch:0,fe=(Pe+j)*P*R;f.set($.id,H+fe)}),(S=s[y])==null||S.forEach($=>{p.add($)})}})});const h=[...f].sort((g,y)=>y[1]-g[1]).map(g=>e[g[0]]);return d.results=h,d.matchedQueryTerms=[...p],d}}},Hu={},Ou=100;let ts=1;function yq(e,t,o){if(e in Hu)return Hu[e];const a=hq(t,o);return Hu[e]=a,a}function bq(e){if(!Fo.isOpen())return[];const t=i("#quoteSearchModal .quoteLengthFilter").val();if(t.length===0)return e;const o=new Set(t.map(s=>parseInt(s,10)));return e.filter(s=>o.has(s.group))}function vq(e){if(!Fo.isOpen())return[];const t=document.querySelector(".toggleFavorites").classList.contains("active");return e.filter(a=>t?mt.isQuoteFavorite(a):!0)}function wq(e,t){let o;e.length<101?o="short":e.length<301?o="medium":e.length<601?o="long":o="thicc";const a=!B(),s=!a&&mt.isQuoteFavorite(e);return`
  <div class="searchResult" data-quote-id="${e.id}">

    <div class="text">
      ${wu(e.text,t)}
    </div>

    <div class="id">
      <div class="sub">id</div>
      <span class="quote-id">
        ${wu(e.id.toString(),t)}
      </span>
    </div>

    <div class="length">
      <div class="sub">length</div>
      ${o}
    </div>

    <div class="source">
      <div class="sub">source</div>
      ${wu(e.source,t)}
    </div>

    <div class="textButton report ${a&&"hidden"}" aria-label="Report quote" data-balloon-pos="left">
      <i class="fas fa-flag report"></i>
    </div>

    <div class="textButton favorite ${a&&"hidden"}" aria-label="Favorite quote" data-balloon-pos="left">
      <i class="${s?"fas":"far"} fa-heart favorite"></i>
    </div>

  </div>
  `}async function fd(e){var p,h;if(!Fo.isOpen())return;const{quotes:t}=await mt.getQuotes(r.language),o=yq(r.language,t,g=>`${g.text} ${g.id} ${g.source}`),{results:a,matchedQueryTerms:s}=o.query(e),n=bq(vq(e===""?t:a)),l=i("#quoteSearchResults");l.empty();const c=Math.ceil(n.length/Ou);if(ts>=c?i("#quoteSearchPageNavigator .nextPage").prop("disabled",!0):i("#quoteSearchPageNavigator .nextPage").prop("disabled",!1),ts<=1?i("#quoteSearchPageNavigator .prevPage").prop("disabled",!0):i("#quoteSearchPageNavigator .prevPage").prop("disabled",!1),n.length===0){i("#quoteSearchModal  .pageInfo").html("No search results");return}const d=(ts-1)*Ou,u=Math.min(ts*Ou,n.length);i("#quoteSearchModal  .pageInfo").html(`${d+1} - ${u} of ${n.length}`),n.slice(d,u).forEach(g=>{const y=wq(g,s);l.append(y)});const f=Fo.getModal().querySelectorAll(".searchResult");for(const g of f){const y=parseInt(g.dataset.quoteId);(p=g.querySelector(".textButton.favorite"))==null||p.addEventListener("click",b=>{if(b.stopPropagation(),y===void 0||isNaN(y)){m("Could not toggle quote favorite: quote id is not a number",-1);return}Sq(`${y}`)}),(h=g.querySelector(".textButton.report"))==null||h.addEventListener("click",b=>{if(b.stopPropagation(),y===void 0||isNaN(y)){m("Could not open quote report modal: quote id is not a number",-1);return}$C(y,{modalChain:Fo})}),g.addEventListener("click",b=>{Tp(y),kq(y)})}}let or;async function Gm(e){Fo.show({...e,focusFirstInput:!0,beforeAnimation:async()=>{var a;B()?(i("#quoteSearchModal .goToQuoteSubmit").removeClass("hidden"),i("#quoteSearchModal .toggleFavorites").removeClass("hidden")):(i("#quoteSearchModal .goToQuoteSubmit").addClass("hidden"),i("#quoteSearchModal .toggleFavorites").addClass("hidden"));const t=(a=x())==null?void 0:a.quoteMod;t!==void 0&&(t===!0||t!=="")?i("#quoteSearchModal .goToQuoteApprove").removeClass("hidden"):i("#quoteSearchModal .goToQuoteApprove").addClass("hidden"),or=new st({select:"#quoteSearchModal .quoteLengthFilter",settings:{showSearch:!1,placeholderText:"filter by length",contentLocation:Fo.getModal()},data:[{text:"short",value:"0"},{text:"medium",value:"1"},{text:"long",value:"2"},{text:"thicc",value:"3"}]})},afterAnimation:async()=>{const t=i("#quoteSearchModal input").val();ts=1,fd(t)}})}function Cq(e=!1){Fo.hide({clearModalChain:e})}function kq(e){if(isNaN(e)&&(e=parseInt(document.getElementById("searchBox").value)),e!==null&&!isNaN(e)&&e>=0)Id([-2],!1),Tp(e),ee();else{m("Quote ID must be at least 1",0);return}z(),Cq(!0)}const Nu=It(250,()=>{if(!Fo.isOpen())return;const e=document.getElementById("searchBox").value;ts=1,fd(e)});async function Sq(e){const t=r.language;if(t===void 0||e===""){m("Could not get quote stats!",-1);return}const o={language:t,id:parseInt(e,10)},a=mt.isQuoteFavorite(o),s=i(`#quoteSearchModal .searchResult[data-quote-id=${e}] .textButton.favorite i`);if(x())if(a)try{J(),await mt.setQuoteFavorite(o,!1),K(),s.removeClass("fas").addClass("far")}catch(l){K();const c=ie(l,"Failed to remove quote from favorites");m(c,-1)}else try{J(),await mt.setQuoteFavorite(o,!0),K(),s.removeClass("far").addClass("fas")}catch(l){K();const c=ie(l,"Failed to add quote to favorites");m(c,-1)}}async function xq(e){var t,o,a,s,n,l,c;(t=e.querySelector(".searchBox"))==null||t.addEventListener("input",d=>{Nu()}),(o=e.querySelector("button.toggleFavorites"))==null||o.addEventListener("click",d=>{B()&&(i(d.target).toggleClass("active"),Nu())}),(a=e.querySelector(".goToQuoteApprove"))==null||a.addEventListener("click",d=>{oq({modalChain:Fo})}),(s=e.querySelector(".goToQuoteSubmit"))==null||s.addEventListener("click",async d=>{var p;J();const u=await E.quotes.isSubmissionEnabled(),f=(u.status===200&&((p=u.body.data)==null?void 0:p.isEnabled))??!1;if(K(),!f){m("Quote submission is disabled temporarily due to a large submission queue.",0,{duration:5});return}ZB({modalChain:Fo})}),(n=e.querySelector(".quoteLengthFilter"))==null||n.addEventListener("change",Nu),(l=e.querySelector(".nextPage"))==null||l.addEventListener("click",()=>{const d=document.getElementById("searchBox").value;ts++,fd(d)}),(c=e.querySelector(".prevPage"))==null||c.addEventListener("click",()=>{const d=document.getElementById("searchBox").value;ts--,fd(d)})}async function Tq(){or==null||or.destroy(),or=void 0}const Fo=new re({dialogId:"quoteSearchModal",setup:xq,cleanup:Tq});let Sc=0,np,rp,jm=!0;const qs=document.querySelector("#fpsCounter");function AC(e){if(jm)return;const t=e-rp;if(Sc++,t>500){const o=V(Sc*1e3/t).toFixed(2);Sc=0,rp=e,Mq(o)}window.requestAnimationFrame(AC)}function Lq(){jm=!1,Sc=0,rp=performance.now(),np||(np=window.requestAnimationFrame(AC)),qs.classList.remove("hidden")}function $q(){cancelAnimationFrame(np),jm=!0,qs.classList.add("hidden")}async function Mq(e){qs.innerHTML=`FPS ${e}`;const t=parseFloat(e);qs.classList.remove("error"),qs.classList.remove("main"),t<30?qs.classList.add("error"):t>55&&qs.classList.add("main")}const Qm=cv();Qm.then(e=>{vB(e)}).catch(e=>{console.error(ie(e,"Failed to update challenges commands"))});const EC=qe("language"),_C=qe("difficulty"),IC=qe("blindMode"),BC=qe("oppositeShiftMode"),qC=qe("stopOnError"),FC=qe("confidenceMode"),RC=qe("lazyMode"),DC=qe("layout"),WC=qe("showAverage"),PC=qe("keymapLayout"),zC=qe("customTheme"),HC=qe("ads"),OC=qe("minWpm"),NC=qe("minAcc"),UC=qe("paceCaret"),Ym={title:"",list:[...HI,qe("punctuation"),qe("numbers"),qe("mode"),qe("time"),qe("words"),qe("quoteLength"),EC,{id:"changeCustomModeText",display:"Change custom text",icon:"fa-align-left",exec:()=>{Um()}},{id:"viewQuoteSearchPopup",display:"Search for quotes",icon:"fa-search",exec:()=>{ut("quote"),Gm()},shouldFocusTestUI:!1},...ME,...$E,{id:"shareTestSettings",display:"Share test settings",icon:"fa-share",exec:async()=>{Vm()}},...X0,...gB,...Jw,...$s(_C,"quickRestart","repeatQuotes",IC,"alwaysShowWordsHistory","singleListCommandLine",OC,NC,...iv,"britishEnglish",...tC,"customLayoutfluid","customPolyglot"),...$s("freedomMode","strictSpace",BC,qC,FC,"quickEnd","indicateTypos","hideExtraLetters",RC,DC,"codeUnindentOnBackspace"),...$s("soundVolume","playSoundOnClick","playSoundOnError","playTimeWarning"),...$s("smoothCaret","caretStyle",UC,"repeatedPace","paceCaretStyle"),...$s("timerStyle","liveSpeedStyle","liveAccStyle","liveBurstStyle","timerColor","timerOpacity","highlightMode","tapeMode","tapeMargin","smoothLineScroll","showAllLines","typingSpeedUnit","alwaysShowDecimalPlaces","startGraphsAtZero","maxLineWidth","fontSize",...JI,"keymapMode","keymapStyle","keymapLegendStyle","keymapSize",PC,"keymapShowTopRow"),...$s(...sC,zC,...iB,"flipTestColors","colorfulMode",...oB,...ZI,"customBackgroundSize",...tB,"randomTheme"),{id:"randomizeTheme",display:"Next random theme",icon:"fa-random",exec:async()=>nw(),available:()=>r.randomTheme!=="off"},...$s("showKeyTips","showOutOfFocusWarning","capsLockWarning",WC,"monkeyPowerLevel","monkey"),HC,...nC,...RI,{id:"watchVideoAd",display:"Watch video ad",alias:"support donate",icon:"fa-ad",exec:()=>{wC()}},{id:"importSettingsJSON",display:"Import settings JSON",icon:"fa-cog",alias:"import config",input:!0,exec:async({input:e})=>{e===void 0||e===""||await Wb(e)}},{id:"exportSettingsJSON",display:"Export settings JSON",icon:"fa-cog",alias:"export config",input:!0,defaultValue:()=>JSON.stringify(r)},{id:"clearNotifications",display:"Clear all notifications",icon:"fa-trash-alt",alias:"dismiss",exec:async()=>{H1()}},{id:"clearSwCache",display:"Clear SW cache",icon:"fa-cog",exec:async()=>{const e=await caches.keys();for(const t of e)await caches.delete(t);window.location.reload()}},{id:"getSwCache",display:"Get SW cache",icon:"fa-cog",exec:async()=>{alert(await caches.keys())}},{id:"copyResultStats",display:"Copy result stats",icon:"fa-cog",visible:!1,exec:async()=>{navigator.clipboard.writeText(JSON.stringify(zv())).then(()=>{m("Copied to clipboard",1)}).catch(e=>{const t=ie(e,"Failed to copy to clipboard");m(t,-1)})}},{id:"fpsCounter",display:"FPS counter...",icon:"fa-cog",visible:!1,subgroup:{title:"FPS counter...",list:[{id:"startFpsCounter",display:"show",icon:"fa-cog",exec:()=>{Lq()}},{id:"stopFpsCounter",display:"hide",icon:"fa-cog",exec:()=>{$q()}}]}},{id:"joinDiscord",display:"Join the Discord server",icon:"fa-users",exec:()=>{window.open("https://discord.gg/monkeytype")}}]};var yy,by,vy,wy,Cy,ky;const VC={keymapLayouts:PC.subgroup,enableAds:HC.subgroup,customThemesList:zC.subgroup,themes:(yy=sC[0])==null?void 0:yy.subgroup,loadChallenge:(by=nC[0])==null?void 0:by.subgroup,languages:EC.subgroup,difficulty:_C.subgroup,lazyMode:RC.subgroup,paceCaretMode:UC.subgroup,showAverage:WC.subgroup,minWpm:OC.subgroup,minAcc:NC.subgroup,minBurst:(vy=iv[0])==null?void 0:vy.subgroup,funbox:(wy=tC[0])==null?void 0:wy.subgroup,confidenceMode:FC.subgroup,stopOnError:qC.subgroup,layouts:DC.subgroup,oppositeShiftMode:BC.subgroup,tags:(Cy=X0[0])==null?void 0:Cy.subgroup,resultSaving:(ky=Jw[0])==null?void 0:ky.subgroup,blindMode:IC.subgroup};function Aq(e){return VC[e]!==void 0}async function Eq(e){await Promise.allSettled([Qm]);const t=VC[e];if(!t)throw m(`List not found: ${e}`,-1),new Error(`List ${e} not found`);return t}let ui=[];ui=[Ym];function _q(){return ui.length}function Iq(){Bq([Ym])}function Bq(e){ui=e}function qq(e){ui.push(e)}function Fq(){ui.pop()}function Rq(){return ui[ui.length-1]}let Qh;async function Dq(){await Promise.allSettled([Qm]);const e=[];for(const t of Ym.list){const o=KC(t);e.push(...o)}return Qh={title:"",list:e},Qh}function KC(e,t){var a;const o=[];if(e.subgroup){e.subgroup.beforeList&&e.subgroup.beforeList();const s={...e,subgroup:{...e.subgroup,list:[]}};for(const n of e.subgroup.list)o.push(...KC(n,s))}else if(t){const s=t.display.replace(/\s?\.\.\.$/g,""),n=s+'<i class="fas fa-fw fa-chevron-right chevronIcon"></i>'+e.display,l=s+" "+e.display;let c;((t.alias??"")||(e.alias??""))&&(c=[t.alias,e.alias].filter(Boolean).join(" "));const d={...e,singleListDisplay:n,singleListDisplayNoIcon:l,configKey:(a=t.subgroup)==null?void 0:a.configKey,icon:t.icon,alias:c,visible:(t.visible??!0)&&(e.visible??!0),available:async()=>{var u,f;return(await((u=t==null?void 0:t.available)==null?void 0:u.call(t))??!0)&&(await((f=e==null?void 0:e.available)==null?void 0:f.call(e))??!0)}};o.push(d)}else o.push(e);return o}function $s(...e){return e.map(t=>typeof t=="string"?qe(t):t)}let At=0,zt=!1,Gt="",pd=null,Ki=!1,Ma="search",Me={command:null,placeholder:"",value:"",icon:""},os=null,tl=!1,lp="",ar;function Wq(){i("#commandLine").addClass("noBackground"),r.showOutOfFocusWarning&&Ln()}function cp(){i("#commandLine").removeClass("noBackground");const e=i("#wordsInput").is(":focus");r.showOutOfFocusWarning&&!e&&rv()}function Ci(e,t){aa.show({...t,focusFirstInput:!0,beforeAnimation:async()=>{Ki=!1,Gt="",At=0,Ma="search",xc=null,Me={command:null,placeholder:null,value:null,icon:null},(e==null?void 0:e.subgroupOverride)!==void 0?(typeof e.subgroupOverride=="string"?Aq(e.subgroupOverride)?(J(),os=await Eq(e.subgroupOverride),K()):(os=null,zt=r.singleListCommandLine==="on",m(`Command list ${e.subgroupOverride} not found`,0)):os=e.subgroupOverride,zt=!1):(os=null,zt=r.singleListCommandLine==="on");let o;if((e==null?void 0:e.commandOverride)!==void 0){const a=(await mu()).find(s=>s.id===e.commandOverride);a===void 0?m(`Command ${e.commandOverride} not found`,0):(a==null?void 0:a.input)!==!0?m(`Command ${e.commandOverride} is not an input command`,0):o=a}e!=null&&e.singleListOverride&&(zt=e.singleListOverride),pd=null,Do(!1),Iq(),await mi(),await fi(),await pi(),await Eo(),setTimeout(()=>{var a;if(GC(),o){const s=o.display.split("</i>")[1]??o.display;Ma="input",Me={command:o,placeholder:s,value:((a=o.defaultValue)==null?void 0:a.call(o))??"",icon:o.icon??"fa-chevron-right"},QC(o),mi(Me.value),Xm()}},1)}})}function fu(e=!1){Xf(),Nr(),Z()==="test"&&oi(),tl=!0,aa.hide({clearModalChain:e,afterAnimation:async()=>{var t;if(md(),cp(),Z()==="test"){const o=i("#wordsInput").is(":focus");Z()==="test"&&!o&&oi()}else(t=document.activeElement)==null||t.blur();tl=!1}})}async function Pq(){if(Ma==="input"){Ma="search",Me={command:null,placeholder:null,value:null,icon:null},await mi(""),await fi(),await pi(),await Eo(),md();return}_q()>1?(Fq(),At=0,await mi(""),await fi(),await pi(),await Eo(),md()):fu()}async function fi(){var d,u,f;const e=await pu();(d=e.beforeList)==null||d.call(e);const t=e.list,o=Gt.replace(/^>/gi,"").toLowerCase().trim(),a=o.length===0?[]:o.split(" "),s=[],n=[];for(const p of t){if(!(await((u=p.available)==null?void 0:u.call(p))??!0)){s.push({matchCount:-1,matchStrength:-1});continue}if(o.length===0||a.length===0){s.push({matchCount:0,matchStrength:0});continue}const g=(zt&&(p.singleListDisplayNoIcon??"")||p.display).toLowerCase().split(" "),y=((f=p.alias)==null?void 0:f.toLowerCase().split(" "))??[],b=g.concat(y),C=b.map(()=>null);let L=0;for(const[q,P]of a.entries())for(const[$,H]of b.entries()){const R=C[$];H.startsWith(P)&&R===null&&!C.includes(q)&&(C[$]=q,L+=P.length)}const S=C.filter(q=>q!==null).length;n.push(S),s.push({matchCount:S,matchStrength:L})}const l=Math.max(...s.map(p=>p.matchStrength));let c=a.length;do{if(n.filter(h=>h>=c).length>0)break;c--}while(c>0);c===0&&(c=1);for(const[p,h]of t.entries()){const g=s[p];if(g===void 0){h.found=!1;continue}g.matchCount>=c&&g.matchStrength>=l?h.found=!0:h.found=!1}}function Xm(){const e=document.querySelector("#commandLine .suggestions");if(e===null)throw new Error("Commandline element not found");e.innerHTML="",ar=void 0}let xc=null;async function pu(){if(os!==null)return os;if(zt)if(xc===null)xc=await Dq();else return xc;return Rq()}async function mu(){return(await pu()).list}function zq(e){let t='<i class="fas fa-fw fa-chevron-right"></i>';if(e.icon!==void 0&&e.icon!==""){const a=e.icon.startsWith("fa-"),n=(e.iconType??"solid")==="solid"?"fas":"far";a?t=`<i class="${n} fa-fw ${e.icon}"></i>`:t=`<div class="textIcon">${e.icon}</div>`}let o='<i class="fas fa-fw"></i>';return e.isActive&&(o='<i class="fas fa-fw fa-check"></i>'),{iconHtml:t,configIconHtml:o}}async function pi(){const e=document.querySelector("#commandLine .suggestions");if(e===null)throw new Error("Commandline element not found");if(Gt===""&&zt){Xm();return}const t=await pu(),o=t.list.filter(n=>n.found===!0).map(n=>{let l=!1;if(n.active!==void 0)l=n.active();else{const c=n.configKey??t.configKey;c!==void 0&&(n.configValueMode==="include"?Array.isArray(n.configValue)?l=gs(Hy(r[c],n.configValue),n.configValue):l=r[c].includes(n.configValue):l=r[c]===n.configValue)}return{...n,isActive:l}});if(ar&&zt===ar.usingSingleList&&Cr(o,ar.list))return;ar={list:o,usingSingleList:zt};let a="",s=0;for(const n of o){if(n.found!==!0)continue;let l="";n.customStyle!==void 0&&n.customStyle!==""&&(l=n.customStyle);const{iconHtml:c,configIconHtml:d}=zq(n);let u=n.display;zt&&(u=(n.singleListDisplay??"")||n.display,(n.configValue!==void 0||n.active!==void 0)&&(u=u.replace('<i class="fas fa-fw fa-chevron-right chevronIcon"></i>','<i class="fas fa-fw fa-chevron-right chevronIcon"></i>'+d)));let f=c;if((!zt&&n.subgroup===void 0&&n.configValue!==void 0||!zt&&n.active!==void 0)&&(f=d),n.customData!==void 0){if(n.id.startsWith("changeTheme")&&(a+=`<div class="command changeThemeCommand" data-command-id="${n.id}" data-index="${s}" style="${l}">
      <div class="icon">${f}</div><div>${u}</div>
      <div class="themeFavIcon ${n.customData.isFavorite===!0?"":"hidden"}">
        <i class="fas fa-star"></i>
      </div>
      <div class="themeBubbles" style="background: ${n.customData.bgColor};outline: 0.25rem solid ${n.customData.bgColor};">
        <div class="themeBubble" style="background: ${n.customData.mainColor}"></div>
        <div class="themeBubble" style="background: ${n.customData.subColor}"></div>
        <div class="themeBubble" style="background: ${n.customData.textColor}"></div>
      </div>
      </div>`),n.id.startsWith("setFontFamily")){let p=n.customData.name;p==="Helvetica"&&(p="Comic Sans MS"),n.customData.isSystem===!1&&(p+=" Preview"),a+=`<div class="command" data-command-id="${n.id}" data-index="${s}" style="font-family: '${p}'"><div class="icon">${f}</div><div>${u}</div></div>`}}else a+=`<div class="command" data-command-id="${n.id}" data-index="${s}" style="${l}"><div class="icon">${f}</div><div>${u}</div></div>`;s++}e.innerHTML=a}async function Eo(){var a,s,n;if(tl)return;const e=[...document.querySelectorAll("#commandLine .suggestions .command")];for(const l of e)l.classList.remove("active");const t=e[At],o=(await mu()).filter(l=>l.found)[At];if(pd=o??null,t===void 0||o===void 0){Xf(),Nr(!1),cp();return}t.classList.add("active"),GC(),Xf(),(a=o.id)!=null&&a.startsWith("changeTheme")||(s=o.id)!=null&&s.startsWith("setCustomThemeId")?Wq():(Nr(),cp()),(n=o.hover)==null||n.call(o)}function Hq(){var e,t,o,a,s,n;if(!tl){if(Me.command===null)throw new Error("Can't handle input submit - command is null");if(((e=Me.validation)==null?void 0:e.status)!=="checking"){if(((t=Me.validation)==null?void 0:t.status)==="failed"){const l=i("#commandLine .modal");l.stop(!0,!0).addClass("hasError").animate({undefined:1},500,()=>{l.removeClass("hasError")});return}"inputValueConvert"in Me.command?(a=(o=Me.command).exec)==null||a.call(o,{commandlineModal:aa,input:Me.command.inputValueConvert(Gt)}):(n=(s=Me.command).exec)==null||n.call(s,{commandlineModal:aa,input:Gt}),ri("usedCommandLine",{command:Me.command.id}),fu()}}}async function Yh(){var t,o;if(tl||pd===null)return;const e=pd;if(e.input){const a=e.display.split("</i>")[1]??e.display;Ma="input",Me={command:e,placeholder:a,value:((t=e.defaultValue)==null?void 0:t.call(e))??"",icon:e.icon??"fa-chevron-right"},QC(e),await mi(Me.value),Xm()}else e.subgroup?(qq(e.subgroup),await mi(""),await fi(),await pi(),await Eo()):((o=e.exec)==null||o.call(e,{commandlineModal:aa}),r.singleListCommandLine==="on"&&(lp=Gt),e.sticky??!1?(await fi(),await pi(),await Eo()):(ri("usedCommandLine",{command:e.id}),e.opensModal||fu(!0)))}let Xh;function GC(){if(Ki)return;const e=document.querySelector(".suggestions .command.active");e===null||e.dataset.index===Xh||(e.scrollIntoView({behavior:"auto",block:"center"}),Xh=e.dataset.index)}async function mi(e){const t=document.querySelector("#commandLine .searchicon"),o=document.querySelector("#commandLine input");if(o===null||t===null)throw new Error("Commandline element or icon element not found");if(e!==void 0&&(Gt=e),o.value=Gt,Ma==="input")Me.icon!==null&&(t.innerHTML=`<i class="fas fa-fw ${Me.icon}"></i>`),Me.placeholder!==null&&(o.placeholder=Me.placeholder),Me.value!==null&&(o.value=Me.value,o.setSelectionRange(0,o.value.length));else{t.innerHTML='<i class="fas fa-fw fa-search"></i>',o.placeholder="Search...";const a=await pu();a.title!==void 0&&a.title!==""&&(o.placeholder=`${a.title}`);let s=Gt.length;e!==void 0&&(s=e.length),setTimeout(()=>{o.setSelectionRange(s,s)},0)}}async function Zh(){At++,At>=(await mu()).filter(e=>e.found).length&&(At=0),await Eo()}async function Jh(){At--,At<0&&(At=(await mu()).filter(e=>e.found).length-1),await Eo()}function Oq(e){const t=aa.getModal().querySelector(".warning"),o=aa.getModal().querySelector(".warning .text");if(t===null||o===null)throw new Error("Commandline warning element not found");t.classList.remove("hidden"),o.textContent=e}const jC=It(200,async()=>{const e=aa.getModal().querySelector(".checkingicon");if(e===null)throw new Error("Commandline checking icon element not found");e.classList.remove("hidden")});function ey(){jC.cancel({upcomingOnly:!0});const e=aa.getModal().querySelector(".checkingicon");if(e===null)throw new Error("Commandline checking icon element not found");e.classList.add("hidden")}function md(){const e=aa.getModal().querySelector(".warning");if(e===null)throw new Error("Commandline warning element not found");e.classList.add("hidden")}function Nq(e){Me.validation=e,e.status==="checking"?jC():e.status==="failed"&&e.errorMessage!==void 0?(Oq(e.errorMessage),ey()):(md(),ey())}const dp=new Map;function QC(e){if("validation"in e&&!dp.has(e.id)){const t=e,o=e0(Nq,t.validation,"inputValueConvert"in t?t.inputValueConvert:void 0);dp.set(e.id,o)}}const aa=new re({dialogId:"commandLine",customEscapeHandler:()=>{},customWrapperClickHandler:()=>{fu()},showOptionsWhenInChain:{focusFirstInput:!0},setup:async e=>{const t=e.querySelector("input");t.addEventListener("input",It(50,async s=>{Gt=s.target.value,os===null&&(r.singleListCommandLine==="on"?zt=!0:zt=Gt.startsWith(">")),Ma==="search"&&(Ki=!1,At=0,await fi(),await pi(),await Eo())})),t.addEventListener("keydown",async s=>{if(Ki=!1,s.key==="ArrowUp"||s.ctrlKey&&(s.key.toLowerCase()==="k"||s.key.toLowerCase()==="p")){if(r.singleListCommandLine==="on"&&os===null&&Gt===""&&lp!==""){Gt=lp,await mi(),await fi(),await pi(),await Eo();return}s.preventDefault(),await Jh()}if((s.key==="ArrowDown"||s.ctrlKey&&(s.key.toLowerCase()==="j"||s.key.toLowerCase()==="n"))&&(s.preventDefault(),await Zh()),s.key==="Tab"&&(s.preventDefault(),s.shiftKey?await Jh():await Zh()),s.key==="Enter")if(s.preventDefault(),Ma==="search")await Yh();else if(Ma==="input")Hq();else throw new Error("Unknown mode, can't handle enter press");s.key==="Escape"&&(s.preventDefault(),s.stopPropagation(),await Pq())}),t.addEventListener("input",async s=>{if(Me===null||Me.command===null||!("validation"in Me.command))return;const n=dp.get(Me.command.id);if(n===void 0)throw new Error(`Expected handler for command ${Me.command.id} is missing`);await n(s)}),e.addEventListener("mousemove",s=>{Ki=!0});const o=document.querySelector(".suggestions");let a;o.addEventListener("mousemove",async s=>{Ki=!0;const n=s.target;if(n===a)return;const l=Sg(n==null?void 0:n.getAttribute("data-index"));l!==void 0&&(a=s.target,At=l,await Eo())}),o.addEventListener("click",async s=>{const n=s.target,l=Sg(n==null?void 0:n.getAttribute("data-index"));if(l===void 0)return;const c=At;At=l,c!==At&&await Eo(),await Yh()})}});document.addEventListener("keydown",async e=>{Qs()||e.key!==void 0&&(e.key==="Escape"&&r.quickRestart!=="esc"||e.key==="Tab"&&r.quickRestart==="esc"&&!Mr&&!e.shiftKey||e.key==="Tab"&&r.quickRestart==="esc"&&Mr&&e.shiftKey||e.key.toLowerCase()==="p"&&(e.metaKey||e.ctrlKey)&&e.shiftKey)&&(e.preventDefault(),vd()||Ci())});window.onerror=function(e,t,o,a,s){};window.onunhandledrejection=function(e){};function YC(){XC.show()}const XC=new re({dialogId:"supportModal",setup:async e=>{var t;(t=e.querySelector("button.ads"))==null||t.addEventListener("click",async()=>{Ci({subgroupOverride:"enableAds"},{modalChain:XC})})}});function ZC(){Uq.show()}const Uq=new re({dialogId:"contactModal"});function Vq(){Kq.show({beforeAnimation:async()=>{i("#versionHistoryModal .modal").html(`
    <div class="preloader">
      <i class="fas fa-fw fa-spin fa-circle-notch"></i>
    </div
  `),XL().then(e=>{i("#versionHistoryModal .modal").html('<div class="releases"></div'),e.forEach(t=>{if(!t.draft&&!t.prerelease){let o=t.body;o=o.replace(/\r\n/g,"<br>"),o=o.replace(/### (.*?)<br>/g,"<h3>$1</h3>"),o=o.replace(/<\/h3><br>/gi,"</h3>"),o=o.replace(/^- /gm,""),o=o.replace(/\*\*(.*?)\*\*/g,"<b>$1</b>"),o=o.replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2" target="_blank">$1</a>'),i("#versionHistoryModal .modal .releases").append(`
        <div class="release">
          <div class="title">${t.name}</div>
          <div class="date">${te(new Date(t.published_at),"dd MMM yyyy")}</div>
          <div class="body">${o}</div>
        </div>
      `)}})}).catch(e=>{const t=ie(e,"Failed to fetch version history");i("#versionHistoryModal .modal").html(`<div class="releases">${t}</div`)}),i("#newVersionIndicator").addClass("hidden")}})}const Kq=new re({dialogId:"versionHistoryModal"});var Sy;(Sy=document.querySelector("footer #commandLineMobileButton"))==null||Sy.addEventListener("click",async()=>{Ci({singleListOverride:!1})});var xy;(xy=document.querySelector("footer #newVersionIndicator"))==null||xy.addEventListener("click",e=>{var t;e.stopPropagation(),(t=document.querySelector("#newVersionIndicator"))==null||t.classList.add("hidden")});var Ty;(Ty=document.querySelector("footer .currentVersion"))==null||Ty.addEventListener("click",e=>{e.shiftKey?alert(JSON.stringify({clientVersion:Sn.clientVersion,clientCompatibility:Zu,lastSeenServerCompatibility:lb},null,2)):Vq()});var Ly;(Ly=document.querySelector("footer .right .current-theme"))==null||Ly.addEventListener("click",async e=>{var o,a;if(e.shiftKey){if(r.customTheme){xa(!1);return}if(B()&&(((a=(o=x())==null?void 0:o.customThemes)==null?void 0:a.length)??0)<1){m("No custom themes!",0),xa(!1);return}xa(!0)}else{const s=r.customTheme?"customThemesList":"themes";Ci({subgroupOverride:s})}});var $y;($y=document.querySelector("footer #supportMeButton"))==null||$y.addEventListener("click",()=>{YC()});var My;(My=document.querySelector("footer #contactPopupButton"))==null||My.addEventListener("click",()=>{ZC()});i("#keymap").on("click",".r5 .layoutIndicator",async()=>{Ci({subgroupOverride:"keymapLayouts"})});function JC(e){Zm.show({...e,focusFirstInput:"focusAndSelect",beforeAnimation:async t=>{t.querySelector("input").value=`${r.words}`}})}function Gq(e=!1){Zm.hide({clearModalChain:e})}function jq(){var t;const e=parseInt((t=Zm.getModal().querySelector("input"))==null?void 0:t.value,10);e!==null&&!isNaN(e)&&e>=0&&isFinite(e)?Zs(e)&&(ee(),z(),e>2e3?m("Stay safe and take breaks!",0):e===0&&m("Infinite words! Make sure to use Bail Out from the command line to save your result.",0,{duration:7})):m("Custom word amount must be at least 1",0),Gq(!0)}const Zm=new re({dialogId:"customWordAmountModal",setup:async e=>{e.addEventListener("submit",t=>{t.preventDefault(),jq()})}}),Re={resultId:"",startingTags:[],tags:[],source:"accountPage"};function ek(e,t,o){if(!tt()){m("You are offline",0,{duration:2});return}if(e===""){m("Failed to show edit result tags modal: result id is empty",-1);return}Re.resultId=e,Re.startingTags=[...t],Re.tags=[...t],Re.source=o,Jm.show({beforeAnimation:async()=>{Qq(),tk()}})}function ty(){Jm.hide()}function Qq(){var o,a;const e=Jm.getModal().querySelector(".buttons");if(e===null){m("Failed to append buttons to edit result tags modal: could not find buttons element",-1);return}const t=new Set([...((o=x())==null?void 0:o.tags.map(s=>s._id))??[],...Re.tags]);e.innerHTML="";for(const s of t){const n=(a=x())==null?void 0:a.tags.find(c=>c._id===s),l=document.createElement("button");l.classList.add("toggleTag"),l.setAttribute("data-tag-id",s),l.innerHTML=(n==null?void 0:n.display)??"unknown tag",l.addEventListener("click",c=>{Yq(s),tk()}),e.appendChild(l)}}function tk(){for(const e of i("#editResultTagsModal .modal .buttons button")){const t=i(e).attr("data-tag-id")??"";Re.tags.includes(t)?i(e).addClass("active"):i(e).removeClass("active")}}function Yq(e){Re.tags.includes(e)?Re.tags=Re.tags.filter(t=>t!==e):Re.tags.push(e)}async function Xq(){var o,a,s;J();const e=await E.results.updateTags({body:{resultId:Re.resultId,tagIds:Re.tags}});if(K(),Re.tags=Re.tags.filter(n=>n!==void 0),e.status!==200){m("Failed to update result tags: "+e.body.message,-1);return}const t=((o=e.body.data)==null?void 0:o.tagPbs)??[];m("Tags updated",1,{duration:2}),(s=(a=x())==null?void 0:a.results)==null||s.forEach(n=>{n._id===Re.resultId&&(n.tags=Re.tags)}),Re.source==="accountPage"?T_(Re.resultId,Re.tags):Re.source==="resultPage"&&q2(Re.tags,t)}const Jm=new re({dialogId:"editResultTagsModal",setup:async e=>{var t;(t=e.querySelector("button.saveButton"))==null||t.addEventListener("click",o=>{if(gs(Re.startingTags,Re.tags)){ty();return}ty(),Xq()})}});function ok(e){const t=/((-\s*)?\d+(\.\d+)?\s*[hms]?)/g,o=[...e.toLowerCase().matchAll(t)].map(a=>{const s=a[0],n=parseFloat(s.replace(/\s+/g,""));return s.includes("h")?3600*n:s.includes("m")?60*n:n}).reduce((a,s)=>a+s,0);return Math.floor(o)}function Zq(e){const t=Math.floor(e/3600),o=Math.floor(e%3600/60),a=e%3600%60,s=[];return t>0&&s.push(`${t} hour${t===1?"":"s"}`),o>0&&s.push(`${o} minute${o===1?"":"s"}`),a>0&&s.push(`${a} second${a===1?"":"s"}`),s.length===3?`${s[0]}, ${s[1]} and ${s[2]}`:s.length===2?`${s[0]} and ${s[1]}`:`${s[0]}`}function ak(){const e=i("#customTestDurationModal input").val(),t=ok(e);let o="";t<0?o="Negative time? Really?":t===0?o="Infinite test":o=Zq(t),i("#customTestDurationModal .preview").text(o)}function sk(e){ik.show({...e,focusFirstInput:"focusAndSelect",beforeAnimation:async t=>{t.querySelector("input").value=`${r.time}`,ak()}})}function Jq(e=!1){ik.hide({clearModalChain:e})}function eF(){const e=ok(i("#customTestDurationModal input").val());if(e!==null&&!isNaN(e)&&e>=0&&isFinite(e))Ca(e),ee(),z(),e>=1800?m("Stay safe and take breaks!",0):e===0&&m("Infinite time! Make sure to use Bail Out from the command line to save your result.",0,{duration:7});else{m("Custom time must be a positive number or zero",0);return}Jq(!0)}async function tF(e){var t;e.addEventListener("submit",o=>{o.preventDefault(),eF()}),(t=e.querySelector("input"))==null||t.addEventListener("input",o=>{ak()})}const ik=new re({dialogId:"customTestDurationModal",setup:tF});function nk(){const e=i("#mobileTestConfigModal");if(e.find("button").removeClass("active"),e.find(`.modeGroup button[data-mode='${r.mode}']`).addClass("active"),e.find(".timeGroup").addClass("hidden"),e.find(".wordsGroup").addClass("hidden"),e.find(".quoteGroup").addClass("hidden"),e.find(".customGroup").addClass("hidden"),e.find(`.${r.mode}Group`).removeClass("hidden"),r.punctuation?e.find(".punctuation").addClass("active"):e.find(".punctuation").removeClass("active"),r.numbers?e.find(".numbers").addClass("active"):e.find(".numbers").removeClass("active"),r.mode==="time")e.find(`.timeGroup button[data-time='${r.time}']`).addClass("active"),e.find(".punctuation").removeClass("disabled"),e.find(".numbers").removeClass("disabled");else if(r.mode==="words")e.find(`.wordsGroup button[data-words='${r.words}']`).addClass("active"),e.find(".punctuation").removeClass("disabled"),e.find(".numbers").removeClass("disabled");else if(r.mode==="quote"){if(gs(r.quoteLength,[0,1,2,3]))e.find(".quoteGroup button[data-quoteLength='all']").addClass("active");else for(const t of r.quoteLength)e.find(`.quoteGroup button[data-quoteLength='${t}']`).addClass("active");e.find(".punctuation").addClass("disabled"),e.find(".numbers").addClass("disabled")}else r.mode==="zen"?(e.find(".punctuation").addClass("disabled"),e.find(".numbers").addClass("disabled")):r.mode==="custom"&&(e.find(".punctuation").removeClass("disabled"),e.find(".numbers").removeClass("disabled"))}function oF(){zi.show({beforeAnimation:async()=>{nk()}})}async function aF(e){var l,c,d,u;const t=e.querySelectorAll(".wordsGroup button");for(const f of t)f.addEventListener("click",p=>{const g=p.currentTarget.getAttribute("data-words");if(g==="custom")JC({modalChain:zi});else if(g!==void 0){const y=parseInt(g);Zs(y),ee(),z()}});const o=e.querySelectorAll(".modeGroup button");for(const f of o)f.addEventListener("click",p=>{const g=p.currentTarget.getAttribute("data-mode");g!==r.mode&&(ut(g),ee(),z())});const a=e.querySelectorAll(".timeGroup button");for(const f of a)f.addEventListener("click",p=>{const g=p.currentTarget.getAttribute("data-time");if(g==="custom")sk({modalChain:zi});else if(g!==void 0){const y=parseInt(g);Ca(y),ee(),z()}});const s=e.querySelectorAll(".quoteGroup button");for(const f of s)f.addEventListener("click",p=>{const g=p.currentTarget.getAttribute("data-quoteLength")??"0";if(g==="all")Xi()&&(ee(),z());else if(g==="-2")Gm({modalChain:zi});else{const y=parseInt(g,10);let b=[];p.shiftKey?b=[...r.quoteLength,y]:b=[y],Id(b,!1)&&(ee(),z())}});(l=e.querySelector(".customChange"))==null||l.addEventListener("click",()=>{Um({modalChain:zi})}),(c=e.querySelector(".punctuation"))==null||c.addEventListener("click",()=>{cs(!r.punctuation),ee(),z()}),(d=e.querySelector(".numbers"))==null||d.addEventListener("click",()=>{Sa(!r.numbers),ee(),z()}),(u=e.querySelector(".shareButton"))==null||u.addEventListener("click",()=>{Vm({modalChain:zi})});const n=e.querySelectorAll("button");for(const f of n)f.addEventListener("click",()=>{nk()})}const zi=new re({dialogId:"mobileTestConfigModal",setup:aF});i(".pageTest").on("click","#testModesNotice .textButton",async e=>{const t=i(e.currentTarget).attr("commands");t!==void 0&&Ci({subgroupOverride:t})});i(".pageTest").on("click","#testModesNotice .textButton",async e=>{const t=i(e.currentTarget).attr("commandId");t!==void 0&&Ci({commandOverride:t})});i(".pageTest").on("click","#testConfig .wordCount .textButton",e=>{i(e.currentTarget).attr("wordCount")==="custom"&&JC()});i(".pageTest").on("click","#testConfig .time .textButton",e=>{i(e.currentTarget).attr("timeconfig")==="custom"&&sk()});i(".pageTest").on("click","#testConfig .shareButton",e=>{Vm()});i(".pageTest").on("click",".tags .editTagsButton",()=>{var e,t;if((((t=(e=x())==null?void 0:e.tags)==null?void 0:t.length)??0)>0){const o=i(".pageTest .tags .editTagsButton").attr("data-result-id"),a=i(".pageTest .tags .editTagsButton").attr("data-active-tag-ids"),s=a===""?[]:a.split(",");ek(o,s,"resultPage")}});i(".pageTest").on("click","#mobileTestConfigButton",()=>{oF()});i(".pageTest #rateQuoteButton").on("click",async()=>{if(X===null){m("Failed to show quote rating popup: no quote",-1);return}HA(X)});i(".pageTest #reportQuoteButton").on("click",async()=>{if(X===null){m("Failed to show quote report popup: no quote",-1);return}$C(X==null?void 0:X.id)});i(".pageTest").on("click","#testConfig .quoteLength .textButton",e=>{parseInt(i(e.currentTarget).attr("quoteLength")??"0")===-2&&Gm()});i(".pageTest").on("click","#testConfig .customText .textButton",()=>{Um()});i(".pageTest").on("click","#practiseWordsButton",()=>{if(r.mode==="zen"){m("Practice words is unsupported in zen mode",0);return}U0()});i(".pageTest #dailyLeaderboardRank").on("click",async()=>{Ke(`/leaderboards?type=daily&language=${r.language}&mode2=${gi(r,null)}&goToUserPage=true`)});var Ay;(Ay=document.querySelector("#pageAbout #supportMeAboutButton"))==null||Ay.addEventListener("click",()=>{YC()});var Ey;(Ey=document.querySelector("#pageAbout #contactPopupButton2"))==null||Ey.addEventListener("click",()=>{ZC()});const eg={includeBackground:!1};function sF(){up.show({beforeAnimation:async e=>{e.querySelector("input[type='checkbox']").checked=!1,eg.includeBackground=!1}})}async function iF(){const e={c:Ba.map(t=>i(`.pageSettings .customTheme .customThemeEdit #${t}[type='color']`).attr("value"))};return eg.includeBackground&&(e.i=r.customBackground,e.s=r.customBackgroundSize,e.f=r.customBackgroundFilter),window.location.origin+"?customTheme="+btoa(JSON.stringify(e))}async function nF(){const e=await iF();try{await navigator.clipboard.writeText(e),m("URL Copied to clipboard",1),up.hide()}catch{m("Looks like we couldn't copy the link straight to your clipboard. Please copy it manually.",0,{duration:5}),fp.show({modalChain:up,focusFirstInput:"focusAndSelect",beforeAnimation:async o=>{o.querySelector("input").value=e}})}}const up=new re({dialogId:"shareCustomThemeModal",setup:async e=>{var t,o;(t=e.querySelector("button"))==null||t.addEventListener("click",nF),(o=e.querySelector("input[type='checkbox']"))==null||o.addEventListener("change",a=>{eg.includeBackground=a.target.checked})}}),fp=new re({dialogId:"shareCustomThemeUrlModal",customEscapeHandler:async()=>{await fp.hide({clearModalChain:!0})},customWrapperClickHandler:async()=>{await fp.hide({clearModalChain:!0})}}),rF=D.object({security:D.boolean(),analytics:D.boolean(),sentry:D.boolean()}).strict().nullable();function tg(){return rk.get()}function Uu(e){rk.set(e),lk()}const rk=new Bt({key:"acceptedCookies",schema:rF,fallback:null});function lk(){const e=tg();e!=null&&e.analytics&&mE(),e!=null&&e.sentry&&Bx()}function ck(e){zs.show({beforeAnimation:async()=>{if(e){const t=tg();dk(t)}},afterAnimation:async()=>{Io("cookiesModal")||zs.destroy()}})}function dk(e){var t,o;(t=zs.getModal().querySelector(".main"))==null||t.classList.add("hidden"),(o=zs.getModal().querySelector(".settings"))==null||o.classList.remove("hidden"),e&&(e.analytics&&(zs.getModal().querySelector(".cookie.analytics input").checked=!0),e.sentry&&(zs.getModal().querySelector(".cookie.sentry input").checked=!0))}async function Vu(){zs.hide({afterAnimation:async()=>{oi()}})}const zs=new re({dialogId:"cookiesModal",customEscapeHandler:()=>{},customWrapperClickHandler:()=>{},setup:async e=>{var t,o,a,s,n;(t=e.querySelector(".acceptAll"))==null||t.addEventListener("click",()=>{Uu({security:!0,analytics:!0,sentry:!0}),Vu()}),(o=e.querySelector(".rejectAll"))==null||o.addEventListener("click",()=>{Uu({security:!0,analytics:!1,sentry:!1}),Vu()}),(a=e.querySelector(".openSettings"))==null||a.addEventListener("click",()=>{dk()}),(s=e.querySelector(".cookie.ads .textButton"))==null||s.addEventListener("click",()=>{try{i2()}catch{console.error("Failed to open ad consent UI"),m("Failed to open Ad consent popup. Do you have an ad or cookie popup blocker enabled?",-1)}}),(n=e.querySelector(".acceptSelected"))==null||n.addEventListener("click",()=>{const l=e.querySelector(".cookie.analytics input").checked,c=e.querySelector(".cookie.sentry input").checked;Uu({security:!0,analytics:l,sentry:c}),Vu()})}}),fo=document.querySelector("#pageSettings");var _y;(_y=fo==null?void 0:fo.querySelector("#shareCustomThemeButton"))==null||_y.addEventListener("click",()=>{sF()});var Iy;(Iy=fo==null?void 0:fo.querySelector(".section.updateCookiePreferences .buttons button"))==null||Iy.addEventListener("click",()=>{ck(!0)});var By;(By=fo==null?void 0:fo.querySelector(".section.presets"))==null||By.addEventListener("click",e=>{var o,a,s,n;const t=e.target;if(t.classList.contains("addPresetButton"))wc("add");else if(t.classList.contains("editButton")){const l=(o=t.parentElement)==null?void 0:o.getAttribute("data-id"),c=(a=t.parentElement)==null?void 0:a.getAttribute("data-display");if(l===void 0||c===void 0||l===""||c===""||l===null||c===null){m("Failed to edit preset: Could not find preset id or name",-1);return}wc("edit",l,c)}else if(t.classList.contains("removeButton")){const l=(s=t.parentElement)==null?void 0:s.getAttribute("data-id"),c=(n=t.parentElement)==null?void 0:n.getAttribute("data-display");if(l===void 0||c===void 0||l===""||c===""||l===null||c===null){m("Failed to remove preset: Could not find preset id or name",-1);return}wc("remove",l,c)}});var qy;(qy=fo==null?void 0:fo.querySelector(".section.tags"))==null||qy.addEventListener("click",e=>{var o,a,s,n,l,c;const t=e.target;if(t.classList.contains("addTagButton"))Yn("add");else if(t.classList.contains("editButton")){const d=(o=t.parentElement)==null?void 0:o.getAttribute("data-id"),u=(a=t.parentElement)==null?void 0:a.getAttribute("data-display");if(d===void 0||u===void 0||d===""||u===""||d===null||u===null){m("Failed to edit tag: Could not find tag id or name",-1);return}Yn("edit",d,u)}else if(t.classList.contains("clearPbButton")){const d=(s=t.parentElement)==null?void 0:s.getAttribute("data-id"),u=(n=t.parentElement)==null?void 0:n.getAttribute("data-display");if(d===void 0||u===void 0||d===""||u===""||d===null||u===null){m("Failed to clear tag PB: Could not find tag id or name",-1);return}Yn("clearPb",d,u)}else if(t.classList.contains("removeButton")){const d=(l=t.parentElement)==null?void 0:l.getAttribute("data-id"),u=(c=t.parentElement)==null?void 0:c.getAttribute("data-display");if(d===void 0||u===void 0||d===""||u===""||d===null||u===null){m("Failed to remove tag: Could not find tag id or name",-1);return}Yn("remove",d,u)}});function lF(e){var l;const t=fk.getModal();t.querySelector("table tbody").innerHTML="",t.querySelector("table thead tr td").textContent=e,t.querySelector("table thead tr td span.unit").textContent=r.typingSpeedUnit;const o=x();if(!o)return;const a=(l=o.personalBests)==null?void 0:l[e];if(a===void 0)return;const s=[];Object.keys(a).forEach(function(c){let d=a[c]??[];d=d.sort(function(u,f){return f.wpm-u.wpm}),d.forEach(function(u){u.mode2=c,s.push(u)})});let n;s.forEach(c=>{var f;let d='-<br><span class="sub">-</span>';const u=new Date(c.timestamp);c.timestamp&&(d=te(u,"dd MMM yyyy")+"<br><div class='sub'>"+te(u,"HH:mm")+"</div>"),(f=t.querySelector("table tbody"))==null||f.insertAdjacentHTML("beforeend",`
      <tr>
        <td>${n===c.mode2?"":c.mode2}</td>
        <td>
          ${N.typingSpeed(c.wpm)}
          <br />
          <span class="sub">${N.accuracy(c.acc)}</span>
        </td>
        <td>
          ${N.typingSpeed(c.raw)}
          <br />
          <span class="sub">${N.percentage(c.consistency)}</span>
        </td>
        <td>${c.difficulty}</td>
        <td>${c.language?ea(c.language):"-"}</td>
        <td>${c.punctuation?'<i class="fas fa-check"></i>':""}</td>
        <td>${c.numbers?'<i class="fas fa-check"></i>':""}</td>
        <td>${c.lazyMode?'<i class="fas fa-check"></i>':""}</td>
        <td>${d}</td>
      </tr>
    `),n=c.mode2})}function uk(e){fk.show({beforeAnimation:async()=>{lF(e)}})}const fk=new re({dialogId:"pbTablesModal"});function cF(){if(!tt()){m("You are offline",0,{duration:2});return}mk.show({beforeAnimation:async()=>{fF(),pF()}})}function dF(){mk.hide({afterAnimation:async()=>{const e=x();e&&id("account",e)}})}const og=i("#editProfileModal .bio"),ag=i("#editProfileModal .keyboard"),sg=i("#editProfileModal .twitter"),ig=i("#editProfileModal .github"),ng=i("#editProfileModal .website"),Xl=i("#editProfileModal .badgeSelectionContainer"),pk=document.querySelector("#editProfileModal .editProfileShowActivityOnPublicProfile"),uF=[Ku(sg,mS),Ku(ig,gS),Ku(ng,hS)];let Gi=-1;function fF(){var l;const e=x();if(!e)return;const t=((l=e.inventory)==null?void 0:l.badges)??[],{bio:o,keyboard:a,socialProfiles:s,showActivityOnPublicProfile:n}=e.details??{};Gi=-1,og.val(o??""),ag.val(a??""),sg.val((s==null?void 0:s.twitter)??""),ig.val((s==null?void 0:s.github)??""),ng.val((s==null?void 0:s.website)??""),Xl.html(""),pk.checked=n||!1,t==null||t.forEach(c=>{c.selected&&(Gi=c.id);const d=Xr(c.id,!1,!0),u=`<button type="button" class="badgeSelectionItem ${c.selected?"selected":""}" selection-id=${c.id}>${d}</button>`;Xl.append(u)}),Xl.prepend(`<button type="button" class="badgeSelectionItem ${Gi===-1?"selected":""}" selection-id=-1>
      <div class="badge">
        <i class="fas fa-frown-open"></i>
        <div class="text">none</div>
      </div>
    </button>`),i(".badgeSelectionItem").on("click",({currentTarget:c})=>{const d=i(c).attr("selection-id");Gi=parseInt(d,10),Xl.find(".badgeSelectionItem").removeClass("selected"),i(c).addClass("selected")}),uF.forEach(c=>c.hide())}function pF(){new Zr(og,250),new Zr(ag,75)}function mF(){const e=og.val()??"",t=ag.val()??"",o=sg.val()??"",a=ig.val()??"",s=ng.val()??"",n=pk.checked??!1;return{bio:e,keyboard:t,socialProfiles:{twitter:o,github:a,website:s},showActivityOnPublicProfile:n}}async function gF(){var n,l,c,d,u;const e=x();if(!e)return;const t=mF(),o=39;if(((n=t.socialProfiles)==null?void 0:n.github)!==void 0&&((l=t.socialProfiles)==null?void 0:l.github.length)>o){m(`GitHub username exceeds maximum allowed length (${o} characters).`,-1);return}const a=20;if(((c=t.socialProfiles)==null?void 0:c.twitter)!==void 0&&((d=t.socialProfiles)==null?void 0:d.twitter.length)>a){m(`Twitter username exceeds maximum allowed length (${a} characters).`,-1);return}J();const s=await E.users.updateProfile({body:{...t,selectedBadgeId:Gi}});if(K(),s.status!==200){m("Failed to update profile: "+s.body.message,-1);return}e.details=s.body.data??t,(u=e.inventory)==null||u.badges.forEach(f=>{f.id===Gi?f.selected=!0:delete f.selected}),m("Profile updated",1),dF()}function Ku(e,t){const o=new xm(e,{valid:{icon:"fa-check",level:1},invalid:{icon:"fa-times",level:-1},checking:{icon:"fa-circle-notch",spinIcon:!0,level:0}});return e.on("input",a=>{const s=a.target.value;if(s===void 0||s===""){o.hide();return}const n=t.safeParse(s);if(!n.success){o.show("invalid",n.error.errors.map(l=>l.message).join(", "));return}o.show("valid")}),o}const mk=new re({dialogId:"editProfileModal",setup:async e=>{e.addEventListener("submit",async t=>{t.preventDefault(),await gF()})}});function hF(e){gk.show({...e,focusFirstInput:!0,beforeAnimation:async t=>{t.querySelector("input").value=""}})}function yF(e=!1){gk.hide({clearModalChain:e})}function bF(){const e=i("#newFilterPresetModal input").val();if(e===""){m("Name cannot be empty",0);return}ZE(e),yF(!0)}async function vF(e){e.addEventListener("submit",t=>{t.preventDefault(),bF()})}const gk=new re({dialogId:"newFilterPresetModal",setup:vF}),Al=document.querySelector("#pageAccount");i(Al).on("click",".pbsTime .showAllButton",()=>{uk("time")});i(Al).on("click",".pbsWords .showAllButton",()=>{uk("words")});i(Al).on("click",".editProfileButton",()=>{if(!B()){m("You must be logged in to edit your profile",0);return}const e=x();if(!e){m("Failed to open edit profile modal: No user snapshot found",-1);return}if(e.banned===!0){m("Banned users cannot edit their profile",0);return}cF()});const wF=D.array(D.string());i(Al).on("click",".group.history .resultEditTagsButton",e=>{const t=i(e.target).attr("data-result-id"),o=i(e.target).attr("data-tags");ek(t??"",kn(o??"[]",wF),"accountPage")});i(Al).find("button.createFilterPresetBtn").on("click",()=>{hF()});const Gu=document.getElementById("pageLeaderboards");for(const e of(Gu==null?void 0:Gu.querySelectorAll(".jumpButtons button[data-action='goToPage']"))??[])e==null||e.addEventListener("click",()=>{Oe("lbGoToPage")});function CF(){if(!di()){m("Could not show forgot password popup: Captcha is not available. This could happen due to a blocked or failed network request. Please refresh the page or contact support if this issue persists.",-1);return}rg.show({mode:"dialog",focusFirstInput:!0,beforeAnimation:async e=>{Ra("forgotPasswordModal"),Bn(e.querySelector(".g-recaptcha"),"forgotPasswordModal",async()=>{await hk()})}})}async function hk(){const e=$l("forgotPasswordModal");if(!e){m("Please complete the captcha");return}const t=rg.getModal().querySelector("input").value.trim();if(!t){m("Please enter your email address"),Ra("forgotPasswordModal");return}if(!Lc.safeParse(t).success){m("Please enter a valid email address"),Ra("forgotPasswordModal");return}J(),E.users.forgotPasswordEmail({body:{email:t,captcha:e}}).then(a=>{if(K(),a.status!==200){m("Failed to send password reset email: "+a.body.message,-1);return}m(a.body.message,1,{duration:5})}),pp()}function pp(){rg.hide()}async function kF(e){var t;(t=e.querySelector("button"))==null||t.addEventListener("click",async()=>{await hk()})}const rg=new re({dialogId:"forgotPasswordModal",setup:kF,customEscapeHandler:async()=>{pp()},customWrapperClickHandler:async()=>{pp()}}),SF=document.querySelector("#pageLogin");i(SF).on("click","#forgotPasswordButton",()=>{CF()});let at;function xF(e){yk.show({mode:"dialog",focusFirstInput:!0,beforeAnimation:async()=>{if(at=e,!di()){m("Could not show google sign up popup: Captcha is not avilable. This could happen due to a blocked or failed network request. Please refresh the page or contact support if this issue persists.",-1);return}Ra("googleSignUpModal"),Bn(i("#googleSignUpModal .captcha")[0],"googleSignUpModal"),$F(),lg()},afterAnimation:async()=>{di()||ol()}})}async function ol(){yk.hide({afterAnimation:async()=>{var e;rb(),at!==void 0&&(m("Sign up process cancelled",0,{duration:5}),Zo(),oa(),(e=vp(at))!=null&&e.isNewUser&&(await E.users.delete(),await(at==null?void 0:at.user.delete().catch(()=>{}))),wi(),at=void 0)}})}async function TF(){var o;if(!at){m("Missing user credential. Please close the popup and try again.",-1);return}const e=$l("googleSignUpModal");if(!e){m("Please complete the captcha",0);return}MF(),lg(),J();const t=i("#googleSignUpModal input").val();try{if(t.length===0)throw new Error("Name cannot be empty");const a=await E.users.create({body:{name:t,captcha:e}});if(a.status!==200)throw new Error(`Failed to create user: ${a.body.message}`);a.status===200&&(await eb(at.user,{displayName:t}),await M1(at.user),m("Account created",1),oa(),Zo(),await fC(at.user),at=void 0,K(),ol())}catch(a){console.log(a);const s=ie(a,"Failed to sign in with Google");m(s,-1),Zo(),oa(),qm(),at&&((o=vp(at))!=null&&o.isNewUser)&&(await E.users.delete(),await(at==null?void 0:at.user.delete().catch(()=>{}))),wi(),at=void 0,ol(),K();return}}function LF(){i("#googleSignUpModal button").prop("disabled",!1)}function lg(){i("#googleSignUpModal button").prop("disabled",!0)}const cg=document.querySelector("#googleSignUpModal input");function $F(){cg.disabled=!1}function MF(){cg.disabled=!0}ia(cg,{schema:Cd,isValid:async e=>(await E.users.getNameAvailability({params:{name:e}})).status===200?!0:"Name not available",debounceDelay:1e3,callback:e=>{e.status==="success"?LF():lg()}});async function AF(e){e.addEventListener("submit",t=>{t.preventDefault(),TF()})}N1((e,t)=>{e!==void 0&&t&&xF(e)});const yk=new re({dialogId:"googleSignUpModal",setup:AF,customEscapeHandler:async()=>{ol()},customWrapperClickHandler:async()=>{ol()}}),bk=console.log,EF=console.warn,_F=console.error,vk=new Bt({key:"debugLogs",schema:D.boolean(),fallback:!1});let sr=vk.get();function IF(){sr=!sr,wk(`Debug logs ${sr?"enabled":"disabled"}`),vk.set(sr)}function wk(...e){bk("%cINFO","background:#4CAF50;color: #111;padding:0 5px;border-radius:10px",...e)}function BF(...e){EF("%cWRN","background:#FFC107;color: #111;padding:0 5px;border-radius:10px",...e)}function qF(...e){_F("%cERR","background:#F44336;color: #111;padding:0 5px;border-radius:10px",...e)}function FF(...e){sr&&bk("%cDEBG","background:#2196F3;color: #111;padding:0 5px;border-radius:10px",...e)}console.log=wk;console.warn=BF;console.error=qF;console.debug=FF;const Ck=new Bt({key:"accountSettingsMessageDismissed",schema:D.boolean(),fallback:!1});Ck.get()&&i(".pageSettings .accountSettingsNotice").remove();i(".pageSettings .accountSettingsNotice .dismissAndGo").on("click",()=>{Ck.set(!0),Ke("/account-settings"),i(".pageSettings .accountSettingsNotice").remove()});let mp=!1;const RF=new RegExp("\\p{P}","u");async function DF(e){function t(u,f){let p=u.shiftKey;const h=mp&&f.length>2?2:0,g=!RF.test(f.slice(h,h+2).join());hn&&g&&(p=!u.shiftKey);const y=f[(p?1:0)+h]??"",b=f[p?1:0]??"",C=f[0];return y||b||C}let o;try{o=await Ns(r.layout)}catch(u){return m(ie(u,"Failed to emulate event"),-1),null}ho().includes("layout_mirror")&&(o=cm(o));let s=[];if(o.type==="ansi"?s=["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","Space"]:o.type==="iso"?s=["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","Backslash","IntlBackslash","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","Space"]:o.type==="matrix"&&(s=["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","Space"]),!s.includes(e.code))return null;const n=o.keys,l=n.row1.concat(n.row2).concat(n.row3).concat(n.row4).concat(n.row5),c=s.indexOf(e.code);if(c===-1)return e.code.includes("Numpad")?e.key:null;const d=t(e,l[c]??[]);return d!==void 0?d:null}function kk(e){const t=e.code==="AltLeft"&&navigator.userAgent.includes("Mac");e.code!=="AltRight"&&!t||(e.type==="keydown"&&(mp=!0),e.type==="keyup"&&(mp=!1))}i(document).on("keydown",kk);i(document).on("keyup",kk);const Sk=["MediaTrackNext","MediaTrackPrevious","MediaPlayPause","AudioVolumeUp","AudioVolumeDown","AudioVolumeMute","Home","End"],WF=["Alt","AltGraph","CapsLock","Control","Fn","FnLock","Hyper","Meta","OS","NumLock","ScrollLock","Scroll","Shift","Super","Symbol","SymbolLock"];let gd=!1,hd=!0,ju=!1,xk,Qu=0,yd=!1;const oy=document.getElementById("wordsInput"),Tk=document.getElementById("koInputVisual");function So(e){e!==oy.value&&(oy.value=e)}function ji(){var t;const e=V(bl());if(isNaN(e)||_L(e),r.keymapMode==="next"&&r.mode!=="zen")if(!r.language.startsWith("korean"))Za(_.getCurrent().charAt(k.current.length));else{const o=nt.disassemble(_.getCurrent(),!0),a=nt.disassemble(k.current,!0),s=a.length-1;if(a[s]){const n=a[s].length;try{const l=o[s][n]??o[a.length][n-o[s].length];Za(l)}catch{Za("")}}else{const n=(t=o==null?void 0:o[0])==null?void 0:t[0];n!==void 0&&Za(n)}}}function Lk(){var c,d;if(!Ee)return;const e=bi(ce-1),t=k.getHistory().length===0,o=e===null,a=e==null?void 0:e.classList.contains("hidden"),s=k.getHistory(ce-1)===_.get(ce-1);if(t||o||a||s&&!r.freedomMode||r.confidenceMode==="on"||r.confidenceMode==="max")return;const n=Po(),l=(c=n==null?void 0:n.children[0])==null?void 0:c.classList.contains("incorrect");if(r.stopOnError==="letter"&&l&&Mo(),k.current=k.popHistory(),Ze.popHistory(),bs("nospace")&&(k.current=k.current.slice(0,-1),So(" "+k.current+" ")),rx(),Gd(!0),jc(_.getCurrent()),Mo(),r.mode==="zen"){hl();const u=((d=document.querySelector("#words"))==null?void 0:d.children)??[];for(let f=u.length-1;f>=0;f--){const p=u[f];if(p.classList.contains("newline")||p.classList.contains("beforeNewline")||p.classList.contains("afterNewline"))p.remove();else break}}Ea(),Vs("backWord")}async function ay(){var d;if(!Ee||k.current===""||Us()&&r.language.startsWith("chinese"))return;const e=_.getCurrent();for(const u of yt("handleSpace"))u.functions.handleSpace();gd=!0;const t=Ov();EL(Math.round(t)),Qb(t);const o=bs("nospace"),a=e===k.current||r.mode==="zen";if(Nw(a,!0),Nb(a),a)r.stopOnError==="letter"&&Mo(),nh(!0,e),k.pushHistory(),$g(),jc(_.getCurrent()),df(),uf(ce),o||Wo(),Vs("submitCorrectWord");else{o||(r.playSoundOnError==="off"||r.blindMode?Wo():Cl()),Kb(_.getCurrent()),Ob();const u=k.current.length;if(u<=_.getCurrent().length&&(u>=Ze.current.length?Ze.current+="_":Ze.current=Ze.current.substring(0,u)+"_"+Ze.current.substring(u+1)),r.stopOnError!=="off"){if(r.difficulty==="expert"||r.difficulty==="master"){yr("difficulty");return}r.stopOnError==="word"&&(gd=!1,Vs("incorrectLetter","_"),Mo(),Ea());return}nh(!1,e),r.blindMode?r.highlightMode!=="off"&&dM(ce):cM(ce),k.pushHistory(),$g(),jc(_.getCurrent()),df(),uf(ce),Vs("submitErrorWord"),(r.difficulty==="expert"||r.difficulty==="master")&&yr("difficulty")}Ze.pushHistory();const s=ce===_.length;if(Sm()&&s){li();return}let n;r.mode==="zen"?n=k.current.length:n=_.getCurrent().length;const l=Xk(r.minBurstCustomSpeed,n);if(r.minBurst==="fixed"&&t<r.minBurstCustomSpeed||r.minBurst==="flex"&&t<l){yr("min burst");return}r.keymapMode==="react"&&wv(" ",!0),(r.mode==="words"||r.mode==="custom"||r.mode==="quote"||r.mode==="zen")&&hl(),s?(yd=!0,J(),await mh(),K(),yd=!1):mh(),Gd();const c=r.mode==="time"||r.mode==="custom"&&Te()==="time"||r.mode==="custom"&&xe()===0;if(!r.showAllLines||c){const u=Math.floor(((d=bi(ce-1))==null?void 0:d.offsetTop)??0),{data:f}=wd(()=>{var p;return Math.floor(((p=Po())==null?void 0:p.offsetTop)??0)});(f??0)>u&&Qp(u)}Ea()}function $k(e,t){if(!hd)return!1;if(r.mode==="zen")return!0;if(k.getKoreanStatus()){const n=nt.disassemble(_.getCurrent())[t];return n===void 0?!1:n===e}const o=_.getCurrent()[t];if(o===void 0)return!1;if(o===e)return!0;const a=Ha("isCharCorrect");return a?a.functions.isCharCorrect(e,o):!!(r.language.startsWith("russian")&&(e==="ё"||e==="е"||e==="e")&&(o==="ё"||o==="е"||o==="e")||(e==="’"||e==="‘"||e==="'"||e==="ʼ"||e==="׳"||e==="ʻ")&&(o==="’"||o==="‘"||o==="'"||o==="ʼ"||o==="׳"||o==="ʻ")||(e==='"'||e==="”"||e==="“"||e==="„")&&(o==='"'||o==="”"||o==="“"||o==="„")||(e==="–"||e==="—"||e==="-")&&(o==="-"||o==="–"||o==="—"))}async function Ht(e,t,o){if(ti||de)return;if(e==="…"&&_.getCurrent()[t]!=="…"){for(let b=0;b<3;b++)await Ht(".",t+b);return}if(e==="œ"&&_.getCurrent()[t]!=="œ"){await Ht("o",t),await Ht("e",t+1);return}if(e==="æ"&&_.getCurrent()[t]!=="æ"){await Ht("a",t),await Ht("e",t+1);return}console.debug("Handling char",e,t,o);const a=performance.now(),s=k.getKoreanStatus();for(const b of yt("handleChar"))e=b.functions.handleChar(e);const n=bs("nospace");if(e!==`
`&&e!=="	"&&/\s/.test(e)){if(n)return;if(ay(),r.difficulty!=="normal"||r.strictSpace&&r.mode!=="zen"||r.stopOnError==="word"&&t>0){if(gd){gd=!1;return}}else return}if(r.mode!=="zen"&&_.getCurrent()[t]!==`
`&&e===`
`||!Ee&&!SE(a))return;Do(!0),Yb();const l=$k(e,t);let c;if(l&&r.mode!=="zen"&&(e=s?nt.disassemble(_.getCurrent())[t]??"":_.getCurrent().charAt(t)),!l&&e===`
`){if(k.current==="")return;e=" "}if(k.current===""&&gL(a),s||r.language.startsWith("korean")?(c=(o??"").slice(1),Tk.innerText=c.slice(-1)):r.language.startsWith("chinese")?c=(o??"").slice(1):c=k.current.substring(0,t)+e+k.current.substring(t+1),!l&&Us()&&!r.language.startsWith("korean")){k.current=c,Mo(),Ea();return}if(Nw(l),Nb(l),l||(Ob(),Kb(_.getCurrent())),W$(r.mode==="zen"?e:_.getCurrent()[t]??"",l),l||r.playSoundOnError==="off"||r.blindMode?Wo():Cl(),r.keymapMode==="react"&&wv(e,l),r.difficulty!=="master")if(hd)Qu=0;else{Qu++,Qu>=5&&m("Opposite shift mode is on.",0,{important:!0,customTitle:"Reminder"});return}if(Ze.current==="")Ze.current+=s?nt.disassemble(c).join(""):c;else{const b=s?nt.disassemble(Ze.current).length:Ze.current.length;t>=b?Ze.current+=s?nt.disassemble(e).concat().join(""):e:l||(Ze.current=Ze.current.substring(0,t)+e+Ze.current.substring(t+1))}if(df(),uf(ce),r.difficulty!=="master"&&r.stopOnError==="letter"&&!l){r.blindMode||Mo(k.current+e);return}Vs(l?"correctLetter":"incorrectLetter",e);const d=Po();if((s?nt.disassemble(k.current).length:k.current.length)===1&&ce===0&&(d==null||d.offsetTop,void 0),r.mode==="zen"&&t<30||r.mode!=="zen"&&c.length<_.getCurrent().length+20?k.current=c:console.error("Hitting word limit"),!l&&r.difficulty==="master"){yr("difficulty");return}if(r.mode!=="zen"){const b=_.getCurrent(),L=ce===_.length-1,S=Sm(),q=b===k.current,P=r.quickEnd&&!r.language.startsWith("korean")&&b.length===k.current.length&&r.stopOnError==="off",$=r.language.startsWith("chinese");if(L&&S&&(q||P)&&(!$||o!==void 0&&t+2===o.length)){li();return}}const f=d==null?void 0:d.offsetTop;await Mo();const p=d==null?void 0:d.offsetTop;f<p&&!vf&&(r.mode==="zen"||r.indicateTypos==="replace"?r.showAllLines||Qp(f):(k.current=k.current.slice(0,-1),await Mo())),(n&&k.current.length===_.getCurrent().length||e===`
`&&l)&&ay();const h=_.getCurrent(),g=/^\t+/.test(_.getCurrent()),y=h[k.current.length]==="	";setTimeout(()=>{if(l&&r.language.startsWith("code")&&g&&y){const b=new KeyboardEvent("keydown",{key:"Tab",code:"Tab"});document.dispatchEvent(b)}},0),e!==`
`&&Ea()}async function PF(e,t){if(ti){e.preventDefault();return}let o=!1;(r.mode==="zen"&&!e.shiftKey||Mr&&!e.shiftKey)&&(o=!0);const a=Io("commandLineWrapper")||t;if(r.quickRestart==="esc"){if(a||Z()==="login")return;if(e.preventDefault(),!de&&o){await Ht("	",k.current.length),So(" "+k.current);return}}else if(r.quickRestart==="tab"){if(a||Z()==="login")return;if(Z()!=="test"){await Ke("/");return}if(e.shiftKey?ee():zr(),!de&&o){e.preventDefault(),await Ht("	",k.current.length),So(" "+k.current);return}z({event:e})}else{if(a||Z()!=="test"||de)return;if(o){e.preventDefault(),await Ht("	",k.current.length),So(" "+k.current);return}setTimeout(()=>{var s;((s=document.activeElement)==null?void 0:s.id)!=="wordsInput"&&Do(!1)},0)}}i("#wordsInput").on("keydown",e=>{const t=Z()==="test",o=Io("commandLineWrapper"),a=vd();t&&!o&&!a&&!de&&e.key!=="Enter"&&!yd&&fb||e.preventDefault()});let Yu=-1;i(document).on("keydown",async e=>{var l;if(Qs()){console.debug("Ignoring keydown during page transition.");return}if(Sk.includes(e.key)){console.debug(`Key ${e.key} is on the list of ignored keys. Stopping keydown event.`),e.preventDefault();return}for(const c of yt("handleKeydown"))c.functions.handleKeydown(e);const t=i("#wordsInput").is(":focus"),o=Z()==="test",a=Io("commandLineWrapper"),s=vd(),n=o&&!a&&!s&&!de&&(t||e.key!=="Enter")&&!yd;if(n&&!t&&!["Enter"," ","Escape","Tab",...WF].includes(e.key)&&(oi(),r.showOutOfFocusWarning&&!e.ctrlKey&&!e.metaKey&&e.preventDefault()),e.key==="Tab"&&await PF(e,s),e.key==="Escape"&&r.quickRestart==="esc"){if(Io("commandLineWrapper")||s)return;if(Z()!=="test"){await Ke("/");return}e.shiftKey?ee():zr(),z({event:e})}if(e.key==="Enter"&&r.quickRestart==="enter"){const c=document.activeElement;if((c==null?void 0:c.tagName)==="BUTTON"||(c==null?void 0:c.tagName)==="A"||(c==null?void 0:c.classList.contains("button"))||(c==null?void 0:c.classList.contains("textButton"))||(c==null?void 0:c.tagName)==="INPUT"&&(c==null?void 0:c.id)!=="wordsInput"||Io("commandLineWrapper")||s)return;if(Z()!=="test"){await Ke("/");return}if(de){z({event:e});return}r.mode==="zen"||(!Ar&&!r.funbox.includes("58008")||(Ar||r.funbox.includes("58008"))&&e.shiftKey)&&(e.shiftKey?ee():zr(),z({event:e}))}if(n){if(!((l=e.originalEvent)!=null&&l.isTrusted)||Ot){e.preventDefault();return}if(Hb(),e.key==="Backspace"){if(Wo(),/INPUT|SELECT|TEXTAREA/i.test(e.target.tagName)||e.preventDefault(),r.confidenceMode==="max"){e.preventDefault();return}r.codeUnindentOnBackspace&&k.current.length>0&&/^\t*$/.test(k.current)&&r.language.startsWith("code")&&$k(k.current.slice(-1),k.current.length-1)&&(k.getHistory(ce-1)!==_.get(ce-1)||r.freedomMode)&&(k.current="",await Mo())}if(e.key==="Backspace"&&k.current.length===0&&(Lk(),k.current&&So(" "+k.current+" ")),e.key==="Enter")if(e.shiftKey)if(r.mode==="zen")li();else if(au(r.mode,r.words,r.time,Ia(),ta()??!1))await Ht(`
`,k.current.length),So(" "+k.current),ji();else{const c=Date.now()-Yu;Yu===-1||c>200?(Yu=Date.now(),c>=5e3&&m("Please double tap shift+enter to confirm bail out",0,{important:!0,duration:5})):(xp(!0),li())}else await Ht(`
`,k.current.length),So(" "+k.current),ji();if(e.key==="Dead"&&!Us()){Wo();const c=Po(),d=k.current.length,u=c==null?void 0:c.querySelectorAll("letter")[d];u&&u.classList.toggle("dead")}if(r.oppositeShiftMode!=="off")if(r.oppositeShiftMode==="keymap"&&r.keymapLayout!=="overrideSync"){let c=await Ns(r.keymapLayout).catch(()=>{});if(c===void 0){m("Failed to load keymap layout",-1);return}ho().includes("layout_mirror")&&(c=cm(c));const u=Uv(e.key,c);hd=u===void 0?!0:Tf(u)}else hd=Tf(e.code);for(const c of yt("preventDefaultEvent"))await c.functions.preventDefaultEvent(e)&&(e.preventDefault(),await Ht(e.key,k.current.length),ji(),So(" "+k.current));if(r.layout!=="default"&&!(e.ctrlKey||e.altKey&&Yk())){const c=await DF(e);c!==null&&(e.preventDefault(),await Ht(c,k.current.length),ji(),So(" "+k.current))}xk=e.key==="Backspace"||e.key==="delete"}});i("#wordsInput").on("keydown",e=>{var o;if((o=e.originalEvent)!=null&&o.repeat){console.log("spacing debug keydown STOPPED - repeat",e.key,e.code,e.which);return}nA(e),e.code==="NumpadEnter"&&r.funbox.includes("58008")&&(e.code="Space"),e.code.includes("Arrow")&&r.funbox.includes("arrows")&&(e.code="NoCode");const t=performance.now();setTimeout(()=>{const a=e.code===""||e.key==="Unidentified"?"NoCode":e.code;yL(t,a)},0)});i("#wordsInput").on("keyup",e=>{var o;if((o=e.originalEvent)!=null&&o.repeat){console.log("spacing debug keydown STOPPED - repeat",e.key,e.code,e.which);return}e.code==="NumpadEnter"&&r.funbox.includes("58008")&&(e.code="Space"),e.code.includes("Arrow")&&r.funbox.includes("arrows")&&(e.code="NoCode");const t=performance.now();setTimeout(()=>{const a=e.code===""||e.key==="Unidentified"?"NoCode":e.code;Ub(t,a)},0)});i("#wordsInput").on("keyup",e=>{var t;if(!((t=e.originalEvent)!=null&&t.isTrusted)||Ot){e.preventDefault();return}rA(e),Sk.includes(e.key)});i("#wordsInput").on("beforeinput",e=>{var t;(t=e.originalEvent)!=null&&t.isTrusted&&e.target.value===""&&(e.target.value=" ")});i("#wordsInput").on("input",async e=>{var d;if(!((d=e.originalEvent)!=null&&d.isTrusted)||Ot){e.target.value=" ";return}if(vd()){e.preventDefault();return}Hb(),(r.layout==="default"||r.layout==="korean")&&e.target.value.normalize().match(/[\uac00-\ud7af]|[\u1100-\u11ff]|[\u3130-\u318f]|[\ua960-\ua97f]|[\ud7b0-\ud7ff]/g)&&k.setKoreanStatus(!0);const o=k.getKoreanStatus(),a=r.language.startsWith("chinese"),s=e.target.value.normalize(),n=o?nt.disassemble(s).join("").slice(1):s.slice(1),l=o?nt.disassemble(k.current).join(""):k.current;if(o&&!xk&&(ju||s.slice(1).length<k.current.length&&nt.disassemble(k.current.slice(-1)).length>1)){ju=!ju;return}if(r.layout!=="default"&&n.length>=l.length){So(" "+l),ji();return}if(s.length===0&&l.length===0)Lk();else if(n.length<l.length){if(a)if(l.length-n.length<=2&&l.startsWith(l))k.current=n;else{let u=0;for(;n[u]===l[u];)u++;let f=0;r.stopOnError!=="word"&&/.+ .+/.test(n)&&(f=n.indexOf(" ")+1);for(let p=u;p<n.length;p++)await Ht(n[p],p-f,s)}else if(o){const u=e.target.value.normalize().slice(1);k.current=u,Tk.innerText=u.slice(-1)}else k.current=n;Mo(),Ea(),Us()||((e==null?void 0:e.originalEvent).inputType==="deleteWordBackward"?Vs("setLetterIndex",0):Vs("setLetterIndex",l.length-1))}if(n!==l){let u=0;for(;n[u]===l[u];)u++;let f=0;r.stopOnError!=="word"&&/.+ .+/.test(n)&&(f=n.indexOf(" ")+1);for(let p=u;p<n.length;p++)await Ht(n[p],p-f,s)}So(" "+k.current),ji();const c=Us();setTimeout(()=>{const u=Us();c!==u&&Mo(),e.target.selectionStart!==e.target.value.length&&(!Ga.test(e.target.value)||(e.target.selectionStart??0)<e.target.value.search(Ga))&&(e.target.selectionStart=e.target.selectionEnd=e.target.value.length)},0)});var Fy;(Fy=document.querySelector("#wordsInput"))==null||Fy.addEventListener("focus",e=>{const t=e.target,o=t.value;t.setSelectionRange(o.length,o.length)});i("#wordsInput").on("copy paste",e=>{e.preventDefault()});i("#wordsInput").on("select selectstart",e=>{e.preventDefault()});i("#wordsInput").on("selectionchange",e=>{const t=e.target,o=t.value,a=t.selectionStart!==t.selectionEnd,s=t.selectionStart===o.length;(a||!s)&&t.setSelectionRange(o.length,o.length)});i("#wordsInput").on("keydown",e=>{e.key.startsWith("Arrow")&&e.preventDefault()});i("#wordsInput").on("compositionstart",()=>{r.layout==="default"&&(Hp(!0),t$(k.current.length))});i("#wordsInput").on("compositionend",()=>{r.layout==="default"&&Hp(!1)});const sy=new Bt({key:"merchBannerClosed3",schema:D.boolean(),fallback:!1});function zF(){sy.get()||z1('New merch store now open, including a limited edition metal keycap! <a target="_blank" rel="noopener" href="https://mktp.co/merch">monkeytype.store</a>',1,"./images/merch3.png",!1,()=>{sy.set(!0)},!0)}i(async()=>{await Pb,await V1,i("body").css("transition","background .25s, transform .05s"),zF();for(const e of yt("applyGlobalCSS"))e.functions.applyGlobalCSS();i("#app").css("opacity","0").removeClass("hidden").stop(!0,!0).animate({opacity:1},ge(250)),tt()&&g_().then(()=>{var e;(e=In())!=null&&e.users.signUp||(Yx(),i(".register").addClass("hidden"),i(".login").addClass("hidden"),i(".disabledNotification").removeClass("hidden"))}),O2(),new i1("https://keymash.io/"),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(e=>{console.log("ServiceWorker registration successful with scope: ",e.scope)}).catch(e=>{console.error("ServiceWorker registration failed: ",e)})})});i("#nocss .requestedStylesheets").html("Requested stylesheets:<br>"+[...document.querySelectorAll("link[rel=stylesheet")].map(e=>e.href).filter(e=>/\/css\/style/gi.test(e)).join("<br>"));i("#nocss .requestedJs").html("Requested Javascript files:<br>"+[...document.querySelectorAll("script")].map(e=>e.src).filter(e=>/(\/js\/mon|\/js\/vendor)/gi.test(e)).join("<br>")+"<br><br>Client version:<br>"+Sn.clientVersion);window.navigator.userAgent.toLowerCase().includes("mac")?i("#nocss .keys").html(`
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
        margin-top: 1rem;
        margin-bottom: 1rem;
      "
    >
      Cmd
    </span>
    +
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
      "
    >
      Shift
    </span>
    +
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
      "
    >
      R
    </span>
  `):i("#nocss .keys").html(`
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
        margin-bottom: 1rem;
      "
    >
      Ctrl
    </span>
    +
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
      "
    >
      Shift
    </span>
    +
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
      "
    >
      R
    </span>
  `);let as;async function Mk(e=r.language){if(!as)return;const o=(await $n(e)).bcp47??"en-US";as.lang=o}async function Ak(){as=new SpeechSynthesisUtterance,await Mk()}function HF(){as=void 0}async function OF(e){window.speechSynthesis.cancel(),as===void 0&&await Ak(),as!==void 0&&(as.text=e,window.speechSynthesis.speak(as))}be((e,t)=>{e==="funbox"&&(t==="none"?HF():t==="tts"&&Ak()),e==="language"&&r.funbox.includes("tts")&&Mk()});y$(e=>{OF(e)});const Un=new xm(i(".page.pageProfileSearch .search input"),{notFound:{icon:"fa-user-slash",level:-1},error:{icon:"fa-times",level:-1},checking:{icon:"fa-circle-notch",spinIcon:!0,level:1}});function NF(){i(".page.pageProfileSearch .search button").addClass("disabled"),i(".page.pageProfileSearch .search input").attr("disabled","disabled")}function UF(){i(".page.pageProfileSearch .search button").removeClass("disabled"),i(".page.pageProfileSearch .search input").removeAttr("disabled")}function VF(){return i(".page.pageProfileSearch .search input").attr("disabled")!==void 0}function iy(){i(".page.pageProfileSearch .search input").trigger("focus")}async function KF(){Un.hide();const e=i(".page.pageProfileSearch .search input").val();if(e==="")return;Un.show("checking"),NF(),await Le(500);const t=await E.users.getProfile({params:{uidOrName:e}});if(UF(),t.status===404){iy(),Un.show("notFound","User not found");return}else if(t.status!==200){iy(),Un.show("error",`Error: ${t.body.message}`);return}Un.hide(),await Ke(`/profile/${e}`,{data:t.body.data})}i(".page.pageProfileSearch form").on("submit",e=>{e.preventDefault(),!VF()&&KF()});Xt("pageProfileSearch");const Ek=new Bt({key:"lastSeenVersion",schema:D.string(),fallback:""});let gp=null,bd=null;function GF(e){Ek.set(e)}function jF(){return Ek.get()}async function QF(){const{data:e,error:t}=await Qt(YL());if(t){const a=ie(t,"Failed to fetch version number from GitHub");console.error(a);return}const o=jF();gp=e,bd=o===""?!1:o!==e,(bd||o==="")&&(GF(e),YF())}function YF(){"caches"in window&&caches.keys().then(function(e){for(const t of e)caches.delete(t)})}async function XF(){return(gp===null||bd===null)&&await QF(),{version:gp,isNew:bd}}function ZF(e){i("footer .currentVersion .text").text(e)}function JF(e){e?i("#newVersionIndicator").removeClass("hidden"):i("#newVersionIndicator").addClass("hidden")}async function eR(){const{version:e,isNew:t}=await XF();ZF(e),JF(t)}Xt("devOptionsModal");let po=[],_k=0,Qo=[],Aa=[];const ls={notifications:[],psas:[]};function Xu(){hp(!1),Ex(0),Bk.hide({afterAnimation:async()=>{var l;i("#alertsPopup .notificationHistory .list").empty(),i("#alertsPopup .psas .list").empty();const e=[];let t=0;if(Qo.length===0&&Aa.length===0)return;const o=await E.users.updateInbox({body:{mailIdsToMarkRead:Qo.length>0?Qo:void 0,mailIdsToDelete:Aa.length>0?Aa:void 0}}),a=o.status,s=o.body.message;if(a!==200){m(`Failed to update inbox: ${s}`,-1);return}const n=po.filter(c=>c.rewards.length>0&&Qo.includes(c.id)).map(c=>c.rewards).reduce(function(c,d){return c.concat(d)},[]);for(const c of n)if(c.type==="xp")t+=c.item;else if(c.type==="badge"){const d=u_(c.item.id);d&&(e.push(d.name),_x(c.item))}if(e.length>0&&m(`New badge${e.length>1?"s":""} unlocked: ${e.join(", ")}`,1,{duration:5,customTitle:"Reward",customIcon:"gift"}),t>0){const c=((l=x())==null?void 0:l.xp)??0;$b(c,t);const d=Z();(d==="account"||d==="profile")&&w0(d,c+t,!0),Ax(t)}}})}async function tR(){Bk.show({beforeAnimation:async()=>{B()?(i("#alertsPopup .accountAlerts").removeClass("hidden"),i("#alertsPopup .separator.accountSeparator").removeClass("hidden"),i("#alertsPopup .accountAlerts .list").html(`
          <div class="preloader"><i class="fas fa-fw fa-spin fa-circle-notch"></i></div>`)):(i("#alertsPopup .accountAlerts").addClass("hidden"),i("#alertsPopup .separator.accountSeparator").addClass("hidden")),po=[],Aa=[],Qo=[],iR(),sR()},afterAnimation:async()=>{B()&&oR()}})}async function oR(){if(!tt()){i("#alertsPopup .accountAlerts .list").html(`
    <div class="nothing">
    You are offline
    </div>
    `);return}const e=await E.users.getInbox();if(e.status===503){i("#alertsPopup .accountAlerts .list").html(`
    <div class="nothing">
    Account inboxes are temporarily unavailable
    </div>
    `);return}else if(e.status!==200){i("#alertsPopup .accountAlerts .list").html(`
    <div class="nothing">
    Error getting inbox: ${e.body.message} Please try again later
    </div>
    `);return}const t=e.body.data;if(po=t.inbox,dg(),po.length===0){i("#alertsPopup .accountAlerts .list").html(`
    <div class="nothing">
    Nothing to show
    </div>
    `);return}_k=t.maxMail,Ik(),i("#alertsPopup .accountAlerts .list").empty();for(const o of po){!o.read&&o.rewards.length===0&&Qo.push(o.id);let a="";o.rewards.length>0&&!o.read&&(a=`<div class="rewards">
        <i class="fas fa-fw fa-gift"></i>
        <span>${o.rewards.length}</span>
      </div>`),i("#alertsPopup .accountAlerts .list").append(`
    
      <div class="item" data-id="${o.id}">
        <div class="indicator ${o.read?"":"main"}"></div>
        <div class="timestamp">${Qy(new Date(o.timestamp))} ago</div>
        <div class="title">${o.subject}</div>
        <div class="body">
          ${o.body}

${a}
        </div>
        <div class="buttons">
          ${o.rewards.length>0&&!o.read?'<button class="markReadAlert textButton" aria-label="Claim" data-balloon-pos="left"><i class="fas fa-gift"></i></button>':""}
          ${o.rewards.length>0&&o.read||o.rewards.length===0?'<button class="deleteAlert textButton" aria-label="Delete" data-balloon-pos="left"><i class="fas fa-trash"></i></button>':""}
        </div>
      </div>
    
    `)}}function aR(e,t){ls.psas.push({message:e,level:t})}function sR(){if(ls.psas.length===0)i("#alertsPopup .psas .list").html('<div class="nothing">Nothing to show</div>');else{i("#alertsPopup .psas .list").empty();for(const e of ls.psas){const{message:t,level:o}=e;let a="";o===-1?a="error":o===1?a="main":o===0&&(a="sub"),i("#alertsPopup .psas .list").prepend(`
        <div class="item">
        <div class="indicator ${a}"></div>
        <div class="body">
          ${ft(t)}
        </div>
      </div>
      `)}}}function iR(){if(ls.notifications.length===0)i("#alertsPopup .notificationHistory .list").html('<div class="nothing">Nothing to show</div>');else{i("#alertsPopup .notificationHistory .list").empty();for(const e of ls.notifications){const{message:t,level:o,customTitle:a}=e;let s="Notice",n="sub";o===-1?(n="error",s="Error"):o===1&&(n="main",s="Success"),a!==void 0&&(s=a),i("#alertsPopup .notificationHistory .list").prepend(`
      <div class="item">
      <div class="indicator ${n}"></div>
      <div class="title">${s}</div>
      <div class="body">
        ${ft(t)}
      </div>
    </div>
    `)}}}function hp(e){e?i("header nav .showAlerts .notificationBubble").removeClass("hidden"):i("header nav .showAlerts .notificationBubble").addClass("hidden")}function Ik(){const e=po.length-Aa.length;i("#alertsPopup .accountAlerts .title .right").text(`${e}/${_k}`)}function ny(e){Aa.push(e),i(`#alertsPopup .accountAlerts .list .item[data-id="${e}"]`).remove(),i("#alertsPopup .accountAlerts .list .item").length===0&&i("#alertsPopup .accountAlerts .list").html(`
    <div class="nothing">
    Nothing to show
    </div>
    `),dg(),Ik()}function ry(e){Qo.push(e);const t=i(`#alertsPopup .accountAlerts .list .item[data-id="${e}"]`);dg(),t.find(".indicator").removeClass("main"),t.find(".buttons").empty(),t.find(".buttons").append('<button class="deleteAlert textButton" aria-label="Delete" data-balloon-pos="left"><i class="fas fa-trash"></i></button>'),t.find(".rewards").animate({opacity:0,height:0,marginTop:0},250,"easeOutCubic",()=>{t.find(".rewards").remove()})}function dg(){const e=i("#alertsPopup .accountAlerts .claimAll"),t=i("#alertsPopup .accountAlerts .deleteAll");if(e.addClass("hidden"),t.addClass("hidden"),po.length>0){let o=0;for(const a of po)!a.read&&!Qo.includes(a.id)&&(o+=a.rewards.length);o>0?e.removeClass("hidden"):t.removeClass("hidden")}Aa.length===po.length&&t.addClass("hidden")}i("header nav .showAlerts").on("click",()=>{tR()});R1((e,t,o)=>{ls.notifications.push({message:e,level:t,customTitle:o}),ls.notifications.length>25&&ls.notifications.shift()});sa(e=>{if(e.type==="snapshotUpdated"&&e.data.isInitial){const t=x();hp(((t==null?void 0:t.inboxUnreadSize)??0)>0)}e.type==="authStateChanged"&&!e.data.isUserSignedIn&&(hp(!1),po=[],Qo=[],Aa=[],i("#alertsPopup .accountAlerts .list").empty())});const Bk=new re({dialogId:"alertsPopup",customAnimations:{show:{modal:{from:{marginRight:"-10rem"},to:{marginRight:"0"},easing:"easeOutCirc"}},hide:{modal:{from:{marginRight:"0"},to:{marginRight:"-10rem"},easing:"easeInCirc"}}},customEscapeHandler:()=>{Xu()},customWrapperClickHandler:()=>{Xu()},setup:async()=>{i("#alertsPopup .accountAlerts").on("click",".claimAll",()=>{for(const e of po)!e.read&&!Qo.includes(e.id)&&ry(e.id)}),i("#alertsPopup .accountAlerts").on("click",".deleteAll",()=>{for(const e of po)Aa.includes(e.id)||ny(e.id)}),i("#alertsPopup .mobileClose").on("click",()=>{Xu()}),i("#alertsPopup .accountAlerts .list").on("click",".item .buttons .deleteAlert",e=>{const t=i(e.currentTarget).closest(".item").attr("data-id");ny(t)}),i("#alertsPopup .accountAlerts .list").on("click",".item .buttons .markReadAlert",e=>{const t=i(e.currentTarget).closest(".item").attr("data-id");ry(t)})}}),ug=new Bt({key:"confirmedPSAs",schema:D.array(Uy),fallback:[]});function nR(){ug.set([])}function qk(){return ug.get()}function rR(e){const t=qk();t.push(e),ug.set(t)}async function lR(){const e=await E.psas.get();if(e.status===500){{const{data:t,error:o}=await Qt(fetch("https://monkeytype.instatus.com/summary.json"));let a;o?console.log("Failed to fetch Instatus summary",o):a=(await t.json()).activeMaintenances,a!==void 0&&a.length>0&&a[0]!==void 0&&a[0].status==="INPROGRESS"?Hs(`Server is currently offline for scheduled maintenance. <a target= '_blank' href='${a[0].url}'>Check the status page</a> for more info.`,-1,"bullhorn",!0,void 0,!0):Hs("Looks like the server is experiencing unexpected down time.<br>Check the <a target= '_blank' href='https://monkeytype.instatus.com/'>status page</a> for more information.",-1,"exclamation-triangle",!1,void 0,!0)}return null}else{if(e.status===503)return Hs("Server is currently under maintenance. <a target= '_blank' href='https://monkeytype.instatus.com/'>Check the status page</a> for more info.",-1,"bullhorn",!0,void 0,!0),null;if(e.status!==200)return null}return e.body.data}async function cR(){const e=await lR();if(e===null)return;if(e.length===0){nR();return}const t=qk();e.forEach(o=>{if(Ce(o.date)){const a=new Date(o.date),s=o.date-Date.now(),n=rt(s/1e3,!1,!1,"text",!1,!0);o.message=o.message.replace("{dateDifference}",n),o.message=o.message.replace("{dateNoTime}",te(a,"dd MMM yyyy")),o.message=o.message.replace("{date}",te(a,"dd MMM yyyy HH:mm"))}aR(o.message,o.level??-1),!(t.includes(o._id)&&!(o.sticky??!1))&&Hs(o.message,o.level,"bullhorn",o.sticky,()=>{rR(o._id)},!0)})}sa(e=>{e.type==="authStateChanged"&&cR()});async function dR(e){if(!e)return;const t=new URLSearchParams(e.slice(1));if(t.has("access_token")){history.replaceState(null,"","/");const o=t.get("access_token"),a=t.get("token_type"),s=t.get("state");J();const n=await E.users.linkDiscord({body:{tokenType:a,accessToken:o,state:s}});if(K(),n.status!==200){m("Failed to link Discord: "+n.body.message,-1);return}if(n.body.data===null){m("Failed to link Discord: data returned was null",-1);return}m(n.body.message,1);const l=x();if(!l)return;const{discordId:c,discordAvatar:d}=n.body.data;c!==void 0&&(l.discordId=c),d!==void 0&&(l.discordAvatar=d),kt(l),sf(l)}}const uR=D.object({c:vS,i:D.string().optional(),s:bS.optional(),f:yS.optional()});function fR(e){const t=yp("customTheme",e);if(t===null)return;const{data:o,error:a}=wd(()=>kn(atob(t),uR));if(a){console.log("Custom theme URL decoding failed",a),m("Failed to load theme from URL: "+a.message,0);return}let s,n,l,c;if(Array.isArray(o.c)&&o.c.length===10?(s=o.c,n=o.i,l=o.s,c=o.f):Array.isArray(o)&&o.length===10&&(s=o),s===void 0||s.length!==10){m("Failed to load theme from URL: no colors found",0);return}const d=r.customTheme,u=r.customThemeColors;try{dn(s),m("Custom theme applied",1),n!==void 0&&l!==void 0&&c!==void 0&&(aL(n),Db(l),Oi(c)),r.customTheme||xa(!0)}catch(f){m("Something went wrong. Reverting to previous state.",0),console.error(f),xa(d),dn(u)}}const pR=D.tuple([Ky.nullable(),wS.nullable(),ev.partial({pipeDelimiter:!0,limit:!0,mode:!0}).extend({isTimeRandom:D.boolean().optional(),isWordRandom:D.boolean().optional(),word:D.number().int().optional(),time:D.number().int().optional(),delimiter:D.string().optional()}).nullable(),D.boolean().nullable(),D.boolean().nullable(),D.string().nullable(),CS.nullable(),Oy.or(D.string().nullable())]);function mR(e){const t=yp("testSettings",e);if(t===null)return;const{data:o,error:a}=wd(()=>kn(Jy.decompressFromURI(t)??"",pR));if(a){console.error("Failed to parse test settings:",a),m("Failed to load test settings from URL: "+a.message,0);return}const s={};o[0]!==null&&(ut(o[0],!0),s.mode=o[0]);const n=o[0]??r.mode;if(o[1]!==null&&(n==="time"?Ca(parseInt(o[1],10),!0):n==="words"?Zs(parseInt(o[1],10),!0):n==="quote"&&(Id([-2],!1),Tp(parseInt(o[1],10)),ee()),s.mode2=o[1]),o[2]!==null){const c=o[2];_a(c.text),pn(c.mode??"repeat"),c.limit!==void 0?($o(c.limit.mode),Ko(c.limit.value)):(c.isWordRandom?$o("word"):c.isTimeRandom&&$o("time"),c.word!==void 0?Ko(c.word):c.time!==void 0&&Ko(c.time)),c.pipeDelimiter?ei(c.pipeDelimiter):c.delimiter==="|"&&ei(!0),s["custom text settings"]=""}if(o[3]!==null&&(cs(o[3],!0),s.punctuation=o[3]?"on":"off"),o[4]!==null&&(Sa(o[4],!0),s.numbers=o[4]?"on":"off"),o[5]!==null&&(un(o[5],!0),s.language=o[5]),o[6]!==null&&(ua(o[6],!0),s.difficulty=o[6]),o[7]!==null){let c=[];typeof o[7]=="string"?c=o[7].split("#"):c=o[7],Xa(c,!0),s.funbox=c.join(", ")}z({nosave:!0});let l="";Object.keys(s).forEach(c=>{const d=s[c];d!==void 0&&(l+=`${c}${ft(d?": "+d:"")}<br>`)}),l!==""&&m("Settings applied from URL:<br><br>"+l,1,{duration:10,allowHTML:!0})}function gR(e){const t=(yp("challenge",e)??"").toLowerCase();t!==""&&(m("Loading challenge",0),kw(t).then(o=>{o&&(m("Challenge loaded",1),z({nosave:!0}))}).catch(o=>{m("Failed to load challenge",-1),console.error(o)}))}sa(e=>{if(e.type==="authStateChanged"){const t=window.location.search,o=window.location.hash;fR(t),mR(t),gR(t),dR(o)}});async function hR(e){const t=ko;if(t===null)return;kE(e);const o=await E.results.add({body:{result:t}});if(o.status!==200){m("Failed to save last result: "+o.body.message,-1);return}const a=structuredClone(t),s={xp:o.body.data.xp,streak:o.body.data.streak,result:a,isPb:o.body.data.isPb};a._id=o.body.data.insertedId,o.body.data.isPb&&(a.isPb=!0),Sb(s),Xw(),m(`Last test result saved ${o.body.data.isPb?"(new pb!)":""}`,1)}function yR(){al.getModal().querySelector(".result").innerHTML=`
  <div class="group wpm">
        <div class="sub">wpm</div>
        <div class="val">-</div>
      </div>
      <div class="group acc">
        <div class="sub">accuracy</div>
        <div class="val">-</div>
      </div>
      <div class="group raw">
        <div class="sub">raw</div>
        <div class="val">-</div>
      </div>
      <div class="group con">
        <div class="sub">consistency</div>
        <div class="val">-</div>
      </div>
      <div class="group chardata">
        <div class="sub">characters</div>
        <div class="val">-</div>
      </div>
      <div class="group testType">
        <div class="sub">test type</div>
        <div class="val">-</div>
      </div>`}function bR(){const e=ko;Ri("wpm",e.wpm),Ri("acc",e.acc+"%"),Ri("raw",e.rawWpm),Ri("con",e.consistency+"%"),Ri("chardata",e.charStats.join("/"));let t=e.mode+" "+e.mode2;t+="<br>"+e.language,e.numbers&&(t+="<br>numbers"),e.punctuation&&(t+="<br>punctuation"),e.blindMode&&(t+="<br>blind"),e.lazyMode&&(t+="<br>lazy"),e.funbox.length>0&&(t+="<br>"+e.funbox.map(o=>o.replace(/_/g," ")).join(",")),e.difficulty!=="normal"&&(t+="<br>"+e.difficulty),e.tags.length>0&&(t+="<br>"+e.tags.length+" tags"),Ri("testType",t,!0)}function Ri(e,t,o=!1){o?i(al.getModal()).find(`.group.${e} .val`).html(`${t}`):i(al.getModal()).find(`.group.${e} .val`).text(t)}function vR(){if(!ko){m("Failed to show last signed out result modal: no last result",-1);return}al.show({beforeAnimation:async()=>{yR(),bR()}})}function ly(){al.hide()}sa(e=>{e.type==="snapshotUpdated"&&e.data.isInitial&&ko!==null&&vR()});const al=new re({dialogId:"lastSignedOutResult",setup:async e=>{var t,o;(t=e.querySelector("button.save"))==null||t.addEventListener("click",async()=>{const a=go();a!==null&&hR(a.uid),ly()}),(o=e.querySelector("button.discard"))==null||o.addEventListener("click",()=>{Xw(),m("Last test result discarded",0),ly()})},customWrapperClickHandler:()=>{}});Object.defineProperty(Math,"random",{value:Math.random,writable:!1,configurable:!1,enumerable:!0});Object.freeze(Math);Object.defineProperty(window,"Math",{value:Math,writable:!1,configurable:!1,enumerable:!0});function wR(e){for(const[t,o]of Object.entries(e))window[t]=o}rL();eR();Do(!0,!0);G1(pC);const CR=tg();CR===null?ck():lk();wR({snapshot:x,config:r,toggleFilterDebug:k_,glarsesMode:u2,stats:zv,replay:AA,enableTimerDebug:mA,getTimerStats:xA,toggleSmoothedBurst:w2,egVideoListener:KB,toggleDebugLogs:IF,toggleSentryDebug:Rx});
//# sourceMappingURL=monkeytype.Dxnd5jK-.js.map
